function pageReady(){$(".ms2").select2();$("#startTime").val(getDate()).datepicker("update");$("#endTime").val(getDate()).datepicker("update");getPlan();getGroup();getState();$("#groupSelect").on("select2:select",function(){getProcessor()});$("#taskTable").css("maxHeight",innerHeight*.7)}function getPlan(){var t=1025,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#planSelect").empty();var r=n.datas,u="<option value=0 task=0>所有计划<\/option>";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}" task="{2}">{1}<\/option>'.format(i.Id,i.Plan,i.TaskId);$("#planSelect").append(u)})}function getGroup(){var t=1077,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#groupSelect").empty();var r=n.datas,u="<option value=0>所有分组<\/option>";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.Group);$("#groupSelect").append(u);getProcessor()})}function getProcessor(){var i=1081,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}(t=$("#groupSelect").val(),isStrEmptyOrUndefined(t))||(n={},n.opType=i,n.opData=JSON.stringify({groupId:t,menu:!0}),ajaxPost("/Relay/Post",n,function(n){var i,r,e,u,t,f;if(n.errno!=0){layer.msg(n.errmsg);return}if($("#processorSelect").empty(),i=n.datas,r=i.length,r){for(e='<option value="{0}">{1}<\/option>',u="<option value=0>所有人<\/option>",t=0;t<r;t++)f=i[t],u+=e.format(f.ProcessorId,f.Processor);$("#processorSelect").append(u)}}))}function getState(){var t=1024,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#stateSelect").empty();var r=n.datas,u="<option value=0>所有进度<\/option>";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.State);$("#stateSelect").append(u)})}function showLogModel(){var i=1088,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}if(t=$("#planSelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择计划号");return}$("#planName").text($("#planSelect option:selected").text());n={};n.opType=i;n.opData=JSON.stringify({planId:t});ajaxPost("/Relay/Post",n,function(n){var r,u,t,o,i;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#planTaskLog").empty(),r=n.datas,u="",t=0,o=r.length;t<o;t++){var f=r[t],s=f.Items.length,e="";if(s)for(i=0;i<s;i++)e+=`<li>${f.Items[i]}</li>`;u+=`<div class="box box-solid noShadow collapsed-box" style="margin-bottom: 0;">
            <div class="box-header no-padding">
                <span><font style="font-weight:bold">${t+1}</font>.${f.Log}</span>
                <button type="button" style="padding:0;border:1px solid;width:18px;background:#E5E5E5" class="btn btn-box-tool ${e==""?"hidden":""}" data-widget="collapse"><i class="on_i fa fa-plus"></i></button>
            </div>
            <div class="box-body no-padding">
                <ul class="on_ul nav nav-pills nav-stacked mli" style="text-indent: 2em">${e}</ul>
            </div>
        </div>`}$("#planTaskLog").append(u);$("#showLogModal").modal("show")})}function getTaskList(){var e=1026,u,f,n,t,i,r;if(!checkPermission(e)){layer.msg("没有权限");return}if(u=$("#planSelect").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择计划号");return}if(f=$("#processorSelect").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择操作员");return}if(n=$("#stateSelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择进度");return}if(t=$("#startTime").val(),i=$("#endTime").val(),isStrEmptyOrUndefined(i)||isStrEmptyOrUndefined(t)){layer.msg("请选择实际开始时间");return}comTimeDay(t,i)||(r={},r.opType=e,r.opData=JSON.stringify({planId:u,pId:f,state:n,sTime:t,eTime:i}),ajaxPost("/Relay/Post",r,function(t){var u,r,f,e,i,o;if(t.errno!=0){layer.msg(t.errmsg);return}if($("#taskList").empty(),u=t.datas,f=u.length,!f){$("#taskTable").addClass("hidden");layer.msg("无数据");return}for(e="",r=0;r<f;r++)i=u[r],n=i.State,o=`<tr>
                    <td class="num">${r+1}</td>
                    <td>${i.Processor}</td>
                    <td>${i.Plan}</td>
                    <td>${i.StateDesc}</td>
                    <td>${i.Module}</td>
                    <td>${i.Item}</td>
                    <td>${i.TotalOrder}</td>
                    <td>${i.Order}</td>
                    <td>${i.Relation}</td>
                    <td>${n==0&&r!=0?'<button type="button" class="btn btn-primary btn-sm" onclick="">上移<\/button>':""}</td>
                    <td>${i.EstimatedTime}</td>
                    <td>${i.Score}</td>
                    <td>${i.ActualStartTime}</td>
                    <td>${i.ActualTime}</td>
                    <td>${i.ActualScore}</td>
                    <td><button type="button" class="btn btn-info btn-sm" onclick="">详情</button></td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm"><i class="fa fa-plus"></i></button>
                        <button type="button" class="btn btn-danger btn-sm"><i class="fa fa-minus"></i></button>
                        ${n==3?"":n==4?'<button type="button" class="btn btn-primary btn-sm" onclick="">启动<\/button>':'<button type="button" class="btn btn-warning btn-sm" onclick="">停止<\/button>'}
                    </td>
                </tr>`,e+=o;$("#taskList").append(e);$("#taskTable").removeClass("hidden")}))}