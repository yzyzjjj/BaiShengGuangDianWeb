function pageReady(){$(".ms2").select2();$(".table-bordered td").css("border","1px solid");$("#startTime,#endTime").val(getDate()).datepicker("update");window.onload=()=>{$("#startTime,#endTime").removeAttr("readonly")};getPlan();getGroup();getState();$("#groupSelect").on("select2:select",function(){getProcessor()});$("#updateTask").on("click",function(){if(_isClick=!_isClick,_isClick){$("#taskEstimatedTime .textOn").addClass("hidden").siblings(".textIn").removeClass("hidden");$("#taskScore .textOn").addClass("hidden").siblings(".textIn").removeClass("hidden");$("#taskEstimatedTime .hour").val(_taskDetailData.EstimatedHour);$("#taskEstimatedTime .minute").val(_taskDetailData.EstimatedMin);$("#taskScore .score").val(_taskDetailData.Score);var n=$(this).val();n==3&&($("#taskActualTime .textOn").addClass("hidden").siblings(".textIn").removeClass("hidden"),$("#taskActualScore .textOn").addClass("hidden").siblings(".textIn").removeClass("hidden"),$("#taskActualTime .hour").val(_taskDetailData.ActualHour),$("#taskActualTime .minute").val(_taskDetailData.ActualMin),$("#taskActualScore .score").val(_taskDetailData.ActualScore))}else $("#taskDesc").val(_taskDetailData.Desc),$("#taskDetailTable .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden");$("#taskDesc").prop("disabled",!_isClick)});$("#updateCheck").on("click",function(){if(_isClick=!_isClick,_isClick){$("#checkDetailTable .textOn").addClass("hidden").siblings(".textIn").removeClass("hidden");$("#checkEstimatedTime .hour").val(_taskDetailData.EstimatedHour);$("#checkEstimatedTime .minute").val(_taskDetailData.EstimatedMin);$("#checkScore .score").val(_taskDetailData.Score);var n=$(this).val();n==3?($("#checkActualTime .hour").val(_taskDetailData.ActualHour),$("#checkActualTime .minute").val(_taskDetailData.ActualMin),$("#checkActualScore .score").val(_taskDetailData.ActualScore),$("#checkResult").val(_taskDetailData.CheckResult)):($("#checkActualTime .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"),$("#checkActualScore .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"),$("#checkResultDesc .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"))}else $("#checkDesc").val(_taskDetailData.Desc),$("#checkDetailTable .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden");$("#checkDesc").prop("disabled",!_isClick)});$(".minute").on("input",function(){var n=$(this).val();parseInt(n)>59&&$(this).val(59)});$(".toZero").on("focus",function(){var n=$(this).val();n==0&&$(this).val("")});$(".toZero").on("blur",function(){var n=$(this).val();isStrEmptyOrUndefined(n)&&$(this).val("0")});$("#taskList").on("click",".delAddTask",function(){var n=$(this).parents("tr");setNumTotalOrder(n,-1);$("#taskList .addTask").prop("disabled",!1);n.remove()});$("#taskList").on("input",".minute",function(){var n=$(this).val();parseInt(n)>59&&$(this).val(59)});$("#taskList").on("focus",".toZero",function(){var n=$(this).val();n==0&&$(this).val("")});$("#taskList").on("blur",".toZero",function(){var n=$(this).val();isStrEmptyOrUndefined(n)&&$(this).val("0")});$("#taskList").on("select2:select",".group",function(){var n=$(this).val(),t=$(this).parents("tr").find(".processor");setProcessorSelect(n,t)});$("#taskList").on("select2:select",".module",function(){var t=$(this).find("option:selected").attr("isCheck"),n=$(this).parents("tr");parseInt(t)?n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"):n.find(".taskNameSelect").parent().addClass("hidden").siblings().removeClass("hidden")});$("#taskList").on("input",".relation",function(){var t=$(this).val(),i,n;t=parseInt(t);i=$(this).parents("tr");n=i.find(".order").text();n=parseInt(n)-1;t>n&&$(this).val(n)});$("#taskTable").css("maxHeight",innerHeight*.7)}function setProcessorSelect(n,t){var f,u,i,e,r;for(t.empty(),f='<option value = "{0}">{1}<\/option>',u="",i=0,e=_processor.length;i<e;i++)r=_processor[i],n==r.GroupId&&(u+=f.format(r.ProcessorId,r.Processor));t.append(u)}function getPlan(){var t=1025,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#planSelect").empty();var r=n.datas,u='<option value="0" task=0>所有计划<\/option>';for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}" task="{2}">{1}<\/option>'.format(i.Id,i.Plan,i.TaskId);$("#planSelect").append(u)})}function getGroup(n){var i=1077,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}var f=t.datas,r="";for(i=0,e=f.length;i<e;i++)u=f[i],r+='<option value="{0}">{1}<\/option>'.format(u.Id,u.Group);n==null?($("#groupSelect").empty(),$("#groupSelect").append('<option value="0">所有分组<\/option>'),$("#groupSelect").append(r),getProcessor()):n(r)})}function getProcessor(n){var r=1081,i,t;if(!checkPermission(r)){layer.msg("没有权限");return}(i=n==null?$("#groupSelect").val():0,i!=null)&&(t={},t.opType=r,t.opData=JSON.stringify({groupId:i,menu:!0}),ajaxPost("/Relay/Post",t,function(t){var u,e,i,r,f;if(t.errno!=0){layer.msg(t.errmsg);return}if(_processor=t.datas,u=_processor.length,u){for(e='<option value="{0}">{1}<\/option>',i="",r=0;r<u;r++)f=_processor[r],i+=e.format(f.ProcessorId,f.Processor);n==null?($("#processorSelect").empty(),$("#processorSelect").append('<option value="0">所有人<\/option>'),$("#processorSelect").append(i)):n(i)}},0))}function getState(){var t=1024,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#stateSelect").empty();var r=n.datas,u='<option value="-1">所有进度<\/option>';for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.State);$("#stateSelect").append(u)})}function showLogModel(){var i=1088,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}if(t=$("#planSelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择计划号");return}$("#planName").text($("#planSelect option:selected").text());n={};n.opType=i;n.opData=JSON.stringify({planId:t});ajaxPost("/Relay/Post",n,function(n){var r,u,t,o,i;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#planTaskLog").empty(),r=n.datas,u="",t=0,o=r.length;t<o;t++){var f=r[t],s=f.Items.length,e="";if(s)for(i=0;i<s;i++)e+=`<li>${f.Items[i]}</li>`;u+=`<div class="box box-solid noShadow collapsed-box" style="margin-bottom: 0;">
            <div class="box-header no-padding">
                <span><font style="font-weight:bold">${t+1}</font>.${f.Log}</span>
                <button type="button" style="padding:0;border:1px solid;width:18px;background:#E5E5E5" class="btn btn-box-tool ${e==""?"hidden":""}" data-widget="collapse"><i class="on_i fa fa-plus"></i></button>
            </div>
            <div class="box-body no-padding">
                <ul class="on_ul nav nav-pills nav-stacked mli" style="text-indent: 2em">${e}</ul>
            </div>
        </div>`}$("#planTaskLog").append(u);$("#showLogModal").modal("show")})}function getTaskList(){var o=1026,r,u,n,t,f,e,i;if(!checkPermission(o)){layer.msg("没有权限");return}if(_taskData={},r=$("#planSelect").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择计划号");return}if(u=$("#processorSelect").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择操作员");return}if(n=$("#stateSelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择进度");return}t={planId:r,pId:u,state:n};f=$("#startTime").val();isStrEmptyOrUndefined(f)||(t.sTime=`${f} 00:00:00`);e=$("#endTime").val();isStrEmptyOrUndefined(e)||(t.eTime=`${e} 23:59:59`);i={};i.opType=o;i.opData=JSON.stringify(t);ajaxPost("/Relay/Post",i,function(t){var f,r,e,o,i,u,s,h;if(t.errno!=0){layer.msg(t.errmsg);return}if($("#taskList").empty(),f=t.datas,e=f.length,!e){$("#taskTable").addClass("hidden");layer.msg("无数据");return}for(o="",r=0;r<e;r++)i=f[r],n=i.State,u=i.Id,_taskData[u]=i,s=i.TotalOrder,h=`<tr>
                    <td class="num">${r+1}</td>
                    <td>${i.Processor}</td>
                    <td>${i.Plan}</td>
                    <td>${i.StateDesc}</td>
                    <td>${i.Module}</td>
                    <td>${i.Item}</td>
                    <td class="totalOrder">${s}</td>
                    <td>${i.Order}</td>
                    <td>${i.Relation}</td>
                    <td>${n==0&&r!=0?'<button type="button" class="btn btn-primary btn-sm" onclick="upTask({0},{1},{2},{3})">上移<\/button>'.format(s,f[r-1].TotalOrder,u,f[r-1].Id):""}</td>
                    <td>${i.EstimatedTime}</td>
                    <td>${i.Score}</td>
                    <td>${noShowSecond(i.ActualStartTime)}</td>
                    <td>${i.ActualTime}</td>
                    <td>${i.ActualScore}</td>
                    <td><button type="button" class="btn btn-info btn-sm" onclick="showDetailModal(${u})">详情</button></td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm addTask" onclick="addTask.call(this,${u})"><i class="fa fa-plus"></i></button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="delTask(${u},'${i.Item}')"><i class="fa fa-minus"></i></button>
                        ${n==3?"":n==4?'<button type="button" class="btn btn-primary btn-sm" onclick="taskStartStop(1,{0},\'{1}\')">启动<\/button>'.format(u,i.Item):'<button type="button" class="btn btn-warning btn-sm" onclick="taskStartStop(0,{0},\'{1}\')">停止<\/button>'.format(u,i.Item)}
                    </td>
                </tr>`,o+=h;$("#taskList").append(o);$("#taskTable").removeClass("hidden")})}function showDetailModal(n){var i=1027,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({tId:n});ajaxPost("/Relay/Post",t,function(t){var i,u,r,o;if(t.errno!=0){layer.msg(t.errmsg);return}if(_isClick=!1,i=t.datas[0],_taskDetailData=i,_taskDetailId=n,i.IsCheck){$("#checkDesc").prop("disabled",!0);$("#checkDetailTable .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden");u=i.State;$("#updateCheck").val(u);$("#checkName").text(i.Check);$("#checkPlan").text(i.Plan);$("#checkTaskName").text(i.Item);$("#checkTaskProcessor").text(i.Processor);$("#checkRedo").text(i.IsRedo?"已返工":"未返工");$("#checkResultDesc .textOn").text(i.CheckResultDesc);$("#checkProcessor").text(i.CheckProcessor);$("#checkAssignor").text(i.Assignor);$("#checkEstimatedTime .textOn").text(i.EstimatedTime);$("#checkScore .textOn").text(i.Score);$("#checkActualStartTime").text(noShowSecond(i.ActualStartTime));$("#checkActualEndTime").text(noShowSecond(i.ActualEndTime));$("#checkActualTime .textOn").text(i.ActualTime);$("#checkActualScore .textOn").text(i.ActualScore);$("#checkDesc").val(i.Desc);var s=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},h=function(n,t,i,r){return r.row+1},c=function(n){return`<span class="textOn">${n==null?"":n}</span><textarea class="form-control desc textIn hidden" style="resize: vertical;margin:auto;width:200px"></textarea>`},l=function(n){return`<span class="textOn">${n=="0001-01-01 00:00:00"?"":n.slice(0,n.indexOf(" "))}</span><input type="text" class="form_date form-control text-center checkTime textIn hidden" style="width:120px;cursor: pointer">`},a=function(n){var t=n.Result;return'<button type="button" class="btn btn-primary btn-{1} btn-sm result" onclick="updateCheckTask.call(this,{0},1)" disabled>通过<\/button><button type="button" class="btn btn-primary btn-{2} btn-sm result" onclick = "updateCheckTask.call(this,{0},2)" disabled>不通过<\/button>'.format(n.Id,t==1?"success":"info",t==2?"danger":"info")},v=function(n){return`<button type="button" class="btn btn-primary btn-sm" onclick="showImgModel('${n.ImageList}')"}>查看</button>`},f=i.Items,e={};for(r=0,o=f.length;r<o;r++)i=f[r],e[i.Id]=i;$("#checkDetailList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:f,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:"Id",title:"选择",render:s},{data:null,title:"序号",render:h},{data:"Item",title:"检验流程"},{data:"Method",title:"检验方法"},{data:"Desc",title:"检验说明",render:c},{data:"CheckTime",title:"检验时间",render:l},{data:null,title:"检验结果",render:a},{data:null,title:"图片",render:v}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});u!=3&&$(this).find(".isEnable").iCheck("disable");$(this).find(".form_date").attr("readonly",!0).datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$(this).find(".desc").parents("td").addClass("no-padding");$("#checkDetailList .isEnable").on("ifChanged",function(){var t=$(this).parents("tr"),r=$(this).is(":checked"),u,i,n;r?(u=$(this).val(),i=e[u],t.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden"),t.find(".desc").val(i.Desc),n=i.CheckTime,n=n=="0001-01-01 00:00:00"?"":n.slice(0,n.indexOf(" ")),t.find(".checkTime").val(n).datepicker("update")):t.find(".textIn").addClass("hidden").siblings(".textOn").removeClass("hidden");t.find(".result").prop("disabled",!r)})}});$("#showCheckModal").modal("show")}else $("#taskDesc").prop("disabled",!0),$("#taskDetailTable .textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"),$("#updateTask").val(i.State),$("#taskName").text(i.Item),$("#taskPlan").text(i.Plan),$("#taskProcessor").text(i.Processor),$("#taskAssignor").text(i.Assignor),$("#taskState").text(i.StateDesc),$("#taskRedo").text(i.IsRedo?"已返工":"未返工"),$("#taskEstimatedTime .textOn").text(i.EstimatedTime),$("#taskScore .textOn").text(i.Score),$("#taskActualStartTime").text(noShowSecond(i.ActualStartTime)),$("#taskActualEndTime").text(noShowSecond(i.ActualEndTime)),$("#taskActualTime .textOn").text(i.ActualTime),$("#taskActualScore .textOn").text(i.ActualScore),$("#taskDesc").val(i.Desc),$("#showTaskModal").modal("show")})}function updateCheckTask(n,t){var u=1028,r;if(!checkPermission(u)){layer.msg("没有权限");return}var f=$(this).parents("tr"),e=f.find(".desc").val(),i=f.find(".checkTime").val();i=isStrEmptyOrUndefined(i)?getFullTime():`${i} 00:00:00`;r={};r.opType=u;r.opData=JSON.stringify({Id:_taskDetailId,Items:[{CheckTime:i,Desc:e,Result:t,Id:n}]});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&showDetailModal(_taskDetailId)})}function showImgModel(n){if($("#imgOld").empty(),$("#imgOldList").empty(),isStrEmptyOrUndefined(n))$("#imgOld").append('图片：<font style="color:red" size=5>无<\/font>');else{$("#imgOld").append("图片：");n=n.split(",");var t={type:fileEnum.Manufacture,files:JSON.stringify(n)};ajaxPost("/Upload/Path",t,function(n){var i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(i="",t=0;t<n.data.length;t++)i+=`<div class="imgOption col-lg-2 col-md-3 col-sm-4 col-xs-6">
                    <div class="thumbnail">
                    <img src=${n.data[t].path} style="height:200px">
                    </div>
                    </div>`;$("#imgOldList").append(i)})}$("#showImgModel").modal("show")}function updateTaskDetail(){var o=1028,s,t,i,r,n,h,u,f,e,c;if(!checkPermission(o)){layer.msg("没有权限");return}if(!_isClick){layer.msg("请先修改数据");return}s=$("#taskDesc").val();t=$("#taskEstimatedTime .hour").val();isStrEmptyOrUndefined(t)&&(t=0);i=$("#taskEstimatedTime .minute").val();isStrEmptyOrUndefined(i)&&(i=0);r=$("#taskScore .score").val();isStrEmptyOrUndefined(r)&&(r=0);n={Id:_taskDetailId,EstimatedHour:t,EstimatedMin:i,Score:r,Desc:s};h=$("#updateTask").val();h==3&&(u=$("#taskActualTime .hour").val(),isStrEmptyOrUndefined(u)&&(u=0),f=$("#taskActualTime .minute").val(),isStrEmptyOrUndefined(f)&&(f=0),e=$("#taskActualScore .score").val(),isStrEmptyOrUndefined(e)&&(e=0),n.ActualHour=u,n.ActualMin=f,n.ActualScore=e);c=function(){var t={};t.opType=o;t.opData=JSON.stringify(n);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&showDetailModal(_taskDetailId)})};showConfirm("保存",c)}function updateCheckDetail(){var s=1028,h,t,i,r,n,c,u,f,e,o,l;if(!checkPermission(s)){layer.msg("没有权限");return}if(!_isClick){layer.msg("请先修改数据");return}if(h=$("#checkDesc").val(),t=$("#checkEstimatedTime .hour").val(),isStrEmptyOrUndefined(t)&&(t=0),i=$("#checkEstimatedTime .minute").val(),isStrEmptyOrUndefined(i)&&(i=0),r=$("#checkScore .score").val(),isStrEmptyOrUndefined(r)&&(r=0),n={Id:_taskDetailId,EstimatedHour:t,EstimatedMin:i,Score:r,Desc:h},c=$("#updateCheck").val(),c==3){if(u=$("#checkActualTime .hour").val(),isStrEmptyOrUndefined(u)&&(u=0),f=$("#checkActualTime .minute").val(),isStrEmptyOrUndefined(f)&&(f=0),e=$("#checkActualScore .score").val(),isStrEmptyOrUndefined(e)&&(e=0),o=$("#checkResult").val(),isStrEmptyOrUndefined(o)){layer.msg("请选择检验情况");return}n.ActualHour=u;n.ActualMin=f;n.ActualScore=e;n.CheckResult=o}l=function(){var t={};t.opType=s;t.opData=JSON.stringify(n);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&showDetailModal(_taskDetailId)})};showConfirm("保存",l)}function taskStartStop(n,t,i){var r=n?1032:1033,u;if(!checkPermission(r)){layer.msg("没有权限");return}u=function(){var n={};n.opType=r;n.opData=JSON.stringify({tId:t});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getTaskList()})};showConfirm(`${n?"启动":"停止"}任务：${i}`,u)}function delTask(n,t){var i=1030,r;if(!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({tId:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getTaskList()})};showConfirm(`删除任务：${t}`,r)}function upTask(n,t,i,r){var e=1034,u,f,o;if(!checkPermission(e)){layer.msg("没有权限");return}if(u=_taskData[i],f=_taskData[r],u.Processor==f.Processor&&f.State==1){layer.msg("不能上移到该操作工进行中的任务之前");return}if(u.Plan==f.Plan&&u.Relation==f.Order){layer.msg("不能上移到同计划下的关联任务之前");return}o=function(){var i={};i.opType=e;i.opData=JSON.stringify({FromOrder:n,ToOrder:t});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getTaskList()})};showConfirm(`上移任务：${u.Item}`,o)}function getModule(n){var i=1058,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0,e=u.length;i<e;i++)r=u[i],f+='<option value = "{0}" isCheck = "{2}">{1}<\/option>'.format(r.Id,r.Module,r.IsCheck);n!=null&&n(f)},0)}function getTaskName(n){var i=1066,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var r,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}var f=t.datas,i="";for(r=0,e=f.length;r<e;r++)u=f[r],i+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Check);i=`<select class="ms2 form-control taskNameSelect">${i}</select>`;n!=null&&n(i)},0)}function addTask(n){var t=new Promise(function(n){getGroup(n)}),i=new Promise(function(n){getProcessor(n)}),r=new Promise(function(n){getModule(n)}),u=new Promise(function(n){getTaskName(n)});Promise.all([t,i,r,u]).then(t=>{var i=_taskData[n],u=$(this).parents("tr"),e=parseInt(u.find(".num").text()),o=`<tr>
                <td class="num">${e+1}</td>
                <td>
                    <div class="flexStyle" style="width: 240px;margin:auto">
                        <select class="ms2 form-control group">${t[0]}</select>
                        <select class="ms2 form-control processor">${t[1]}</select>
                    </div>
                </td>
                <td>${i.Plan}</td>
                <td>等待中</td>
                <td>
                    <div style="width: 120px;margin:auto">
                        <select class="ms2 form-control module">${t[2]}</select>
                    </div>
                </td>
                <td>
                    <div style="width: 120px;margin:auto">
                        <input type="text" class="form-control text-center taskName" maxlength="20"><div class="taskNameTwo">${t[3]}</div>
                    </div>
                </td>
                <td class="totalOrder">${i.TotalOrder+1}</td>
                <td class="order">${i.Order+1}</td>
                <td><input type="text" class="form-control text-center relation toZero" oninput="onInput(this, 10, 0)" onblur="onInputEnd(this)" style="width:80px;margin:auto" value="0"></td>
                <td></td>
                <td>
                    <div class="flexStyle" style="width:140px;margin:auto">
                        <input type="text" class="form-control text-center hour toZero" oninput="onInput(this, 3, 0)" onblur="onInputEnd(this)" value="0">
                        <label class="control-label" style="white-space: nowrap; margin: 0">小时</label>
                        <input type="text" class="form-control text-center minute toZero" oninput="onInput(this, 3, 0)" onblur="onInputEnd(this)" value="0">
                        <label class="control-label" style="white-space: nowrap; margin: 0">分</label>
                    </div>
                </td>
                <td><input type="text" class="form-control text-center score toZero" oninput="onInput(this, 3, 0)" onblur="onInputEnd(this)" style="width:80px;margin:auto" value="0"></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm delAddTask"><i class="fa fa-minus"></i></button>
                    <button type="button" class="btn btn-primary btn-sm" onclick="updateAddTask.call(this,${i.PlanId},${i.TotalOrder})">保存</button>
                </td>
            </tr>`,r,f;u.after(o);r=u.next();r.find(".ms2").select2();f=parseInt(r.find(".module option:selected").attr("ischeck"));r.find(f?".taskName":".taskNameTwo").addClass("hidden");setNumTotalOrder(r,1);$("#taskList .addTask").prop("disabled",!0)})}function setNumTotalOrder(n,t){for(var r,u,f,e=n.nextAll(),i=0,o=e.length;i<o;i++)r=e.eq(i),u=r.find(".num"),u.text(parseInt(u.text())+t),f=r.find(".totalOrder"),f.text(parseInt(f.text())+t)}function updateAddTask(n,t){var a=1029,i,c,o,l,r,s,u,f,e,h,v;if(!checkPermission(a)){layer.msg("没有权限");return}if(i=$(this).parents("tr"),c=i.find(".processor").val(),isStrEmptyOrUndefined(c)){layer.msg("请选择操作员");return}if(o=i.find(".module").val(),isStrEmptyOrUndefined(o)){layer.msg("请选择模块名");return}if(l=!!parseInt(i.find(".module").find(`option[value=${o}]`).attr("isCheck")),l){if(r=i.find(".taskNameSelect").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择检验任务");return}r=parseInt(r);s=i.find(`.taskNameSelect option[value=${r}]`).text()}else if(r=0,s=i.find(".taskName").val(),isStrEmptyOrUndefined(s)){layer.msg("任务名不能为空");return}u=i.find(".hour").val();isStrEmptyOrUndefined(u)&&(u=0);u=parseInt(u);f=i.find(".minute").val();isStrEmptyOrUndefined(f)&&(f=0);f=parseInt(f);e=i.find(".score").val();isStrEmptyOrUndefined(e)&&(e=0);e=parseInt(e);h=i.find(".relation").val();isStrEmptyOrUndefined(h)&&(h=0);v=function(){var i={};i.opType=a;i.opData=JSON.stringify({Person:c,PlanId:n,ModuleId:o,IsCheck:l,CheckId:r,Item:s,TotalOrder:t,EstimatedHour:u,EstimatedMin:f,Score:e,Relation:h});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getTaskList()})};showConfirm("保存",v)}var _isClick=!1,_processor=null,_taskData=null,_taskDetailData=null,_taskDetailId=null;