function pageReady(){var t,n;for(_permissionList[444]={uIds:["addGroupBtn"]},_permissionList[445]={uIds:[]},_permissionList[446]={uIds:["deleteGroupBtn"]},_permissionList[447]={uIds:["addGroupProcessorBtn"]},_permissionList[448]={uIds:["deleteGroupProcessorBtn"]},_permissionList=checkPermissionUi(_permissionList),_permissionList[445].have||$(".updateGroup").addClass("hidden"),$(".ms2").select2(),$(".ms3").select2({allowClear:!0,placeholder:"请选择",multiple:!0}),$("#GroupName").val(""),$("#DayViv").addClass("hidden"),$("#Day1").html(getDate()),$("#Day2").html(getDate()),$("#Day").empty(),t="",n=1;n<29;n++)t+=option.format(n,n);$("#Day").append(t);$("#DateTypeSelect").on("change",function(){initTime()});$("#Day").on("change",function(){initTime()});$("#GroupSelect").on("select2:select",function(){$("#GroupName").val($(this).find("option:checked").text());var t=$(this).val(),n=_groups[t];n&&($("#DateTypeSelect").val(n.Interval),$("#Day").val(n.ScoreTime),initTime());initProcessorSelect(t)});init()}function init(n=0,t=false){n==-1&&(n=$("#GroupSelect").val());var r=new Promise(function(t){getGroupList(t,n)}),u=new Promise(function(n){if(t){n("success");return}getAllProcessorList(n)}),f=new Promise(function(i){if(t){i("success");return}initProcessorSelect(n,i)}),i=[r,u];n!=0&&i.push(f);Promise.all(i).then(()=>{var t=_groups[n];t&&($("#DateTypeSelect").val(t.Interval),$("#Day").val(t.ScoreTime))})}function initTime(){var i=$("#DateTypeSelect").val(),n,t;i==2?$("#DayViv").removeClass("hidden"):$("#DayViv").addClass("hidden");switch(i){case"0":$("#Day1").html(getDate());$("#Day2").html(getDate());break;case"1":n=getNowWeekRange((new Date).getDay()==0?7:(new Date).getDay());$("#Day1").html(n.start);$("#Day2").html(n.end);break;case"2":t=getNowMonthRange($("#Day").val());$("#Day1").html(t.start);$("#Day2").html(t.end)}}function getGroupList(n,t=0){var i={};i.opType=1077;ajaxPost("/Relay/Post",i,function(i){var f,u,o,e,r;if(n!=null&&n("success"),i.errno!=0){layer.msg(i.errmsg);return}for($("#GroupSelect").empty(),f=i.datas,_groups=[],o=f.length,e="",u=0;u<o;u++)r=f[u],e+=option.format(r.Id,r.Group),_groups[r.Id]=r;$("#GroupSelect").append(e);$("#GroupSelect").val(t).trigger("change")})}function getAllProcessorList(n){var t={};t.opType=248;ajaxPost("/Relay/Post",t,function(t){if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}_allProcessors=t.datas})}function initProcessorSelect(n,t=null){if($("#ProcessorSelect").empty(),!isStrEmptyOrUndefined(n)){var i={};i.opType=1081;i.opData=JSON.stringify({groupId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){if(t!=null&&t("success"),n.errno!=0){layer.msg(n.errmsg);return}for(var e=[],o=n.datas,f=o.length,u="",i,r=0;r<f;r++)i=o[r],e[i.ProcessorId]=i,u+=option.format(i.Id,i.Processor);for($("#ProcessorSelect").append(u),$("#AllProcessorSelect").empty(),f=_allProcessors.length,u="",r=0;r<f;r++)i=_allProcessors[r],e[i.Id]||(u+=option.format(i.Id,i.ProcessorName));_allProcessorOptions=u;$("#AllProcessorSelect").append(u)})}}function deleteGroup(){var n=$("#GroupSelect").val(),t;isStrEmptyOrUndefined(n)||(t=function(){var t={};t.opType=1080;t.opData=JSON.stringify({ids:[n]});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&init()})},showConfirm("删除项目组："+$("#GroupSelect option:selected").text(),t))}function addGroup(){var n=$("#GroupName").val(),i=$("#GroupSelect option:selected").text(),t;if(isStrEmptyOrUndefined(n)){layer.msg("组名不能为空");return}n!=i&&(t=function(){var t={};t.opType=1079;t.opData=JSON.stringify({Group:n});ajaxPost("/Relay/Post",t,function(n){if(layer.msg(n.errmsg),n.errno==0){var t=$("#GroupSelect").val();isStrEmptyOrUndefined(t)&&(t=0);init(t,!0)}})},showConfirm("新增项目组："+n,t))}function updateGroup(){var n=$("#GroupName").val(),r=$("#GroupSelect option:selected").text(),t=$("#GroupSelect").val(),i;if(isStrEmptyOrUndefined(t)){layer.msg("请选择项目组");return}if(isStrEmptyOrUndefined(n)){layer.msg("组名不能为空");return}n!=r&&(i=function(){var i={};i.opType=1078;i.opData=JSON.stringify({Id:t,Group:n,IsName:!0});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&init(t,!0)})},showConfirm("修改项目组："+$("#GroupSelect option:selected").text(),i))}function updateGroupTime(){var t=$("#DateTypeSelect").val(),i=$("#Day").val(),n=$("#GroupSelect").val(),r;if(isStrEmptyOrUndefined(n)){layer.msg("请选择项目组");return}isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(i)||(r=function(){var r={};r.opType=1078;r.opData=JSON.stringify({Id:n,Interval:t,ScoreTime:i,IsName:!1});ajaxPost("/Relay/Post",r,function(t){layer.msg(t.errmsg);t.errno==0&&init(n,!0)})},showConfirm("修改项目组："+$("#GroupSelect option:selected").text(),r))}function deleteGroupProcessor(){var t=$("#GroupSelect").val(),n,i;if(isStrEmptyOrUndefined(t)){layer.msg("请选择项目组");return}(n=$("#ProcessorSelect").val(),isStrEmptyOrUndefined(n))||(i=function(){var i={};i.opType=1083;i.opData=JSON.stringify({ids:[n]});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&initProcessorSelect(t)})},showConfirm("删除成员："+$("#ProcessorSelect option:selected").text(),i))}function addGroupProcessor(){var i=$("#GroupSelect").val(),n,r,t,u;if(isStrEmptyOrUndefined(i)){layer.msg("请选择项目组");return}if(n=$("#AllProcessorSelect").val(),!isStrEmptyOrUndefined(n)){if(n.length<=0){layer.msg("请选择成员");return}for(r=[],t=0;t<n.length;t++)r.push({GroupId:i,ProcessorId:n[t]});u=function(){var n={};n.opType=1082;n.opData=JSON.stringify(r);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&initProcessorSelect(i)})};showConfirm("新增成员："+$("#AllProcessorSelect option:selected").text(),u)}}var _permissionList=[],option='<option value = "{0}">{1}<\/option>',_groups=null,_allProcessors=null,_allProcessorOptions="";