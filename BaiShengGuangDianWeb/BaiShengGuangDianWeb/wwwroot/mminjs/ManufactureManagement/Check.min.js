function pageReady(){_permissionList[438]={uIds:["showCheckListModelBtn"]};_permissionList[474]={uIds:["addCheckListBtn"]};_permissionList[475]={uIds:["updateCheckListBtn"]};_permissionList[476]={uIds:["deleteCheckListBtn"]};_permissionList[439]={uIds:["saveCheckConfigBtn"]};_permissionList=checkPermissionUi(_permissionList);$(".ms2").select2();$("#CheckListSelect").on("select2:select",function(){$("#CheckListName").val($(this).find("option:checked").text())});$("#CopyCheckListChoose").on("ifChanged",function(){$(this).is(":checked")?$("#updateCheckListBtn").attr("disabled","disabled"):$("#updateCheckListBtn").removeAttr("disabled")});$("#CheckSelect").on("select2:select",function(){var n=$(this).val();initCheckConfig(n)});$("#selectAll").on("ifChanged",function(){$(this).is(":checked")?$("#checkConfig .chose").iCheck("check"):$("#checkConfig .chose").iCheck("uncheck")});init()}function init(n=0){if(n!=-1||(n=$("#CheckSelect").val(),!isStrEmptyOrUndefined(n))){$("#CheckSelect").empty();var i=new Promise(function(n){getCheckList(n)}),r=new Promise(function(t){initCheckConfig(n,t)}),t=[i];n!=0&&t.push(r);Promise.all(t).then(()=>{var i,t,r;if(_checks&&_checks.length>0){for(i="",t=0;t<_checks.length;t++)r=_checks[t],i+=option.format(r.Id,r.Check);$("#CheckSelect").append(i)}$("#CheckSelect").val(n).trigger("change")})}}function showCheckListModel(n=0,t=true){t&&($("#CopyCheckListChoose").iCheck("uncheck"),$("#updateCheckListBtn").removeAttr("enabled"),$("#CheckListName").val(""));$("#CheckListSelect").empty();var i=new Promise(function(n){getCheckList(n)});Promise.all([i]).then(()=>{var r,i,u;if(_checks&&_checks.length>0){for(r="",i=0;i<_checks.length;i++)u=_checks[i],r+=option.format(u.Id,u.Check);$("#CheckListSelect").append(r)}$("#CheckListSelect").val(n).trigger("change");t&&$("#checkListModel").modal("show")})}function getCheckList(n){var t={};t.opType=1066;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}var i=t.datas;_checks=i})}function deleteCheckList(){var n=$("#CheckListSelect").val(),t;isStrEmptyOrUndefined(n)||(t=function(){var t={};t.opType=1069;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&showCheckListModel(0,!1)})},showConfirm("删除配置："+$("#CheckListSelect option:selected").text(),t))}function updateCheckList(){var n=$("#CheckListName").val(),r=$("#CheckListSelect option:selected").text(),t=$("#CheckListSelect").val(),i;if(isStrEmptyOrUndefined(t)){layer.msg("请选择配置");return}if(isStrEmptyOrUndefined(n)){layer.msg("名称不能为空");return}n!=r&&(i=function(){var i={};i.opType=1067;i.opData=JSON.stringify({Id:t,Check:n});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&showCheckListModel(t,!1)})},showConfirm("修改配置："+$("#CheckListSelect option:selected").text(),i))}function addCheckList(){var n=$("#CheckListName").val(),r=$("#CheckListSelect option:selected").text(),t,i;if(isStrEmptyOrUndefined(n)){layer.msg("名称不能为空");return}if(t=$("#CheckListSelect").val(),$("#CopyCheckListChoose").is(":checked")&&isStrEmptyOrUndefined(t)){layer.msg("请选择配置");return}n!=r&&(i=function(){var i={};i.opType=1068;i.opData=JSON.stringify({Check:n,CopyId:$("#CopyCheckListChoose").is(":checked")?t:0});ajaxPost("/Relay/Post",i,function(n){if(layer.msg(n.errmsg),n.errno==0){var t=$("#CheckListSelect").val();isStrEmptyOrUndefined(t)&&(t=0);showCheckListModel(t,!1)}})},showConfirm("新增配置："+n,i))}function initCheckConfig(n,t=null){if($("#selectAll").iCheck("uncheck"),$("#checkConfig").empty(),!isStrEmptyOrUndefined(n)){var i={};i.opType=1070;i.opData=JSON.stringify({checkId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){var f,u;if(t!=null&&t("success"),n.errno!=0){layer.msg(n.errmsg);return}if(checkConfig=n.datas,checkConfig.length>0){for(f="",u=0;u<checkConfig.length;u++){var i=u+1,r=checkConfig[u],e=`<tr id="item${i}" value="${i}" xh="${i}" itemId="${r.Id}">
                        <td style="width:50px;">
                           <input id="itemChose${i}" type="checkbox" class="icb_minimal chose">
                        </td>
                        <td style="width:50px;" id="itemXh${i}">
                            ${i}
                        </td>
                        <td class="no-padding">
                        ${(r.Item.length>tdShowLength?`<span id="itemItem1${i}" title="${r.Item}" class="chose1" onclick = "showAllContent('${escape(r.Item)}', '检验流程')">${r.Item.substring(0,tdShowLength)}...</span>`:`<span id="itemItem1${i}" title="${r.Item}" class="chose1">${r.Item}</span>`)+`<textarea id="itemItem2${i}" old="${r.Item}" class="chose2 hidden form-control" maxlength = "500" style = "resize: vertical;margin:auto" ></textarea>`}
                        </td>
                        <td style="width:100px;">
                            <span class="chose1" id ="itemMethod1${i}">${r.Method}</span >
                            <input class="chose2 hidden form-control text-center" old="${r.Method}" id="itemMethod2${i}" maxlength="100">
                        </td>
                    </tr>`;f+=e}$("#checkConfig").append(f);checkConfigMax=checkConfig.length;checkConfigMaxV=checkConfig.length;$("#checkConfig .chose").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"});$("#checkConfig .chose").on("ifChanged",function(){var n=$(this).parents("tr:first"),t=n.attr("value");$(this).is(":checked")?(n.find(".chose1").addClass("hidden"),n.find(".chose2").removeClass("hidden"),$("#itemMethod2"+t).val($("#itemMethod2"+t).attr("old")),$("#itemItem2"+t).val($("#itemItem2"+t).attr("old"))):(n.find(".chose1").removeClass("hidden"),n.find(".chose2").addClass("hidden"))})}})}}function addOneCheckConfig(){var r=$("#CheckSelect").val(),n,i,t;if(!isStrEmptyOrUndefined(r)){checkConfigMax++;checkConfigMaxV++;n=checkConfigMax;i=`<tr id="item${n}" value="${n}" xh="${checkConfigMaxV}" itemId="0">
            <td style="width:50px;">
               <input id="itemChose${n}" type="checkbox" class="icb_minimal chose">
            </td>
            <td style="width:50px;" id="itemXh${n}">
                ${checkConfigMaxV}
            </td>
            <td class="no-padding">
                <textarea id="itemItem2${n}" class="chose2 form-control" maxlength = "500" style = "resize: vertical;margin:auto" ></textarea>
            </td>
            <td style="width:100px;">
                <input class="chose2 form-control text-center" id="itemMethod2${n}" maxlength="100">
            </td>
        </tr>`;$("#checkConfig").append(i);t="#item"+n;$(t).find(".ms2").select2({width:"120px"});$(t).find(".icb_minimal").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"}).iCheck("check");$(t).find(".icb_minimal").on("ifChanged",function(){var t,i,n,r;for($(this).parents("tr:first").remove(),checkConfigMaxV--,t=1,i=$("#checkConfig tr"),n=0;n<i.length;n++)$(i[n]).attr("xh",t),r=$(i[n]).attr("value"),$("#itemXh"+r).html(t),t++})}}function delCheckConfig(){var e=$("#CheckSelect").val(),n,i,t,r,u,f;if(!isStrEmptyOrUndefined(e)){for(n=$("#checkConfig tr"),i=[],t=0;t<n.length;t++)r=$(n[t]).attr("value"),u=$(n[t]).attr("xh"),$("#itemChose"+r).is(":checked")&&i.push(u);i.length!=0&&(f=function(){for(var i,r=1,t=0;t<n.length;t++)$(n[t]).attr("xh",r),i=$(n[t]).attr("value"),$("#itemXh"+i).html(r),$("#itemChose"+i).is(":checked")?(checkConfigMaxV--,$("#itemChose"+i).parents("tr:first").remove()):r++},showConfirm("删除序号："+i.join(),f))}}function saveCheckConfig(){var u=$("#CheckSelect").val(),t,s;if(isStrEmptyOrUndefined(u)){layer.msg("请选择配置");return}var f=$("#checkConfig tr"),o=0,e=[];for(t=0;t<f.length;t++){var n=$(f[t]).attr("value"),c=$(f[t]).attr("xh"),i,r,h=$("#item"+n).attr("itemId");if($("#itemChose"+n).is(":checked")?(i=$("#itemItem2"+n).val(),r=$("#itemMethod2"+n).val(),o++):(i=$("#itemItem1"+n).attr("title"),r=$("#itemMethod1"+n).html()),isStrEmptyOrUndefined(i)){layer.msg("请输入检验流程");return}if(isStrEmptyOrUndefined(r)){layer.msg("请输入检验方法");return}e.push({CheckId:u,Id:h,Item:i,Method:r})}o<=0&&e.length==checkConfig.length||(s=function(){var n={};n.opType=1071;n.opData=JSON.stringify(e);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&initCheckConfig(u)})},showConfirm("保存",s))}var _permissionList=[],option='<option value = "{0}">{1}<\/option>',_checks=null,checkConfig=null,checkConfigMax=0,checkConfigMaxV=0;