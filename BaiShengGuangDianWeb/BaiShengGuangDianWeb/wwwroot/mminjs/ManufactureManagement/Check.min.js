function pageReady(){$(".ms2").select2();$("#CheckListSelect").on("select2:select",function(){$("#CheckListName").val($(this).find("option:checked").text())});$("#CopyCheckListChoose").on("ifChanged",function(){$(this).is(":checked")?$("#updateCheckListBtn").attr("disabled","disabled"):$("#updateCheckListBtn").removeAttr("disabled")});$("#CheckSelect").on("select2:select",function(){var n=$(this).val();initCheckConfig(n)});$("#selectAll").on("ifChanged",function(){$(this).is(":checked")?$("#checkConfig .chose").iCheck("check"):$("#checkConfig .chose").iCheck("uncheck")});init()}function init(n=0){if(n!=-1||(n=$("#CheckSelect").val(),!isStrEmptyOrUndefined(n))){$("#CheckSelect").empty();var i=new Promise(function(n){getCheckList(n)}),r=new Promise(function(t){initCheckConfig(n,t)}),t=[i];n!=0&&t.push(r);Promise.all(t).then(()=>{var i,t,r;if(_checks&&_checks.length>0){for(i="",t=0;t<_checks.length;t++)r=_checks[t],i+=option.format(r.Id,r.Check);$("#CheckSelect").append(i)}$("#CheckSelect").val(n).trigger("change")})}}function showCheckListModel(n=0,t=true){t&&($("#CopyCheckListChoose").iCheck("uncheck"),$("#updateCheckListBtn").removeAttr("enabled"),$("#CheckListName").val(""));$("#CheckListSelect").empty();var i=new Promise(function(n){getCheckList(n)});Promise.all([i]).then(()=>{var r,i,u;if(_checks&&_checks.length>0){for(r="",i=0;i<_checks.length;i++)u=_checks[i],r+=option.format(u.Id,u.Check);$("#CheckListSelect").append(r)}$("#CheckListSelect").val(n).trigger("change");t&&$("#checkListModel").modal("show")})}function getCheckList(n){var i=1066,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}var i=t.datas;_checks=i})}function deleteCheckList(){var t=1069,n,i;if(!checkPermission(t)){layer.msg("没有权限");return}(n=$("#CheckListSelect").val(),isStrEmptyOrUndefined(n))||(i=function(){var i={};i.opType=t;i.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&showCheckListModel(0,!1)})},showConfirm("删除配置："+$("#CheckListSelect option:selected").text(),i))}function updateCheckList(){var i=1067,r;if(!checkPermission(i)){layer.msg("没有权限");return}var n=$("#CheckListName").val(),u=$("#CheckListSelect option:selected").text(),t=$("#CheckListSelect").val();if(isStrEmptyOrUndefined(t)){layer.msg("请选择配置");return}if(isStrEmptyOrUndefined(n)){layer.msg("名称不能为空");return}n!=u&&(r=function(){var r={};r.opType=i;r.opData=JSON.stringify({Id:t,Check:n});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&showCheckListModel(t,!1)})},showConfirm("修改配置："+$("#CheckListSelect option:selected").text(),r))}function addCheckList(){var i=1068,n,r,t,u;if(!checkPermission(i)){layer.msg("没有权限");return}if(n=$("#CheckListName").val(),r=$("#CheckListSelect option:selected").text(),isStrEmptyOrUndefined(n)){layer.msg("名称不能为空");return}if(t=$("#CheckListSelect").val(),$("#CopyCheckListChoose").is(":checked")&&isStrEmptyOrUndefined(t)){layer.msg("请选择配置");return}n!=r&&(u=function(){var r={};r.opType=i;r.opData=JSON.stringify({Check:n,CopyId:$("#CopyCheckListChoose").is(":checked")?t:0});ajaxPost("/Relay/Post",r,function(n){if(layer.msg(n.errmsg),n.errno==0){var t=$("#CheckListSelect").val();isStrEmptyOrUndefined(t)&&(t=0);showCheckListModel(t,!1)}})},showConfirm("新增配置："+n,u))}function initCheckConfig(n,t=null){var r,i;if($("#selectAll").iCheck("uncheck"),$("#checkConfig").empty(),!isStrEmptyOrUndefined(n)){if(r=1070,!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;i.opData=JSON.stringify({checkId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){var f,u;if(t!=null&&t("success"),n.errno!=0){layer.msg(n.errmsg);return}if(checkConfig=n.datas,checkConfig.length>0){for(f="",u=0;u<checkConfig.length;u++){var i=u+1,r=checkConfig[u],e=`<tr id="item${i}" value="${i}" xh="${i}" itemId="${r.Id}">
                        <td style="width:50px;">
                           <input id="itemChose${i}" type="checkbox" class="icb_minimal chose">
                        </td>
                        <td style="width:50px;" id="itemXh${i}">
                            ${i}
                        </td>
                        <td class="no-padding">
                        ${(r.Item.length>tdShowLength?`<span id="itemItem1${i}" title="${r.Item}" class="chose1" onclick = "showAllContent('${escape(r.Item)}', '检验流程')">${r.Item.substring(0,tdShowLength)}...</span>`:`<span id="itemItem1${i}" title="${r.Item}" class="chose1">${r.Item}</span>`)+`<textarea id="itemItem2${i}" old="${r.Item}" class="chose2 hidden form-control" maxlength = "500" style = "resize: vertical;margin:auto" ></textarea>`}
                        </td>
                        <td style="width:100px;">
                            <span class="chose1" id ="itemMethod1${i}">${r.Method}</span >
                            <input class="chose2 hidden form-control text-center" old="${r.Method}" id="itemMethod2${i}" maxlength="100">
                        </td>
                    </tr>`;f+=e}$("#checkConfig").append(f);checkConfigMax=checkConfig.length;checkConfigMaxV=checkConfig.length;$("#checkConfig .chose").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"});$("#checkConfig .chose").on("ifChanged",function(){var n=$(this).parents("tr:first"),t=n.attr("value");$(this).is(":checked")?(n.find(".chose1").addClass("hidden"),n.find(".chose2").removeClass("hidden"),$("#itemMethod2"+t).val($("#itemMethod2"+t).attr("old")),$("#itemItem2"+t).val($("#itemItem2"+t).attr("old"))):(n.find(".chose1").removeClass("hidden"),n.find(".chose2").addClass("hidden"))})}})}}function addOneCheckConfig(){var r=$("#CheckSelect").val(),n,i,t;if(!isStrEmptyOrUndefined(r)){checkConfigMax++;checkConfigMaxV++;n=checkConfigMax;i=`<tr id="item${n}" value="${n}" xh="${checkConfigMaxV}" itemId="0">
            <td style="width:50px;">
               <input id="itemChose${n}" type="checkbox" class="icb_minimal chose">
            </td>
            <td style="width:50px;" id="itemXh${n}">
                ${checkConfigMaxV}
            </td>
            <td class="no-padding">
                <textarea id="itemItem2${n}" class="chose2 form-control" maxlength = "500" style = "resize: vertical;margin:auto" ></textarea>
            </td>
            <td style="width:100px;">
                <input class="chose2 form-control text-center" id="itemMethod2${n}" maxlength="100">
            </td>
        </tr>`;$("#checkConfig").append(i);t="#item"+n;$(t).find(".ms2").select2({width:"120px"});$(t).find(".icb_minimal").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"}).iCheck("check");$(t).find(".icb_minimal").on("ifChanged",function(){var t,i,n,r;for($(this).parents("tr:first").remove(),checkConfigMaxV--,t=1,i=$("#checkConfig tr"),n=0;n<i.length;n++)$(i[n]).attr("xh",t),r=$(i[n]).attr("value"),$("#itemXh"+r).html(t),t++})}}function delCheckConfig(){var e=$("#CheckSelect").val(),n,i,t,r,u,f;if(!isStrEmptyOrUndefined(e)){for(n=$("#checkConfig tr"),i=[],t=0;t<n.length;t++)r=$(n[t]).attr("value"),u=$(n[t]).attr("xh"),$("#itemChose"+r).is(":checked")&&i.push(u);i.length!=0&&(f=function(){for(var i,r=1,t=0;t<n.length;t++)$(n[t]).attr("xh",r),i=$(n[t]).attr("value"),$("#itemXh"+i).html(r),$("#itemChose"+i).is(":checked")?(checkConfigMaxV--,$("#itemChose"+i).parents("tr:first").remove()):r++},showConfirm("删除序号："+i.join(),f))}}function saveCheckConfig(){var o=1071,i,t,h;if(!checkPermission(o)){layer.msg("没有权限");return}if(i=$("#CheckSelect").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择配置");return}var f=$("#checkConfig tr"),s=0,e=[];for(t=0;t<f.length;t++){var n=$(f[t]).attr("value"),l=$(f[t]).attr("xh"),r,u,c=$("#item"+n).attr("itemId");if($("#itemChose"+n).is(":checked")?(r=$("#itemItem2"+n).val(),u=$("#itemMethod2"+n).val(),s++):(r=$("#itemItem1"+n).attr("title"),u=$("#itemMethod1"+n).html()),isStrEmptyOrUndefined(r)){layer.msg("请输入检验流程");return}if(isStrEmptyOrUndefined(u)){layer.msg("请输入检验方法");return}e.push({CheckId:i,Id:c,Item:r,Method:u})}s<=0&&e.length==checkConfig.length||(h=function(){var n={};n.opType=o;n.opData=JSON.stringify(e);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&initCheckConfig(i)})},showConfirm("保存",h))}var option='<option value = "{0}">{1}<\/option>',_checks=null,checkConfig=null,checkConfigMax=0,checkConfigMaxV=0;