function pageReady(){$(".table-bordered td").css("border","1px solid");getCheckTask();getCheckList(0,"#waitCheckList");getCheckList(1,"#passCheckList");getCheckList(2,"#redoCheckList");getCheckList(3,"#blockCheckList");$("#imgOldList").on("click",".delImg",function(){$(this).parents(".imgOption").remove();var n=$(this).val();_imgNameData.splice(_imgNameData.indexOf(n),1)})}function getCheckTask(){var t=1012,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({account:_admin});ajaxPost("/Relay/Post",n,function(n){var t,i,r,u;if(n.errno!=0){layer.msg(n.errmsg);$("#startBtn,#pauseBtn").addClass("hidden");return}$("#startBtn,#pauseBtn").removeClass("hidden");t=n.datas[0];_taskData={TaskId:t.Id,Account:_admin};i=t.State;$("#startBtn").prop("disabled",!(i==2||i==7));i==8?($(".finish").removeClass("hidden"),$("#pauseBtn").prop("disabled",!1)):($(".finish").addClass("hidden"),$("#pauseBtn").prop("disabled",!0));$("#check").text(t.Check);$("#plan").text(t.Plan);$("#item").text(t.Item);$("#processor").text(t.Processor);$("#checkProcessor").text(t.CheckProcessor);$("#estimatedTime").text(t.EstimatedTime);r=t.ActualStartTime;$("#actualStartTime").text(r=="0001-01-01 00:00:00"?"":r);u=t.ActualEndTime;$("#actualEndTime").text(u=="0001-01-01 00:00:00"?"":u);$("#score").text(t.Score);$("#actualTime").text(t.ActualTime);var f=function(n,t,i,r){return r.row+1},e=function(n){return`<textarea class="form-control desc" style="resize: vertical;margin:auto;width:200px" ${i!=8?"disabled":""}>${n==null?"":n}</textarea>`},o=function(n){var t=n.Result;return'<button type="button" class="btn btn-primary btn-{1} btn-sm" onclick="updateCheckTask.call(this,{0},1)" {3}>通过<\/button><button type="button" class="btn btn-primary btn-{2} btn-sm" onclick = "updateCheckTask.call(this,{0},2)" {3}>不通过<\/button>'.format(n.Id,t==1?"success":"info",t==2?"danger":"info",i!=8?"disabled":"")},s=function(){return`<input type="text" class="form_date form-control text-center checkTime" style="width:120px;cursor: pointer" ${i!=8?"disabled":""}>`},h=function(n){return`<button type="button" class="btn btn-primary btn-sm" onclick="showImgModel('${n.ImageList}',${n.Id})" ${i!=8?"disabled":""}>查看</button>`};$("#checkTaskList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t.Items,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:null,title:"序号",render:f},{data:"Item",title:"检验流程"},{data:"Method",title:"检验要求"},{data:"Desc",title:"检验说明",render:e,sClass:"no-padding"},{data:null,title:"检验时间",render:s},{data:null,title:"检验结果",render:o},{data:null,title:"拍照",render:h}],createdRow:function(n,t){var i=t.CheckTime;i=i.slice(0,i.indexOf(" "));$(n).find(".form_date").attr("readonly",!0).val(i=="0001-01-01"?"":i).datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0})}})})}function checkTaskHandle(n,t){var i,r;switch(n){case 0:i=1017;break;case 1:i=1018;break;case 2:i=1019;_taskData.CheckResult=t}if(!checkPermission(i)){layer.msg("没有权限");return}r={};r.opType=i;r.opData=JSON.stringify(_taskData);ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&getCheckTask()})}function updateCheckTask(n,t){var r=1020,i;if(!checkPermission(r)){layer.msg("没有权限");return}var u=$(this).parents("tr"),e=u.find(".desc").val(),f=u.find(".checkTime").val();if(isStrEmptyOrUndefined(f)){layer.msg("请选择检验时间");return}i={};i.opType=r;i.opData=JSON.stringify({CheckTime:f,Desc:e,Result:t,Id:n,ItemId:_taskData.TaskId});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getCheckTask()})}function showImgModel(n,t){if(_updateFirmwareUpload==null&&(_updateFirmwareUpload=initFileInputMultiple("addImg",fileEnum.Manufacture)),$("#addImg").fileinput("clear"),t!=null?($("#checkId").text(t),$(".noDetail").removeClass("hidden")):$(".noDetail").addClass("hidden"),$("#imgOld").empty(),$("#imgOldList").empty(),_imgNameData=[],isStrEmptyOrUndefined(n))$("#imgOld").append('图片：<font style="color:red" size=5>无<\/font>');else{$("#imgOld").append("图片：");n=n.split(",");_imgNameData=n;var i={type:fileEnum.Manufacture,files:JSON.stringify(n)};ajaxPost("/Upload/Path",i,function(i){var f,u,r;if(i.errno!=0){layer.msg(i.errmsg);return}for(f=`<div class="imgOption col-lg-2 col-md-3 col-sm-4 col-xs-6">
                    <div class="thumbnail">
                    <img src={0} style="height:200px">
                    <div class="caption text-center ${t==null?"hidden":""}">
                    <button type="button" class="btn btn-default glyphicon glyphicon-trash delImg" value="{1}"></button>
                    </div>
                    </div>
                    </div>`,u="",r=0;r<i.data.length;r++)u+=f.format(i.data[r].path,n[r]);$("#imgOldList").append(u)})}$("#addImgBox").find(".file-caption-name").attr("readonly",!0).attr("placeholder","请选择图片...");$("#showImgModel").modal("show")}function updateImg(){var n=1020,t;if(!checkPermission(n)){layer.msg("没有权限");return}fileCallBack[fileEnum.Manufacture]=function(t){var u,f,i,e,r;if(t.errno==0){u=[];for(f in t.data)u.push(t.data[f].newName);i=_imgNameData.concat(u);i=JSON.stringify(i);e=$("#checkId").text();r={};r.opType=n;r.opData=JSON.stringify({Images:i,Id:e,ItemId:_taskData.TaskId});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#showImgModel").modal("hide");n.errno==0&&getCheckTask()})}};t=function(){$("#addImg").fileinput("upload")};showConfirm("操作",t)}function getCheckList(n,t){var i,r;switch(n){case 0:i=1013;break;case 1:i=1014;break;case 2:i=1015;break;case 3:i=1016}if(!checkPermission(i)){layer.msg("没有权限");return}r={};r.opType=i;r.opData=JSON.stringify({account:_admin,limit:10});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i=n.datas,r=function(n,t,i,r){return r.row+1},u=function(n){return`<button type="button" class="btn btn-primary btn-sm" onclick="showDetailModel(${n})">查看</button>`};$(t).DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:null,title:"序号",render:r},{data:"Item",title:"检验单名称"},{data:"Plan",title:"所属计划号"},{data:"Score",title:"任务绩效分"},{data:"Surveyor",title:"任务完成人"},{data:"Id",title:"任务流程",render:u}]})})}function showDetailModel(n){var i=1021,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n,t,i,r){return r.row+1},r=function(n){return n=="0001-01-01 00:00:00"?"":n},u=function(n){return n==1?"通过":"不通过"},f=function(n){return`<button type="button" class="btn btn-primary btn-sm" onclick="showImgModel('${n}')">查看</button>`};$("#showDetailList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:null,title:"序号",render:i},{data:"Item",title:"检验流程"},{data:"Method",title:"检验要求"},{data:"Desc",title:"检验说明"},{data:"CheckTime",title:"检验时间",render:r},{data:"Result",title:"检验结果",render:u},{data:"ImageList",title:"图片",render:f}]});$("#showDetailModel").modal("show")})}var _admin=getCookieTokenInfo().account,_taskData=null,_updateFirmwareUpload=null,_imgNameData=null;