function pageReady(){var t,n;for($(".ms2").select2(),$(".ms3").select2({allowClear:!0,placeholder:"请选择",multiple:!0}),$("#GroupName").val(""),$("#DayViv").addClass("hidden"),$("#Day1").html(getDate()),$("#Day2").html(getDate()),$("#Day").empty(),t="",n=1;n<29;n++)t+=option.format(n,n);$("#Day").append(t);$("#DateTypeSelect").on("change",function(){initTime()});$("#Day").on("change",function(){initTime()});$("#GroupSelect").on("select2:select",function(){$("#GroupName").val($(this).find("option:checked").text());var t=$(this).val(),n=_groups[t];n&&($("#DateTypeSelect").val(n.Interval),$("#Day").val(n.ScoreTime),initTime());initProcessorSelect(t)});init()}function init(n=0,t=false){n==-1&&(n=$("#GroupSelect").val());var r=new Promise(function(t){getGroupList(t,n)}),u=new Promise(function(n){if(t){n("success");return}getAllProcessorList(n)}),f=new Promise(function(i){if(t){i("success");return}initProcessorSelect(n,i)}),i=[r,u];n!=0&&i.push(f);Promise.all(i).then(()=>{var t=_groups[n];t&&($("#DateTypeSelect").val(t.Interval),$("#Day").val(t.ScoreTime))})}function initTime(){var i=$("#DateTypeSelect").val(),n,t;i==2?$("#DayViv").removeClass("hidden"):$("#DayViv").addClass("hidden");switch(i){case"0":$("#Day1").html(getDate());$("#Day2").html(getDate());break;case"1":n=getNowWeekRange((new Date).getDay()==0?7:(new Date).getDay());$("#Day1").html(n.start);$("#Day2").html(n.end);break;case"2":t=getNowMonthRange($("#Day").val());$("#Day1").html(t.start);$("#Day2").html(t.end)}}function getGroupList(n,t=0){var r=1077,i;if(!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;ajaxPost("/Relay/Post",i,function(i){var f,u,o,e,r;if(n!=null&&n("success"),i.errno!=0){layer.msg(i.errmsg);return}for($("#GroupSelect").empty(),f=i.datas,_groups=[],o=f.length,e="",u=0;u<o;u++)r=f[u],e+=option.format(r.Id,r.Group),_groups[r.Id]=r;$("#GroupSelect").append(e);$("#GroupSelect").val(t).trigger("change")})}function getAllProcessorList(n){var i=248,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}_allProcessors=t.datas})}function initProcessorSelect(n,t=null){var r,i;if($("#ProcessorSelect").empty(),!isStrEmptyOrUndefined(n)){if(r=1081,!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;i.opData=JSON.stringify({groupId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){if(t!=null&&t("success"),n.errno!=0){layer.msg(n.errmsg);return}for(var e=[],o=n.datas,f=o.length,u="",i,r=0;r<f;r++)i=o[r],e[i.ProcessorId]=i,u+=option.format(i.Id,i.Processor);for($("#ProcessorSelect").append(u),$("#AllProcessorSelect").empty(),f=_allProcessors.length,u="",r=0;r<f;r++)i=_allProcessors[r],e[i.Id]||(u+=option.format(i.Id,i.ProcessorName));_allProcessorOptions=u;$("#AllProcessorSelect").append(u)})}}function deleteGroup(){var t=1080,n,i;if(!checkPermission(t)){layer.msg("没有权限");return}(n=$("#GroupSelect").val(),isStrEmptyOrUndefined(n))||(i=function(){var i={};i.opType=t;i.opData=JSON.stringify({ids:[n]});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&init()})},showConfirm("删除项目组："+$("#GroupSelect option:selected").text(),i))}function addGroup(){var t=1079,n,i,r;if(!checkPermission(t)){layer.msg("没有权限");return}if(n=$("#GroupName").val(),i=$("#GroupSelect option:selected").text(),isStrEmptyOrUndefined(n)){layer.msg("组名不能为空");return}n!=i&&(r=function(){var i={};i.opType=t;i.opData=JSON.stringify({Group:n});ajaxPost("/Relay/Post",i,function(n){if(layer.msg(n.errmsg),n.errno==0){var t=$("#GroupSelect").val();isStrEmptyOrUndefined(t)&&(t=0);init(t,!0)}})},showConfirm("新增项目组："+n,r))}function updateGroup(){var i=1078,r;if(!checkPermission(i)){layer.msg("没有权限");return}var n=$("#GroupName").val(),u=$("#GroupSelect option:selected").text(),t=$("#GroupSelect").val();if(isStrEmptyOrUndefined(t)){layer.msg("请选择项目组");return}if(isStrEmptyOrUndefined(n)){layer.msg("组名不能为空");return}n!=u&&(r=function(){var r={};r.opType=i;r.opData=JSON.stringify({Id:t,Group:n,IsName:!0});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&init(t,!0)})},showConfirm("修改项目组："+$("#GroupSelect option:selected").text(),r))}function updateGroupTime(){var t=1078,u;if(!checkPermission(t)){layer.msg("没有权限");return}var i=$("#DateTypeSelect").val(),r=$("#Day").val(),n=$("#GroupSelect").val();if(isStrEmptyOrUndefined(n)){layer.msg("请选择项目组");return}isStrEmptyOrUndefined(i)||isStrEmptyOrUndefined(r)||(u=function(){var u={};u.opType=t;u.opData=JSON.stringify({Id:n,Interval:i,ScoreTime:r,IsName:!1});ajaxPost("/Relay/Post",u,function(t){layer.msg(t.errmsg);t.errno==0&&init(n,!0)})},showConfirm("修改项目组："+$("#GroupSelect option:selected").text(),u))}function deleteGroupProcessor(){var i=1083,n,t,r;if(!checkPermission(i)){layer.msg("没有权限");return}if(n=$("#GroupSelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择项目组");return}(t=$("#ProcessorSelect").val(),isStrEmptyOrUndefined(t))||(r=function(){var r={};r.opType=i;r.opData=JSON.stringify({ids:[t]});ajaxPost("/Relay/Post",r,function(t){layer.msg(t.errmsg);t.errno==0&&initProcessorSelect(n)})},showConfirm("删除成员："+$("#ProcessorSelect option:selected").text(),r))}function addGroupProcessor(){var u=1082,t,n,r,i,f;if(!checkPermission(u)){layer.msg("没有权限");return}if(t=$("#GroupSelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择项目组");return}if(n=$("#AllProcessorSelect").val(),!isStrEmptyOrUndefined(n)){if(n.length<=0){layer.msg("请选择成员");return}for(r=[],i=0;i<n.length;i++)r.push({GroupId:t,ProcessorId:n[i]});f=function(){var n={};n.opType=u;n.opData=JSON.stringify(r);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&initProcessorSelect(t)})};showConfirm("新增成员："+$("#AllProcessorSelect option:selected").text(),f)}}var option='<option value = "{0}">{1}<\/option>',_groups=null,_allProcessors=null,_allProcessorOptions="";