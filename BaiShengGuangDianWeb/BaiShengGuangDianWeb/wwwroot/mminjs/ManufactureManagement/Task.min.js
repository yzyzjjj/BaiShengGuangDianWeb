function pageReady(){$(".ms2").select2();$(".ms3").select2({allowClear:!0,placeholder:"请选择",multiple:!0});$("#6sGroupChangeCheck").iCheck("uncheck");$("#6sGroupChangeCheck").on("ifChanged",function(){$(this).is(":checked")?$("#6sGroupChangeDiv").removeClass("hidden"):$("#6sGroupChangeDiv").addClass("hidden")});$("#6sGroupSelect").on("select2:select",function(){initSurveyorSelect();getItemList()});init()}function init(n=0){var t=new Promise(function(t){getGroupList(t,n)}),i=new Promise(function(n){getSurveyorList(n)});Promise.all([t,i]).then(()=>{initSurveyorSelect(),getItemList()})}function _6sGroupChangeLabel(){var n=$("#new6sGroupTxt").val();isStrEmptyOrUndefined(n)&&$("#6sGroupChangeCheck").iCheck($("#6sGroupChangeCheck").is(":checked")?"uncheck":"check")}function new6sGroupTxt(){var n=$("#new6sGroupTxt").val();isStrEmptyOrUndefined(n)?($("#6sGroupSelect").removeAttr("disabled"),$("#6sGroupChangeCheck").removeAttr("disabled"),$("#6sGroupChangeCheckLbl").removeAttr("disabled")):($("#6sGroupChangeCheck").iCheck("uncheck"),$("#6sGroupChangeDiv").addClass("hidden"),$("#6sGroupSelect").attr("disabled","disabled"),$("#6sGroupChangeCheck").attr("disabled","disabled"),$("#6sGroupChangeCheckLbl").attr("disabled","disabled"))}function getGroupList(n,t=0){var r=900,i;if(!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;ajaxPost("/Relay/Post",i,function(i){var r,f;if(n!=null&&n("success"),i.errno!=0){layer.msg(i.errmsg);return}$("#6sGroupSelect").empty();r=i.datas;_groups=r;for(var o=r.length,e="",u=0;u<o;u++)f=r[u],e+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.Group);$("#6sGroupSelect").append(e);$("#6sGroupSelect").val(t).trigger("change")})}function getSurveyorList(n){var i=254,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var i,f;if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}$("#surveyorSelect").empty();i=t.datas;_surveyors=i;for(var e=i.length,u="",r=0;r<e;r++)f=i[r],u+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.SurveyorName);_surveyorOptions=u;$("#surveyorSelect").append(u)})}function initSurveyorSelect(){var i,n,t;if($("#surveyorSelect").val("").trigger("change"),i=$("#6sGroupSelect").val(),!isStrEmptyOrUndefined(i)&&_groups&&_groups.length>0)for(n=0;n<_groups.length;n++)t=_groups[n],t.Id==i&&($("#surveyorSelect").attr("old",t.SurveyorId),$("#surveyorSelect").val(t.SurveyorId.split(",")).trigger("change"))}function getItemList(){var t,i,n;if($("#itemList").empty(),t=904,!checkPermission(t)){layer.msg("没有权限");return}i=$("#6sGroupSelect").val();isStrEmptyOrUndefined(i)||(n={},n.opType=t,n.opData=JSON.stringify({qId:i}),ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}item=n.datas;initItemList()}))}function initItemList(){var r,i;if($("#6sGroupChangeCheck").iCheck("uncheck"),$("#6sGroupChangeDiv").addClass("hidden"),$("#6sGroupChangeTxt").val(""),$("#itemList").empty(),itemMax=itemMaxV=0,item&&item.length>0){for(itemMax=itemMaxV=item.length,r="",i=0;i<item.length;i++){var t=i+1,n=item[i],u=`<tr id="item${t}" value="${t}" xh="${t}" itemId="${n.Id}">
                    <td style="width:50px;">
                       <input id="itemChose${t}" type="checkbox" class="icb_minimal chose">
                    </td>
                    <td style="width:50px;" id="itemXh${t}">
                        ${t}
                    </td>
                    <td style="width:80px;">
                        <span class="chose1" id ="itemOrder1${t}">${n.Order}</span >
                        <input class="chose2 hidden form-control text-center" old="${n.Order}" id="itemOrder2${t}" style="width:80px;" type="tel" value="0" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" maxlength="10">
                    </td>
                    <td style="width:200px;">
                        <span class="chose1" id ="itemName1${t}">${n.Item}</span >
                        <input class="chose2 hidden form-control text-center" old="${n.Item}" id="itemName2${t}" maxlength="100">
                    </td>
                    <td style="width:80px;">
                        <input id="itemEnable${t}" old="${n.Enable}" type="checkbox" class="icb_minimal enable">
                    </td>
                    <td style="width:80px;">
                        <span class="chose1" id ="itemStandard1${t}">${n.Standard}</span >
                        <input class="chose2 hidden form-control text-center" old="${n.Standard}" id="itemStandard2${t}" style="width:80px;" type="tel" value="0" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" maxlength="10">
                    </td>
                    <td class="no-padding">
                    ${(n.Reference.length>tdShowLength?`<span id="itemReference1${t}" title="${n.Reference}" class="chose1" onclick = "showAllContent('${escape(n.Reference)}', '要求及目标')">${n.Reference.substring(0,tdShowLength)}...</span>`:`<span id="itemReference1${t}" title="${n.Reference}" class="chose1">${n.Reference}</span>`)+`<textarea id="itemReference2${t}" old="${n.Reference}" class="chose2 hidden form-control" maxlength = "500" style = "resize: vertical;margin:auto" ></textarea>`}
                    </td>
                    <td style="width:100px;">
                        <span class="chose1" id ="itemInterval1${t}" interval="${n.Interval}" day="${n.Day}" week="${n.Week}">${n.Interval==0?"":n.Interval==1?`${n.Day}天/次`:`${n.Week}周/次`}</span >
                        <div class="chose2 hidden form-inline" interval="${n.Interval}" day="${n.Day}" week="${n.Week}">
                            <input class="form-control" id ="itemInterval21${t}" maxlength="3" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" style="width:50px" value="1">
                            <select class="form-control" id ="itemInterval22${t}">
                               <option value="1">天</option>
                               <option value="2">周</option>
                            </select>
                        </div>
                    </td>
                    <td style="width:100px;">
                        <span class="chose1" id="itemPerson1${t}" old="${n.Person}">${n.SurveyorName}</span>
                        <div class="chose2 hidden">
                            <select class="ms2 form-control" id ="itemPerson2${t}" old="${n.Person}">
                               ${_surveyorOptions}
                            </select>
                        </div>
                    </td>
                    <td style="width:50px;">
                        <button type="button" class="btn btn-danger btn-sm" id="delItemList${t}" onclick="delItemList(${t})"><i class="fa fa-minus"></i></button>
                    </td>
                </tr>`;r+=u}$("#itemList").append(r);$("#itemList .ms2").select2({width:"120px"});$("#itemList .chose").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"});$("#itemList .enable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_polaris",increaseArea:"20%"}).iCheck("disable");$("#itemList .enable[old='true']").iCheck("check");$("#itemList .chose").on("ifChanged",function(){var t=$(this).parents("tr:first"),n=t.attr("value");if($(this).is(":checked")){t.find(".chose1").addClass("hidden");t.find(".chose2").removeClass("hidden");$("#itemEnable"+n).iCheck($("#itemEnable"+n).attr("old")=="true"?"check":"uncheck").iCheck("enable");$("#itemOrder2"+n).val($("#itemOrder2"+n).attr("old"));$("#itemName2"+n).val($("#itemName2"+n).attr("old"));$("#itemStandard2"+n).val($("#itemStandard2"+n).attr("old"));$("#itemReference2"+n).html($("#itemReference2"+n).attr("old"));var i=$("#itemInterval21"+n).parents("div:first"),r=$(i).attr("interval"),u=r==0?"":r==1?$(i).attr("day"):$(i).attr("week");$("#itemInterval21"+n).val(u);$("#itemInterval22"+n).val(r);$("#itemPerson2"+n).val($("#itemPerson2"+n).attr("old")).trigger("change")}else t.find(".chose1").removeClass("hidden"),t.find(".chose2").addClass("hidden"),t.find(".enable").iCheck("disable"),$("#itemEnable"+n).iCheck($("#itemEnable"+n).attr("old")=="true"?"check":"uncheck").iCheck("disable")})}}function resetItemList(){var n=$("#new6sGroupTxt").val();isStrEmptyOrUndefined(n)||($("#6sGroupSelect").val(0).trigger("change"),item=null);itemMax=itemMaxV=0;initItemList()}function addOneItemList(){var n,i,t;itemMax++;itemMaxV++;n=itemMax;i=`
            <tr id="item${n}" value="${n}" xh="${itemMaxV}" itemId="0">
                <td style="width:50px;">
                </td>
                <td style="width:50px;" id="itemXh${n}">
                    ${itemMaxV}
                </td>
                <td style="width:50px;">
                    <input class="form-control text-center" type="tel" id="itemOrder2${n}" value="${itemMaxV}" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" maxlength="10">
                </td>
                <td style="width:200px;">
                    <input class="form-control text-center" id="itemName2${n}" maxlength="100">
                </td>
                <td style="width:50px;">
                    <input id="itemEnable${n}" type="checkbox" class="icb_minimal enable">
                </td>
                <td style="width:100px;">
                    <input class="form-control text-center" id="itemStandard2${n}" value="0" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" maxlength="10" style="width:100px;">
                </td>
                <td class="no-padding">
                    <textarea id="itemReference2${n}" class= "form-control" maxlength = "500" style = "resize: vertical;margin:auto"></textarea >
                </td>
                <td style="width:100px;">
                    <div class="form-inline">
                        <input class="form-control" id ="itemInterval21${n}" maxlength="3" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)" style="width:50px" value="1">
                        <select class="form-control" id ="itemInterval22${n}">
                           <option value="1">天</option>
                           <option value="2">周</option>
                        </select>
                    </div>
                </td>
                <td style="width:100px;">
                    <select class="ms2 form-control" id ="itemPerson2${n}" style="width:60px">
                       ${_surveyorOptions}
                    </select>
                </td>
                <td style="width:50px;">
                    <button type="button" class="btn btn-danger btn-sm" id="delItemList${n}" onclick="delItemList(${n})"><i class="fa fa-minus"></i></button>
                </td>
            </tr>`;$("#itemList").append(i);t="#item"+n;$(t).find(".ms2").select2({width:"120px"});$(t).find(".enable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_polaris",increaseArea:"20%"}).iCheck("check")}function delItemList(n){var i,r,t,u;for($("#itemList").find(`tr[value=${n}]:first`).remove(),itemMaxV--,i=1,r=$("#itemList tr"),t=0;t<r.length;t++)$(r[t]).attr("xh",i),u=$(r[t]).attr("value"),$("#itemXh"+u).html(i),i++}function saveItemList(){var a=$("#new6sGroupTxt").val(),k=$("#6sGroupChangeTxt").val(),d=$("#surveyorSelect").val(),t={},f=0,i=0,r=!1,g,v,y,s,h,p,c,w,l,e,o,b,u,rt;if(isStrEmptyOrUndefined(a)){if(i=901,f=$("#6sGroupSelect").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择分组");return}t.Id=f;$("#6sGroupChangeCheck").is(":checked")&&$("#6sGroupSelect option:selected").text()!=k&&(r=!0,t.Group=k)}else{if(isStrEmptyOrUndefined(a))return;i=902;r=!0;t.Group=a}if(g=isStrEmptyOrUndefined($("#surveyorSelect").attr("old"))?"":$("#surveyorSelect").attr("old"),v=d==null?"":d.join(),i==901&&g!=v&&(r=!0),t.SurveyorId=v,!checkPermission(i)){layer.msg("没有权限");return}for(var nt=[],tt=0,it=0,n=1;n<=itemMax;n++)if($("#item"+n).length>0){if(y=$("#item"+n).attr("itemId"),u=0,y==0?(u=2,it++):(tt++,$("#itemChose"+n).is(":checked")?(u=2,r=!0):u=1),u==1)s=$("#itemOrder1"+n).html(),h=$("#itemName1"+n).html(),p=$("#itemEnable"+n).is(":checked"),c=$("#itemStandard1"+n).html(),w=$("#itemReference1"+n).attr("title"),l=$("#itemInterval1"+n).attr("interval"),e=$("#itemInterval1"+n).attr("day"),o=$("#itemInterval1"+n).attr("week"),b=$("#itemPerson1"+n).attr("old");else if(u==2)s=$("#itemOrder2"+n).val(),h=$("#itemName2"+n).val(),p=$("#itemEnable"+n).is(":checked"),c=$("#itemStandard2"+n).val().trim(),w=$("#itemReference2"+n).val().trim(),l=$("#itemInterval22"+n).val().trim(),l==1?(e=$("#itemInterval21"+n).val().trim(),o=0):(e=0,o=$("#itemInterval21"+n).val().trim()),b=$("#itemPerson2"+n).val();else return;if(isStrEmptyOrUndefined(s)){layer.msg("请输入顺序");return}if(isStrEmptyOrUndefined(h)){layer.msg("请输入检查项目");return}if(isStrEmptyOrUndefined(c)){layer.msg("请输入标准分");return}if(e+o<=0){layer.msg("请输入频次");return}nt.push({Id:y,Order:s,Item:h,GroupId:f,Enable:p,Standard:c,Reference:w,Interval:l,Day:e,Week:o,Person:b})}(t.Items=nt,(it>0||i==901&&tt!=item.length)&&(r=!0),r)&&(rt=function(){var n={};n.opType=i;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&init(f)})},showConfirm("保存",rt))}function delGroup(){var t=903,n,i;if(!checkPermission(t)){layer.msg("没有权限");return}if(n=$("#6sGroupSelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择分组");return}i=function(){var i={};i.opType=t;i.opData=JSON.stringify({ids:[n]});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&init()})};showConfirm("删除分组："+$("#6sGroupSelect option:selected").text(),i)}var _groups=null,_surveyors=null,_surveyorOptions="",itemMax=0,itemMaxV=0,item=null,itemLength=0;