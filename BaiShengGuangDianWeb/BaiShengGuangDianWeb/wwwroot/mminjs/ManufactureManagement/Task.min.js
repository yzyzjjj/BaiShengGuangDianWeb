function pageReady(){$(".ms2").select2();getTaskConfig();$("#configItem").on("ifChanged",".isEnable",function(){var n=$(this).parents("tr"),u=$(this).val(),t=_taskItem[u],i,r;$(this).is(":checked")?(n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden"),i=t.GroupId,n.find(".group").val(i).trigger("change"),r=n.find(".processor"),setProcessorSelect(i,r),r.val(t.Person).trigger("change"),n.find(".module").val(t.ModuleId).trigger("change"),t.IsCheck?(n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"),n.find(".taskNameSelect").val(t.CheckId).trigger("change")):n.find(".taskNameSelect").parent().addClass("hidden").siblings().removeClass("hidden"),n.find(".taskName").val(t.Item),n.find(".hour").val(t.EstimatedHour),n.find(".minute").val(t.EstimatedMin),n.find(".score").val(t.Score),n.find(".desc").val(t.Desc),n.find(".relation").val(t.Relation)):n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")});$("#configItem").on("select2:select",".group",function(){var n=$(this).val(),t=$(this).parents("tr").find(".processor");setProcessorSelect(n,t)});$("#configItem").on("select2:select",".module",function(){var t=$(this).val(),i=$(this).find(`option[value=${t}]`).attr("isCheck"),n=$(this).parents("tr");parseInt(i)?n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"):n.find(".taskNameSelect").parent().addClass("hidden").siblings().removeClass("hidden")});$("#selectConfig").on("select2:select",function(){getTaskConfigItem()})}function setProcessorSelect(n,t){var f,u,i,e,r;for(t.empty(),f='<option value = "{0}">{1}<\/option>',u="",i=0,e=_processor.length;i<e;i++)r=_processor[i],n==r.GroupId&&(u+=f.format(r.ProcessorId,r.Processor));t.append(u)}function getTaskConfig(){var t=1051,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}var r=n.datas,u="";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value = "{0}">{1}<\/option>'.format(i.Id,i.Task);$("#selectConfig").empty();$("#selectConfig").append(u);taskTrData()})}function getGroup(n){var i=1077,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0,e=u.length;i<e;i++)r=u[i],f+='<option value = "{0}">{1}<\/option>'.format(r.Id,r.Group);n!=null&&n(f)})}function getProcessor(n){var i=1081,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({groupId:0,menu:!0});ajaxPost("/Relay/Post",t,function(t){var f,r,i,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}for(_processor=t.datas,f='<option value = "{0}">{1}<\/option>',r="",i=0,e=_processor.length;i<e;i++)u=_processor[i],r+=f.format(u.ProcessorId,u.Processor);n!=null&&n(r)})}function getModule(n){var i=1058,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0,e=u.length;i<e;i++)r=u[i],f+='<option value = "{0}" isCheck = "{2}">{1}<\/option>'.format(r.Id,r.Module,r.IsCheck);n!=null&&n(f)})}function getTaskName(n){var i=1066,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var r,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}var f=t.datas,i="";for(r=0,e=f.length;r<e;r++)u=f[r],i+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Check);i=`<select class="ms2 form-control taskNameSelect">${i}</select>`;n!=null&&n(i)})}function setTableStyle(){$("#configItem").find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$("#configItem").find(".ms2").select2()}function taskTrData(){var n=new Promise(function(n){getGroup(n)}),t=new Promise(function(n){getProcessor(n)}),i=new Promise(function(n){getModule(n)}),r=new Promise(function(n){getTaskName(n)});Promise.all([n,t,i,r]).then(function(n){_taskTrData=`<tr>
            <td><input type="checkbox" class="icb_minimal isEnable" value={8} itemId={9}></td>
            <td class="num">{0}</td>
            <td>
            <span class="textOn">{1}</span>
            <div class="flexStyle textIn hidden" style="width: 240px;margin:auto"><select class="ms2 form-control group">${n[0]}</select><select class="ms2 form-control processor">${n[1]}</select></div>
            </td>
            <td><span class="textOn">{2}</span><div class="textIn hidden" style="width: 120px;margin:auto"><select class="ms2 form-control module">${n[2]}</select></div></td>
            <td><span class="textOn">{3}</span><div class="textIn hidden" style="width: 120px;margin:auto"><input type="text" class="form-control text-center taskName" maxlength="10"><div>${n[3]}</div></div></td>
            <td><span class="textOn">{4}</span>
            <div class="flexStyle textIn hidden" style="width:120px;margin:auto">
            <input type="text" class="form-control text-center hour" maxlength="2" oninput="value=value.replace(/[^\d]/g,'')">
            <label class="control-label" style="white-space: nowrap; margin: 0">小时</label>
            <input type="text" class="form-control text-center minute" maxlength="2" oninput="value=value.replace(/[^\d]/g,'')">
            <label class="control-label" style="white-space: nowrap; margin: 0">分</label>
            </div>
            </td>
            <td><span class="textOn">{5}</span><input type="text" class="form-control text-center textIn hidden score" maxlength="10" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto"></td>
            <td class="no-padding"><span class="textOn">{6}</span><textarea class="form-control textIn hidden desc" maxlength="500" style="resize: vertical;width:180px;margin:auto"></textarea></td>
            <td><span class="textOn">{7}</span><input type="text" class="form-control text-center textIn hidden relation" maxlength="10" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto"></td>
            <td><button type="button" class="btn btn-primary btn-sm">上移</button></td>
            </tr>`;getTaskConfigItem()})}function getTaskConfigItem(){var i=1055,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}(t=$("#selectConfig").val(),isStrEmptyOrUndefined(t))||(n={},n.opType=i,n.opData=JSON.stringify({taskId:t}),ajaxPost("/Relay/Post",n,function(n){var r,i,u,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(_taskItem=n.datas,r="",i=0,u=_taskItem.length;i<u;i++)t=_taskItem[i],r+=_taskTrData.format(i+1,t.Processor,t.Module,t.Item,t.EstimatedTime,t.Score,t.Desc,t.Relation,i,t.Id);$("#configItem").empty();$("#configItem").append(r);setTableStyle()}))}function updateTask(){var y=1056,h,c,t,p,n,i,l,r,a,u,v,f,e,o,w,s,b;if(!checkPermission(y)){layer.msg("没有权限");return}if(h=$("#selectConfig").val(),isStrEmptyOrUndefined(h)){layer.msg("请选择配置");return}for(c=[],t=0,p=$("#configItem tr").length;t<p;t++){if(n=$("#configItem tr").eq(t),i=n.find(".isEnable").attr("itemId"),i==null&&(i=0),l=n.find(".processor").val(),isStrEmptyOrUndefined(l)){layer.msg(`序列${t+1}：请选择操作员`);return}if(r=n.find(".module").val(),isStrEmptyOrUndefined(r)){layer.msg(`序列${t+1}：请选择模块名`);return}a=!!parseInt(n.find(".module").find(`option[value=${r}]`).attr("isCheck"));a?(u=parseInt(n.find(".taskNameSelect").val()),v=n.find(`.taskNameSelect option[value=${u}]`).text()):(u=0,v=n.find(".taskName").val());f=parseInt(n.find(".hour").val());isStrEmptyOrUndefined(f)&&(f=0);e=parseInt(n.find(".minute").val());isStrEmptyOrUndefined(e)&&(e=0);o=parseInt(n.find(".score").val());isStrEmptyOrUndefined(o)&&(o=0);w=n.find(".desc").val();s=parseInt(n.find(".relation").val());isStrEmptyOrUndefined(s)&&(s=0);c.push({TaskId:h,Order:t+1,Person:l,ModuleId:r,IsCheck:a,CheckId:u,Item:v,EstimatedHour:f,EstimatedMin:e,Score:o,Desc:w,Relation:s,Id:i})}b=function(){var n={};n.opType=y;n.opData=JSON.stringify(c);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getTaskConfigItem()})};showConfirm("保存",b)}var _processor=null,_taskTrData=null,_taskItem=null;