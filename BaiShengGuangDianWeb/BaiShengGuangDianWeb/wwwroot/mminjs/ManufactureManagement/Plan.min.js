function pageReady(){$(".ms2").select2();getTaskConfig();getTaskState();$("#startTime").val(getDate()).datepicker("update");$("#endTime").val(getDate()).datepicker("update");$("#planConfigList").on("ifChanged",".isEnable",function(){var n=$(this).parents("tr"),u=$(this).val(),t,i,r;$(this).is(":checked")?(_planIdData.push(u),t=_planConfigData[u],n.find(".planName").val(t.Plan),i=t.PlannedStartTime,i=i.slice(0,i.indexOf(" ")),i=="0001-01-01"&&(i=""),r=t.PlannedEndTime,r=r.slice(0,r.indexOf(" ")),r=="0001-01-01"&&(r=""),n.find(".sTime").val(i).datepicker("update"),n.find(".eTime").val(r).datepicker("update"),n.find(".hour").val(t.EstimatedHour),n.find(".minute").val(t.EstimatedMin),n.find(".taskConfig").val(t.TaskId).trigger("change"),n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden")):(_planIdData.splice(_planIdData.indexOf(u),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"))});$("#planConfigList,#planItemList").on("focus",".toZero",function(){var n=$(this).val();n==0&&$(this).val("")});$("#planConfigList,#planItemList").on("blur",".toZero",function(){var n=$(this).val();isStrEmptyOrUndefined(n)&&$(this).val("0")});$("#planConfigList,#planItemList").on("input",".minute",function(){var n=$(this).val();parseInt(n)>59&&$(this).val(59)});$("#planItemList").on("ifChanged",".isEnable",function(){var n=$(this).parents("tr"),u=$(this).val(),t=_planTaskItem[u],i,r;$(this).is(":checked")?(n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden"),i=t.GroupId,n.find(".group").val(i).trigger("change"),r=n.find(".processor"),setProcessorSelect(i,r),r.val(t.Person).trigger("change"),n.find(".module").val(t.ModuleId).trigger("change"),t.IsCheck?(n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"),n.find(".taskNameSelect").val(t.CheckId).trigger("change")):n.find(".taskNameSelect").parent().addClass("hidden").siblings().removeClass("hidden"),n.find(".taskName").val(t.Item),n.find(".hour").val(t.EstimatedHour),n.find(".minute").val(t.EstimatedMin),n.find(".score").val(t.Score),n.find(".desc").val(t.Desc),n.find(".relation").val(n.find(".relationText").text())):n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")});$("#planItemList").on("select2:select",".group",function(){var n=$(this).val(),t=$(this).parents("tr").find(".processor");setProcessorSelect(n,t)});$("#planItemList").on("select2:select",".module",function(){var t=$(this).val(),i=$(this).find(`option[value=${t}]`).attr("isCheck"),n=$(this).parents("tr");parseInt(i)?n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"):n.find(".taskNameSelect").parent().addClass("hidden").siblings().removeClass("hidden")});$("#planItemList").on("click",".moveUp",function(){var n,f,i,h,l;_isUpMove=!1;var t=$(this).parents("tr"),s=t.find(".relation"),a=s.is(":hidden"),u=a?t.find(".relationText").text():s.val();if(u=parseInt(u),n=t.find(".num").text(),n=parseInt(n),u+1==n){layer.msg("不能上移到关联任务前");return}for(f=t.nextAll(),i=0,h=f.length;i<h;i++){var c=f.eq(i),e=c.find(".relationText"),o=c.find(".relation"),r=n-1;switch(parseInt(e.text())){case n:e.text(r);break;case r:e.text(n)}switch(parseInt(o.val())){case n:o.val(r);break;case r:o.val(n)}}l=t.prev();l.before(t);setTableStyle("#planItemList")});$("#planItemList").on("input",".relation",function(){var t=$(this).val(),i,n;t=parseInt(t);i=$(this).parents("tr");n=i.find(".num").text();n=parseInt(n)-1;t>n&&$(this).val(n)});$("#planItemList").on("click",".delPlanItem",function(){for(var n=$(this).parents("tr"),i=n.find(".num").text(),r=n.nextAll(),t=0,o=r.length;t<o;t++){var u=r.eq(t),f=u.find(".relationText"),e=u.find(".relation");f.text()==i&&f.text(0);e.val()==i&&e.val(0)}n.remove();setTableStyle("#planItemList")});$("#planReuse").on("ifChanged",function(){$(this).is(":checked")?$("#updatePlanBtn").attr("disabled","disabled"):$("#updatePlanBtn").removeAttr("disabled")});$("#planSelect").on("select2:select",function(){$("#newPlan").val($(this).find("option:checked").text())});$(".maxHeight").css("maxHeight",innerHeight*.7)}function setProcessorSelect(n,t){var f,u,i,e,r;for(t.empty(),f='<option value = "{0}">{1}<\/option>',u="",i=0,e=_processor.length;i<e;i++)r=_processor[i],n==r.GroupId&&(u+=f.format(r.ProcessorId,r.Processor));t.append(u)}function getTaskState(){var t=1038,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#selectState").empty();var r=n.datas,u="<option value=0>所有状态<\/option>";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.State);$("#selectState").append(u)})}function getTaskConfig(){var t=1051,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var i,u,t,f,r;if(n.errno!=0){layer.msg(n.errmsg);return}for(i=n.datas,u='<option value = "{0}">{1}<\/option>',_taskConfigOp="",t=0,f=i.length;t<f;t++)r=i[t],_taskConfigOp+=u.format(r.Id,r.Task)})}function getPlanConfig(){var u=1039,r,n,t,i;if(!checkPermission(u)){layer.msg("没有权限");return}if(_planIdData=[],r=$("#selectState").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择状态");return}if(n=$("#startTime").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择开始时间");return}if(t=$("#endTime").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择结束时间");return}comTimeDay(n,t)||(i={},i.opType=u,i.opData=JSON.stringify({state:r,sTime:n,eTime:t,menu:!1}),ajaxPost("/Relay/Post",i,function(n){var t,i,u,r;if(n.errno!=0){layer.msg(n.errmsg);return}for(t=n.datas,_planConfigData={},i=0,u=t.length;i<u;i++)r=t[i],_planConfigData[r.Id]=r;var f=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n.Id}>`},e=function(n,t,i,r){return r.row+1},o=function(n){return`<span class="textOn">${n}</span><input type="text" class="form-control text-center textIn planName hidden" maxlength="20" style="width:120px">`},s=function(n){var t=n.slice(0,n.indexOf(" "));return t=="0001-01-01"&&(t=""),`<span class="textOn">${t}</span><input type="text" class="form_date form-control text-center textIn sTime hidden" style="width:120px;cursor: pointer">`},h=function(n){var t=n.slice(0,n.indexOf(" "));return t=="0001-01-01"&&(t=""),`<span class="textOn">${t}</span><input type="text" class="form_date form-control text-center textIn eTime hidden" style="width:120px;cursor: pointer">`},c=function(n){return`<span class="textOn">${n.EstimatedTime}</span>
            <div class="flexStyle textIn hidden" style="justify-content:center">
            <input type="text" class="form-control text-center hour toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" style="width:50px">
            <label class="control-label" style="white-space: nowrap; margin: 0">小时</label>
            <input type="text" class="form-control text-center minute toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" style="width:50px">
            <label class="control-label" style="white-space: nowrap; margin: 0">分</label>
            </div>`},l=function(n){return`<span class="textOn">${n}</span><div class="textIn hidden" style="width:120px;margin:auto"><select class="ms2 form-control taskConfig">${_taskConfigOp}</select></div>`},a=function(n){return n.State==1?`<button type="button" class="btn btn-info btn-sm" onclick="issuePlan(${n.Id})">下发</button>`:""},v=function(n){return`<button type="button" class="btn btn-primary btn-sm" onclick="planTaskDetail(${n.Id},'${n.Plan}')">查看任务</button>`},y=function(n){return`<button type="button" class="btn btn-success btn-sm" onclick="showLogModel(${n.Id})">查看</button>`};_planConfigTab=$("#planConfigList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"选择",render:f,orderable:!1},{data:null,title:"序号",render:e},{data:"Plan",title:"计划号",render:o},{data:"PlannedStartTime",title:"开始时间",render:s},{data:"PlannedEndTime",title:"结束时间",render:h},{data:null,title:"预计用时",render:c},{data:"Task",title:"任务配置",render:l},{data:null,title:"实施",render:a},{data:"StateDesc",title:"状态"},{data:null,title:"详情",render:v,orderable:!1},{data:null,title:"日志",render:y,orderable:!1}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$(this).find(".form_date").attr("readonly",!0).datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$(this).find(".ms2").select2()}})}))}function issuePlan(n){var t=1041,i,r;if(!checkPermission(t)){layer.msg("没有权限");return}i=_planConfigData[n].Plan;r=function(){var i={};i.opType=t;i.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getPlanConfig()})};showConfirm(`下发计划：${i}`,r)}function getGroup(n){var i=1077,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0,e=u.length;i<e;i++)r=u[i],f+='<option value = "{0}">{1}<\/option>'.format(r.Id,r.Group);n!=null&&n(f)},0)}function getProcessor(n){var i=1081,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({groupId:0,menu:!0});ajaxPost("/Relay/Post",t,function(t){var f,r,i,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}for(_processor=t.datas,f='<option value = "{0}">{1}<\/option>',r="",i=0,e=_processor.length;i<e;i++)u=_processor[i],r+=f.format(u.ProcessorId,u.Processor);n!=null&&n(r)},0)}function getModule(n){var i=1058,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var i,e,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0,e=u.length;i<e;i++)r=u[i],f+='<option value = "{0}" isCheck = "{2}">{1}<\/option>'.format(r.Id,r.Module,r.IsCheck);n!=null&&n(f)},0)}function getTaskName(n){var i=1066,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var r,e,u;if(t.errno!=0){layer.msg(t.errmsg);return}var f=t.datas,i="";for(r=0,e=f.length;r<e;r++)u=f[r],i+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Check);i=`<select class="ms2 form-control taskNameSelect">${i}</select>`;n!=null&&n(i)},0)}function planTaskTr(n){var t=new Promise(function(n){getGroup(n)}),i=new Promise(function(n){getProcessor(n)}),r=new Promise(function(n){getModule(n)}),u=new Promise(function(n){getTaskName(n)});Promise.all([t,i,r,u]).then(function(t){_planTaskTr=`<tr>
            <td class="isIssue"><input type="checkbox" class="icb_minimal isEnable" value={0}></td>
            <td class="num"></td>
            <td>
            <span class="textOn">{1}</span>
            <div class="flexStyle textIn hidden" style="width: 240px;margin:auto"><select class="ms2 form-control group">${t[0]}</select><select class="ms2 form-control processor">${t[1]}</select></div>
            </td>
            <td><span class="textOn">{2}</span><div class="textIn hidden" style="width: 120px;margin:auto"><select class="ms2 form-control module">${t[2]}</select></div></td>
            <td><span class="textOn">{3}</span><div class="textIn hidden" style="width: 120px;margin:auto"><input type="text" class="form-control text-center taskName" maxlength="10"><div>${t[3]}</div></div></td>
            <td><span class="textOn">{4}</span>
            <div class="flexStyle textIn hidden" style="width:140px;margin:auto">
            <input type="text" class="form-control text-center hour toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')">
            <label class="control-label" style="white-space: nowrap; margin: 0">小时</label>
            <input type="text" class="form-control text-center minute toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')">
            <label class="control-label" style="white-space: nowrap; margin: 0">分</label>
            </div>
            </td>
            <td><span class="textOn">{5}</span><input type="text" class="form-control text-center textIn hidden score toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto"></td>
            <td class="no-padding"><span class="textOn">{6}</span><textarea class="form-control textIn hidden desc" maxlength="500" style="resize: vertical;width:180px;margin:auto"></textarea></td>
            <td><span class="textOn relationText">{7}</span><input type="text" class="form-control text-center textIn hidden relation toZero" maxlength="10" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto"></td>
            <td class="isIssue"><button type="button" class="btn btn-primary btn-sm moveUp">上移</button></td>
            <td><button type="button" class="btn btn-success btn-sm" onclick="showLogModel({8},{0})">日志</button></td>
            <td class="isIssue"><button type="button" class="btn btn-danger btn-sm delPlanItem"><i class="fa fa-minus"></i></button></td>
            </tr>`;_addPlanTaskTr=`<tr>
            <td></td>
            <td class="num"></td>
            <td>
            <div class="flexStyle" style="width: 240px;margin:auto"><select class="ms2 form-control group">${t[0]}</select><select class="ms2 form-control processor">${t[1]}</select></div>
            </td>
            <td><div style="width: 120px;margin:auto"><select class="ms2 form-control module">${t[2]}</select></div></td>
            <td><div style="width: 120px;margin:auto"><input type="text" class="form-control text-center taskName" maxlength="10"><div class="hidden">${t[3]}</div></div></td>
            <td>
            <div class="flexStyle" style="width:140px;margin:auto">
            <input type="text" class="form-control text-center hour toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" value="0">
            <label class="control-label" style="white-space: nowrap; margin: 0">小时</label>
            <input type="text" class="form-control text-center minute toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" value="0">
            <label class="control-label" style="white-space: nowrap; margin: 0">分</label>
            </div>
            </td>
            <td><input type="text" class="form-control text-center score toZero" maxlength="3" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto" value="0"></td>
            <td class="no-padding"><textarea class="form-control desc" maxlength="500" style="resize: vertical;width:180px;margin:auto"></textarea></td>
            <td><input type="text" class="form-control text-center relation toZero" maxlength="10" oninput="value=value.replace(/[^\d]/g,'')" style="width:80px;margin:auto" value="0"></td>
            <td><button type="button" class="btn btn-primary btn-sm moveUp">上移</button></td>
            <td></td>
            <td><button type="button" class="btn btn-danger btn-sm delPlanItem"><i class="fa fa-minus"></i></button></td>
            </tr>`;n("success")})}function planTaskDetail(n,t){var r=1040,i;if(!checkPermission(r)){layer.msg("没有权限");return}_isUpMove=!0;$("#planText").text(t);$("#planText").attr("planid",n);i={};i.opType=r;i.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",i,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}new Promise(function(n){planTaskTr(n)}).then(()=>{var f=t.datas,u,r,e,i;for($("#planItemList").empty(),_planTaskItem={},u="",r=0,e=f.length;r<e;r++)i=f[r],_planTaskItem[i.Id]=i,u+=_planTaskTr.format(i.Id,i.Processor,i.Module,i.Item,i.EstimatedTime,i.Score,i.Desc,i.Relation,i.PlanId);$("#planItemList").append(u);setTableStyle("#planItemList");_planConfigData[n].State!=1?$("#planItem .isIssue").addClass("hidden"):$("#planItem .isIssue").removeClass("hidden");$("#planItem").removeClass("hidden")})})}function resetPlanItemList(){var n=$("#planText").attr("planid");planTaskDetail(n,$("#planText").text())}function addPlanTaskTr(){$("#planItemList").append(_addPlanTaskTr);var n=$("#planItemList tr:last"),t=n.find(".module option:selected").attr("ischeck");parseInt(t)?n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"):n.find(".taskName").removeClass("hidden").siblings().addClass("hidden");setTableStyle("#planItemList");$("#planItemTable").scrollTop($("#planItemTable")[0].scrollHeight)}function updatePlanTaskItem(){var b=1042,l,h,a,r,c,u,f,e,w,o,t,d;if(!checkPermission(b)){layer.msg("没有权限");return}var v=$("#planText").attr("planid"),g=_planConfigData[v].TaskId,y={Id:v,TaskId:g};y.Items=[];var i,p=$("#planItemList tr").length,nt=$("#planItemList .isEnable").is(":checked"),tt=$("#planItemList .isEnable").length;if(!p||tt==p&&!nt&&_isUpMove){layer.msg("请先修改数据");return}for(i=0;i<p;i++){var n=$("#planItemList tr").eq(i),k=n.find(".isEnable"),s=k.val();if(isStrEmptyOrUndefined(s)&&(s=0),k.is(":checked")||s==0){if(l=n.find(".processor").val(),isStrEmptyOrUndefined(l)){layer.msg(`序列${i+1}：请选择操作员`);return}if(h=n.find(".module").val(),isStrEmptyOrUndefined(h)){layer.msg(`序列${i+1}：请选择模块名`);return}if(a=!!parseInt(n.find(".module").find(`option[value=${h}]`).attr("isCheck")),a){if(r=n.find(".taskNameSelect").val(),isStrEmptyOrUndefined(r)){layer.msg(`序列${i+1}：请选择检验任务`);return}c=n.find(`.taskNameSelect option[value=${r}]`).text();r=parseInt(r)}else if(r=0,c=n.find(".taskName").val(),isStrEmptyOrUndefined(c)){layer.msg(`序列${i+1}：任务名不能为空`);return}u=n.find(".hour").val();isStrEmptyOrUndefined(u)&&(u=0);u=parseInt(u);f=n.find(".minute").val();isStrEmptyOrUndefined(f)&&(f=0);f=parseInt(f);e=n.find(".score").val();isStrEmptyOrUndefined(e)&&(e=0);e=parseInt(e);w=n.find(".desc").val();o=n.find(".relation").val()}else t=_planTaskItem[s],l=t.Person,h=t.ModuleId,a=t.IsCheck,r=t.CheckId,c=t.Item,u=t.EstimatedHour,f=t.EstimatedMin,e=t.Score,w=t.Desc,o=n.find(".relationText").text();isStrEmptyOrUndefined(o)&&(o=0);o=parseInt(o);y.Items.push({Order:i+1,Person:l,ModuleId:h,IsCheck:a,CheckId:r,Item:c,EstimatedHour:u,EstimatedMin:f,Score:e,Desc:w,Relation:o,Id:s})}d=function(){var n={};n.opType=b;n.opData=JSON.stringify([y]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&planTaskDetail(v,$("#planText").text())})};showConfirm("保存",d)}function setTableStyle(n){for(var i=$(`${n} tr .num`),t=0,r=i.length;t<r;t++)i.eq(t).text(t+1);$(n).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$(n).find(".ms2").select2();$(`${n} .moveUp`).removeClass("hidden");$(`${n} .moveUp`).eq(0).addClass("hidden")}function showLogModel(){}function delPlanConfig(){var f=1044,t,i,n,e,o,r,u,s;if(!checkPermission(f)){layer.msg("没有权限");return}if(t=_planIdData.length,!t){layer.msg("请选择需要删除的数据");return}for(i=_planConfigTab.context[0].aoData,t=i.length,n=0;n<t;n++)if(e=i[n].nTr,o=$(e).find(".isEnable"),o.is(":checked")&&(r=i[n]._aData.State,r!=1)){layer.msg(`序号${n+1}：${r}的计划不能删除`);return}for(u=[],n=0;n<t;n++)u.push(_planConfigData[_planIdData[n]].Plan);s=function(){var n={};n.opType=f;n.opData=JSON.stringify({ids:_planIdData});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getPlanConfig()})};showConfirm(`删除以下计划:<pre style='color:red'>${u.join("<br>")}</pre>`,s)}function updatePlanConfig(){var v=1042,i,r,s,n,t,h,c,y,l,u,f,e,o,a,p;if(!checkPermission(v)){layer.msg("没有权限");return}if(i=_planIdData.length,!i){layer.msg("请选择需要修改的数据");return}for(r=_planConfigTab.context[0].aoData,i=r.length,s=[],n=0;n<i;n++)if(t=r[n].nTr,h=$(t).find(".isEnable"),h.is(":checked")){if(c=r[n]._aData.State,c!=1){layer.msg(`序号${n+1}：${c}的计划不能保存`);return}if(y=h.val(),l=$(t).find(".planName").val(),isStrEmptyOrUndefined(l)){layer.msg(`序号${n+1}：计划号不能为空`);return}if(u=$(t).find(".sTime").val(),isStrEmptyOrUndefined(u)){layer.msg(`序号${n+1}：请选择开始时间`);return}if(f=$(t).find(".eTime").val(),isStrEmptyOrUndefined(f)){layer.msg(`序号${n+1}：请选择结束时间`);return}if(compareDate(u,f)){layer.msg(`序号${n+1}：开始时间不能大于结束时间`);return}if(e=$(t).find(".hour").val(),isStrEmptyOrUndefined(e)&&(e=0),o=$(t).find(".minute").val(),isStrEmptyOrUndefined(o)&&(o=0),a=$(t).find(".taskConfig").val(),isStrEmptyOrUndefined(a)){layer.msg(`序号${n+1}：请选择人物配置`);return}s.push({Id:y,Plan:l,PlannedStartTime:u,PlannedEndTime:f,EstimatedHour:e,EstimatedMin:o,TaskId:a})}p=function(){var n={};n.opType=v;n.opData=JSON.stringify(s);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getPlanConfig()})};showConfirm("保存",p)}function getPlanSelect(){var t=1039,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var i,f,t;if(n.errno!=0){layer.msg(n.errmsg);return}$("#planSelect").empty();var r=n.datas,u="";for(i=0,f=r.length;i<f;i++)t=r[i],u+='<option value = "{0}" taskid = "{2}" state="{3}">{1}<\/option>'.format(t.Id,t.Plan,t.TaskId,t.State);$("#planSelect").append(u);$("#planSelect").val(0).trigger("change")},0)}function showPlanModal(){getPlanSelect();$("#taskConfig").empty();$("#taskConfig").append(_taskConfigOp);$("#taskConfig").val(0).trigger("change");$("#newPlan").val("");$("#planReuse").iCheck("uncheck");$("#addPlanTaskList").empty();new Promise(function(n){planTaskTr(n)}).then(()=>{$("#showPlanModal").modal("show")})}function delPlanSelect(){var i=1044,n,t,r,u;if(!checkPermission(i)){layer.msg("没有权限");return}if(n=$("#planSelect"),t=n.val(),isStrEmptyOrUndefined(t)){layer.msg("请选择计划");return}if(r=n.find("option:selected").attr("state"),r!=1){layer.msg("非待下发状态的计划不能删除");return}u=function(){var n={};n.opType=i;n.opData=JSON.stringify({ids:[t]});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getPlanSelect()})};showConfirm(`删除计划：${n.find("option:selected").text()}`,u)}function addPlanTaskConTr(){$("#addPlanTaskList").append(_addPlanTaskTr);var n=$("#addPlanTaskList tr:last"),t=n.find(".module option:selected").attr("ischeck");parseInt(t)?n.find(".taskName").addClass("hidden").siblings().removeClass("hidden"):n.find(".taskName").removeClass("hidden").siblings().addClass("hidden");setTableStyle("#addPlanTaskList");$("#addPlanTaskTable").scrollTop($("#addPlanTaskTable")[0].scrollHeight)}var _taskConfigOp=null,_planConfigData=null,_planConfigTab=null,_processor=null,_planTaskTr=null,_planTaskItem=null,_addPlanTaskTr=null,_isUpMove=!0,_planIdData=[];