function pageReady(){_permissionList[392]={uIds:["getAccountTaskBtn"]};_permissionList[393]={uIds:["startBtn"]};_permissionList[394]={uIds:["pauseBtn"]};_permissionList[395]={uIds:["finishBtn"]};_permissionList=checkPermissionUi(_permissionList);$(".ms2").select2();$(".table-bordered td").css("border","1px solid");getGroup();$("#groupSelect").on("select2:select",function(){getProcessor();getScoreList()})}function getGroup(){var n={};n.opType=1077;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#groupSelect").empty();var r=n.datas,u="";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value = "{0}">{1}<\/option>'.format(i.Id,i.Group);$("#groupSelect").append(u);getProcessor();getScoreList()})}function getProcessor(){var t=$("#groupSelect").val(),n={};n.opType=1081;n.opData=JSON.stringify({groupId:t,menu:!0});ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#processorSelect").empty();var r=n.datas,u="";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value = "{0}" account="{2}">{1}<\/option>'.format(i.Id,i.Processor,i.Account);$("#processorSelect").append(u)})}function getScoreList(){var t=$("#groupSelect").val(),n={};n.opType=1003;n.opData=JSON.stringify({gId:t});ajaxPost("/Relay/Post",n,function(n){var i,r,t,f,u;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#scoreList").empty(),i=n.datas,r="",t=0,f=i.length;t<f;t++)u=i[t],r+=`<tr><td>${t+1}</td><td>${u.Processor}</td><td>${u.Score}</td></tr>`;$("#scoreList").append(r)})}function getAccountTask(){var n,t;if(_taskData={},n=$("#processorSelect option:selected").attr("account"),isStrEmptyOrUndefined(n)){layer.msg("请选择操作员");return}_taskData.Account=n;t={};t.opType=1e3;t.opData=JSON.stringify({account:n});ajaxPost("/Relay/Post",t,function(n){var t,i,r;if(n.errno!=0){layer.msg(n.errmsg);$("#taskDetail").addClass("hidden");$("#finishList").addClass("hidden");return}t=n.datas[0];_taskData.TaskId=t.Id;t.IsRedo?$("#redo").removeClass("hidden"):$("#redo").addClass("hidden");i=t.State;$("#startBtn").prop("disabled",!(i==0||i==2));$(".finish").prop("disabled",i!=1);$("#taskName").text(t.Item);$("#planName").text(t.Plan);$("#actualStartTime").text(noShowSecond(t.ActualStartTime));$("#actualTime").text(t.ActualTime);$("#taskDesc").val(t.Desc);$("#estimatedTime").text(t.EstimatedTime);$("#score").text(t.Score);$("#processor").text(t.Processor);$("#assignor").text(t.Assignor);$("#nextTask").text(t.NextTask);r=t.CheckProcessor;isStrEmptyOrUndefined(r)?($("#checkProcessor").addClass("hidden"),$("#checkProcessor").prev().addClass("hidden")):$("#checkProcessor").text(r);$("#taskDetail").removeClass("hidden");getUnFinishedList(0,"#unFinishEdList");getUnFinishedList(1,"#finishEdList")})}function taskHandle(n){var t=null,i;switch(n){case 0:t=1004;break;case 1:t=1005;break;case 2:t=1006}i={};i.opType=t;i.opData=JSON.stringify(_taskData);ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getAccountTask()})}function getUnFinishedList(n,t,i){var u=n?1002:1001,f=_taskData.Account,r;i==null&&(i=10);r={};r.opType=u;r.opData=JSON.stringify({account:f,limit:i});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var r=n.datas,u=function(n,t,i,r){return r.row+1};$(t).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:r,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:null,title:"序号",render:u},{data:"Item",title:"任务名称"},{data:"Plan",title:"所属计划号"},{data:"EstimatedTime",title:"预计用时"},{data:"Score",title:"任务绩效"},{data:"ActualTime",title:"实际工时",visible:i!==10},{data:"ActualScore",title:"实际绩效",visible:i!==10}]});$("#finishList").removeClass("hidden")})}var _permissionList=[],_taskData=null;