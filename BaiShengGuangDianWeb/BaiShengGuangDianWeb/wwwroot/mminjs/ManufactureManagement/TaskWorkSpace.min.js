function pageReady(){$(".ms2").select2();$(".table-bordered td").css("border","1px solid");getGroup();$("#groupSelect").on("select2:select",function(){getProcessor();getScoreList()})}function getGroup(){var t=1077,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#groupSelect").empty();var r=n.datas,u="";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value = "{0}">{1}<\/option>'.format(i.Id,i.Group);$("#groupSelect").append(u);getProcessor();getScoreList()})}function getProcessor(){var t=1081,i,n;if(!checkPermission(t)){layer.msg("没有权限");return}i=$("#groupSelect").val();n={};n.opType=t;n.opData=JSON.stringify({groupId:i,menu:!0});ajaxPost("/Relay/Post",n,function(n){var t,f,i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#processorSelect").empty();var r=n.datas,u="";for(t=0,f=r.length;t<f;t++)i=r[t],u+='<option value = "{0}" account="{2}">{1}<\/option>'.format(i.ProcessorId,i.Processor,i.Account);$("#processorSelect").append(u)})}function getScoreList(){var t=1003,i,n;if(!checkPermission(t)){layer.msg("没有权限");return}i=$("#groupSelect").val();n={};n.opType=t;n.opData=JSON.stringify({gId:i});ajaxPost("/Relay/Post",n,function(n){var i,r,t,f,u;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#scoreList").empty(),i=n.datas,r="",t=0,f=i.length;t<f;t++)u=i[t],r+=`<tr><td>${t+1}</td><td>${u.Processor}</td><td>${u.Score}</td></tr>`;$("#scoreList").append(r)})}function getAccountTask(){var i=1e3,n,t;if(!checkPermission(i)){layer.msg("没有权限");return}if(_taskData={},n=$("#processorSelect option:selected").attr("account"),isStrEmptyOrUndefined(n)){layer.msg("请选择操作员");return}_taskData.Account=n;t={};t.opType=i;t.opData=JSON.stringify({account:n});ajaxPost("/Relay/Post",t,function(n){var t,i;if(n.errno!=0){layer.msg(n.errmsg);$("#taskDetail").addClass("hidden");$("#finishList").addClass("hidden");return}t=n.datas[0];_taskData.TaskId=t.Id;t.IsRedo?$("#redo").removeClass("hidden"):$("#redo").addClass("hidden");$("#startBtn").prop("disabled",!(t.State==0||t.State==2));$("#pauseBtn,#finishBtn").prop("disabled",t.State!=1);$("#taskName").text(t.Item);$("#planName").text(t.Plan);$("#actualStartTime").text(t.ActualStartTime);$("#actualTime").text(t.ActualTime);$("#taskDesc").val(t.Desc);$("#estimatedTime").text(t.EstimatedTime);$("#score").text(t.Score);$("#processor").text(t.Processor);$("#assignor").text(t.Assignor);$("#nextTask").text(t.NextTask);i=t.CheckProcessor;isStrEmptyOrUndefined(i)?($("#checkProcessor").addClass("hidden"),$("#checkProcessor").prev().addClass("hidden")):$("#checkProcessor").text(i);$("#taskDetail").removeClass("hidden");getUnFinishedList(0,"#unFinishEdList");getUnFinishedList(1,"#finishEdList")})}function taskHandle(n){var t,i;switch(n){case 0:t=1004;break;case 1:t=1005;break;case 2:t=1006}if(!checkPermission(t)){layer.msg("没有权限");return}i={};i.opType=t;i.opData=JSON.stringify(_taskData);ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);n.errno==0&&getAccountTask()})}function getUnFinishedList(n,t,i){var u=n?1002:1001,f,r;if(!checkPermission(u)){layer.msg("没有权限");return}f=_taskData.Account;i==null&&(i=10);r={};r.opType=u;r.opData=JSON.stringify({account:f,limit:i});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var r=n.datas,u=function(n,t,i,r){return r.row+1};$(t).DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:r,aaSorting:[[0,"asc"]],aLengthMenu:[10,40,60],iDisplayLength:10,columns:[{data:null,title:"序号",render:u},{data:"Item",title:"任务名称"},{data:"Plan",title:"所属计划号"},{data:"EstimatedTime",title:"预计用时"},{data:"Score",title:"任务绩效"},{data:"ActualTime",title:"实际工时",visible:i!==10},{data:"ActualScore",title:"实际绩效",visible:i!==10}]});$("#finishList").removeClass("hidden")})}var _taskData=null;