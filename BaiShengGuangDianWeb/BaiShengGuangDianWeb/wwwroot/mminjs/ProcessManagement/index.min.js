function pageReady(){$(".ms2").select2();getProcessList();$("#pdProcess1").on("select2:select",function(){var n=$("#pdProcess1").val();showProcessDetailModel(n)});$("#pdProductionProcessName2").on("select2:select",function(){var n=$("#pdProductionProcessName2").val();showProcessDetailModel(n)});$("#pdDeviceModel3").on("select2:select",function(){var n=$("#pdDeviceModel3").val();showProcessDetailModel(n)});$("#pdCode4").on("select2:select",function(){var n=$("#pdCode4").val();showProcessDetailModel(n)});$(".ms3").select2({allowClear:!0,placeholder:"请选择"});$("#apDeviceModel").on("select2:select",function(){getDeviceList(-1)});$("#apDeviceModel").on("select2:unselect",function(){getDeviceList(-1)});$("#apProductionProcessName").on("select2:select",function(){getDeviceList(-1)});$("#apProductionProcessName").on("select2:unselect",function(){getDeviceList(-1)});checkPermission(316)||$("#showAddModel").addClass("hidden");$("#apBody").off("focusin").on("focusin","input",function(){var n=$(this).val();n==0&&$(this).val("")});$("#apBody").off("focusout").on("focusout","input",function(){var n=$(this).val();isStrEmptyOrUndefined(n)&&$(this).val("0")})}function getProcessList(n=307){var t=n,i;if(n==-1){if(lastType==0)return;t=lastType}if(!checkPermission(t)){layer.msg("没有权限");return}n!=-1&&(lastType=n);i={};i.opType=t;ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}lastData=n.datas;var e=function(n){var t='<button type="button" class="btn btn-primary" onclick="showProcessDetailModel({0})">详情<\/button>'.format(n.Id),i='<button type="button" class="btn btn-warning" onclick="showUpdateProcessModel({0})">修改<\/button>'.format(n.Id),r='<button type="button" class="btn btn-info" onclick="showAddModel({0})">拷贝<\/button>'.format(n.Id),u='<button type="button" class="btn btn-danger" onclick="deleteProcess({0}, \'{1}\')">删除<\/button>'.format(n.Id,escape(n.ProcessNumber));return"{0}{1}{2}{3}".format(checkPermission(313)?t:"",checkPermission(313)&&lastType==307?i:"",checkPermission(316)&&lastType==307?r:"",checkPermission(317)&&lastType==307?u:"")},o=0,t=function(){return++o},s=checkPermission(313)||(checkPermission(316)||checkPermission(317))&&lastType==307?[{data:null,title:"操作",render:e},{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"ProcessNumber",title:"工艺编号"},{data:"ModelName",title:"设备型号"},{data:"ProductionProcessName",title:"产品型号"},{data:"Code",title:"机台号"}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"ProcessNumber",title:"工艺编号"},{data:"ModelName",title:"设备型号"},{data:"ProductionProcessName",title:"产品型号"},{data:"Code",title:"机台号"}],i=function(n,t,i){return i.ProcessNumber?i.ProcessNumber.length>tdShowContentLength?i.ProcessNumber.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}', '{1}')\">...<\/a> ".format(escape(i.ProcessNumber),escape("工艺编号")):i.ProcessNumber:""},r=function(n,t,i){return i.ModelName?i.ModelName.length>tdShowContentLength?i.ModelName.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}', '{1}')\">...<\/a> ".format(escape(i.ModelName),escape("设备型号")):i.ModelName:""},u=function(n,t,i){return i.ProductionProcessName?i.ProductionProcessName.length>tdShowContentLength?i.ProductionProcessName.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}', '{1}')\">...<\/a> ".format(escape(i.ProductionProcessName),escape("产品型号")):i.ProductionProcessName:""},f=function(n,t,i){return i.Code?i.Code.length>tdShowContentLength?i.Code.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}', '{1}')\">...<\/a> ".format(escape(i.Code),escape("机台号")):i.Code:""},h=checkPermission(313)||(checkPermission(316)||checkPermission(317))&&lastType==307?[{orderable:!1,targets:0},{targets:[4],render:i},{targets:[5],render:r},{targets:[6],render:u},{targets:[7],render:f,type:"html-percent"}]:[{targets:[3],render:i},{targets:[4],render:r},{targets:[5],render:u},{targets:[6],render:f,type:"html-percent"}];$("#processList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:s,columnDefs:h})})}function showDetailModel(n,t){n=unescape(n);t=unescape(t);$("#detailTitle").text(t);$("#detail").text(n);$("#detailModel").modal("show")}function deleteProcess(n,t){var i,r;if(t=unescape(t),i=317,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getProcessList(lastType)})};showConfirm("删除工艺编号："+t,r)}function showProcessDetailModel(n){$(".dd").addClass("hidden");$("."+lastType).removeClass("hidden");var f,u,i,t,r;switch(lastType){case 307:if($("#pdProcess1").empty(),$("#pdDeviceModel1").html(""),$("#pdProductionProcessName1").html(""),$("#pdCode1").html(""),$("#pdProcessDataList1").empty(),lastData.length>0){for(u=!1,f='<option value="{0}">{1}<\/option>',i=0;i<lastData.length;i++)t=lastData[i],$("#pdProcess1").append(f.format(t.Id,t.ProcessNumber)),t.Id==n&&(u=!0,$("#pdDeviceModel1").html(t.ModelName),$("#pdProductionProcessName1").html(t.ProductionProcessName),$("#pdCode1").html(t.Code));n=u?n:lastData[0].Id;$("#pdProcess1").val(n).trigger("change");r={};r.opType=300;r.opData=JSON.stringify({Id:n});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=function(n){return n.PressurizeMinute+" : "+n.PressurizeSecond},i=function(n){return n.ProcessMinute+" : "+n.ProcessSecond};$("#pdProcessDataList1").DataTable({destroy:!0,bSort:!1,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],columns:[{data:"ProcessOrder",title:"NO"},{data:null,title:"加压时间(M:S)",render:t},{data:null,title:"工序时间(M:S)",render:i},{data:"Pressure",title:"设定压力(Kg)"},{data:"Speed",title:"下盘速度(rpm)"}]});$("#processDetailModel").modal("show")})}else $("#processDetailModel").modal("show");break;case 308:if($("#pdProductionProcessName2").empty(),$("#pdProcessList2").empty(),lastData.length>0){for(u=!1,f='<option value="{0}">{1}<\/option>',i=0;i<lastData.length;i++)t=lastData[i],t.Id==n&&(u=!0),$("#pdProductionProcessName2").append(f.format(t.Id,t.ProductionProcessName));n=u?n:lastData[0].Id;$("#pdProductionProcessName2").val(n).trigger("change");r={};r.opType=320;r.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=0,i=function(){return++t};$("#pdProcessList2").DataTable({destroy:!0,bSort:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],columns:[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"ProcessNumber",title:"工艺编号"},{data:"Code",title:"适用机台号"}],columnDefs:[{targets:[3],render:function(n,t,i){return i.Code?i.Code.length>tdShowContentLength?i.Code.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}','{1}')\">...<\/a> ".format(escape(i.Code),escape("适用机台号")):i.Code:""}}]});$("#processDetailModel").modal("show")})}else $("#processDetailModel").modal("show");break;case 309:if($("#pdDeviceModel3").empty(),$("#pdProcessList3").empty(),lastData.length>0){for(u=!1,f='<option value="{0}">{1}<\/option>',i=0;i<lastData.length;i++)t=lastData[i],t.Id==n&&(u=!0),$("#pdDeviceModel3").append(f.format(t.Id,t.ModelName));n=u?n:lastData[0].Id;$("#pdDeviceModel3").val(n).trigger("change");r={};r.opType=321;r.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=0,i=function(){return++t};$("#pdProcessList3").DataTable({destroy:!0,bSort:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],columns:[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"Code",title:"机台号"},{data:"ProcessNumber",title:"所用工艺编号"}],columnDefs:[{type:"html-percent",targets:[2]},{targets:[3],render:function(n,t,i){return i.ProcessNumber?i.ProcessNumber.length>tdShowContentLength?i.ProcessNumber.substr(0,tdShowContentLength)+"<a href = \"javascript:showDetailModel('{0}','{1}')\">...<\/a> ".format(escape(i.ProcessNumber),escape("所用工艺编号")):i.ProcessNumber:""}}]});$("#processDetailModel").modal("show")})}else $("#processDetailModel").modal("show");break;case 310:if($("#pdCode4").empty(),$("#pdDeviceModel4").html(""),$("#pdProcessList4").empty(),lastData.length>0){for(u=!1,f='<option value="{0}">{1}<\/option>',i=0;i<lastData.length;i++)t=lastData[i],t.Id==n&&(u=!0),$("#pdCode4").append(f.format(t.Id,t.Code));n=u?n:lastData[0].Id;$("#pdCode4").val(n).trigger("change");r={};r.opType=322;r.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#pdDeviceModel4").html(n.datas[0].ModelName);var t=0,i=function(){return++t};$("#pdProcessList4").DataTable({destroy:!0,bSort:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],columns:[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"ProductionProcessName",title:"产品型号"},{data:"ProcessNumber",title:"工艺编号"}]});$("#processDetailModel").modal("show")})}else $("#processDetailModel").modal("show")}}function showAddModel(n){if($(".opb").addClass("hidden"),$("#addProcess").removeClass("hidden"),cData=null,hideClassTip("adt"),$("#apProcess").val(""),n==null)apReset(),getMenuList();else{$("#apBody").empty();$("#addOtherBtn").removeClass("hidden");max=maxV=1;var t={};t.opType=300;t.opData=JSON.stringify({Id:n});ajaxPost("/Relay/Post",t,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}if(n.datas.length>0){for(r='<tr id="ap{0}" value="{2}"><td><label class="control-label" id="apx{0}">{1}<\/label><\/td><td><input type="tel" class="form-control text-center" id="apJy1{0}" value="{3}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apJy2{0}" value="{4}" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx1{0}" value="{5}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx2{0}" value="{6}" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apYl{0}"  value="{7}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apSd{0}"  value="{8}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>',i=0;i<n.datas.length;i++)t=n.datas[i],$("#apBody").append(r.format(max,maxV,t.Id,t.PressurizeMinute,t.PressurizeSecond,t.ProcessMinute,t.ProcessSecond,t.Pressure,t.Speed)),max++,maxV++;n.datas.length==maxProcessData&&$("#addOtherBtn").addClass("hidden")}getMenuList()})}}function getMenuList(){var n=new Promise(function(n){getDeviceModelList(n)}),t=new Promise(function(n){getProductionProcessList(n)}),i=new Promise(function(n){getDeviceList(0,n)});Promise.all([n,t,i]).then(()=>{})}function getDeviceModelList(n=null){$("#apDeviceModel").empty();var t=120;if(!checkPermission(t)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:t},function(t){var u,i,r;if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}for(u='<option value="{0}">{1}<\/option>',i=0;i<t.datas.length;i++)r=t.datas[i],$("#apDeviceModel").append(u.format(r.Id,r.CategoryName+"-"+r.ModelName));cData!=null&&$("#apDeviceModel").val(cData.DeviceModels.split(",")).trigger("change")})}function getProductionProcessList(n=null){var i,t;if($("#apProductionProcessName").empty(),i=215,!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var u,i,r;if(n!=null&&n("success"),t.errno!=0){layer.msg(t.errmsg);return}for(u='<option value="{0}">{1}<\/option>',i=0;i<t.datas.length;i++)r=t.datas[i],$("#apProductionProcessName").append(u.format(r.Id,r.ProductionProcessName));cData!=null?$("#apProductionProcessName").val(cData.ProductModels).trigger("change"):$("#apProductionProcessName").val(0).trigger("change");getDeviceList()})}function getDeviceList(n=0,t=null){var u,i,f,r,e;if($("#apCode").empty(),u=319,!checkPermission(u)){layer.msg("没有权限");return}if(i=$("#apDeviceModel").val(),f=$("#apProductionProcessName").val(),i==null||i.length<=0||f==null){$("#addProcessModel").modal("show");return}r={};r.opType=u;e={DeviceModelIds:i.join(","),ProductionProcessIds:f};cData!=null&&(e.Pid=cData.Id);r.opData=JSON.stringify(e);ajaxPost("/Relay/Post",r,function(i){var f,r,u;if(t!=null&&t("success"),i.errno!=0){layer.msg(i.errmsg);return}for(f='<option value="{0}">{1}<\/option>',r=0;r<i.datas.length;r++)u=i.datas[r],$("#apCode").append(f.format(u.Id,u.Code));cData!=null&&$("#apCode").val(cData.DeviceIds.split(",")).trigger("change");n!=-1&&$("#addProcessModel").modal("show")})}function apReset(){$("#apBody").empty();var n='<tr id="ap{0}" value="0"><td><label class="control-label" id="apx{0}">{0}<\/label><\/td><td><input type="tel" class="form-control text-center" id="apJy1{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apJy2{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx1{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx2{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apYl{0}"  value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apSd{0}"  value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(1);$("#apBody").append(n);max=maxV=2;$("#addOtherBtn").removeClass("hidden")}function addOther(){if(!(maxV>maxProcessData)){var n='<tr id="ap{0}" value="0"><td><label class="control-label" id="apx{0}">{1}<\/label><\/td><td><input type="tel" class="form-control text-center" id="apJy1{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apJy2{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx1{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx2{0}" value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apYl{0}"  value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apSd{0}"  value="0" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(max,maxV);$("#apBody").append(n);max++;maxV++;maxV>maxProcessData&&$("#addOtherBtn").addClass("hidden")}}function delSelf(n){var i,r,t;for($("#apBody").find("[id=ap"+n+"]").remove(),maxV--,i=1,r=$("#apBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++;maxV<=maxProcessData&&$("#addOtherBtn").removeClass("hidden")}function addProcess(){var a=316,i,r,u,f,t,v,n,e,o,s,h,c,l,y,p;if(!checkPermission(a)){layer.msg("没有权限");return}if(i=$("#apProcess").val().trim(),isStrEmptyOrUndefined(i)){showTip($("#apProcessTip"),"工艺编号不能为空");return}if(r=$("#apDeviceModel").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择适用设备型号");return}if(u=$("#apProductionProcessName").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择适用产品型号");return}if(f=$("#apCode").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择适用机台号");return}for(t=[],v=1,n=1;n<max;n++)if($("#ap"+n).length>0){if(e=$("#apJy1"+n).val().trim(),isStrEmptyOrUndefined(e)){layer.msg("加压时间(M)不能为空");return}if(o=$("#apJy2"+n).val().trim(),isStrEmptyOrUndefined(o)){layer.msg("加压时间(S)不能为空");return}if(s=$("#apGx1"+n).val().trim(),isStrEmptyOrUndefined(s)){layer.msg("工序时间(M)不能为空");return}if(h=$("#apGx2"+n).val().trim(),isStrEmptyOrUndefined(h)){layer.msg("工序时间(S)不能为空");return}if(c=$("#apYl"+n).val().trim(),isStrEmptyOrUndefined(c)){layer.msg("设定压力(Kg)不能为空");return}if(l=$("#apSd"+n).val().trim(),isStrEmptyOrUndefined(l)){layer.msg("下盘速度(rpm)不能为空");return}t.push({ProcessOrder:v++,PressurizeMinute:e,PressurizeSecond:o,ProcessMinute:s,ProcessSecond:h,Pressure:c,Speed:l})}if(t.length<=0){layer.msg("请填写工艺数据");return}y={ProcessNumber:i,DeviceModels:r.join(","),ProductModels:u,DeviceIds:f.join(","),ProcessDatas:t};p=function(){$("#addProcessModel").modal("hide");var n={};n.opType=a;n.opData=JSON.stringify(y);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getProcessList()})};showConfirm("添加",p)}function showUpdateProcessModel(n){var t,u,i,r;for($(".opb").addClass("hidden"),$("#updateProcess").removeClass("hidden"),hideClassTip("adt"),$("#apProcess").val(""),$("#apBody").empty(),$("#addOtherBtn").removeClass("hidden"),max=maxV=1,t={},t.opType=300,t.opData=JSON.stringify({Id:n}),u=!1,i=0;i<lastData.length;i++)r=lastData[i],r.Id==n&&(u=!0,cData=r,$("#apProcess").val(r.ProcessNumber));u&&ajaxPost("/Relay/Post",t,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(r='<tr id="ap{0}" value="{2}"><td><label class="control-label" id="apx{0}">{1}<\/label><\/td><td><input type="tel" class="form-control text-center" id="apJy1{0}" value="{3}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apJy2{0}" value="{4}" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx1{0}" value="{5}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apGx2{0}" value="{6}" oninput="value=value.replace(/[^\\d]/g,\'\')" onblur="value=isStrEmptyOrUndefined(value)?\'\':(parseInt(value)>59?59:parseInt(value))" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apYl{0}"  value="{7}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><input type="tel" class="form-control text-center" id="apSd{0}"  value="{8}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>',i=0;i<n.datas.length;i++)t=n.datas[i],$("#apBody").append(r.format(max,maxV,t.Id,t.PressurizeMinute,t.PressurizeSecond,t.ProcessMinute,t.ProcessSecond,t.Pressure,t.Speed)),max++,maxV++;n.datas.length==maxProcessData&&$("#addOtherBtn").addClass("hidden");getMenuList()})}function updateProcess(){var a=313,i,r,u,f,t,v,n,e,o,s,h,c,l,y,p,w;if(!checkPermission(a)){layer.msg("没有权限");return}if(i=$("#apProcess").val().trim(),isStrEmptyOrUndefined(i)){showTip($("#apProcessTip"),"工艺编号不能为空");return}if(r=$("#apDeviceModel").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择适用设备型号");return}if(u=$("#apProductionProcessName").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择适用产品型号");return}if(f=$("#apCode").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择适用机台号");return}for(t=[],v=1,n=1;n<max;n++)if($("#ap"+n).length>0){if(e=$("#apJy1"+n).val().trim(),isStrEmptyOrUndefined(e)){layer.msg("加压时间(M)不能为空");return}if(o=$("#apJy2"+n).val().trim(),isStrEmptyOrUndefined(o)){layer.msg("加压时间(S)不能为空");return}if(s=$("#apGx1"+n).val().trim(),isStrEmptyOrUndefined(s)){layer.msg("工序时间(M)不能为空");return}if(h=$("#apGx2"+n).val().trim(),isStrEmptyOrUndefined(h)){layer.msg("工序时间(S)不能为空");return}if(c=$("#apYl"+n).val().trim(),isStrEmptyOrUndefined(c)){layer.msg("设定压力(Kg)不能为空");return}if(l=$("#apSd"+n).val().trim(),isStrEmptyOrUndefined(l)){layer.msg("下盘速度(rpm)不能为空");return}y=$("#ap"+n).attr("value");t.push({Id:y,ProcessOrder:v++,PressurizeMinute:e,PressurizeSecond:o,ProcessMinute:s,ProcessSecond:h,Pressure:c,Speed:l})}if(t.length<=0){layer.msg("请填写工艺数据");return}p={Id:cData.Id,ProcessNumber:i,DeviceModels:r.join(","),ProductModels:u,DeviceIds:f.join(","),ProcessDatas:t};w=function(){$("#addProcessModel").modal("hide");var n={};n.opType=a;n.opData=JSON.stringify(p);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getProcessList()})};showConfirm("修改",w)}var lastData=null,lastType=0,cData=null,max=2,maxV=2;