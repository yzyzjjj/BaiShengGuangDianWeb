function pageReady(){$(".sidebar-mini").addClass("sidebar-collapse");_permissionList[738]={uIds:["permissionGroupLi","permissionGroupTab"]};_permissionList[739]={uIds:["permissionsLi","permissionsTab"]};_permissionList[745]={uIds:["updateAdministrator"]};_permissionList[747]={uIds:["upPermissionGroup"]};_permissionList[746]={uIds:["delPermissionGroup"]};_permissionList[744]={uIds:["delPermission"]};_permissionList=checkPermissionUi(_permissionList);getPermissionsList();var n=new Promise(n=>getPermissionsList(n)),t=new Promise(n=>getPermissionsGroup(n));Promise.all([n,t]).then(()=>{if(!_permissionList[738].have&&_permissionList[739].have){$("#permissionsLi a").click();return}})}function getPermissionsGroup(n){if(!_permissionList[738].have){n&&n("success");return}$("#permissionGroupList").empty();ajaxPost("/Relay/Post",{opType:55},t=>{if(t.errno!=0){layer.msg(t.errmsg);n&&n("success");return}t.datas.length>0&&showPermissionsGroups("permissionGroupList",t.datas);n&&n("success")})}function showPermissionsGroups(n,t){var h=`<div class="box box-solid noShadow" style="margin-bottom: 0;">
                            <div class="box-header no-padding">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="on_i fa fa-minus"></i></button>
                                <label class="pointer" style="margin:0;font-weight:inherit">
                                    <input type="checkbox" class="on_cb" style="width: 15px" value="0">
                                    <span class="textOverTop" style="vertical-align: middle;font-size: 16px">权限管理</span>
                                </label>
                            </div>
                            <div class="box-body no-padding">
                                <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px">{0}</ul>
                            </div>
                        </div>`,c=`<li>
                        <div class="box box-solid noShadow collapsed-box" style="margin-bottom: 0;">
                            <div class="box-header no-padding form-inline">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="on_i fa fa-plus"></i></button>
                                <label class="pointer" style="margin:0;font-weight:inherit">
                                    <input type="checkbox" class="on_cb" style="width: 15px" value="{0}">
                                    <span class="textOverTop" style="vertical-align: middle;font-size: 16px">{1}</span>
                                </label>
                                <span class="textOn text-red text-bold">{2}</span>
                                <input type="text" class="form-control text-center textIn hidden text-red text-bold" style="min-width:250px;width:auto;" placeholder="权限Id,多个以英文逗号隔开" value={2}>
                            </div>
                            <div class="box-body no-padding">
                                <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px">{3}</ul>
                            </div>
                        </div>
                    </li>`,l=`<li>
                        <div class="box box-solid noShadow" style="margin-bottom: 0;">
                            <div class="box-header no-padding form-inline">
                                <a type="button" class="btn btn-box-tool disabled" data-widget="collapse"><i class="fa fa-chevron-right"></i></a>
                                <label class="pointer" style="margin:0;font-weight:inherit">
                                    <input type="checkbox" class="on_cb" style="width: 15px" value="{0}">
                                    <span class="textOverTop" style="vertical-align: middle;font-size: 16px">{1}</span>
                                </label>
                                <span class="textOn text-red text-bold">{2}</span>
                                <input type="text" class="form-control text-center textIn hidden text-red text-bold" style="min-width:250px;width:auto;" placeholder="权限Id,多个以英文逗号隔开" value={2}>
                            </div>
                        </div>
                    </li>`,i,f,s,r,u,o;for(t.sort(sortOrder),i={parent:[]},f=0,s=t.length;f<s;f++)r=t[f],u=r.Parent,u==0?i.parent.push(r):i[u]?i[u].push(r):i[u]=[r];o=n=>n.map(n=>{return""+(i[n.Id]?c.format(n.Id,n.Name,n.List,o(i[n.Id])):l.format(n.Id,n.Name,n.List))}).join("");const e=`${"permissionGroupList"}Data`;tableTmp[e]=[];$(`#${n}`).html(i.parent.length?h.format(o(i.parent)):"").find(".on_cb").iCheck({checkboxClass:"icheckbox_minimal",increaseArea:"20%"}).off("ifChanged").on("ifChanged",function(){const n=$(this).closest(".box-header");var t=$(this).val()>>0,r=n.find(".textOverTop").text(),i=n.find(".textOn").text();$(this).is(":checked")?(n.find(".textIn").val(i),tableTmp[e][t]={Id:t,Name:r,List:i},n.find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")):(delete tableTmp[e][t],n.find(".textIn").addClass("hidden").siblings(".textOn").removeClass("hidden"))});$(`#${n}`).find(".textIn").off("change").on("change",function(){const n=$(this).val();if(!/^\d+(,\d+)*$/g.test(n))return onInputDouHao(this),void layer.msg("只能输入数字或英文逗号");const t=$(this).closest(".box-header");var i=t.find(".on_cb").val()>>0;tableTmp[e][i].List=n})}function upPermissionGroup(){const t=`${"permissionGroupList"}Data`,n=Object.values(tableTmp[t]),i=n.map(n=>n.Id),r=n.map(n=>n.Name).join("<br>");isStrEmptyOrUndefined(i)?layer.msg("请选择要修改的数据"):showConfirm(`修改以下权限:<pre style='color:red'>${r}</pre>`,()=>{ajaxPost("/Relay/Post",{opType:56,opData:JSON.stringify(n)},n=>{layer.msg(n.errmsg),n.errno==0&&(getPermissionsGroup(),$("a.menuitem[href]").filter(function(){return this.pathname===url}).parent().addClass("active").parent().parent().addClass("active"))})})}function delPermissionGroup(){const i=`${"permissionGroupList"}Data`,n=Object.values(tableTmp[i]),t=n.map(n=>n.Id),r=n.map(n=>n.Name).join("<br>");isStrEmptyOrUndefined(t)?layer.msg("请选择要删除的数据"):showConfirm(`删除以下权限:<pre style='color:red'>${r}</pre>`,()=>{ajaxPost("/Relay/Post",{opType:58,opData:JSON.stringify({ids:t})},n=>{layer.msg(n.errmsg),n.errno==0&&getPermissionsGroup()})})}function updatePermissionGroup(){ajaxPost("/Relay/Post",{opType:92},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}})}function getPermissionsList(n){if(!_permissionList[739].have){n&&n("success");return}const t="permissionsList",u=`#${t}`,r=`${t}Arr`,i=`${t}Data`;tableTmp[r]=[];tableTmp[i]=[];ajaxPost("/Relay/Post",{opType:59},f=>{if(f.errno!=0){layer.msg(f.errmsg);n&&n("success");return}const e=f.datas;if(tableTmp[t])updateTable(tableTmp[t],e);else{const f=_permissionList[744].have,n=dataTableConfig(e,f);n.addColumns([{data:"Id",title:"权限Id",Class:"text-red"},{data:"Name",title:"名称"},{data:"Type",title:"类型"},{data:"Label",title:"分类"}]);n.drawCallback=function(){initCheckboxAddEvent.call(this,tableTmp[r],(n,t)=>{tableTmp[i].push(t)},(n,t)=>{removeArray(tableTmp[i],"Id",t.Id)})};tableTmp[t]=$(u).DataTable(n)}n&&n("success")})}function delPermission(){const n=`${"permissionsList"}Data`,t=tableTmp[n].map(n=>n.id).join(","),i=tableTmp[n].map(n=>n.name).join("<br>");isStrEmptyOrUndefined(t)?layer.msg("请选择要删除的数据"):showConfirm(`删除以下权限:<pre style='color:red'>${i}</pre>`,()=>{ajaxPost("/Relay/Post",{opType:62,opData:JSON.stringify({ids:t})},n=>{layer.msg(n.errmsg),n.errno==0&&getPermissionsList()})})}function updateAdministrator(){ajaxPost("/Relay/Post",{opType:63},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}})}var _permissionList=[],tableTmp=[];