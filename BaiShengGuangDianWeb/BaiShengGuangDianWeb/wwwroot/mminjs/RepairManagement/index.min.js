function pageReady(){var t,r;$(".sidebar-mini").addClass("sidebar-collapse");_permissionList[41]={uIds:["showFaultModelBtn"]};_permissionList[34]={uIds:["showMaintainerModel"]};_permissionList[45]={uIds:["showAddMaintainerModelBtn"]};_permissionList[46]={uIds:["updateMaintainerBtn"]};_permissionList[47]={uIds:["delMaintainerBtn"]};_permissionList[35]={uIds:["getFaultTypeList"]};_permissionList[52]={uIds:["showAddFaultTypeModel"]};_permissionList[53]={uIds:[]};_permissionList[54]={uIds:[]};_permissionList[36]={uIds:["getUsuallyFaultList"]};_permissionList[59]={uIds:["showAddUsuallyFaultModel"]};_permissionList[60]={uIds:[]};_permissionList[61]={uIds:[]};_permissionList[37]={uIds:["getFaultDeviceListBtn"]};_permissionList[66]={uIds:[]};_permissionList[67]={uIds:["showBatchAssignModalBtn"]};_permissionList[68]={uIds:[]};_permissionList[69]={uIds:[]};_permissionList[70]={uIds:[]};_permissionList[71]={uIds:["delChangeBtn"]};_permissionList[38]={uIds:["getServiceLogListBtn"]};_permissionList[76]={uIds:["showStatisticsModelBtn"]};_permissionList[77]={uIds:["addServiceLogBtn"]};_permissionList[78]={uIds:["updateServiceLogBtn"]};_permissionList[79]={uIds:["delServiceLogBtn"]};_permissionList[39]={uIds:["getDelFaultDeviceListBtn"]};_permissionList[40]={uIds:["getDelServiceLogListBtn"]};_permissionList=checkPermissionUi(_permissionList);t=$("#tabs li:not(.hidden)").first();t&&(t.addClass("active"),$(t.find("a").attr("href")).addClass("active"));$(".ms2").select2();$("#serLogFaultType").on("change",function(){var n=$(this).val();$("#serLogFaultDesc").val(_faultTypeData[n].FaultDescription)});$("#faultType").on("change",function(){var n=$(this).val();$("#faultDefaultDesc").val(_faultTypeData[n].FaultDescription)});getWorkerSelect();getFaultTypeSelect();r=getMonthScope();$("#faultSTime,#serviceLogSTime,#delFSTime,#delRepairSTime,#statSTime").val(r.start).datepicker("update");$("#faultETime,#serviceLogETime,#delFETime,#delRepairETime,#statETime").val(r.end).datepicker("update");$("#faultDevicePro").on("change",function(){var r=$(this).val(),n="#faultQuery",t="faultDeviceAttr",i="#faultDeviceAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#faultDeviceInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"state":setFaultDeviceGet(n,t,i,'<option value="0">未确认<\/option><option value="1">已确认<\/option><option value="2">维修中<\/option>');break;case"maintainer":setFaultDeviceGet(n,t,i,`<option value="0" wname="0">未指派</option>${_worker}`);break;case"solveTime":$("#solveSTime,#solveETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#faultDeviceTime")}});$("#serviceLogPro").on("change",function(){var r=$(this).val(),n="#serviceLogQuery",t="serviceAttr",i="#serviceAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#serviceInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"maintainer":setFaultDeviceGet(n,t,i,`<option value="0" wname="0">未指派</option>${_worker}`);break;case"faultSolver":setFaultDeviceGet(n,t,i,`${_workerName}`);break;default:$("#serSTime,#serETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#solveTime")}});$("#delFPro").on("change",function(){var r=$(this).val(),n="#delFQuery",t="delFAttr",i="#delFAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#delFInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"state":setFaultDeviceGet(n,t,i,'<option value="0">未确认<\/option><option value="1">已确认<\/option><option value="2">维修中<\/option>');break;case"maintainer":setFaultDeviceGet(n,t,i,`<option value="0" wname="0">未指派</option>${_worker}`);break;case"solveTime":$("#delFSolveSTime,#delFSolveETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#delFTime")}});$("#delRepairPro").on("change",function(){var r=$(this).val(),n="#delRepairQuery",t="delRepairAttr",i="#delRepairAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#delRepairInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"maintainer":setFaultDeviceGet(n,t,i,`<option value="0" wname="0">未指派</option>${_worker}`);break;default:$("#delRepSTime,#delRepETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#delRepairTime")}});getFaultDeviceList();setTimeout(()=>getServiceLogList(0),2e3);$("#batchAssignList").on("select2:select",".serviceName",function(){$(this).val().includes("同上")&&$(this).val($(this).parents("tr").prev().find(".serviceName").val()).trigger("change");$(this).parents("td").next().text(Array.from($(this).find("option:selected")).map(n=>$(n).attr("phone")).join())});$("#batchAssignList").on("select2:unselect",".serviceName",function(){$(this).parents("td").next().text(Array.from($(this).find("option:selected")).map(n=>$(n).attr("phone")).join())});$("#serLogDevSite,#devSite").select2({allowClear:!0,placeholder:"请选择(可不选)"});$("#faultCode").select2({allowClear:!0,placeholder:"请选择"});$("#designateName,#servicePro,#serLogFaultSolver,#serLogMaintainer").select2({allowClear:!0,placeholder:"请选择",matcher});$("#serLogWorkshop").on("change",function(){setWorkSiteSelect("#serLogWorkshop","#serLogDevSite")});$("#workshop").on("change",function(){setWorkSiteSelect("#workshop","#devSite")});$("#maintainerModel").on("show.bs.modal",function(){const n=()=>$("#currentTime").text(getFullTime());n();this.time=setInterval(n,1e3)});$("#maintainerModel").on("hidden.bs.modal",function(){clearInterval(this.time)});if(!_faultDeviceListTable){const n="#faultDeviceList";$(n).closest(".table-responsive").addClass("hidden");var i=_permissionList[71].have,h=_permissionList[68].have||_permissionList[69].have||_permissionList[70].have,c=_permissionList[66].have,l=function(n){var f=n.State,t="",i="",r="",u="";switch(f){case 0:t="danger";i="确认故障";r=`showConfirmModel(${n.Id}, 0,'${n.EstimatedTime}','${n.Remark}')`;_permissionList[68].have||(u="disabled");break;case 1:t="info";i="开始维修";r=`showConfirmModel(${n.Id}, 1,'${n.EstimatedTime}','${n.Remark}')`;_permissionList[69].have||(u="disabled");break;case 2:t="success";i="维修完成";r=`showServiceModel(${n.Id},'${n.Maintainer}','${n.EstimatedTime}',${n.FaultTypeId})`;_permissionList[70].have||(u="disabled")}return'<button type="button" class="btn btn-{0} btn-xs" onclick="{1}" {3}>{2}<\/button>'.format(t,r,i,u)},a=function(n){var t=n.Name==""?"未指派":n.Name;return c?`<a href="javascript:showDesignateModal(${n.Id},${n.Priority},'${n.Maintainer?n.Maintainer:0}',${n.Grade})" style="padding:3px" class="designate"><i class="glyphicon glyphicon-hand-right"></i><span class="text-black">${t}</span></a>`:t};_faultDeviceListTable=$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:[],aaSorting:[[i?1:0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setRow.isEnable,visible:i,orderable:!i},{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:null,title:"状态",render:setRow.rState},{data:null,title:"优先级",render:setRow.priority},{data:"Grade",title:"故障等级",render:setRow.grade},{data:null,title:"维修",render:l,visible:h},{data:null,title:"指派给",render:a},{data:"Phone",title:"联系方式"},{data:"EstimatedTime",title:"预计解决时间",render:setRow.setTime},{data:"Remark",title:"维修备注",render:setRow.remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障补充",render:setRow.rSup},{data:null,title:"故障详情",render:setRow.detailBtn}],drawCallback:function(){if(i)$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_faultDevData.Id.push(n),_faultDevData.Name.push(t)):(_faultDevData.Id.splice(_faultDevData.Id.indexOf(n),1),_faultDevData.Name.splice(_faultDevData.Name.indexOf(t),1))})}})}var n=_permissionList[79].have,f=_permissionList[78].have,e=[1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21],o=[11,18],s=[7],u=[];if(u[7]="评分",!_repairRecordListTable){const t="#repairRecordList";$(t).closest(".table-responsive").addClass("hidden");_repairRecordListTable=$(t).DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",exportOptions:{columns:e,format:{body:(n,t,i,r)=>o.indexOf(i)>-1?$(r).find("span").attr("title"):s.indexOf(i)>-1&&r.textContent==u[i]?"":r.textContent}}}],destroy:!0,paging:!0,searching:!0,language:oLanguage,data:[],aaSorting:[[n&&!name?1:0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setRow.serIsEnable,visible:n&&!name,orderable:!n&&name},{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:"SolveTime",title:"解决时间",sClass:"text-primary",render:setRow.setTime},{data:"CostTime",title:"用时",sClass:"text-primary"},{data:null,title:"优先级",render:setRow.priority},{data:"Grade",title:"故障等级",render:setRow.grade},{data:null,title:"评分",sClass:"text-primary",render:(n,t,i,r)=>{let u;if(!f||n.FaultSolvers.length===n.Scores.length){const t=n.FaultSolver.split(",");if(t.length===1)u=n.Score;else{const i=n.Scores;u=t.reduce((n,t,r)=>`${n},${t}-${i[r]||0}`,"").slice(1)}}else u=`<button class="btn btn-primary btn-sm" onclick="showScoreModel(${r.row})">评分</button>`;return u}},{data:"Id",title:"详情",render:setRow.upServiceLog.bind(null,0,!!name)},{data:"FaultSolver",title:"解决人"},{data:"Name",title:"指派给",render:setRow.serviceName},{data:"EstimatedTime",title:"预计解决时间",render:setRow.setTime},{data:"Remark",title:"维修备注",render:setRow.remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName1",title:"故障类型"},{data:"FaultDescription1",title:"故障类型描述",visible:!1},{data:"SolvePlan",title:"解决方案",visible:!1},{data:"FaultTypeName",title:"报修故障类型",visible:!1},{data:"FaultDescription",title:"报修故障类型描述",visible:!1},{data:"Supplement",title:"故障补充",render:setRow.remark},{data:"Comment",title:"评论",visible:!1},{data:null,title:"故障图片",render:setRow.imgBtn}],drawCallback:function(){if(n&&!name)$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_serviceLogData.Id.push(n),_serviceLogData.Name.push(t)):(_serviceLogData.Id.splice(_serviceLogData.Id.indexOf(n),1),_serviceLogData.Name.splice(_serviceLogData.Name.indexOf(t),1))})}})}if(!_statisticsDetailListTable){const t="#statisticsDetailList";$(t).closest(".table-responsive").addClass("hidden");_statisticsDetailListTable=$(t).DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",exportOptions:{columns:e,format:{body:(n,t,i,r)=>o.indexOf(i)>-1?$(r).find("span").attr("title"):s.indexOf(i)>-1&&r.textContent==u[i]?"":r.textContent}}}],destroy:!0,paging:!0,searching:!0,language:oLanguage,data:[],aaSorting:[[n&&!name?1:0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setRow.serIsEnable,visible:n&&!name,orderable:!n&&name},{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:"SolveTime",title:"解决时间",sClass:"text-primary",render:setRow.setTime},{data:"CostTime",title:"用时",sClass:"text-primary"},{data:null,title:"优先级",render:setRow.priority},{data:"Grade",title:"故障等级",render:setRow.grade},{data:null,title:"评分",sClass:"text-primary",render:(n,t,i,r)=>{let u;if(!f||n.FaultSolvers.length===n.Scores.length){const t=n.FaultSolver.split(",");if(t.length===1)u=n.Score;else{const i=n.Scores;u=t.reduce((n,t,r)=>`${n},${t}-${i[r]||0}`,"").slice(1)}}else u=`<button class="btn btn-primary btn-sm" onclick="showScoreModel(${r.row})">评分</button>`;return u}},{data:"Id",title:"详情",render:setRow.upServiceLog.bind(null,0,!!name)},{data:"FaultSolver",title:"解决人"},{data:"Name",title:"指派给",render:setRow.serviceName},{data:"EstimatedTime",title:"预计解决时间",render:setRow.setTime},{data:"Remark",title:"维修备注",render:setRow.remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName1",title:"故障类型"},{data:"FaultDescription1",title:"故障类型描述",visible:!1},{data:"SolvePlan",title:"解决方案",visible:!1},{data:"FaultTypeName",title:"报修故障类型",visible:!1},{data:"FaultDescription",title:"报修故障类型描述",visible:!1},{data:"Supplement",title:"故障补充",render:setRow.remark},{data:"Comment",title:"评论",visible:!1},{data:null,title:"故障图片",render:setRow.imgBtn}],drawCallback:function(){if(n&&!name)$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_serviceLogData.Id.push(n),_serviceLogData.Name.push(t)):(_serviceLogData.Id.splice(_serviceLogData.Id.indexOf(n),1),_serviceLogData.Name.splice(_serviceLogData.Name.indexOf(t),1))})}})}if(!_delFaultDeviceListTable){const n="#delFaultDeviceList";$(n).closest(".table-responsive").addClass("hidden");_delFaultDeviceListTable=$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:oLanguage,data:[],aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setRow.isEnable,orderable:!1,visible:!1},{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:null,title:"优先级",render:setRow.priority},{data:"Grade",title:"故障等级",render:setRow.grade},{data:null,title:"状态",render:setRow.rState},{data:"Name",title:"指派给",render:setRow.serviceName},{data:"Phone",title:"联系方式"},{data:"Remark",title:"维修备注",render:setRow.remark},{data:"EstimatedTime",title:"预计解决时间",render:setRow.setTime},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setRow.rDesc},{data:null,title:"故障图片",render:setRow.imgBtn}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_delFaultDevData.Id.push(n),_delFaultDevData.Name.push(t)):(_delFaultDevData.Id.splice(_delFaultDevData.Id.indexOf(n),1),_delFaultDevData.Name.splice(_delFaultDevData.Name.indexOf(t),1))})}})}if(!_delRepairListTable){const n="#delRepairList";$(n).closest(".table-responsive").addClass("hidden");_delRepairListTable=$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:[],aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setRow.serIsEnable,orderable:!1,visible:!1},{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:"SolveTime",title:"解决时间",sClass:"text-primary",render:setRow.setTime},{data:"CostTime",title:"用时",sClass:"text-primary"},{data:null,title:"优先级",render:setRow.priority},{data:"Grade",title:"故障等级",render:setRow.grade},{data:"Score",title:"评分",sClass:"text-primary"},{data:"FaultSolver",title:"解决人"},{data:"Name",title:"指派给",render:setRow.serviceName()},{data:"EstimatedTime",title:"预计解决时间",render:setRow.setTime},{data:"Remark",title:"维修备注",render:setRow.remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setRow.rDesc},{data:null,title:"故障图片",render:setRow.imgBtn},{data:"Id",title:"详情",render:setRow.upServiceLog.bind(null,1,!1)}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_delServiceLogData.Id.push(n),_delServiceLogData.Name.push(t)):(_delServiceLogData.Id.splice(_delServiceLogData.Id.indexOf(n),1),_delServiceLogData.Name.splice(_delServiceLogData.Name.indexOf(t),1))})}})}}function setFaultDeviceGet(n,t,i,r,u=true){$(`${n} .${t}`).addClass("hidden");$(i).removeClass("hidden");r&&($(`#${t}`).empty(),u?$(`#${t}`).append(`<option value="-1">所有</option>${r}`):$(`#${t}`).append(r))}function getWorkerSelect(){var n={};n.opType=430;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t='<option value="{0}" wname="{1}" phone="{2}">{1}<\/option>';_worker=n.datas.reduce((n,i)=>`${n}${t.format(i.Account,i.Name,i.Phone)}`,"");_workerName=n.datas.reduce((n,i)=>`${n}${t.format(i.Name,i.Name,i.Phone)}`,"");$("#designateName,#servicePro").empty().append(_worker)},0)}function getFaultTypeSelect(){var n={};n.opType=406;ajaxPost("/Relay/Post",n,function(n){var r,u,i,f,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#serviceFaultType").empty(),r=n.datas,u='<option value="{0}">{1}<\/option>',_faultType="",_faultTypeData={},i=0,f=r.length;i<f;i++)t=r[i],_faultTypeData[t.Id]=t,_faultType+=u.format(t.Id,t.FaultTypeName);$("#serviceFaultType").append(_faultType)},0)}function setTable(){return{isEnable:n=>`<input type="checkbox" class="icb_minimal isEnable" value=${n.Id} fName=${n.DeviceCode}>`,order:(n,t,i,r)=>r.row+1,grade:n=>n?'<span class="text-red">大修<\/span>':"小修",setTime:n=>n=="0001-01-01 00:00:00"?"":n.slice(0,n.lastIndexOf(":")),rState:n=>n.State==0?'<span class="text-red">未确认<\/span>':n.State==1?'<span class="text-warning">已确认<\/span>':'<span class="text-success">维修中<\/span>',priority:n=>n.Priority==0?"低":n.Priority==1?'<span class="text-warning">中<\/span>':'<span class="text-red">高<\/span>',remark:n=>n==""||n.length<tdShowLength?n:`<span title = "${n}" class="pointer" onclick="showAllContent('${escape(n)}', '维修备注')">${n.substring(0,tdShowLength)+"..."}</span>`,rDesc:n=>{var t=n.FaultDescription;return`<span title = "${t}" onclick = "showFaultTypeDetailModel(${n.FaultTypeId}, '${escape(t.trim())}')">${t.length>tdShowLength?t.substring(0,tdShowLength)+"...":t}</span>`},rSup:n=>{var t=n.Supplement;return`<span title = "${t}" onclick = "showFaultTypeDetailModel(${n.FaultTypeId}, '${escape(t.trim())}')">${t.length>tdShowLength?t.substring(0,tdShowLength)+"...":t}</span>`},imgBtn:n=>{var t=`<span class="glyphicon glyphicon-{0}" aria-hidden="true" style="color:{1};font-size:25px;vertical-align:middle;margin-right:5px"></span>
                      <button type="button" class="btn btn-info btn-sm" style="vertical-align:middle" onclick="showImgModel('${n.FaultTypeName}','${n.ImageList}')">查看</button>`;return n.ImageList.length?t.format("ok","green"):t.format("remove","red")},serIsEnable:n=>{var t=`机台号-${n.DeviceCode}：${n.FaultTypeName}`;return`<input type="checkbox" class="icb_minimal isEnable" value=${n.Id} fName=${t}>`},upServiceLog:(n,t,i)=>`<button type="button" class="btn btn-primary btn-sm" onclick="showServiceLogModal(${i},${n},${t})">查看</button>`,serviceName:n=>n==""?"未指派":n,detailBtn:n=>`<button type="button" class="btn btn-info btn-sm" onclick="showLogDetailModel(${n.FaultTypeId},'${n.DeviceCode}','${n.Proposer}','${n.FaultTime}','${escape(n.Supplement)}',${n.Priority},${n.Grade},'${n.ImageList}')">查看</button>`}}function getFaultDeviceList(){var n,t,e,o,u;if(_faultDevData={},_faultDevData.Id=[],_faultDevData.Name=[],_faultDevData.data={},n=$("#faultSTime").val(),t=$("#faultETime").val(),isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择故障时间");return}if(!comTimeDay(n,t)){n=`${n} 00:00:00`;t=`${t} 23:59:59`;var s=$("#faultDeviceCond").val(),r={startTime:n,endTime:t,condition:s},f=$("#faultDevicePro").val(),i;switch(f){case"code":i=$("#faultDeviceInput").val().trim();isStrEmptyOrUndefined(i)||(r[f]=i);break;case"solveTime":e=$("#solveSTime").val();isStrEmptyOrUndefined(e)||(r.eStartTime=e);o=$("#solveETime").val();isStrEmptyOrUndefined(o)||(r.eEndTime=o);break;default:i=$("#faultDeviceAttr").val();isStrEmptyOrUndefined(i)||(r[f]=i)}u={};u.opType=417;u.opData=JSON.stringify(r);ajaxPost("/Relay/Post",u,function(n){var t,i,u,r;if(n.errno!=0){layer.msg(n.errmsg);return}for(t=n.datas,i=0,u=t.length;i<u;i++)r=t[i],_faultDevData.data[r.Id]=r;updateTable(_faultDeviceListTable,t);$("#faultDeviceList").closest(".table-responsive").removeClass("hidden")})}}function showBatchAssignModal(){var i=_faultDevData.Id,r=i.length,t,n;if(!r){layer.msg("请选择需要指派的故障设备");return}for(t=[],n=0;n<r;n++)t.push(_faultDevData.data[i[n]]);var u=function(){return`<div style="width:100%;min-width:80px;margin:auto"><select class="form-control priority" style="width: 100%">${_priority}</select></div>`},f=function(){return`<div style="width:100%;min-width:80px;margin:auto"><select class="form-control grade" style="width: 100%">${_grade}</select></div>`},e=function(n,t,i,r){return`<div style="width:100%;min-width:120px;margin:auto"><select class="form-control serviceName" style="width: 100%" multiple="multiple">${r.row==0?"":'<option value="同上">同上<\/option>'}${_worker}</select></div>`};_batchAssignTable=$("#batchAssignList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[0,"asc"]],ordering:!1,aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:setRow.order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setRow.setTime},{data:null,title:"状态",render:setRow.rState},{data:null,title:"优先级",render:u},{data:null,title:"故障等级",render:f},{data:null,title:"指派给",render:e},{data:"Phone",title:"联系方式"},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setRow.rDesc},{data:null,title:"故障详情",render:setRow.detailBtn}],createdRow:function(n,t){$(n).find(".priority").val(t.Priority).end().find(".grade").val(t.Grade).end().find(".serviceName").select2({allowClear:!0,placeholder:"请选择",matcher}).val(t.Maintainers).trigger("change")}});$("#showBatchAssignModal").modal("show")}function batchAssign(){for(var t,r=_batchAssignTable.context[0].aoData,f=r.length,u=[],n=0;n<f;n++){var i=r[n].nTr,e=$(i).find(".priority").val(),o=$(i).find(".grade").val(),s=$(i).find(".serviceName").val()||[];u.push({Id:_faultDevData.Id[n]>>0,Maintainer:s.join(),Priority:e>>0,Grade:o>>0})}t={};t.opType=446;t.opData=JSON.stringify(u);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showBatchAssignModal").modal("hide"),getFaultDeviceList())})}function showConfirmModel(n,t,i,r){$("#confirmTitle").text(t?"开始维修":"确认故障");t?($("#confirmTitle").text("开始维修"),$("#confirmFaultBtn").addClass("hidden"),$("#confirmStartBtn").val(n)):($("#confirmTitle").text("确认故障"),$("#confirmFaultBtn").removeClass("hidden"),$("#confirmFaultBtn,#confirmStartBtn").val(n));i=i=="0001-01-01 00:00:00"?getDate():i.slice(0,i.indexOf(" "));$("#confirmTime").val(i).datepicker("update");$("#confirmHms").timepicker("setTime",getTime());$("#confirmDesc").val(r);$("#showConfirmModel").modal("show")}function confirmFault(n){var u=$(this).val(),i=$("#confirmTime").val(),r=$("#confirmHms").val();if(isStrEmptyOrUndefined(i)||isStrEmptyOrUndefined(r)){layer.msg("请选择预计解决时间");return}var f=`${i} ${r}`,e=$("#confirmDesc").val(),t={};t.opType=444;t.opData=JSON.stringify([{Id:u,EstimatedTime:f,Remark:e,State:n}]);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showConfirmModel").modal("hide"),getFaultDeviceList())})}function showServiceModel(n,t,i,r){$("#serviceBtn").val(n);t=t.split(",");$("#servicePro").val(t).trigger("change");i=i=="0001-01-01 00:00:00"?getDate():i.slice(0,i.indexOf(" "));$("#serviceTime").val(i).datepicker("update");$("#serviceHms").timepicker("setTime",getTime());$("#serviceFaultType").val(r).trigger("change");$("#serviceDesc").val("");$("#showServiceModel").modal("show")}function service(){var o=$(this).val(),u=Array.from($("#servicePro :selected")).map(n=>$(n).text()).join(),t,i,f,r,e,n;if(isStrEmptyOrUndefined(u)){layer.msg("请选择解决人");return}if(t=$("#serviceTime").val(),i=$("#serviceHms").val(),isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(i)){layer.msg("请选择解决时间");return}if(f=`${t} ${i}`,r=$("#serviceFaultType").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择故障类型");return}e=$("#serviceDesc").val();n={};n.opType=444;n.opData=JSON.stringify([{FaultSolver:u,SolveTime:f,SolvePlan:e,FaultTypeId1:r,State:3,Id:o}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showServiceModel").modal("hide"),getFaultDeviceList())})}function showDesignateModal(n,t,i,r){$("#designateBtn").val(n);i=i.split(",");$("#designateName").val(i).trigger("change");$("#designatePro").val(t);$("#designateGrade").val(r);$("#showDesignateModal").modal("show")}function designate(){var r=$("#designateName").val(),t,i,u,n;if(isStrEmptyOrUndefined(r)){layer.msg("请选择指派人");return}if(t=$("#designatePro").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择优先级");return}if(i=$("#designateGrade").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择故障等级");return}u=$(this).val();n={};n.opType=445;n.opData=JSON.stringify([{Id:u>>0,Maintainer:r.join(),Priority:t>>0,Grade:i>>0}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showDesignateModal").modal("hide"),getFaultDeviceList())})}function showLogDetailModel(n,t,i,r,u,f,e,o){var s={};s.opType=406;s.opData=JSON.stringify({qId:n,menu:!0});getImg("#faultDetailImgList",o);ajaxPost("/Relay/Post",s,function(n){var h,o,s;if(n.errno!=0){layer.msg(n.errmsg);return}h=n.datas[0];$("#logDevName").text(t);$("#logPerson").text(i);$("#logFaultTime").text(r);$("#logFaultType").text(h.FaultTypeName);$("#logFaultTypeDesc").val(h.FaultDescription);u=unescape(u);$("#logFaultSup").val(u);o="";s="";switch(f){case 0:o="低";s="black";break;case 1:o="中";s="#CC6600";break;case 2:o="高";s="red"}$("#logPriority").text(o).css("color",s);$("#logGrade").text(e==0?"小修":"大修").css("color",e==0?"black":"red");$("#showLogDetailModel").modal("show")})}function delChange(){if(!_faultDevData.Id.length){layer.msg("请选择需要删除的数据");return}var n=function(){var n={};n.opType=423;n.opData=JSON.stringify({ids:_faultDevData.Id});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultDeviceList()})};showConfirm(`删除以下故障设备：<pre style='color:red'>${_faultDevData.Name.join("<br>")}</pre>`,n)}function getServiceLogList(n,t,i,r,u){var f=null,e,o,p,h,s,l,a,v,y,c;if(t)f={startTime:i,endTime:r,condition:0,maintainer:t},_statisticsParData={name:t,sTime:i,eTime:r,score:u};else{if(_serviceLogData={},_serviceLogData.Id=[],_serviceLogData.Name=[],e=$("#serviceLogSTime").val(),o=$("#serviceLogETime").val(),isStrEmptyOrUndefined(e)||isStrEmptyOrUndefined(o)){layer.msg("请选择解决时间");return}if(comTimeDay(e,o))return;e=`${e} 00:00:00`;o=`${o} 23:59:59`;p=$("#serviceLogCond").val();f={startTime:e,endTime:o,condition:p};h=$("#serviceLogPro").val();switch(h){case"code":s=$("#serviceInput").val().trim();isStrEmptyOrUndefined(s)||(f[h]=s);break;case"faultTime":l=$("#serSTime").val();isStrEmptyOrUndefined(l)||(f.fStartTime=l);a=$("#serETime").val();isStrEmptyOrUndefined(a)||(f.fEndTime=a);break;case"solveTime":v=$("#serSTime").val();isStrEmptyOrUndefined(v)||(f.eStartTime=v);y=$("#serETime").val();isStrEmptyOrUndefined(y)||(f.eEndTime=y);break;default:s=$("#serviceAttr").val();isStrEmptyOrUndefined(s)||(f[h]=s)}}c={};c.opType=412;c.opData=JSON.stringify(f);ajaxPost("/Relay/Post",c,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}t?(updateTable(_statisticsDetailListTable,n.datas),$("#statisticsDetailList").closest(".table-responsive").removeClass("hidden")):(updateTable(_repairRecordListTable,n.datas),$("#repairRecordList").closest(".table-responsive").removeClass("hidden"));t&&($("#score").text(u),$("#showStatisticsDetailModel").modal("show"))},n)}function showScoreModel(n){const t=$("#repairRecordList").DataTable().row(n).data();$("#updateScoreBtn").val(t.Id);const i=t.FaultSolver.split(","),r=t.Scores,u=i.map((n,t)=>({name:n,score:r[t]})),f=n=>`<input type="text" class="form-control text-center score" style="min-width:100px" oninput="onInput(this, 3, 0)" value=${n||""}>`;$("#scoreList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:u,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:(n,t,i,r)=>r.row+1},{data:"name",title:"维修工"},{data:"score",title:"评分",render:f}]});$("#showScoreModel").modal("show")}function updateScore(){const t=$("#scoreList").DataTable(),r=t.data().length,i=[];for(let n=0;n<r;n++){const u=t.row(n).nodes()[0],r=$(u).find(".score").val().trim();if(isStrEmptyOrUndefined(r)){layer.msg(`序号${n+1}：评分不能为空`);return}i.push(r)}var n={};n.opType=440;n.opData=JSON.stringify([{Id:$(this).val(),Score:i.join()}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showScoreModel").modal("hide"),$("#showStatisticsDetailModel").is(":hidden")?getServiceLogList(1):getServiceLogList(1,_statisticsParData.name,_statisticsParData.sTime,_statisticsParData.eTime,_statisticsParData.score))})}function showStatisticsModel(){getStatisticsList();$("#showStatisticsModel").modal("show")}function getStatisticsList(){var n=$("#statSTime").val(),t=$("#statETime").val(),i;if(isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择解决时间");return}comTimeDay(n,t)||(n=`${n} 00:00:00`,t=`${t} 23:59:59`,i={},i.opType=447,i.opData=JSON.stringify({startTime:n,endTime:t}),ajaxPost("/Relay/Post",i,function(i){if(i.errno!=0){layer.msg(i.errmsg);return}var r=function(n,t,i,r){return r.row+1},u=function(i){return`<button type="button" class="btn btn-primary btn-sm" onclick="getServiceLogList(1,'${i.Name}','${n}','${t}','${i.Score}')">查看</button>`};$("#statisticsList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i.datas,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:r},{data:"Name",title:"维修工"},{data:"Score",title:"评分"},{data:null,title:"详情",render:u}]})}))}function getImg(n,t){var i,r;if($(n).empty(),!isStrEmptyOrUndefined(t)){t=t.split(",");i={type:fileEnum.FaultDevice,files:JSON.stringify(t)};i.dir="";for(r in fileEnum)if(fileEnum[r]==i.type){i.dir=r;break}if(isStrEmptyOrUndefined(i.dir))return void layer.msg("文件类型不存在！");ajaxPost("/Upload/Path",i,t=>{var r,i;if(t.errno!=0){layer.msg(t.errmsg);return}for(r="",i=0;i<t.data.length;i++)r+=`<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">
                <div class="thumbnail">
                <img src=${t.data[i].path} style="height:200px">
                </div>
                </div>`;$(n).append(r)})}}function showImgModel(n,t){$("#FaultImgName").text(n);getImg("#faultImgList",t);$("#showFaultImgModel").modal("show")}function delServiceLog(){if(!_serviceLogData.Id.length){layer.msg("请选择需要删除的数据");return}var n=function(){var n={};n.opType=416;n.opData=JSON.stringify({ids:_serviceLogData.Id});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getServiceLogList(1)})};showConfirm(`删除以下维修记录：<pre style='color:red'>${_serviceLogData.Name.join("<br>")}</pre>`,n)}function getDeviceCode(n){var t={};t.opType=100;ajaxPost("/Relay/Post",t,function(t){var i,e,f,r,u;if(t.errno!=0){layer.msg(t.errmsg);return}for(i=t.datas,i.sort((n,t)=>n.Code-t.Code),e='<option value="{0}" admin="{2}">{1}<\/option>',f="",r=0;r<i.length;r++)u=i[r],f+=e.format(u.Id,u.Code,u.Administrator);n!=null&&n(f)},0)}function getWorkShop(n){var t={};t.opType=162;ajaxPost("/Relay/Post",t,function(t){var i,f;if(t.errno!=0){layer.msg(t.errmsg);return}var r=t.datas,u="";for(i=0;i<r.length;i++)f=r[i],u+='<option value = "{0}">{0}<\/option>'.format(f.SiteName);n!=null&&n(u)},0)}function getSite(n,t){var i={};i.opType=125;ajaxPost("/Relay/Post",i,function(i){var f,u,e,r;if(i.errno!=0){layer.msg(i.errmsg);return}for(_siteData={},f=i.datas,u=0,e=f.length;u<e;u++)r=f[u],_siteData[r.SiteName]?_siteData[r.SiteName].push(r.RegionDescription):_siteData[r.SiteName]=[r.RegionDescription];setWorkSiteSelect(n,t)},0)}function setWorkSiteSelect(n,t){var r,u,f,i,o,e;if($(t).empty(),r=$(n).val(),!isStrEmptyOrUndefined(r)){for(u=_siteData[r],f="",i=0,o=u.length;i<o;i++)e=u[i],f+=`<option value=${e}>${e}</option>`;$(t).append(f);$(t).val("").trigger("change")}}function showServiceLogModal(n,t,i){var o=n?t?425:412:415,r,u,f,e;$("#serLogFaultSup").prop("disabled",!!n);$("#serviceLogTitle").text(n?"维修记录详情":"添加维修记录");n?($("#showServiceLogModal .isText").removeClass("hidden"),$("#showServiceLogModal .evaluate").removeClass("hidden"),$("#showServiceLogModal .noText").addClass("hidden"),r={},r.opType=o,r.opData=JSON.stringify({qId:n}),ajaxPost("/Relay/Post",r,function(r){var u,s,f,h;if(r.errno!=0){layer.msg(r.errmsg);return}u=r.datas[0];isStrEmptyOrUndefined(u.Comment)&&$("#showServiceLogModal .evaluate").eq(1).addClass("hidden");$("#serLogCodeText").text(u.DeviceCode);$("#serLogProposerText").text(u.Proposer);$("#serLogFaultTimeText").text(u.FaultTime);$("#serLogFaultTypeText").text(u.FaultTypeName);$("#serLogFaultDesc").val(_faultTypeData[u.FaultTypeId].FaultDescription);$("#serLogFaultSup").val(u.Supplement);$("#serLogScore").text(u.Score);$("#serLogComment").val(u.Comment);var c=u.Priority,e="",o="";switch(c){case 0:e="低";o="black";break;case 1:e="中";o="#CC6600";break;case 2:e="高";o="red"}if($("#serLogPriorityText").text(e).css("color",o),s=u.Grade,$("#serLogGradeText").text(s==0?"小修":"大修").css("color",s==0?"black":"red"),$("#serLogMaintainerText").text(u.Name==""?"未指派":u.Name),f=u.SolveTime,$("#serLogFaultType1").empty(),$("#serLogFaultType1").append(_faultType),t||i)$("#upServiceLogBox .isText").removeClass("hidden"),$("#upServiceLogBox .noText").addClass("hidden"),$("#serLogFaultSolverText").text(u.FaultSolver),$("#serLogSolveTimeText").text(f=="0001-01-01 00:00:00"?"":f.slice(0,f.lastIndexOf(":"))),h=$(`#serLogFaultType1 option[value=${u.FaultTypeId1}]`).text(),$("#serLogFaultType1Text").text(h),$("#serLogSolvePlan").prop("disabled",!0),$("#updateServiceLogBtn").addClass("hidden");else{$("#upServiceLogBox .isText").addClass("hidden");$("#upServiceLogBox .noText").removeClass("hidden");$("#serLogFaultSolver").empty().append(_worker);let i=u.FaultSolver.split(",");const t=[];$("#serLogFaultSolver option").each((n,r)=>void(i.includes($(r).attr("wname"))&&t.push($(r).val())));$("#serLogFaultSolver").val(t).trigger("change");f=="0001-01-01 00:00:00"?($("#serLogSolveDate").val(getDate()).datepicker("update"),$("#serLogSolveTime").timepicker("setTime",getTime())):($("#serLogSolveDate").val(f.split(" ")[0]).datepicker("update"),$("#serLogSolveTime").timepicker("setTime",f.split(" ")[1]));$("#serLogFaultType1").val(u.FaultTypeId1).trigger("change");_permissionList[78].have?($("#updateServiceLogBtn").removeClass("hidden"),$("#updateServiceLogBtn").val(n),$("#serLogSolvePlan").prop("disabled",!1)):($("#updateServiceLogBtn").addClass("hidden"),$("#serLogSolvePlan").prop("disabled",!0))}$("#serLogSolvePlan").val(u.SolvePlan)})):($("#updateServiceLogBtn").addClass("hidden"),$("#showServiceLogModal .isText").addClass("hidden"),$("#showServiceLogModal .evaluate").addClass("hidden"),$("#showServiceLogModal .noText").removeClass("hidden"),$("#serLogSolvePlan").prop("disabled",!1),$("#serLogCodeOther,#serLogFaultSup,#serLogSolvePlan").val(""),$("#serLogPriority").val(0),$("#serLogGrade").val(0),$("#serLogProposer").val(getCookieTokenInfo().name),$("#serLogFaultDate,#serLogSolveDate").val(getDate()).datepicker("update"),$("#serLogFaultTime,#serLogSolveTime").timepicker("setTime",getTime()),$("#serLogFaultType,#serLogFaultType1,#serLogMaintainer,#serLogFaultSolver").empty(),$("#serLogFaultType,#serLogFaultType1").append(_faultType),$("#serLogMaintainer,#serLogFaultSolver").append(_worker),u=$("#serLogFaultType").val(),$("#serLogFaultDesc").val(_faultTypeData[u].FaultDescription),f=new Promise(n=>getDeviceCode(n)),e=new Promise(n=>getWorkShop(n)),Promise.all([f,e]).then(n=>{$("#serLogCode,#serLogWorkshop").empty(),$("#serLogCode").append(n[0]),$("#serLogCode").val(0).trigger("change"),$("#serLogCode").select2({allowClear:!0,placeholder:"请选择"}),$("#serLogWorkshop").append(n[1]),getSite("#serLogWorkshop","#serLogDevSite")}));$("#showServiceLogModal").modal("show")}function showFaultModel(){var n=new Promise(n=>getDeviceCode(n)),t=new Promise(n=>getWorkShop(n));Promise.all([n,t]).then(n=>{$("#faultCode,#workshop").empty(),$("#faultCode").append(n[0]),$("#faultCode").val("").trigger("change"),$("#workshop").append(n[1]),getSite("#workshop","#devSite")});$("#faultType").empty().append(_faultType).trigger("change");$("#faultOther").val("");$("#proposer").val(getCookieTokenInfo().name);$("#faultDate").val(getDate()).datepicker("update");$("#faultTime").val(getTime()).timepicker("setTime",getTime());_updateFirmwareUpload==null&&(_updateFirmwareUpload=initFileInputMultiple("addImg",fileEnum.FaultDevice));$("#addImg").fileinput("clear");$("#addImgBox").find(".file-caption-name").attr("readonly",!0).attr("placeholder","请选择图片...");$("#faultDesc").val("");$("#faultModel").modal("show")}function reportFault(){var t=$("#faultCode").val(),i=$("#faultOther").val().trim(),n,r,f,e,o,s,l,v,y,p;if(isStrEmptyOrUndefined(t)&&isStrEmptyOrUndefined(i)){layer.msg("请选择或输入设备");return}if(!isStrEmptyOrUndefined(t)&&!isStrEmptyOrUndefined(i))for(n=0,r=t.length;n<r;n++)if(i==t[n]){layer.msg("其他机台号已选择，请重新输入");return}if(!isStrEmptyOrUndefined(i)){if(f=$("#workshop").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择车间");return}e=$("#devSite").val();i=`${f}-${e?e+"-":""}${i}`}if(o=$("#proposer").val().trim(),isStrEmptyOrUndefined(o)){layer.msg("报修人不能为空");return}var w=$("#faultDate").val(),b=$("#faultTime").val(),a=`${w} ${b}`;if(exceedTime(a)){layer.msg("所选时间不能大于当前时间");return}if(s=$("#faultType").val(),isStrEmptyOrUndefined(s)){layer.msg("请选择故障类型");return}var k=$("#faultDesc").val().trim(),u=[],h=[],c={FaultTime:a,Proposer:o,Supplement:k,FaultTypeId:s};if(isStrEmptyOrUndefined(i)||(l=$.extend({},c),l.DeviceCode=i,u.push(l)),t!=null)for(n=0,r=t.length;n<r;n++)v=t[n],c.DeviceId=t[n],u.push($.extend({},c)),y=$("#faultCode option:selected").attr("admin"),h.push({Code:v,Admin:y});p=function(t){var i=$("#addImg").val();isStrEmptyOrUndefined(i)?t("success"):($("#addImg").fileinput("upload"),fileCallBack[fileEnum.FaultDevice]=i=>{var f,e,o;if(i.errno==0){f=[];for(e in i.data)f.push(i.data[e].newName);for(f=JSON.stringify(f),n=0,r=u.length;n<r;n++)o=u[n],o.Images=f;t("success")}})};new Promise(function(n){p(n)}).then(function(){var t={};t.opType=422;t.opData=JSON.stringify(u);ajaxPost("/Relay/Post",t,function(t){if($("#faultModel").modal("hide"),layer.msg(t.errmsg),t.errno==0)for(getFaultDeviceList(),n=0,r=h.length;n<r;n++){var i=h[n],u={ChatEnum:chatEnum.FaultDevice,Message:{Admin:i.Admin,Code:i.Code}};hubConnection.invoke("SendMsg",u)}})})}function addUpServiceLog(n){var it=n?415:414,i={},f,e,o,s,k,h,d,c,l,g,a,v,y,nt,p;if(n){var r=$("#serLogCode").val(),rt=$("#serLogWorkshop").val(),t=$("#serLogCodeOther").val().trim(),b=isStrEmptyOrUndefined(r),u=isStrEmptyOrUndefined(t);if(b&&u){layer.msg("请选择或输入一台机台号");return}if(!b&&!u){layer.msg("只能选择或输入一台机台号");return}if(u||(f=$("#serLogDevSite").val(),t=`${rt}-${f?f+"-":""}${t}`,r=0),e=$("#serLogProposer").val().trim(),isStrEmptyOrUndefined(e)){layer.msg("报修人不能为空");return}if(o=$("#serLogFaultDate").val(),s=$("#serLogFaultTime").val(),isStrEmptyOrUndefined(o)||isStrEmptyOrUndefined(s)){layer.msg("请选择故障时间");return}if(k=`${o} ${s}`,h=$("#serLogFaultType").val(),isStrEmptyOrUndefined(h)){layer.msg("请选择故障类型");return}if(d=$("#serLogFaultSup").val().trim(),c=$("#serLogPriority").val(),isStrEmptyOrUndefined(c)){layer.msg("请选择优先级");return}if(l=$("#serLogGrade").val(),isStrEmptyOrUndefined(l)){layer.msg("请选择故障等级");return}g=$("#serLogMaintainer").val()||[];i={DeviceId:r,DeviceCode:t,Proposer:e,FaultTime:k,FaultTypeId:h,Supplement:d,Priority:c,Grade:l,Maintainer:g.join()}}else i.Id=$(this).val();if(a=Array.from($("#serLogFaultSolver :selected")).map(n=>$(n).text()).join(),isStrEmptyOrUndefined(a)){layer.msg("请选择解决人");return}if(v=$("#serLogSolveDate").val(),y=$("#serLogSolveTime").val(),isStrEmptyOrUndefined(v)||isStrEmptyOrUndefined(y)){layer.msg("请选择解决时间");return}if(nt=`${v} ${y}`,p=$("#serLogFaultType1").val(),isStrEmptyOrUndefined(p)){layer.msg("请选择实际故障类型");return}var ut=$("#serLogSolvePlan").val().trim(),tt=$.extend(i,{FaultSolver:a,SolveTime:nt,FaultTypeId1:p,SolvePlan:ut}),w={};w.opType=it;w.opData=JSON.stringify(n?tt:[tt]);ajaxPost("/Relay/Post",w,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showServiceLogModal").modal("hide"),$("#showStatisticsDetailModel").is(":hidden")?getServiceLogList(1):getServiceLogList(1,_statisticsParData.name,_statisticsParData.sTime,_statisticsParData.eTime,_statisticsParData.score))})}function getDelFaultDeviceList(){var n,t,e,o,u;if(_delFaultDevData={},_delFaultDevData.Id=[],_delFaultDevData.Name=[],n=$("#delFSTime").val(),t=$("#delFETime").val(),isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择故障时间");return}if(!comTimeDay(n,t)){n=`${n} 00:00:00`;t=`${t} 23:59:59`;var s=$("#delFCond").val(),r={startTime:n,endTime:t,condition:s},f=$("#delFPro").val(),i;switch(f){case"code":i=$("#delFInput").val().trim();isStrEmptyOrUndefined(i)||(r[f]=i);break;case"solveTime":e=$("#delFSolveSTime").val();isStrEmptyOrUndefined(e)||(r.eStartTime=e);o=$("#delFSolveETime").val();isStrEmptyOrUndefined(o)||(r.eEndTime=o);break;default:i=$("#delFAttr").val();isStrEmptyOrUndefined(i)||(r[f]=i)}u={};u.opType=424;u.opData=JSON.stringify(r);ajaxPost("/Relay/Post",u,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}updateTable(_delFaultDeviceListTable,n.datas);$("#delFaultDeviceList").closest(".table-responsive").removeClass("hidden")})}}function getDelServiceLogList(){var t,i,e,o,s,h,u;if(_delServiceLogData={},_delServiceLogData.Id=[],_delServiceLogData.Name=[],t=$("#delRepairSTime").val(),i=$("#delRepairETime").val(),isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(i)){layer.msg("请选择解决时间");return}if(!comTimeDay(t,i)){t=`${t} 00:00:00`;i=`${i} 23:59:59`;var c=$("#delRepairCond").val(),n={startTime:t,endTime:i,condition:c},f=$("#delRepairPro").val(),r;switch(f){case"code":r=$("#delRepairInput").val().trim();isStrEmptyOrUndefined(r)||(n[f]=r);break;case"faultTime":e=$("#delRepSTime").val();isStrEmptyOrUndefined(e)||(n.fStartTime=e);o=$("#delRepETime").val();isStrEmptyOrUndefined(o)||(n.fEndTime=o);break;case"solveTime":s=$("#delRepSTime").val();isStrEmptyOrUndefined(s)||(n.eStartTime=s);h=$("#delRepETime").val();isStrEmptyOrUndefined(h)||(n.eEndTime=h);break;default:r=$("#delRepairAttr").val();isStrEmptyOrUndefined(r)||(n[f]=r)}u={};u.opType=425;u.opData=JSON.stringify(n);ajaxPost("/Relay/Post",u,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}updateTable(_delRepairListTable,n.datas);$("#delRepairList").closest(".table-responsive").removeClass("hidden")})}}function getUsuallyFaultList(){$("#usuallyFaultList").empty();var n={};n.opType=400;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>',r=function(n){var t='<li><a onclick="showUpdateUsuallyFaultModel({0})">修改<\/a><\/li>'.format(n.Id),r="<li><a onclick=\"deleteUsuallyFault({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.UsuallyFaultDesc));return i.format(_permissionList[60].have?t:"",_permissionList[61].have?r:"")},u=function(n){var t=n.SolvePlan;return`<span title = "${t}" onclick = "showAllContent('${escape(t)}', '解决方案')">${t.length>tdShowLength?t.substring(0,tdShowLength)+"...":t}</span>`},t=[{data:"Id",title:"序号"},{data:"UsuallyFaultDesc",title:"常见故障"},{data:null,title:"解决方案",render:u}];(_permissionList[60].have||_permissionList[61].have)&&t.push({data:null,title:"操作",render:r,orderable:!1});$("#usuallyFaultList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:t,bAutoWidth:!0});$("#usuallyFaultModel").modal("show")})}function deleteUsuallyFault(n,t){t=unescape(t);var i=function(){var t={};t.opType=405;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})};showConfirm("删除常见故障："+t,i)}function showAddUsuallyFaultModel(){hideClassTip("adt");$("#addUsuallyFaultDesc").val("");$("#addSolvePlan").val("");$("#addUsuallyFaultModel").modal("show")}function addUsuallyFault(){var n=!0,i=$("#addUsuallyFaultDesc").val().trim(),t,r;(isStrEmptyOrUndefined(i)&&(showTip("addUsuallyFaultDescTip","故障描述不能为空"),n=!1),t=$("#addSolvePlan").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("addSolvePlanTip","解决方案不能为空"),n=!1),n)&&(r=function(){$("#addUsuallyFaultModel").modal("hide");var n={};n.opType=403;n.opData=JSON.stringify({UsuallyFaultDesc:i,SolvePlan:t});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("添加",r))}function showUpdateUsuallyFaultModel(n){$("#updateId").html(n);var t={};t.opType=400;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateUsuallyFaultDesc").val(n.datas[0].UsuallyFaultDesc),$("#updateSolvePlan").val(n.datas[0].SolvePlan));hideClassTip("adt");$("#updateUsuallyFaultModel").modal("show")})}function updateUsuallyFault(){var n=!0,i=$("#updateUsuallyFaultDesc").val().trim(),t,r,u;(isStrEmptyOrUndefined(i)&&(showTip($("#updateUsuallyFaultDescTip"),"故障描述不能为空"),n=!1),t=$("#updateSolvePlan").val().trim(),isStrEmptyOrUndefined(t)&&(showTip($("#updateSolvePlanTip"),"解决方案不能为空"),n=!1),n)&&(r=parseInt($("#updateId").html()),u=function(){$("#updateUsuallyFaultModel").modal("hide");var n={};n.opType=402;n.opData=JSON.stringify({id:r,UsuallyFaultDesc:i,SolvePlan:t});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("修改",u))}function getFaultTypeList(){$("#faultTypeList").empty();var n={};n.opType=406;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>',r=function(n){var t='<li><a onclick="showUpdateFaultTypeModel({0})">修改<\/a><\/li>'.format(n.Id),r="<li><a onclick=\"deleteFaultType({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.FaultTypeName));return i.format(_permissionList[53].have?t:"",_permissionList[54].have?r:"")},u=n=>n.length>tdShowLength?`<span title="${n}" class="pointer" onclick="showAllContent('${escape(n)}','故障类型描述')">${n.substring(0,tdShowLength)}...</span>`:n,t=[{data:null,title:"序号",render:setRow.order},{data:"Id",title:"Id",bVisible:!1},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障类型描述",render:u}];(_permissionList[53].have||_permissionList[54].have)&&t.push({data:null,title:"操作",render:r,orderable:!1});$("#faultTypeList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:t});$("#faultTypeModel").modal("show")})}function showFaultTypeDetailModel(n,t=""){t=unescape(t);$("#faultTypeDetail1Div").addClass("hidden");isStrEmptyOrUndefined(t)||($("#faultTypeDetail1Div").removeClass("hidden"),$("#faultTypeDetail1").html(t));var i={};i.opType=406;i.opData=JSON.stringify({qId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas[0];n.datas.length>0&&($("#faultTypeNameDetail").html(t.FaultTypeName),$("#faultTypeDetail").html(t.FaultDescription));$("#faultTypeDetailModel").modal("show")})}function deleteFaultType(n,t){t=unescape(t);var i=function(){var t={};t.opType=411;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&(getFaultTypeList(),getFaultTypeSelect())})};showConfirm("删除故障类型："+t,i)}function showAddFaultTypeModel(){hideClassTip("adt");$("#addFaultTypeName").val("");$("#addFaultTypeDesc").val("");$("#addFaultTypeModel").modal("show")}function addFaultType(){var n=!0,t=$("#addFaultTypeName").val().trim(),i,r;(isStrEmptyOrUndefined(t)&&(showTip("addFaultTypeNameTip","故障类型不能为空"),n=!1),i=$("#addFaultTypeDesc").val(),n)&&(r=function(){$("#addFaultTypeModel").modal("hide");var n={};n.opType=410;n.opData=JSON.stringify([{FaultTypeName:t,FaultDescription:i}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&(getFaultTypeList(),getFaultTypeSelect())})},showConfirm("添加",r))}function showUpdateFaultTypeModel(n){$("#updateTypeId").html(n);var t={};t.opType=406;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateFaultTypeName").val(n.datas[0].FaultTypeName),$("#updateFaultTypeDesc").val(n.datas[0].FaultDescription));hideClassTip("adt");$("#updateFaultTypeModel").modal("show")})}function updateFaultType(){var n=!0,t=$("#updateFaultTypeName").val().trim(),i,r,u;(isStrEmptyOrUndefined(t)&&(showTip("updateFaultTypeNameTip","故障类型不能为空"),n=!1),i=$("#updateFaultTypeDesc").val(),n)&&(r=parseInt($("#updateTypeId").html()),u=function(){$("#updateFaultTypeModel").modal("hide");var n={};n.opType=408;n.opData=JSON.stringify({id:r,FaultTypeName:t,FaultDescription:i});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&(getFaultTypeList(),getFaultTypeSelect())})},showConfirm("修改",u))}function showMaintainerModel(n=1,t=true){$("#maintainerTable").css("maxHeight",innerHeight*.7);maintainers=[];_maintainerListTrs=[];var i={};i.opType=430;i.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",i,function(r){if(r.errno!=0){layer.msg(r.errmsg);return}var o=r.datas;const u=_permissionList[46].have||_permissionList[47].have,f=_permissionList[46].have,s=`<tr>${u?"<th>选择<\/th>":""}<th>序号</th><th>姓名</th><th>手机号</th><th>是否排班</th><th>顺序</th><th>备注</th></tr>`;$("#maintainerHead").html(s);let e="";o.forEach(n=>{maintainers[n.Id]=n,e+=`<tr>
                            ${u?'<td><input type="checkbox" class="icb_minimal isEnabled" value='+n.Id+"><\/td>":""}
                            <td class="num"></td>
                            <td>${n.Name}</td>
                            <td><span class="textIn">${n.Phone}</span><input class="textOn hidden form-control text-center phone" onkeyup="onInput(this, 11, 0)"></td>
                            <td><input type="checkbox" class="icb_minimal isWork" work=${!!n.Order}></td>
                            <td><span class="order">${n.Order||""}${f?'<\/span><span class="glyphicon glyphicon-arrow-up pointer text-green upTr" aria-hidden="true" onclick="upMaintainers.call(this)" title="上移"><\/span>':""}</td>
                            <td>
                                ${i.length>tdShowLength?'<span class="textIn" onclick="showAllContent('+n.Remark+')">'+n.Remark.substring(0,tdShowLength)+"...<\/span>":'<span class="textIn">'+n.Remark+"<\/span>"}
                                <input class="textOn hidden form-control remark" style="width: 100%"></td>
                        </tr>`});$("#maintainerList").html(e);$("#maintainerList .isEnabled").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){const n=$(this).parents("tr"),t=$(this).val(),i=$(this).is(":checked");i?(n.find(".textIn").addClass("hidden").end().find(".textOn").removeClass("hidden"),n.find(".phone").val(maintainers[t].Phone),n.find(".remark").val(maintainers[t].Remark)):n.find(".textIn").removeClass("hidden").end().find(".textOn").addClass("hidden");operationMaintainerListTrs(n[0],i)});$("#maintainerList .isWork[work=true]").iCheck("check");f||$("#maintainerList .isWork").iCheck("disable");$("#maintainerList .isWork").iCheck({handle:"checkbox",checkboxClass:"icheckbox_polaris",increaseArea:"20%"}).on("ifChanged",function(){const n=$(this).parents("tr");operationMaintainerListTrs(n[0],!0);setOrder()});setMaintainerList();n&&getScheduleInfo(t)},n)}function setOrder(){const n=$("#maintainerList .isWork");let t=0;for(let i=0,r=n.length;i<r;i++){const u=n.eq(i),r=u.parents("tr");u.is(":checked")?(r.find(".order").text(++t),i&&r.find(".upTr").removeClass("hidden"),operationMaintainerListTrs(r[0],!0)):(r.find(".order").text(""),r.find(".upTr").addClass("hidden"))}}function outputTable(){const n=[];maintainers.forEach(t=>void n.push(t));$("<table><\/table>").DataTable({dom:"B",buttons:[{extend:"excel",filename:`维修工名单`}],destroy:!0,data:n,columns:[{data:null,title:"序号",render:(n,t,i,r)=>r.row+1},{data:"Name",title:"姓名"},{data:"Phone",title:"手机号"},{data:"Remark",title:"备注"}]}).buttons(".buttons-excel").trigger()}function upMaintainers(){const n=$(this).parents("tr"),t=n.prev();t.before(n);setMaintainerList();setOrder()}function setMaintainerList(){const n=$("#maintainerList tr");for(let t=0,i=n.length;t<i;t++){const i=n.eq(t);i.find(".num").text(t+1);const r=i.find(".isWork").is(":checked");t&&r?i.find(".upTr").removeClass("hidden"):i.find(".upTr").addClass("hidden")}}function operationMaintainerListTrs(n,t){const i=_maintainerListTrs.indexOf(n);t?~i||_maintainerListTrs.push(n):_maintainerListTrs.splice(i,1)}function getScheduleInfo(n){_scheduleSelectEl=[];var t="";maintainers.forEach(n=>{t+=`<option value=${n.Id}>${n.Name}</option>`});ajaxPost("/Relay/Post",{opType:434},i=>{if(i.errno!=0){layer.msg(i.errmsg);return}let o=0;const s=["一","二","三","四","五","六","日"];let f="";const u=i.datas,h=n=>(n=new Date(n),{m:n.getMonth()+1,d:n.getDate()});let r=[],e=[];const c=getDate();u.forEach((n,i)=>{let u=n.Maintainers.map(n=>{const t=n.Name;return e.includes(t)||e.push(t),t});i<4&&(r[i]=`<td style="font-weight:bold;border:1px solid">${parseInt(n.StartTime.split(" ")[1])}点 ~ ${parseInt(n.EndTime.split(" ")[1])}点</td>`);const l=i%4,a=u.join(u.length>1?"<br>":"")||"未排班",y=n.Maintainers[0]?n.Maintainers[0].Id:0,p=l===1?a:`<div class="schedule-name">${a}</div><div class="select-ops hidden"><select class="ms2 form-control" infoid="${y}">${t}</select></div>`,v=new Date,w=new Date(n.StartTime)<v&&v<=new Date(n.EndTime)?"3px solid red":"1px solid black";if(u=`<td style="border:${w}">${p}</td>`,r[l]+=u,!l){const t=h(n.StartTime),i=c===n.StartTime.split(" ")[0]?"text-red":"";f+=`<th class=${i}>周${s[o++]}(${t.m}/${t.d})</th>`}});r=r.reduce((n,t)=>`${n}<tr>${t}</tr>`,"");$("#scheduleTime").text(`${u[0].StartTime.split(" ")[0]} 至 ${u[u.length-1].StartTime.split(" ")[0]}`);$("#scheduleHead").empty().append(`<tr><th></th>${f}</tr>`);$("#scheduleHead th").css("border","1px solid black");$("#scheduleBody").empty().append(r).find(".ms2").select2();$("#scheduleBody .schedule-name").on("dblclick",function(){$("#scheduleBody .select-ops").addClass("hidden");$("#scheduleBody .schedule-name").removeClass("hidden");const r=$(this).text(),n=$(this).addClass("hidden").siblings(".select-ops").removeClass("hidden").find("select");let t;Array.from(n.find("option")).some(n=>{if($(n).text()===r)return t=$(n).val(),!0});n.val(t).trigger("change");const i=n[0];_scheduleSelectEl.includes(i)||_scheduleSelectEl.push(i)});$("#scheduleBody .ms2").on("select2:select",function(){const n=$(this).find(":selected").text(),t=$(this).parents("td");t.find(".schedule-name").text(n)});n&&$("#maintainerModel").modal("show")})}function updateSchedule(){if(!_scheduleSelectEl.length){layer.msg("请先进行修改");return}const t=_scheduleSelectEl.map(n=>{const t=$(n);return{Id:t.attr("infoid")>>0||0,MaintainerId:t.val()>>0||0}});var n={};n.opType=435;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,n=>{layer.msg(n.errmsg),n.errno==0&&getScheduleInfo(!1)})}function initList(){$("#addList").empty();addMax=addMaxV=0}function showAddMaintainerModel(n=1){initList();$("#addOneBtn").attr("disabled","disabled");$("#addMaintainerBtn").attr("disabled","disabled");ajaxGet("/AccountManagement/List",null,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}$("#addOneBtn").removeAttr("disabled");$("#addMaintainerBtn").removeAttr("disabled");users=n.datas;$("#addMaintainerModel").modal("show")},n)}function addOne(){var f,t,n,u,i,r;if(addMax++,addMaxV++,f=`<tr id="add{0}" value="{0}" xh="{1}">
            <td style="vertical-align: addherit;" id="addXh{0}">{1}</td>
            <td><select class="ms2 form-control" id="addUser{0}"></select></td>
            <td><input class="form-control" type="tel" id="addPhone{0}" onkeyup="onInput(this, 11, 0)" onblur="onInputEnd(this)" maxlength="11"></td>
            <td><input class="form-control" id="addRk{0}" maxlength="100"></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delOne({0})"><i class="fa fa-minus"></i></button></td>
        </tr>`.format(addMax,addMaxV),$("#addList").append(f),t=addMax,n="#addUser"+t,$(n).empty(),users&&users.length>0){for(u="",i=0;i<users.length;i++)r=users[i],u+=`<option value="${r.account}" title="${r.account}">${r.name}</option>`;$(n).append(u);$("#addPhone"+t).val(users[0].phone);$(n).on("select2:select",function(){var r=$(this).val(),i=$(this).parents("tr:first").attr("value"),n,t;for($("#addPhone"+i).val(""),n=0;n<users.length;n++)if(t=users[n],r==t.account){$("#addPhone"+i).val(t.phone);break}})}n="#add"+t;$(n).find(".ms2").css("width","100%");$(n).find(".ms2").select2({width:"120px"});$("#addTable").scrollTop($("#addTable")[0].scrollHeight)}function delOne(n){var i,r,t,u;for($("#addList").find(`tr[value=${n}]:first`).remove(),addMaxV--,i=1,r=$("#addList tr"),t=0;t<r.length;t++)$(r[t]).attr("xh",i),u=$(r[t]).attr("value"),$("#addXh"+u).html(i),i++}function addMaintainer(){for(var i,h,c=432,r=$("#addList tr"),u=[],n=0;n<r.length;n++){var t=$(r[n]).attr("value"),e=$(r[n]).attr("xh"),o=$("#addUser"+t).find("option:checked").text(),s=$("#addUser"+t).find("option:checked").val(),f=$("#addPhone"+t).val(),l=$("#addRk"+t).val();if(isStrEmptyOrUndefined(o)){layer.msg(`序列${e}：请输入姓名`);return}if(isStrEmptyOrUndefined(s))return;if(!isStrEmptyOrUndefined(f)&&!isPhone(f)){layer.msg(`序列${e}：手机号格式不正确`);return}u.push({Name:o,Account:s,Phone:f,Remark:l})}u.length<=0||(i=null,h=function(){$("#addMaintainerBtn").attr("disabled","disabled");var n={};n.opType=c;n.opData=JSON.stringify(u);ajaxPost("/Relay/Post",n,function(n){i&&clearTimeout(i);$("#addMaintainerBtn").removeAttr("disabled");layer.msg(n.errmsg);n.errno==0&&(showMaintainerModel(1,!1),getWorkerSelect(),$("#addMaintainerModel").modal("hide"))});i=setTimeout(function(){$("#addMaintainerBtn").removeAttr("disabled")},5e3)},showConfirm("添加",h))}function updateMaintainer(){const n=[],t=_maintainerListTrs.length;if(!t){layer.msg("请先修改数据");return}for(let i=0;i<t;i++){const r=$(_maintainerListTrs[i]),e=r.find(".isEnabled"),o=e.val(),u=maintainers[o];let t,f;if(e.is(":checked")?(t=r.find(".phone").val().trim(),f=r.find(".remark").val().trim()):(t=u.Phone,f=u.Remark),!isStrEmptyOrUndefined(t)&&!isPhone(t)){layer.msg("手机号格式不正确");return}n.push({Id:o,Name:u.Name,Account:u.Account,Phone:t,Remark:f,Order:r.find(".order").text().trim()||0})}var i=function(){var i={},t;i.opType=431;i.opData=JSON.stringify(n);t=null;ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);t&&clearTimeout(t);$("#updateMaintainerBtn").removeAttr("disabled");n.errno==0&&(showMaintainerModel(0,!1),getWorkerSelect())});t=setTimeout(function(){$("#delMaintainerBtn").removeAttr("disabled")},5e3)};showConfirm("保存",i)}function delMaintainer(){const n=[],t=[];if($("#maintainerList .isEnabled:checked").each((i,r)=>{const u=$(r).val();n.push(u);t.push(maintainers[u].Name)}),!n.length){layer.msg("请选择需要删除的数据");return}var i=function(){var t,i;$("#delMaintainerBtn").attr("disabled","disabled");t={};t.opType=433;t.opData=JSON.stringify({ids:n});i=null;ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);i&&clearTimeout(i);$("#delMaintainerBtn").removeAttr("disabled");n.errno==0&&(showMaintainerModel(1,!1),getWorkerSelect())});i=setTimeout(function(){$("#delMaintainerBtn").removeAttr("disabled")},5e3)};showConfirm(`删除以下维修工：<pre style='color:red'>${t.join("<br>")}</pre>`,i)}var _permissionList=[],_faultType,_faultTypeData,_faultDevData,_batchAssignTable,_serviceLogData,_statisticsParData,_siteData,_updateFirmwareUpload,_delFaultDevData,_delServiceLogData,maintainers,_maintainerListTrs,addMax,addMaxV,users;const setRow=setTable();let _faultDeviceListTable=null,_repairRecordListTable=null,_statisticsDetailListTable=null,_delFaultDeviceListTable=null,_delRepairListTable=null;var _priority='<option value="0">低<\/option><option value="1">中<\/option><option value="2">高<\/option>',_grade='<option value="0">小修<\/option><option value="1">大修<\/option>',_worker=null,_workerName=null;_faultType=null;_faultTypeData=null;_faultDevData=null;_batchAssignTable=null;_serviceLogData=null;_statisticsParData=null;_siteData=null;_updateFirmwareUpload=null;_delFaultDevData=null;_delServiceLogData=null;maintainers=null;_maintainerListTrs=null;let _scheduleSelectEl=null;addMax=0;addMaxV=0;users=null;