function pageReady(){var n,t;permissionList[100]={uIds:[]};permissionList[400]={uIds:["getUsuallyFaultList"]};permissionList[402]={uIds:[]};permissionList[403]={uIds:["showAddUsuallyFaultModel"]};permissionList[404]={uIds:[]};permissionList[405]={uIds:[]};permissionList[406]={uIds:["getFaultTypeList"]};permissionList[408]={uIds:["updateFaultTypeModel"]};permissionList[410]={uIds:["showAddFaultTypeModel"]};permissionList[411]={uIds:[]};permissionList[412]={uIds:["repairListLi"]};permissionList[414]={uIds:[]};permissionList[415]={uIds:["addServiceLogBtn"]};permissionList[416]={uIds:[]};permissionList[417]={uIds:["faultDeviceLi"]};permissionList[420]={uIds:[]};permissionList[423]={uIds:[]};permissionList[424]={uIds:["delFaultDeviceLi"]};permissionList[425]={uIds:["delRepairLi"]};permissionList[430]={uIds:["showMaintainerModel"]};permissionList[431]={uIds:["updateMaintainerBtn"]};permissionList[432]={uIds:["showAddMaintainerModelBtn"]};permissionList[433]={uIds:["delMaintainerBtn"]};permissionList[444]={uIds:[]};permissionList[445]={uIds:[]};permissionList[446]={uIds:[]};permissionList[447]={uIds:[]};permissionList=checkPermissionUi(permissionList);n=$("#tabs li:not(.hidden)").first();n&&(n.addClass("active"),$(n.find("a").attr("href")).addClass("active"));$(".ms2").select2();$("#serLogFaultType").on("change",function(){var n=$(this).val();$("#serLogFaultDesc").val(_faultTypeData[n].FaultDescription)});getWorkerSelect();getFaultTypeSelect();t=getMonthScope();$("#faultSTime,#serviceLogSTime,#delFSTime,#delRepairSTime,#statSTime").val(t.start).datepicker("update");$("#faultETime,#serviceLogETime,#delFETime,#delRepairETime,#statETime").val(t.end).datepicker("update");$("#faultDevicePro").on("change",function(){var r=$(this).val(),n="#faultQuery",t="faultDeviceAttr",i="#faultDeviceAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#faultDeviceInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"state":setFaultDeviceGet(n,t,i,'<option value="0">未确认<\/option><option value="1">已确认<\/option><option value="2">维修中<\/option>');break;case"maintainer":setFaultDeviceGet(n,t,i,_worker);break;case"solveTime":$("#solveSTime,#solveETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#faultDeviceTime")}});$("#serviceLogPro").on("change",function(){var r=$(this).val(),n="#serviceLogQuery",t="serviceAttr",i="#serviceAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#serviceInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"maintainer":setFaultDeviceGet(n,t,i,_worker);break;default:$("#serSTime,#serETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#solveTime")}});$("#delFPro").on("change",function(){var r=$(this).val(),n="#delFQuery",t="delFAttr",i="#delFAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#delFInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"state":setFaultDeviceGet(n,t,i,'<option value="0">未确认<\/option><option value="1">已确认<\/option><option value="2">维修中<\/option>');break;case"maintainer":setFaultDeviceGet(n,t,i,_worker);break;case"solveTime":$("#delFSolveSTime,#delFSolveETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#delFTime")}});$("#delRepairPro").on("change",function(){var r=$(this).val(),n="#delRepairQuery",t="delRepairAttr",i="#delRepairAttrSelect";switch(r){case"code":setFaultDeviceGet(n,t,"#delRepairInput");break;case"faultType":setFaultDeviceGet(n,t,i,_faultType);break;case"priority":setFaultDeviceGet(n,t,i,_priority);break;case"grade":setFaultDeviceGet(n,t,i,_grade);break;case"maintainer":setFaultDeviceGet(n,t,i,_worker);break;default:$("#delRepSTime,#delRepETime").removeAttr("readonly");setFaultDeviceGet(n,t,"#delRepairTime")}});getFaultDeviceList();setTimeout(()=>getServiceLogList(0),2e3);$("#batchAssignList").on("change",".serviceName",function(){$(this).val()=="同上"&&$(this).val($(this).parents("tr").prev().find(".serviceName").val())});$("#serLogDevSite").select2({allowClear:!0,placeholder:"请选择(可不选)"});$("#serLogWorkshop").on("change",function(){setWorkSiteSelect()})}function setFaultDeviceGet(n,t,i,r){$(`${n} .${t}`).addClass("hidden");$(i).removeClass("hidden");r&&($(`#${t}`).empty(),$(`#${t}`).append(`<option value="-1">所有</option>${r}`))}function getWorkerSelect(){var t=430,n;if(!permissionList[t].have){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var i,u,t,f,r;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#designateName,#servicePro").empty(),i=n.datas,u='<option value="{0}" wname="{1}">{1}<\/option>',_worker='<option value="0" wname="0">未指派<\/option>',t=0,f=i.length;t<f;t++)r=i[t],_worker+=u.format(r.Account,r.Name);$("#designateName,#servicePro").append(_worker)},0)}function getFaultTypeSelect(){var t=406,n;if(!permissionList[t].have){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var r,u,i,f,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#serviceFaultType").empty(),r=n.datas,u='<option value="{0}">{1}<\/option>',_faultType="",_faultTypeData={},i=0,f=r.length;i<f;i++)t=r[i],_faultTypeData[t.Id]=t,_faultType+=u.format(t.Id,t.FaultTypeName);$("#serviceFaultType").append(_faultType)},0)}function setTable(){return{isEnable:n=>`<input type="checkbox" class="icb_minimal isEnable" value=${n.Id} fName=${n.DeviceCode}>`,order:(n,t,i,r)=>r.row+1,grade:n=>n?'<span class="text-red">大修<\/span>':"小修",setTime:n=>n=="0001-01-01 00:00:00"?"":n.slice(0,n.lastIndexOf(":")),rState:n=>n.State==0?'<span class="text-red">未确认<\/span>':n.State==1?'<span class="text-warning">已确认<\/span>':'<span class="text-success">维修中<\/span>',priority:n=>n.Priority==0?"低":n.Priority==1?'<span class="text-warning">中<\/span>':'<span class="text-red">高<\/span>',remark:n=>n==""||n.length<tdShowLength?n:`<span title = "${n}" onclick="showAllContent('${escape(n)}', '维修备注')">${n.substring(0,tdShowLength)+"..."}</span>`,rDesc:n=>{var t=n.FaultDescription;return`<span title = "${t}" onclick = "showFaultTypeDetailModel(${n.FaultTypeId}, '${escape(t.trim())}')">${t.length>tdShowLength?t.substring(0,tdShowLength):t}...</span>`},imgBtn:n=>{var t=`<span class="glyphicon glyphicon-{0}" aria-hidden="true" style="color:{1};font-size:25px;vertical-align:middle;margin-right:5px"></span>
                      <button type="button" class="btn btn-info btn-sm" style="vertical-align:middle" onclick="showImgModel(${n.Id},'${n.FaultTypeName}','${n.ImageList}')">查看</button>`;return n.ImageList.length?t.format("ok","green"):t.format("remove","red")},serIsEnable:n=>{var t=`机台号-${n.DeviceCode}：${n.FaultTypeName}`;return`<input type="checkbox" class="icb_minimal isEnable" value=${n.Id} fName=${t}>`},upServiceLog:(n,t)=>`<button type="button" class="btn btn-primary btn-sm" onclick="showServiceLogModal(${t},${n})">查看</button>`,serviceName:n=>n==""?"未指派":n,detailBtn:n=>`<button type="button" class="btn btn-info btn-sm" onclick="showLogDetailModel(${n.FaultTypeId},'${n.DeviceCode}','${n.Proposer}','${n.FaultTime}','${n.FaultDescription}',${n.Priority},${n.Grade})">查看</button>`}}function getFaultDeviceList(){var s=417,n,t,e,o,u;if(permissionList[s].have){if(_faultDevData={},_faultDevData.Id=[],_faultDevData.Name=[],_faultDevData.data={},n=$("#faultSTime").val(),t=$("#faultETime").val(),isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择故障时间");return}if(!comTimeDay(n,t)){n=`${n} 00:00:00`;t=`${t} 23:59:59`;var h=$("#faultDeviceCond").val(),r={startTime:n,endTime:t,condition:h},f=$("#faultDevicePro").val(),i;switch(f){case"code":i=$("#faultDeviceInput").val().trim();isStrEmptyOrUndefined(i)||(r[f]=i);break;case"solveTime":e=$("#solveSTime").val();isStrEmptyOrUndefined(e)||(r.eStartTime=e);o=$("#solveETime").val();isStrEmptyOrUndefined(o)||(r.eEndTime=o);break;default:i=$("#faultDeviceAttr").val();isStrEmptyOrUndefined(i)||(r[f]=i)}u={};u.opType=s;u.opData=JSON.stringify(r);ajaxPost("/Relay/Post",u,function(n){var i,r,f,u,e,o;if(n.errno!=0){layer.msg(n.errmsg);return}for(i=n.datas,r=0,f=i.length;r<f;r++)u=i[r],_faultDevData.data[u.Id]=u;var t=permissionList[423].have,s=permissionList[420].have,h=permissionList[445].have,c=permissionList[446].have;t?$("#delChangeBtn").removeClass("hidden"):$("#delChangeBtn").addClass("hidden");c?$("#showBatchAssignModalBtn").removeClass("hidden"):$("#showBatchAssignModalBtn").addClass("hidden");e=function(n){var u=n.State,t="",i="",r="";switch(u){case 0:t="danger";i="确认故障";r=`showConfirmModel(${n.Id}, 0,'${n.EstimatedTime}','${n.Remark}')`;break;case 1:t="info";i="开始维修";r=`showConfirmModel(${n.Id}, 1,'${n.EstimatedTime}','${n.Remark}')`;break;case 2:t="success";i="维修完成";r=`showServiceModel(${n.Id},'${n.Maintainer}','${n.EstimatedTime}',${n.FaultTypeId})`}return'<button type="button" class="btn btn-{0} btn-xs" onclick="{1}">{2}<\/button>'.format(t,r,i)};o=function(n){var t=n.Name==""?"未指派":n.Name;return h?`<a href="javascript:showDesignateModal(${n.Id},${n.Priority},'${n.Maintainer?n.Maintainer:0}',${n.Grade})" style="padding:3px" class="designate"><i class="glyphicon glyphicon-hand-right"></i><span class="text-black">${t}</span></a>`:t};$("#faultDeviceList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i,aaSorting:[[t?1:0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setTable().isEnable,visible:t,orderable:!t},{data:null,title:"序号",render:setTable().order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setTable().setTime},{data:null,title:"状态",render:setTable().rState},{data:null,title:"优先级",render:setTable().priority},{data:"Grade",title:"故障等级",render:setTable().grade},{data:null,title:"维修",render:e,visible:s},{data:null,title:"指派给",render:o},{data:"Phone",title:"联系方式"},{data:"EstimatedTime",title:"预计解决时间",render:setTable().setTime},{data:"Remark",title:"维修备注",render:setTable().remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setTable().rDesc},{data:null,title:"故障详情",render:setTable().detailBtn}],drawCallback:function(){if(t)$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_faultDevData.Id.push(n),_faultDevData.Name.push(t)):(_faultDevData.Id.splice(_faultDevData.Id.indexOf(n),1),_faultDevData.Name.splice(_faultDevData.Name.indexOf(t),1))})}})})}}}function showBatchAssignModal(){var i=_faultDevData.Id,r=i.length,t,n;if(!r){layer.msg("请选择需要指派的故障设备");return}for(t=[],n=0;n<r;n++)t.push(_faultDevData.data[i[n]]);var u=function(){return`<div style="width:100%;min-width:80px;margin:auto"><select class="form-control priority" style="width: 100%">${_priority}</select></div>`},f=function(){return`<div style="width:100%;min-width:80px;margin:auto"><select class="form-control grade" style="width: 100%">${_grade}</select></div>`},e=function(n,t,i,r){return`<div style="width:100%;min-width:120px;margin:auto"><select class="form-control serviceName" style="width: 100%">${r.row==0?"":'<option value="同上">同上<\/option>'}${_worker}</select></div>`};_batchAssignTable=$("#batchAssignList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:setTable().order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setTable().setTime},{data:null,title:"状态",render:setTable().rState},{data:null,title:"优先级",render:u},{data:null,title:"故障等级",render:f},{data:null,title:"指派给",render:e},{data:"Phone",title:"联系方式"},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setTable().rDesc},{data:null,title:"故障详情",render:setTable().detailBtn}],createdRow:function(n,t){var r=t.Priority,i=t.Maintainer,u=t.Grade;isStrEmptyOrUndefined(i)&&(i=0);$(n).find(".priority").val(r).end().find(".grade").val(u).end().find(".serviceName").val(i)}});$("#showBatchAssignModal").modal("show")}function batchAssign(){var r=446,n,t;if(!permissionList[r].have){layer.msg("没有权限");return}var u=_batchAssignTable.context[0].aoData,e=u.length,f=[];for(n=0;n<e;n++){var i=u[n].nTr,o=$(i).find(".priority").val(),s=$(i).find(".grade").val(),h=$(i).find(".serviceName").val();f.push({Id:_faultDevData.Id[n]>>0,Maintainer:h,Priority:o>>0,Grade:s>>0})}t={};t.opType=r;t.opData=JSON.stringify(f);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showBatchAssignModal").modal("hide"),getFaultDeviceList())})}function showConfirmModel(n,t,i,r){$("#confirmTitle").text(t?"开始维修":"确认故障");t?($("#confirmTitle").text("开始维修"),$("#confirmFaultBtn").addClass("hidden"),$("#confirmStartBtn").val(n)):($("#confirmTitle").text("确认故障"),$("#confirmFaultBtn").removeClass("hidden"),$("#confirmFaultBtn,#confirmStartBtn").val(n));i=i=="0001-01-01 00:00:00"?getDate():i.slice(0,i.indexOf(" "));$("#confirmTime").val(i).datepicker("update");$("#confirmHms").timepicker("setTime",getTime());$("#confirmDesc").val(r);$("#showConfirmModel").modal("show")}function confirmFault(n){var i=444;if(!permissionList[i].have){layer.msg("没有权限");return}var f=$(this).val(),r=$("#confirmTime").val(),u=$("#confirmHms").val();if(isStrEmptyOrUndefined(r)||isStrEmptyOrUndefined(u)){layer.msg("请选择预计解决时间");return}var e=`${r} ${u}`,o=$("#confirmDesc").val(),t={};t.opType=i;t.opData=JSON.stringify([{Id:f,EstimatedTime:e,Remark:o,State:n}]);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showConfirmModel").modal("hide"),getFaultDeviceList())})}function showServiceModel(n,t,i,r){$("#serviceBtn").val(n);$("#servicePro").val(t).trigger("change");i=i=="0001-01-01 00:00:00"?getDate():i.slice(0,i.indexOf(" "));$("#serviceTime").val(i).datepicker("update");$("#serviceHms").timepicker("setTime",getTime());$("#serviceFaultType").val(r).trigger("change");$("#showServiceModel").modal("show")}function service(){var f=444,e,t,i,r,o,u,s,n;if(!permissionList[f].have){layer.msg("没有权限");return}if(e=$(this).val(),t=$("#servicePro option:selected").attr("wname"),isStrEmptyOrUndefined(t)){layer.msg("请选择解决人");return}if(i=$("#serviceTime").val(),r=$("#serviceHms").val(),isStrEmptyOrUndefined(i)||isStrEmptyOrUndefined(r)){layer.msg("请选择解决时间");return}if(o=`${i} ${r}`,u=$("#serviceFaultType").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择故障类型");return}s=$("#serviceDesc").val();n={};n.opType=f;n.opData=JSON.stringify([{FaultSolver:t,SolveTime:o,SolvePlan:s,FaultTypeId1:u,State:3,Id:e}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showServiceModel").modal("hide"),getFaultDeviceList())})}function showDesignateModal(n,t,i,r){$("#designateBtn").val(n);$("#designateName").val(i);$("#designatePro").val(t);$("#designateGrade").val(r);$("#showDesignateModal").modal("show")}function designate(){var u=445,t,i,r,f,n;if(!permissionList[u].have){layer.msg("没有权限");return}if(t=$("#designateName").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择指派人");return}if(i=$("#designatePro").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择优先级");return}if(r=$("#designateGrade").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择故障等级");return}f=$(this).val();n={};n.opType=u;n.opData=JSON.stringify([{Id:f>>0,Maintainer:t,Priority:i>>0,Grade:r>>0}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showDesignateModal").modal("hide"),getFaultDeviceList())})}function showLogDetailModel(n,t,i,r,u,f,e){var s=406,o;permissionList[s].have&&(o={},o.opType=s,o.opData=JSON.stringify({qId:n,menu:!0}),ajaxPost("/Relay/Post",o,function(n){var h,o,s;if(n.errno!=0){layer.msg(n.errmsg);return}h=n.datas[0];$("#logDevName").text(t);$("#logPerson").text(i);$("#logFaultTime").text(r);$("#logFaultType").text(h.FaultTypeName);$("#logFaultTypeDesc").val(h.FaultDescription);$("#logFaultSup").val(u);o="";s="";switch(f){case 0:o="低";s="black";break;case 1:o="中";s="#CC6600";break;case 2:o="高";s="red"}$("#logPriority").text(o).css("color",s);$("#logGrade").text(e==0?"小修":"大修").css("color",e==0?"black":"red");$("#showLogDetailModel").modal("show")}))}function delChange(){var n=423,t;if(!permissionList[n].have){layer.msg("没有权限");return}if(!_faultDevData.Id.length){layer.msg("请选择需要删除的数据");return}t=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_faultDevData.Id});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultDeviceList()})};showConfirm(`删除以下故障设备：<pre style='color:red'>${_faultDevData.Name.join("<br>")}</pre>`,t)}function getServiceLogList(n,t,i,r,u){var p=412,f,e,o,w,h,s,l,a,v,y,c;if(permissionList[p].have){if(f=null,t)f={startTime:i,endTime:r,condition:0,maintainer:t},_statisticsParData={name:t,sTime:i,eTime:r,score:u};else{if(_serviceLogData={},_serviceLogData.Id=[],_serviceLogData.Name=[],e=$("#serviceLogSTime").val(),o=$("#serviceLogETime").val(),isStrEmptyOrUndefined(e)||isStrEmptyOrUndefined(o)){layer.msg("请选择解决时间");return}if(comTimeDay(e,o))return;e=`${e} 00:00:00`;o=`${o} 23:59:59`;w=$("#serviceLogCond").val();f={startTime:e,endTime:o,condition:w};h=$("#serviceLogPro").val();switch(h){case"code":s=$("#serviceInput").val().trim();isStrEmptyOrUndefined(s)||(f[h]=s);break;case"faultTime":l=$("#serSTime").val();isStrEmptyOrUndefined(l)||(f.fStartTime=l);a=$("#serETime").val();isStrEmptyOrUndefined(a)||(f.fEndTime=a);break;case"solveTime":v=$("#serSTime").val();isStrEmptyOrUndefined(v)||(f.eStartTime=v);y=$("#serETime").val();isStrEmptyOrUndefined(y)||(f.eEndTime=y);break;default:s=$("#serviceAttr").val();isStrEmptyOrUndefined(s)||(f[h]=s)}}c={};c.opType=p;c.opData=JSON.stringify(f);ajaxPost("/Relay/Post",c,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}i=permissionList[416].have;i?$("#delServiceLogBtn").removeClass("hidden"):$("#delServiceLogBtn").addClass("hidden");var r=[6,9],f=t?$("#statisticsDetailList"):$("#repairRecordList");f.DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rtip',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14],format:{body:function(n,t,i,u){if(r.indexOf(i)>-1){var f=$(u).find("span").attr("title");if(f!=null)return"‌"+unescape(f)}return"‌"+u.textContent}}}}],destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[i&&!t?1:0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setTable().serIsEnable,visible:i&&!t,orderable:!i&&t},{data:null,title:"序号",render:setTable().order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setTable().setTime},{data:"SolveTime",title:"解决时间",sClass:"text-primary",render:setTable().setTime},{data:"CostTime",title:"用时",sClass:"text-primary"},{data:null,title:"优先级",render:setTable().priority},{data:"Grade",title:"故障等级",render:setTable().grade},{data:"Score",title:"评分",sClass:"text-primary"},{data:"FaultSolver",title:"解决人"},{data:"Name",title:"指派给",render:setTable().serviceName},{data:"EstimatedTime",title:"预计解决时间",render:setTable().setTime},{data:"Remark",title:"维修备注",render:setTable().remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setTable().rDesc},{data:null,title:"故障图片",render:setTable().imgBtn},{data:"Id",title:"详情",render:setTable().upServiceLog.bind(null,0)}],drawCallback:function(){if(i&&!t)$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_serviceLogData.Id.push(n),_serviceLogData.Name.push(t)):(_serviceLogData.Id.splice(_serviceLogData.Id.indexOf(n),1),_serviceLogData.Name.splice(_serviceLogData.Name.indexOf(t),1))})}});t&&($("#score").text(u),$("#showStatisticsDetailModel").modal("show"))},n)}}function showStatisticsModel(){getStatisticsList();$("#showStatisticsModel").modal("show")}function getStatisticsList(){var r=447,n,t,i;if(permissionList[r].have){if(n=$("#statSTime").val(),t=$("#statETime").val(),isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择解决时间");return}comTimeDay(n,t)||(n=`${n} 00:00:00`,t=`${t} 23:59:59`,i={},i.opType=r,i.opData=JSON.stringify({startTime:n,endTime:t}),ajaxPost("/Relay/Post",i,function(i){if(i.errno!=0){layer.msg(i.errmsg);return}var r=function(n,t,i,r){return r.row+1},u=function(i){return`<button type="button" class="btn btn-primary btn-sm" onclick="getServiceLogList(1,'${i.Account}','${n}','${t}','${i.Score}')">查看</button>`};$("#statisticsList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i.datas,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:r},{data:"Name",title:"维修工"},{data:"Score",title:"评分"},{data:null,title:"详情",render:u}]})}))}}function showImgModel(n,t,i){if($("#FaultImgName").text(t),$("#faultImgList").empty(),!isStrEmptyOrUndefined(i)){i=i.split(",");var r={type:fileEnum.FaultDevice,files:JSON.stringify(i)};ajaxPost("/Upload/Path",r,function(n){var i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(i="",t=0;t<n.data.length;t++)i+=`<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6">
                <div class="thumbnail">
                <img src=${n.data[t].path} style="height:200px">
                </div>
                </div>`;$("#faultImgList").append(i)})}$("#showFaultImgModel").modal("show")}function delServiceLog(){var n=416,t;if(!permissionList[n].have){layer.msg("没有权限");return}if(!_serviceLogData.Id.length){layer.msg("请选择需要删除的数据");return}t=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_serviceLogData.Id});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getServiceLogList(1)})};showConfirm(`删除以下维修记录：<pre style='color:red'>${_serviceLogData.Name.join("<br>")}</pre>`,t)}function getDeviceCode(n){var i=100,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var i,r;if(t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas,f="";for(i=0;i<u.length;i++)r=u[i],f+='<option value="{0}">{1}<\/option>'.format(r.Id,r.Code);n!=null&&n(f)},0)}function getWorkShop(n){var i=162,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var i,f;if(t.errno!=0){layer.msg(t.errmsg);return}var r=t.datas,u="";for(i=0;i<r.length;i++)f=r[i],u+='<option value = "{0}">{0}<\/option>'.format(f.SiteName);n!=null&&n(u)},0)}function getSite(){var t=125,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var r,i,u,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(_siteData={},r=n.datas,i=0,u=r.length;i<u;i++)t=r[i],_siteData[t.SiteName]?_siteData[t.SiteName].push(t.RegionDescription):_siteData[t.SiteName]=[t.RegionDescription];setWorkSiteSelect()},0)}function setWorkSiteSelect(){var t,i,r,n,f,u;if($("#serLogDevSite").empty(),t=$("#serLogWorkshop").val(),!isStrEmptyOrUndefined(t)){for(i=_siteData[t],r="",n=0,f=i.length;n<f;n++)u=i[n],r+=`<option value=${u}>${u}</option>`;$("#serLogDevSite").append(r);$("#serLogDevSite").val(0).trigger("change")}}function showServiceLogModal(n,t){var r=n?t?425:412:415,i,u,f,e;if(!permissionList[r].have){layer.msg("没有权限");return}$("#serLogFaultSup").prop("disabled",!!n);$("#serviceLogTitle").text(n?"维修记录详情":"添加维修记录");n?($("#showServiceLogModal .isText").removeClass("hidden"),$("#showServiceLogModal .noText").addClass("hidden"),i={},i.opType=r,i.opData=JSON.stringify({qId:n}),ajaxPost("/Relay/Post",i,function(i){var r,o,u,h,s;if(i.errno!=0){layer.msg(i.errmsg);return}r=i.datas[0];$("#serLogCodeText").text(r.DeviceCode);$("#serLogProposerText").text(r.Proposer);$("#serLogFaultTimeText").text(r.FaultTime);$("#serLogFaultTypeText").text(r.FaultTypeName);$("#serLogFaultDesc").val(_faultTypeData[r.FaultTypeId].FaultDescription);$("#serLogFaultSup").val(r.FaultDescription);var c=r.Priority,f="",e="";switch(c){case 0:f="低";e="black";break;case 1:f="中";e="#CC6600";break;case 2:f="高";e="red"}$("#serLogPriorityText").text(f).css("color",e);o=r.Grade;$("#serLogGradeText").text(o==0?"小修":"大修").css("color",o==0?"black":"red");$("#serLogMaintainerText").text(r.Name==""?"未指派":r.Name);u=r.SolveTime;$("#serLogFaultType1").empty();$("#serLogFaultType1").append(_faultType);t?($("#upServiceLogBox .isText").removeClass("hidden"),$("#upServiceLogBox .noText").addClass("hidden"),$("#serLogFaultSolverText").text(r.FaultSolver),$("#serLogSolveTimeText").text(u=="0001-01-01 00:00:00"?"":u.slice(0,u.lastIndexOf(":"))),h=$(`#serLogFaultType1 option[value=${r.FaultTypeId1}]`).text(),$("#serLogFaultType1Text").text(h),$("#serLogSolvePlan").prop("disabled",!0),$("#updateServiceLogBtn").addClass("hidden")):($("#upServiceLogBox .isText").addClass("hidden"),$("#upServiceLogBox .noText").removeClass("hidden"),$("#serLogFaultSolver").empty(),$("#serLogFaultSolver").append(_worker),s=$(`#serLogFaultSolver option[wname=${r.FaultSolver}]`).val(),$("#serLogFaultSolver").val(s?s:0),u=="0001-01-01 00:00:00"?($("#serLogSolveDate").val(getDate()).datepicker("update"),$("#serLogSolveTime").timepicker("setTime",getTime())):($("#serLogSolveDate").val(u.split(" ")[0]).datepicker("update"),$("#serLogSolveTime").timepicker("setTime",u.split(" ")[1])),$("#serLogFaultType1").val(r.FaultTypeId1).trigger("change"),permissionList[414].have?($("#updateServiceLogBtn").removeClass("hidden"),$("#updateServiceLogBtn").val(n),$("#serLogSolvePlan").prop("disabled",!1)):($("#updateServiceLogBtn").addClass("hidden"),$("#serLogSolvePlan").prop("disabled",!0)));$("#serLogSolvePlan").val(r.SolvePlan)})):($("#showServiceLogModal .isText").addClass("hidden"),$("#showServiceLogModal .noText").removeClass("hidden"),$("#serLogSolvePlan").prop("disabled",!1),$("#serLogCodeOther,#serLogFaultSup,#serLogSolvePlan").val(""),$("#serLogPriority").val(0),$("#serLogGrade").val(0),$("#serLogProposer").val(getCookieTokenInfo().name),$("#serLogFaultDate,#serLogSolveDate").val(getDate()).datepicker("update"),$("#serLogFaultTime,#serLogSolveTime").timepicker("setTime",getTime()),$("#serLogFaultType,#serLogFaultType1,#serLogMaintainer,#serLogFaultSolver").empty(),$("#serLogFaultType,#serLogFaultType1").append(_faultType),$("#serLogMaintainer,#serLogFaultSolver").append(_worker),u=$("#serLogFaultType").val(),$("#serLogFaultDesc").val(_faultTypeData[u].FaultDescription),f=new Promise(n=>getDeviceCode(n)),e=new Promise(n=>getWorkShop(n)),Promise.all([f,e]).then(n=>{$("#serLogCode,#serLogWorkshop").empty(),$("#serLogCode").append(n[0]),$("#serLogCode").val(0).trigger("change"),$("#serLogCode").select2({allowClear:!0,placeholder:"请选择"}),$("#serLogWorkshop").append(n[1]),getSite()}));$("#showServiceLogModal").modal("show")}function addUpServiceLog(n){var k=n?415:414,i,o,s,h,c,g,l,nt,a,v,u,t,y,p,tt,w;if(!permissionList[k].have){layer.msg("没有权限");return}if(i={},n){var f=$("#serLogCode").val(),rt=$("#serLogWorkshop").val(),r=$("#serLogCodeOther").val().trim(),d=isStrEmptyOrUndefined(f),e=isStrEmptyOrUndefined(r);if(d&&e){layer.msg("请选择或输入一台机台号");return}if(!d&&!e){layer.msg("只能选择或输入一台机台号");return}if(e||(o=$("#serLogDevSite").val(),r=`${rt}-${o?o+"-":""}${r}`,f=0),s=$("#serLogProposer").val().trim(),isStrEmptyOrUndefined(s)){layer.msg("报修人不能为空");return}if(h=$("#serLogFaultDate").val(),c=$("#serLogFaultTime").val(),isStrEmptyOrUndefined(h)||isStrEmptyOrUndefined(c)){layer.msg("请选择故障时间");return}if(g=`${h} ${c}`,l=$("#serLogFaultType").val(),isStrEmptyOrUndefined(l)){layer.msg("请选择故障类型");return}if(nt=$("#serLogFaultSup").val().trim(),a=$("#serLogPriority").val(),isStrEmptyOrUndefined(a)){layer.msg("请选择优先级");return}if(v=$("#serLogGrade").val(),isStrEmptyOrUndefined(v)){layer.msg("请选择故障等级");return}u=$("#serLogMaintainer").val();u==0&&(u="");i={DeviceId:f,DeviceCode:r,Proposer:s,FaultTime:g,FaultTypeId:l,FaultDescription:nt,Priority:a,Grade:v,Maintainer:u}}else i.Id=$(this).val();if(t=$("#serLogFaultSolver option:selected").attr("wname"),isStrEmptyOrUndefined(t)){layer.msg("请选择解决人");return}if(t==0&&(t="未指派"),y=$("#serLogSolveDate").val(),p=$("#serLogSolveTime").val(),isStrEmptyOrUndefined(y)||isStrEmptyOrUndefined(p)){layer.msg("请选择解决时间");return}if(tt=`${y} ${p}`,w=$("#serLogFaultType1").val(),isStrEmptyOrUndefined(w)){layer.msg("请选择实际故障类型");return}var ut=$("#serLogSolvePlan").val().trim(),it=$.extend(i,{FaultSolver:t,SolveTime:tt,FaultTypeId1:w,SolvePlan:ut}),b={};b.opType=k;b.opData=JSON.stringify(n?it:[it]);ajaxPost("/Relay/Post",b,function(n){layer.msg(n.errmsg);n.errno==0&&($("#showServiceLogModal").modal("hide"),$("#showStatisticsDetailModel").is(":hidden")?getServiceLogList(1):getServiceLogList(1,_statisticsParData.name,_statisticsParData.sTime,_statisticsParData.eTime,_statisticsParData.score))})}function getDelFaultDeviceList(){var s=424,n,t,e,o,u;if(permissionList[s].have){if(_delFaultDevData={},_delFaultDevData.Id=[],_delFaultDevData.Name=[],n=$("#delFSTime").val(),t=$("#delFETime").val(),isStrEmptyOrUndefined(n)||isStrEmptyOrUndefined(t)){layer.msg("请选择故障时间");return}if(!comTimeDay(n,t)){n=`${n} 00:00:00`;t=`${t} 23:59:59`;var h=$("#delFCond").val(),r={startTime:n,endTime:t,condition:h},f=$("#delFPro").val(),i;switch(f){case"code":i=$("#delFInput").val().trim();isStrEmptyOrUndefined(i)||(r[f]=i);break;case"solveTime":e=$("#delFSolveSTime").val();isStrEmptyOrUndefined(e)||(r.eStartTime=e);o=$("#delFSolveETime").val();isStrEmptyOrUndefined(o)||(r.eEndTime=o);break;default:i=$("#delFAttr").val();isStrEmptyOrUndefined(i)||(r[f]=i)}u={};u.opType=s;u.opData=JSON.stringify(r);ajaxPost("/Relay/Post",u,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}$("#delFaultDeviceList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:oLanguage,data:n.datas,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setTable().isEnable,orderable:!1,visible:!1},{data:null,title:"序号",render:setTable().order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setTable().setTime},{data:null,title:"优先级",render:setTable().priority},{data:"Grade",title:"故障等级",render:setTable().grade},{data:null,title:"状态",render:setTable().rState},{data:"Name",title:"指派给",render:setTable().serviceName},{data:"Phone",title:"联系方式"},{data:"Remark",title:"维修备注",render:setTable().remark},{data:"EstimatedTime",title:"预计解决时间",render:setTable().setTime},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setTable().rDesc},{data:null,title:"故障图片",render:setTable().imgBtn}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_delFaultDevData.Id.push(n),_delFaultDevData.Name.push(t)):(_delFaultDevData.Id.splice(_delFaultDevData.Id.indexOf(n),1),_delFaultDevData.Name.splice(_delFaultDevData.Name.indexOf(t),1))})}})})}}}function getDelServiceLogList(){var c=425,t,i,e,o,s,h,u;if(permissionList[c].have){if(_delServiceLogData={},_delServiceLogData.Id=[],_delServiceLogData.Name=[],t=$("#delRepairSTime").val(),i=$("#delRepairETime").val(),isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(i)){layer.msg("请选择解决时间");return}if(!comTimeDay(t,i)){t=`${t} 00:00:00`;i=`${i} 23:59:59`;var l=$("#delRepairCond").val(),n={startTime:t,endTime:i,condition:l},f=$("#delRepairPro").val(),r;switch(f){case"code":r=$("#delRepairInput").val().trim();isStrEmptyOrUndefined(r)||(n[f]=r);break;case"faultTime":e=$("#delRepSTime").val();isStrEmptyOrUndefined(e)||(n.fStartTime=e);o=$("#delRepETime").val();isStrEmptyOrUndefined(o)||(n.fEndTime=o);break;case"solveTime":s=$("#delRepSTime").val();isStrEmptyOrUndefined(s)||(n.eStartTime=s);h=$("#delRepETime").val();isStrEmptyOrUndefined(h)||(n.eEndTime=h);break;default:r=$("#delRepairAttr").val();isStrEmptyOrUndefined(r)||(n[f]=r)}u={};u.opType=c;u.opData=JSON.stringify(n);ajaxPost("/Relay/Post",u,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}$("#delRepairList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"",render:setTable().serIsEnable,orderable:!1,visible:!1},{data:null,title:"序号",render:setTable().order},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间",render:setTable().setTime},{data:"SolveTime",title:"解决时间",sClass:"text-primary",render:setTable().setTime},{data:"CostTime",title:"用时",sClass:"text-primary"},{data:null,title:"优先级",render:setTable().priority},{data:"Grade",title:"故障等级",render:setTable().grade},{data:"Score",title:"评分",sClass:"text-primary"},{data:"FaultSolver",title:"解决人"},{data:"Name",title:"指派给",render:setTable().serviceName()},{data:"EstimatedTime",title:"预计解决时间",render:setTable().setTime},{data:"Remark",title:"维修备注",render:setTable().remark},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障描述",render:setTable().rDesc},{data:null,title:"故障图片",render:setTable().imgBtn},{data:"Id",title:"详情",render:setTable().upServiceLog.bind(null,1)}],drawCallback:function(){$(this).find(".isEnable").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(){var n=$(this).val(),t=$(this).attr("fName");$(this).is(":checked")?(_delServiceLogData.Id.push(n),_delServiceLogData.Name.push(t)):(_delServiceLogData.Id.splice(_delServiceLogData.Id.indexOf(n),1),_delServiceLogData.Name.splice(_delServiceLogData.Name.indexOf(t),1))})}})})}}}function getUsuallyFaultList(){var t=400,n;if(!permissionList[t].have){layer.msg("没有权限");return}$("#usuallyFaultList").empty();n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>',r=function(n){var t='<li><a onclick="showUpdateUsuallyFaultModel({0})">修改<\/a><\/li>'.format(n.Id),r="<li><a onclick=\"deleteUsuallyFault({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.UsuallyFaultDesc));return i.format(permissionList[402].have?t:"",permissionList[405].have?r:"")},u=function(n){var t=n.SolvePlan;return`<span title = "${t}" onclick = "showAllContent('${escape(t)}', '解决方案')">${t.length>tdShowLength?t.substring(0,tdShowLength)+"...":t}</span>`},t=[{data:"Id",title:"序号"},{data:"UsuallyFaultDesc",title:"常见故障"},{data:null,title:"解决方案",render:u}];(permissionList[402].have||permissionList[405].have)&&t.push({data:null,title:"操作",render:r,orderable:!1});$("#usuallyFaultList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:t,bAutoWidth:!0});$("#usuallyFaultModel").modal("show")})}function deleteUsuallyFault(n,t){var i,r;if(t=unescape(t),i=405,!permissionList[i].have){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})};showConfirm("删除常见故障："+t,r)}function showAddUsuallyFaultModel(){hideClassTip("adt");$("#addUsuallyFaultDesc").val("");$("#addSolvePlan").val("");$("#addUsuallyFaultModel").modal("show")}function addUsuallyFault(){var r=403,n,t,i,u;if(!permissionList[r].have){layer.msg("没有权限");return}(n=!0,t=$("#addUsuallyFaultDesc").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("addUsuallyFaultDescTip","故障描述不能为空"),n=!1),i=$("#addSolvePlan").val().trim(),isStrEmptyOrUndefined(i)&&(showTip("addSolvePlanTip","解决方案不能为空"),n=!1),n)&&(u=function(){$("#addUsuallyFaultModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({UsuallyFaultDesc:t,SolvePlan:i});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("添加",u))}function showUpdateUsuallyFaultModel(n){var i=400,t;if(!permissionList[i].have){layer.msg("没有权限");return}$("#updateId").html(n);t={};t.opType=i;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateUsuallyFaultDesc").val(n.datas[0].UsuallyFaultDesc),$("#updateSolvePlan").val(n.datas[0].SolvePlan));hideClassTip("adt");$("#updateUsuallyFaultModel").modal("show")})}function updateUsuallyFault(){var r=402,n,t,i,u,f;if(!permissionList[r].have){layer.msg("没有权限");return}(n=!0,t=$("#updateUsuallyFaultDesc").val().trim(),isStrEmptyOrUndefined(t)&&(showTip($("#updateUsuallyFaultDescTip"),"故障描述不能为空"),n=!1),i=$("#updateSolvePlan").val().trim(),isStrEmptyOrUndefined(i)&&(showTip($("#updateSolvePlanTip"),"解决方案不能为空"),n=!1),n)&&(u=parseInt($("#updateId").html()),f=function(){$("#updateUsuallyFaultModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({id:u,UsuallyFaultDesc:t,SolvePlan:i});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("修改",f))}function getFaultTypeList(){var t=406,n;if(!permissionList[t].have){layer.msg("没有权限");return}$("#faultTypeList").empty();n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>',r=function(n){var t='<li><a onclick="showUpdateFaultTypeModel({0})">修改<\/a><\/li>'.format(n.Id),r="<li><a onclick=\"deleteFaultType({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.FaultTypeName));return i.format(permissionList[408].have?t:"",permissionList[411].have?r:"")},t=[{data:null,title:"序号",render:setTable().order},{data:"Id",title:"Id",bVisible:!1},{data:"FaultTypeName",title:"故障类型"},{data:null,title:"故障类型描述",render:setTable().rDesc}];(permissionList[408].have||permissionList[411].have)&&t.push({data:null,title:"操作",render:r,orderable:!1});$("#faultTypeList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:t});$("#faultTypeModel").modal("show")})}function showFaultTypeDetailModel(n,t=""){var r=406,i;if(!permissionList[r].have){layer.msg("没有权限");return}t=unescape(t);$("#faultTypeDetail1Div").addClass("hidden");isStrEmptyOrUndefined(t)||($("#faultTypeDetail1Div").removeClass("hidden"),$("#faultTypeDetail1").html(t));i={};i.opType=r;i.opData=JSON.stringify({qId:n,menu:!0});ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas[0];n.datas.length>0&&($("#faultTypeNameDetail").html(t.FaultTypeName),$("#faultTypeDetail").html(t.FaultDescription));$("#faultTypeDetailModel").modal("show")})}function deleteFaultType(n,t){var i,r;if(t=unescape(t),i=411,!permissionList[411].have){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultTypeList()})};showConfirm("删除故障类型："+t,r)}function showAddFaultTypeModel(){hideClassTip("adt");$("#addFaultTypeName").val("");$("#addFaultTypeDesc").val("");$("#addFaultTypeModel").modal("show")}function addFaultType(){var i=410,n,t,r,u;if(!permissionList[i].have){layer.msg("没有权限");return}(n=!0,t=$("#addFaultTypeName").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("addFaultTypeNameTip","故障类型不能为空"),n=!1),r=$("#addFaultTypeDesc").val(),n)&&(u=function(){$("#addFaultTypeModel").modal("hide");var n={};n.opType=i;n.opData=JSON.stringify([{FaultTypeName:t,FaultDescription:r}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultTypeList()})},showConfirm("添加",u))}function showUpdateFaultTypeModel(n){var i=406,t;if(!permissionList[i].have){layer.msg("没有权限");return}$("#updateTypeId").html(n);t={};t.opType=i;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateFaultTypeName").val(n.datas[0].FaultTypeName),$("#updateFaultTypeDesc").val(n.datas[0].FaultDescription));hideClassTip("adt");$("#updateFaultTypeModel").modal("show")})}function updateFaultType(){var i=408,n,t,r,u,f;if(!permissionList[i].have){layer.msg("没有权限");return}(n=!0,t=$("#updateFaultTypeName").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("updateFaultTypeNameTip","故障类型不能为空"),n=!1),r=$("#updateFaultTypeDesc").val(),n)&&(u=parseInt($("#updateTypeId").html()),f=function(){$("#updateFaultTypeModel").modal("hide");var n={};n.opType=i;n.opData=JSON.stringify({id:u,FaultTypeName:t,FaultDescription:r});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultTypeSelect()})},showConfirm("修改",f))}function showMaintainerModel(n=1,t=true){var r=430,i;if(!permissionList[r].have){layer.msg("没有权限");return}maintainers=[];choseMaintainer=[];$("#maintainerList").empty();i={};i.opType=r;i.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",i,function(n){var i,r,f,e;if(n.errno!=0){layer.msg(n.errmsg);return}for(i=0;i<n.datas.length;i++)r=n.datas[i],maintainers[r.Id]=r;var o=function(n,t,i,r){var u=r.row+1;return`<input type="checkbox" class="icb_minimal chose" value="${u}" id="${n}">`},s=function(n,t,i,r){var u=r.row+1;return`<span class="chose1" id="userPhone1${u}">${n}</span >
                        <input class="chose2 hidden form-control text-center" old="${n}" id="userPhone2${u}" onkeyup="onInput(this, 11, 0)" onblur="onInputEnd(this)" maxlength="11" onchange="changeMaintainer(this, 'Phone')">`},h=function(n,t,i,r){var u=r.row+1;return`<span class="chose1" title="${n}" id ="userRemark1${u}" onclick = "showAllContent('${escape(n)}')">${n.length>tdShowLength?n.substring(0,tdShowLength)+"...":n}</span>
                        <input class="chose2 hidden form-control" style="width: 100%;" old="${n}" id ="userRemark2${u}" onchange="changeMaintainer(this, 'Remark')">`},u=[{data:"Id",title:"序号",render:setTable().order,sWidth:"80px"},{data:"Name",title:"姓名",sWidth:"120px"},{data:"Phone",title:"手机号",render:s,sWidth:"130px"},{data:"Remark",title:"备注",render:h}];(permissionList[431].have||permissionList[433].have)&&u.unshift({data:"Id",title:"选择",render:o,sWidth:"80px",orderable:!1});f=[0,1,2,3,4];e=[4];$("#maintainerList").DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rtip',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",exportOptions:{columns:f,format:{body:function(n,t,i,r){if(e.indexOf(i)>-1){var u=$(r).find("span").attr("title");if(u!=null)return"‌"+unescape(u)}return"‌"+r.textContent}}}}],bAutoWidth:!1,destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:u,createdRow:function(){},drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$(this).find(".chose").on("ifChanged",function(){var t=$(this).parents("tr:first"),n=$(this).attr("value"),i=$(this).attr("id");$(this).is(":checked")?(t.find(".chose1").addClass("hidden"),t.find(".chose2").removeClass("hidden"),$("#userPhone2"+n).val($("#userPhone2"+n).attr("old")),$("#userRemark2"+n).val($("#userRemark2"+n).attr("old")),choseMaintainer[i]={Id:i,Phone:$("#userPhone2"+n).val(),Remark:$("#userRemark2"+n).val()}):(t.find(".chose1").removeClass("hidden"),t.find(".chose2").addClass("hidden"),choseMaintainer=removeArrayObj(choseMaintainer,i))})}});t&&$("#maintainerModel").modal("show")},n)}function changeMaintainer(n,t){var u=$(n).parents("tr:first"),r=$(u).find(".chose").attr("value"),i=$(u).find(".chose").attr("id");$("#"+i).is(":checked")&&(choseMaintainer[i]?choseMaintainer[i][t]=$(`#user${t}2${r}`).val():choseMaintainer[i]={Id:i,Phone:$("#userPhone2"+r).val(),Remark:$("#userRemark2"+r).val()})}function initList(){$("#addList").empty();addMax=addMaxV=0}function showAddMaintainerModel(n=1){initList();$("#addOneBtn").attr("disabled","disabled");$("#addMaintainerBtn").attr("disabled","disabled");ajaxGet("/AccountManagement/List",null,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}$("#addOneBtn").removeAttr("disabled");$("#addMaintainerBtn").removeAttr("disabled");users=n.datas;$("#addMaintainerModel").modal("show")},n)}function addOne(){var f,t,n,u,i,r;if(addMax++,addMaxV++,f=`<tr id="add{0}" value="{0}" xh="{1}">
            <td style="vertical-align: addherit;" id="addXh{0}">{1}</td>
            <td><select class="ms2 form-control" id="addUser{0}"></select></td>
            <td><input class="form-control" type="tel" id="addPhone{0}" onkeyup="onInput(this, 11, 0)" onblur="onInputEnd(this)" maxlength="11"></td>
            <td><input class="form-control" id="addRk{0}" maxlength="100"></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delOne({0})"><i class="fa fa-minus"></i></button></td>
        </tr>`.format(addMax,addMaxV),$("#addList").append(f),t=addMax,n="#addUser"+t,$(n).empty(),users&&users.length>0){for(u="",i=0;i<users.length;i++)r=users[i],u+=`<option value="${r.account}" title="${r.account}">${r.name}</option>`;$(n).append(u);$("#addPhone"+t).val(users[0].phone);$(n).on("select2:select",function(){var r=$(this).val(),i=$(this).parents("tr:first").attr("value"),n,t;for($("#addPhone"+i).val(""),n=0;n<users.length;n++)if(t=users[n],r==t.account){$("#addPhone"+i).val(t.phone);break}})}n="#add"+t;$(n).find(".ms2").css("width","100%");$(n).find(".ms2").select2({width:"120px"});$("#addTable").scrollTop($("#addTable")[0].scrollHeight)}function delOne(n){var i,r,t,u;for($("#addList").find(`tr[value=${n}]:first`).remove(),addMaxV--,i=1,r=$("#addList tr"),t=0;t<r.length;t++)$(r[t]).attr("xh",i),u=$(r[t]).attr("value"),$("#addXh"+u).html(i),i++}function addMaintainer(){for(var i,o,s=432,r=$("#addList tr"),u=[],n=0;n<r.length;n++){var t=$(r[n]).attr("value"),l=$(r[n]).attr("xh"),f=$("#addUser"+t).find("option:checked").text(),e=$("#addUser"+t).find("option:checked").val(),h=$("#addPhone"+t).val(),c=$("#addRk"+t).val();if(isStrEmptyOrUndefined(f)){layer.msg("请输入姓名");return}if(isStrEmptyOrUndefined(e))return;u.push({Name:f,Account:e,Phone:h,Remark:c})}u.length<=0||(i=null,o=function(){$("#addMaintainerBtn").attr("disabled","disabled");var n={};n.opType=s;n.opData=JSON.stringify(u);ajaxPost("/Relay/Post",n,function(n){i&&clearTimeout(i);$("#addMaintainerBtn").removeAttr("disabled");layer.msg(n.errmsg);n.errno==0&&(showMaintainerModel(0,!1),$("#addMaintainerModel").modal("hide"))});i=setTimeout(function(){$("#addMaintainerBtn").removeAttr("disabled")},5e3)},showConfirm("添加",o))}function updateMaintainer(){var r=431,i,n,t,u;if(!permissionList[r].have){layer.msg("没有权限");return}if(choseMaintainer&&!(choseMaintainer.length<=0)){i=[];for(n in choseMaintainer)t=choseMaintainer[n],maintainers&&maintainers[n]&&(maintainers[n].Phone!=t.Phone||maintainers[n].Remark!=t.Remark)&&(t.Account=maintainers[n].Account,t.Name=maintainers[n].Name,i.push(t));i.length&&(u=function(){var t={},n;t.opType=r;t.opData=JSON.stringify(i);n=null;ajaxPost("/Relay/Post",t,function(t){layer.msg(t.errmsg);n&&clearTimeout(n);$("#updateMaintainerBtn").removeAttr("disabled");t.errno==0&&showMaintainerModel(0,!1)});n=setTimeout(function(){$("#delMaintainerBtn").removeAttr("disabled")},5e3)},showConfirm("保存",u))}}function delMaintainer(){var u=433,r,t,i,n,f;if(!permissionList[u].have){layer.msg("没有权限");return}if(choseMaintainer&&!(choseMaintainer.length<=0)){if(r=[],t=[],choseMaintainer&&choseMaintainer.length>0){for(n in choseMaintainer)maintainers&&maintainers[n]&&t.push(n);for(i=0;i<t.length;i++)n=t[i],maintainers&&maintainers[n]&&r.push(maintainers[n].Name)}f=function(){var n,i;$("#delMaintainerBtn").attr("disabled","disabled");n={};n.opType=u;n.opData=JSON.stringify({ids:t});i=null;ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);i&&clearTimeout(i);$("#delMaintainerBtn").removeAttr("disabled");n.errno==0&&showMaintainerModel(0,!1)});i=setTimeout(function(){$("#delMaintainerBtn").removeAttr("disabled")},5e3)};showConfirm("删除维修工："+r.join(","),f)}}var permissionList=[],_priority='<option value="0">低<\/option><option value="1">中<\/option><option value="2">高<\/option>',_grade='<option value="0">小修<\/option><option value="1">大修<\/option>',_worker=null,_faultType=null,_faultTypeData=null,_faultDevData=null,_batchAssignTable=null,_serviceLogData=null,_statisticsParData=null,_siteData=null,_delFaultDevData=null,_delServiceLogData=null,maintainers=null,addMax=0,addMaxV=0,choseMaintainer=null,users=null;