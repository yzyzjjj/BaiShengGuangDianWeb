function pageReady(){$(".ms2").select2();$("#singleFaultType").select2();getFaultDeviceList();getRepairRecordList();getFaultType();$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$("#fStartDate").val(getDate()).datepicker("update");$("#fEndDate").val(getDate()).datepicker("update");$("#rStartDate").val(getDate()).datepicker("update");$("#rEndDate").val(getDate()).datepicker("update");$(".fHead input,.fHead span").css("verticalAlign","middle");$(".rHead input,.rHead span").css("verticalAlign","middle");$(".fHead label").on("ifChanged",function(){$(".fHead .icb_minimal").is(":checked")?($("#fBtn").addClass("hidden"),$("#fTime").removeClass("hidden"),$("#fStartDate").val(getDate()).datepicker("update"),$("#fStartTime").val(getTime()).timepicker("setTime",getTime()),$("#fEndDate").val(getDate()).datepicker("update"),$("#fEndTime").val(getTime()).timepicker("setTime",getTime())):($("#fBtn").removeClass("hidden"),$("#fTime").addClass("hidden"))});$(".rHead label").on("ifChanged",function(){$(".rHead .icb_minimal").is(":checked")?($("#rBtn").addClass("hidden"),$("#rTime").removeClass("hidden"),$("#rStartDate").val(getDate()).datepicker("update"),$("#rStartTime").val(getTime()).timepicker("setTime",getTime()),$("#rEndDate").val(getDate()).datepicker("update"),$("#rEndTime").val(getTime()).timepicker("setTime",getTime())):($("#rBtn").removeClass("hidden"),$("#rTime").addClass("hidden"))});$("#singleFaultType1").on("select2:select",function(){for(var t="",n=0;n<faultData.length;n++)if(faultData[n].Id==$("#singleFaultType1").val()){t=faultData[n].FaultDescription;break}$("#singleFaultDefaultDesc").val(t)});checkPermission(410)||$("#showAddFaultTypeModel").addClass("hidden");checkPermission(415)||$("#rChange").addClass("hidden");checkPermission(403)||$("#showAddUsuallyFaultModel").addClass("hidden");window.onload=function(){(function(n){funObj={timeUserFun:"timeUserFun"};n[funObj.timeUserFun]=function(n){var u=n*60,t={init:0,time:function(){t.init+=1;t.init==u&&(getFaultDeviceList(),t.init=0)},eventFun:function(){clearInterval(r);t.init=0;r=setInterval(t.time,1e3)}},r=setInterval(t.time,1e3),i=document.querySelector("html");i.addEventListener("click",t.eventFun);i.addEventListener("keydown",t.eventFun);i.addEventListener("mousemove",t.eventFun);i.addEventListener("mousewheel",t.eventFun)}})(window);timeUserFun(1)};var n=null,t=0,i,r;$("#singleFaultModel").on("scroll",function(){n!=document.activeElement&&(n=document.activeElement,t=$(n).offset().top,$(".bootstrap-timepicker-widget").length>0&&(i=$(".bootstrap-timepicker-widget").offset().top),$(".datepicker").length>0&&(r=$(".datepicker").offset().top));var f=$(n).offset().top,u=f-t;$(".bootstrap-timepicker-widget").css("top",i+u+"px");$(".datepicker").css("top",r+u+"px")})}function getFaultType(){var n={};n.opType=406;ajaxPost("/Relay/Post",n,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(faultData=n.datas,$("#singleFaultType").empty(),$("#singleFaultType1").empty(),r='<option value="{0}">{1}<\/option>',i=0;i<n.datas.length;i++)t=n.datas[i],i==0&&(fType=t.Id),$("#singleFaultType").append(r.format(t.Id,t.FaultTypeName)),$("#singleFaultType1").append(r.format(t.Id,t.FaultTypeName))})}function getFaultDeviceList(){var t=417,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var o,t,i;if(n.errno!=0){layer.msg(n.errmsg);return}var r=function(n){var t=n.Priority;return t==2?'<span class="text-red"><span class="hidden">2<\/span>高<\/span>':t==1?'<span class="text-warning"><span class="hidden">1<\/span>中<\/span>':'<span class="text-success"><span class="hidden">0<\/span>低<\/span>'},s=function(n){var i='<button type="button" class="btn btn-danger" onclick="sChange({0}, 1)">确认故障<\/button>'.format(n.Id),r='<button type="button" class="btn btn-info" onclick="sChange({0}, 2)">开始维修<\/button>'.format(n.Id),u='<button type="button" class="btn btn-success" onclick="sChange({0}, 3)">维修完成<\/button>'.format(n.Id),t='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>',f='<li><a onclick="sChange({0}, 0)">修改<\/a><\/li>'.format(n.Id),e="<li><a onclick=\"delChange({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.DeviceCode));return t=t.format(checkPermission(420)?f:"",checkPermission(423)?e:""),"{0}{1}{2}{3}".format(t,checkPermission(420)&&n.State==0?i:"",checkPermission(420)&&n.State==1?r:"",checkPermission(420)&&n.State==2?u:"")},h=0,u=function(){return++h},f=function(n){var t=n.State;return t==0?'<span class="text-red"><span class="hidden">0<\/span>未确认<\/span>':t==1?'<span class="text-warning"><span class="hidden">1<\/span>已确认<\/span>':'<span class="text-success"><span class="hidden">2<\/span>维修中<\/span>'},c=checkPermission(420)||checkPermission(423)?[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:null,title:"状态",render:f},{data:null,title:"优先级",render:r},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障描述"},{data:null,title:"操作",render:s}]:[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:null,title:"状态",render:f},{data:null,title:"优先级",render:r},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障描述"}],e=function(n,t,i){return i.FaultDescription=i.FaultDescription?i.FaultDescription:"",i.FaultDescription.length>tdShowContentLength?i.FaultDescription.substr(0,tdShowContentLength)+"<a href = \"javascript:showFaultTypeDetailModel({0}, '{1}')\">...<\/a> ".format(i.FaultTypeId,escape(i.FaultDescription.trim())):i.FaultDescription},l=checkPermission(420)||checkPermission(423)?[{orderable:!1,targets:9},{targets:[8],render:e},{type:"html-percent",targets:[2]}]:[{targets:[8],render:e},{type:"html-percent",targets:[2]}];for($("#faultDeviceList").DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:c,columnDefs:l}),$("#singleFaultCode").empty(),o='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#singleFaultCode").append(o.format(i.Id,i.DeviceCode))})}function sChange(n,t){var r,i;if(hideClassTip("adt"),$(".dd").attr("disabled","disabled"),$(".db").addClass("hidden"),$("#solveDiv").addClass("hidden"),$("#faultOtherDiv").addClass("hidden"),$("#singleFaultType").val(fType).trigger("change"),$("#rFaultCodeDiv").addClass("hidden"),$("#singleFaultCode").removeClass("hidden"),r=418,!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;i.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",i,function(i){var r,f,e,u,o;if(i.errno!=0){layer.msg(i.errmsg);return}if(i.datas.length>0){for(r=i.datas[0],$("#singleUpdateId").html(n),$("#singleUpdateState").html(r.State),$("#singleUpdateCodeId").html(r.DeviceId),$("#singleFaultCode").val(r.DeviceCode),$("#singleProposer").val(r.Proposer),$("#singleFaultType1").val(r.FaultTypeId).trigger("change"),f=r.FaultTime.split(" "),$("#singleFaultDate").val(f[0]),$("#singleFaultTime").val(f[1]),e="",u=0;u<faultData.length;u++)if(faultData[u].Id==$("#singleFaultType1").val()){e=faultData[u].FaultDescription;break}$("#singleFaultDefaultDesc").val(e);$("#singleFaultDesc").val(r.FaultDescription);$("#singleFaultPriority").val(r.Priority);t==0&&($("#singleFaultPriority").removeAttr("disabled"),$("#singleChange").removeClass("hidden"));t==1&&$("#singleSure").removeClass("hidden");t==2&&$("#singleRepairing").removeClass("hidden");t==3&&($("#solveDiv").removeClass("hidden"),$("#singleRepaired").removeClass("hidden"),$("#singleFaultType").val(r.FaultTypeId).trigger("change"))}t==3&&($("#singleSolveDate").val(getDate()),$("#singleSolveDate").datepicker("update"),$("#singleSolveTime").val(getTime()),o=getCookieTokenInfo(),$("#singleFaultSolver").val(o.name),$("#singleSolvePlan").val(""));$("#singleFaultModel").modal("show")})}function delChange(n,t){var i,r;if(t=unescape(t),i=423,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultDeviceList()})};showConfirm("删除故障设备："+t,r)}function getDelFaultDeviceList(){var r=424,n,t,i;if(!checkPermission(r)){layer.msg("没有权限");return}if(n={},n.opType=r,$(".fHead .icb_minimal").is(":checked")){if(t=$("#fStartDate").val()+" "+$("#fStartTime").val(),i=$("#fEndDate").val()+" "+$("#fEndTime").val(),exceedTime(t)||exceedTime(i)){layer.msg("所选时间不能大于当前时间");return}if(compareDate(t,i)){layer.msg("结束时间不能小于开始时间");return}n.opData=JSON.stringify({StartTime:t,EndTime:i})}ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=0,i=function(){return++t};$("#delFaultDeviceList").DataTable({destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:"Proposer",title:"报修人"},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障描述"}],columnDefs:[{targets:[6],render:function(n,t,i){return i.FaultDescription=i.FaultDescription?i.FaultDescription:"",i.FaultDescription.length>tdShowContentLength?i.FaultDescription.substr(0,tdShowContentLength)+"<a href = \"javascript:showFaultTypeDetailModel({0}, '{1}')\">...<\/a> ".format(i.FaultTypeId,escape(i.FaultDescription.trim())):i.FaultDescription}},{type:"html-percent",targets:[2]}]})})}function singleChange(n){var u=parseInt($("#singleUpdateId").html()),c=parseInt($("#singleUpdateState").html()),o=parseInt($("#singleUpdateCodeId").html()),f=$("#singleFaultCode").val(),r;if(!isStrEmptyOrUndefined(f)&&(r=$("#singleProposer").val().trim(),!isStrEmptyOrUndefined(r))){var a=$("#singleFaultDate").val(),v=$("#singleFaultTime").val(),e="{0} {1}".format(a,v),s=$("#singleFaultDesc").val().trim(),h=$("#singleFaultPriority").val().trim(),i,t;if(n<3){if(i=420,!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify([{id:u,DeviceCode:f,DeviceId:o,FaultTime:e,Proposer:r,FaultDescription:s,Priority:h,State:n==0?c:n}]);$("#singleFaultModel").modal("hide");ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultDeviceList()})}else{var y=$("#singleFaultSolver").val(),p=$("#singleSolvePlan").val(),w=$("#singleSolveDate").val(),b=$("#singleSolveTime").val(),l="{0} {1}".format(w,b),k=$("#singleFaultType").val(),d=$("#singleFaultType1").val();if(compareDate(e,l)){layer.msg("解决时间不能小于故障时间");return}if(i=420,!checkPermission(i)){layer.msg("没有权限");return}if(t={},t.opType=i,t.opData=JSON.stringify([{id:u,DeviceCode:f,DeviceId:o,FaultTime:e,Proposer:r,FaultDescription:s,Priority:h,State:c,FaultLogId:u,MarkedDelete:!0}]),$("#singleFaultModel").modal("hide"),ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultDeviceList()}),i=415,!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({DeviceCode:f,DeviceId:o,FaultTime:e,Proposer:r,FaultDescription:s,Priority:h,FaultSolver:y,SolveTime:l,SolvePlan:p,FaultTypeId:k,FaultTypeId1:d,FaultLogId:u});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getRepairRecordList()})}}}function getRepairRecordList(){var t=412,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var u=0,t=function(){return++u},f=function(n){var t='<li><a onclick="rChange({0}, 0)">修改<\/a><\/li>'.format(n.Id),i="<li><a onclick=\"deleteChange({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.FaultTypeName));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>'.format(checkPermission(414)?t:"",checkPermission(416)?i:"")},i=function(n){return n==!1?"否":"是"},e=checkPermission(414)||checkPermission(416)?[{data:"Id",title:"序号",render:t},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:"Proposer",title:"报修人"},{data:"FaultSolver",title:"解决人员"},{data:"FaultDescription",title:"故障描述"},{data:"SolveTime",title:"解决时间"},{data:"FaultTypeName",title:"故障类型"},{data:"SolvePlan",title:"解决方案",visible:!1},{data:"IsAdd",title:"是否为添加记录",render:i},{data:null,title:"操作",render:f}]:[{data:"Id",title:"序号",render:t},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:"Proposer",title:"报修人"},{data:"FaultSolver",title:"解决人员"},{data:"FaultDescription",title:"故障描述"},{data:"SolveTime",title:"解决时间"},{data:"FaultTypeName",title:"故障类型"},{data:"SolvePlan",title:"解决方案",visible:!1},{data:"IsAdd",title:"是否为添加记录",render:i}],r=function(n,t,i){return i.FaultDescription=i.FaultDescription?i.FaultDescription:"",i.FaultDescription.length>tdShowContentLength?i.FaultDescription.substr(0,tdShowContentLength)+"<a tittle = '{1}'  href = \"javascript:showFaultTypeDetailModel({0}, '{1}')\">...<\/a> ".format(i.FaultTypeId,escape(i.FaultDescription.trim())):i.FaultDescription},o=checkPermission(414)||checkPermission(416)?[{orderable:!1,targets:9},{targets:[5],render:r},{type:"html-percent",targets:[1]}]:[{targets:[5],render:r},{type:"html-percent",targets:[1]}];$("#repairRecordList").DataTable({dom:'B<"clear">lfrtip',buttons:{dom:{container:{tag:"div",className:"pull-right"}},buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",exportOptions:{columns:[0,1,2,3,4,5,6,7,8],format:{body:function(n,t,i,r){if(i===5){var u=$(r).find("a").attr("tittle");if(u!=null)return"‌"+unescape(u)}return"‌"+r.textContent}}}}]},destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:e,columnDefs:o})})}function getDelRepairList(){var r=425,n,t,i;if(!checkPermission(r)){layer.msg("没有权限");return}if(n={},n.opType=r,$(".rHead .icb_minimal").is(":checked")){if(t=$("#rStartDate").val()+" "+$("#rStartTime").val(),i=$("#rEndDate").val()+" "+$("#rEndTime").val(),exceedTime(t)||exceedTime(i)){layer.msg("所选时间不能大于当前时间");return}if(compareDate(t,i)){layer.msg("结束时间不能小于开始时间");return}n.opData=JSON.stringify({StartTime:t,EndTime:i})}ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=0,i=function(){return++t};$("#delRepairList").DataTable({destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"序号",render:i},{data:"DeviceCode",title:"机台号"},{data:"FaultTime",title:"故障时间"},{data:"Proposer",title:"报修人"},{data:"FaultSolver",title:"解决人员"},{data:"FaultDescription",title:"故障描述"},{data:"SolveTime",title:"解决时间"},{data:"FaultTypeName",title:"故障类型"},{data:"SolvePlan",title:"解决方案",visible:!1},],columnDefs:[{targets:[5],render:function(n,t,i){return i.FaultDescription=i.FaultDescription?i.FaultDescription:"",i.FaultDescription.length>tdShowContentLength?i.FaultDescription.substr(0,tdShowContentLength)+"<a tittle = '{1}'  href = \"javascript:showFaultTypeDetailModel({0}, '{1}')\">...<\/a> ".format(i.FaultTypeId,escape(i.FaultDescription.trim())):i.FaultDescription}},{type:"html-percent",targets:[1]}]})})}function rChange(n,t){hideClassTip("adt");$(".db").addClass("hidden");$(".dd").attr("disabled","disabled");$("#rFaultCodeDiv").addClass("hidden");$("#faultOtherDiv").addClass("hidden");$("#singleFaultType").val(fType).trigger("change");var r,i;if(t==0){if(r=413,!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;i.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",i,function(t){var i,f,u,r;if(t.errno!=0){layer.msg(t.errmsg);return}if(t.datas.length>0){for(i=t.datas[0],$("#rFaultCodeDiv").addClass("hidden"),$("#faultOtherDiv").addClass("hidden"),$("#singleFaultCode").removeClass("hidden"),$("#singleUpdateId").html(n),$("#singleUpdateState").html(i.State),$("#singleFaultCode").val(i.DeviceCode),$("#singleProposer").val(i.Proposer),$("#singleFaultType1").val(i.FaultTypeId1).trigger("change"),r=i.FaultTime.split(" "),$("#singleFaultDate").val(r[0]),$("#singleFaultTime").val(r[1]),f="",u=0;u<faultData.length;u++)if(faultData[u].Id==$("#singleFaultType1").val()){f=faultData[u].FaultDescription;break}$("#singleFaultDefaultDesc").val(f);$("#singleFaultDesc").val(i.FaultDescription.trim());$("#singleFaultPriority").val(i.Priority);$("#singleFaultSolver").val(i.FaultSolver);r=i.SolveTime.split(" ");$("#singleSolveDate").val(r[0]).datepicker("update");$("#singleSolveTime").val(r[1]).timepicker("setTime",r[1]);$("#singleSolvePlan").val(i.SolvePlan.trim());$("#singleFaultType").val(i.FaultTypeId).trigger("change");$("#solveDiv").removeClass("hidden");$("#recordChange").removeClass("hidden")}$("#singleFaultModel").modal("show")})}else{if($("#singleUpdateId").html(0),r=100,!checkPermission(r)){layer.msg("没有权限");return}i={};i.opType=r;ajaxPost("/Relay/Post",i,function(t){var u,f,e,i,r;if(t.errno!=0){layer.msg(t.errmsg);return}for($("#faultOtherDiv").removeClass("hidden"),$("#singleSolveDate").val(getDate()).datepicker("update"),$("#singleSolveTime").val(getTime()).timepicker("setTime",getTime()),u=getCookieTokenInfo(),n==0&&$("#singleFaultSolver").val(u.name),$("#singleFaultCode").addClass("hidden"),$("#rFaultCodeDiv").removeClass("hidden"),$("#singleProposer").val(u.name),$("#singleFaultType1").val(fType).trigger("change"),$("#singleFaultDesc").val(""),$("#singleSolvePlan").val(""),$("#singleFaultPriority").val("0"),$("#faultOther").val(""),f="",i=0;i<faultData.length;i++)if(faultData[i].Id==$("#singleFaultType1").val()){f=faultData[i].FaultDescription;break}for($("#singleFaultDefaultDesc").val(f),$("#singleFaultDate").val(getDate()).datepicker("update"),$("#singleFaultTime").val(getTime()).timepicker("setTime",getTime()),$(".dd").removeAttr("disabled"),$("#solveDiv").removeClass("hidden"),$("#rFaultCode").empty(),$("#rFaultCode").select2({allowClear:!0,placeholder:"请选择"}),e='<option value="{0}" id="{2}">{1}<\/option>',$("#rFaultCode").append("<option><\/option>"),i=0;i<t.datas.length;i++)r=t.datas[i],$("#rFaultCode").append(e.format(r.Code,r.Code,r.Id));$("#recordAdd").removeClass("hidden");$("#singleFaultModel").modal("show")})}}function deleteChange(n,t){var i,r;if(t=unescape(t),i=416,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getRepairRecordList()})};showConfirm("删除维修记录："+t,r)}function recordChange(n){var h=parseInt($("#singleUpdateId").html()),i,t=$("#rFaultCode").val(),r=$("#faultOther").val().trim(),u,e,a,v,o,f,s;if(n!=0){if(isStrEmptyOrUndefined(t)&&isStrEmptyOrUndefined(r)){layer.msg("请选择或输入一台机台号");return}if(!isStrEmptyOrUndefined(t)&&!isStrEmptyOrUndefined(r)){layer.msg("只能选择或输入一台机台号");return}isStrEmptyOrUndefined(t)&&!isStrEmptyOrUndefined(r)&&(i=r);!isStrEmptyOrUndefined(t)&&isStrEmptyOrUndefined(r)&&(i=t)}else i=$("#singleFaultCode").val();if(u=$("#rFaultCode").find("[value='"+i+"']").attr("id"),u=isStrEmptyOrUndefined(u)||isStrEmptyOrUndefined(t)?0:parseInt(u),e=$("#singleProposer").val().trim(),isStrEmptyOrUndefined(e)){n!=0&&showTip($("#singleProposerTip"),"报修人不能为空");return}var y=$("#singleFaultDate").val(),p=$("#singleFaultTime").val(),c="{0} {1}".format(y,p);if(exceedTime(c)){layer.msg("故障时间不能大于当前时间");return}var w=$("#singleFaultDesc").val().trim(),b=$("#singleFaultPriority").val(),k=$("#singleFaultSolver").val(),d=$("#singleSolvePlan").val().trim(),g=$("#singleSolveDate").val(),nt=$("#singleSolveTime").val(),l="{0} {1}".format(g,nt);if(exceedTime(l)){layer.msg("解决时间不能大于当前时间");return}if(a=$("#singleFaultType1").val(),v=$("#singleFaultType").val(),$("#singleFaultModel").modal("hide"),o=n==0?414:415,!checkPermission(o)){layer.msg("没有权限");return}f={};f.opType=o;s={DeviceCode:i,FaultTime:c,Proposer:e,FaultDescription:w,Priority:b,FaultSolver:k,SolveTime:l,SolvePlan:d,FaultTypeId:v,FaultTypeId1:a,FaultLogId:h,DeviceId:u,IsAdd:!0};n==0&&(s.id=h);f.opData=JSON.stringify(s);ajaxPost("/Relay/Post",f,function(n){layer.msg(n.errmsg);n.errno==0&&getRepairRecordList()})}function getUsuallyFaultList(){var t=400,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i=function(n){var t='<li><a onclick="showUpdateUsuallyFaultModel({0})">修改<\/a><\/li>'.format(n.Id),i="<li><a onclick=\"deleteUsuallyFault({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.UsuallyFaultDesc));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>'.format(checkPermission(402)?t:"",checkPermission(405)?i:"")},r=checkPermission(402)||checkPermission(405)?[{data:"Id",title:"序号"},{data:"UsuallyFaultDesc",title:"常见故障"},{data:"SolverPlan",title:"解决方法"},{data:null,title:"操作",render:i}]:[{data:"Id",title:"序号"},{data:"UsuallyFaultDesc",title:"常见故障"},{data:"SolverPlan",title:"解决方法"}],t=function(n,t,i){return i.SolverPlan=i.SolverPlan?i.SolverPlan:"",i.SolverPlan.length>tdShowContentLength?i.SolverPlan.substr(0,tdShowContentLength)+'<a href = "javascript:showUsuallyFaultDetailModel({0})">...<\/a> '.format(i.Id):i.SolverPlan},u=checkPermission(402)||checkPermission(405)?[{orderable:!1,targets:3},{targets:[2],render:t}]:[{targets:[2],render:t}];$("#usuallyFaultList").DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:r,bAutoWidth:!0,columnDefs:u});$("#usuallyFaultModel").modal("show")})}function showUsuallyFaultDetailModel(n){var i=401,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#usuallyFaultDetail").html(n.datas[0].SolverPlan);$("#usuallyFaultDetailModel").modal("show")})}function deleteUsuallyFault(n,t){var i,r;if(t=unescape(t),i=405,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})};showConfirm("删除常见故障："+t,r)}function showAddUsuallyFaultModel(){hideClassTip("adt");$("#addUsuallyFaultDesc").val("");$("#addSolverPlan").val("");$("#addUsuallyFaultModel").modal("show")}function addUsuallyFault(){var r=403,n,t,i,u;if(!checkPermission(r)){layer.msg("没有权限");return}(n=!0,t=$("#addUsuallyFaultDesc").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("addUsuallyFaultDescTip","故障描述不能为空"),n=!1),i=$("#addSolverPlan").val().trim(),isStrEmptyOrUndefined(i)&&(showTip("addSolverPlanTip","解决方案不能为空"),n=!1),n)&&(u=function(){$("#addUsuallyFaultModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({UsuallyFaultDesc:t,SolverPlan:i});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("添加",u))}function showUpdateUsuallyFaultModel(n){var i=401,t;if(!checkPermission(i)){layer.msg("没有权限");return}$("#updateId").html(n);t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateUsuallyFaultDesc").val(n.datas[0].UsuallyFaultDesc),$("#updateSolverPlan").val(n.datas[0].SolverPlan));hideClassTip("adt");$("#updateUsuallyFaultModel").modal("show")})}function updateUsuallyFault(){var r=402,n,t,i,u,f;if(!checkPermission(r)){layer.msg("没有权限");return}(n=!0,t=$("#updateUsuallyFaultDesc").val().trim(),isStrEmptyOrUndefined(t)&&(showTip($("#updateUsuallyFaultDescTip"),"故障描述不能为空"),n=!1),i=$("#updateSolverPlan").val().trim(),isStrEmptyOrUndefined(i)&&(showTip($("#updateSolverPlanTip"),"解决方案不能为空"),n=!1),n)&&(u=parseInt($("#updateId").html()),f=function(){$("#updateUsuallyFaultModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({id:u,UsuallyFaultDesc:t,SolverPlan:i});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getUsuallyFaultList()})},showConfirm("修改",f))}function getFaultTypeList(){var t=406,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}faultData=n.datas;var e=0,u=function(){return++e},o=function(n){var t='<li><a onclick="showUpdateFaultTypeModel({0})">修改<\/a><\/li>'.format(n.Id),i="<li><a onclick=\"deleteFaultType({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.FaultTypeName));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button ><button type = "button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">   <span class="caret"><\/span>   <span class="sr-only">Toggle Dropdown<\/span><\/button><ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}<\/ul><\/div>'.format(checkPermission(408)?t:"",checkPermission(411)?i:"")},s=checkPermission(408)||checkPermission(411)?[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障类型描述"},{data:null,title:"操作",render:o}]:[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"FaultTypeName",title:"故障类型"},{data:"FaultDescription",title:"故障类型描述"}],f=function(n,t,i){return i.FaultDescription=i.FaultDescription?i.FaultDescription:"",i.FaultDescription.length>tdShowContentLength?i.FaultDescription.substr(0,tdShowContentLength)+'<a href = "javascript:showFaultTypeDetailModel({0})">...<\/a> '.format(i.Id):i.FaultDescription},h=checkPermission(408)||checkPermission(411)?[{orderable:!1,targets:4},{targets:[3],render:f}]:[{targets:[3],render:f}];for($("#faultTypeList").DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[10,20,30],iDisplayLength:10,columns:s,columnDefs:h}),$("#singleFaultType").empty(),$("#singleFaultType1").empty(),r='<option value="{0}">{1}<\/option>',i=0;i<n.datas.length;i++)t=n.datas[i],i==0&&(fType=t.Id),$("#singleFaultType").append(r.format(t.Id,t.FaultTypeName)),$("#singleFaultType1").append(r.format(t.Id,t.FaultTypeName));$("#faultTypeModel").modal("show")})}function showFaultTypeDetailModel(n,t=""){var r=407,i;if(!checkPermission(r)){layer.msg("没有权限");return}t=unescape(t);$("#faultTypeDetail1Div").addClass("hidden");isStrEmptyOrUndefined(t)||($("#faultTypeDetail1Div").removeClass("hidden"),$("#faultTypeDetail1").html(t));i={};i.opType=r;i.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#faultTypeDetail").html(n.datas[0].FaultDescription);$("#faultTypeDetailModel").modal("show")})}function deleteFaultType(n,t){var i,r;if(t=unescape(t),i=411,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultTypeList()})};showConfirm("删除故障类型："+t,r)}function showAddFaultTypeModel(){hideClassTip("adt");$("#addFaultTypeName").val("");$("#addFaultTypeDesc").val("");$("#addFaultTypeModel").modal("show")}function addFaultType(){var i=410,n,t,r,u;if(!checkPermission(i)){layer.msg("没有权限");return}(n=!0,t=$("#addFaultTypeName").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("addFaultTypeNameTip","故障类型不能为空"),n=!1),r=$("#addFaultTypeDesc").val(),n)&&(u=function(){$("#addFaultTypeModel").modal("hide");var n={};n.opType=i;n.opData=JSON.stringify([{FaultTypeName:t,FaultDescription:r}]);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getFaultTypeList()})},showConfirm("添加",u))}function showUpdateFaultTypeModel(n){var i=407,t;if(!checkPermission(i)){layer.msg("没有权限");return}$("#updateTypeId").html(n);t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&($("#updateFaultTypeName").val(n.datas[0].FaultTypeName),$("#updateFaultTypeDesc").val(n.datas[0].FaultDescription));hideClassTip("adt");$("#updateFaultTypeModel").modal("show")})}function updateFaultType(){var i=408,n,t,r,u,f;if(!checkPermission(i)){layer.msg("没有权限");return}(n=!0,t=$("#updateFaultTypeName").val().trim(),isStrEmptyOrUndefined(t)&&(showTip("updateFaultTypeNameTip","故障类型不能为空"),n=!1),r=$("#updateFaultTypeDesc").val(),n)&&(u=parseInt($("#updateTypeId").html()),f=function(){$("#updateFaultTypeModel").modal("hide");var n={};n.opType=i;n.opData=JSON.stringify({id:u,FaultTypeName:t,FaultDescription:r});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&(getFaultTypeList(),getFaultDeviceList(),getRepairRecordList())})},showConfirm("修改",f))}var faultData=null,fType=0;