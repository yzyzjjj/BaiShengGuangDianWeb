function pageReady(){getSiteList();checkPermission(128)||$("#showAddSite").addClass("hidden")}function getSiteList(){var n=125;if(!checkPermission(n)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:n},function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var r=0,t=function(){return++r},i=function(n,t,i){return i.RegionDescription=i.RegionDescription?i.RegionDescription:"",i.RegionDescription.length>tdShowContentLength?i.RegionDescription.substr(0,tdShowContentLength)+'<a href = "javascript:showRegionDescriptionModel({0})">...<\/a> '.format(i.Id):i.RegionDescription},u=checkPermission(127)||checkPermission(129)?[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"SiteName",title:"车间名"},{data:"RegionDescription",title:"场地位置",type:"html-percent",render:i},{data:"Manager",title:"管理人",type:"html-percent"},{data:null,title:"操作",render:op,orderable:!1}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"SiteName",title:"车间名"},{data:"RegionDescription",title:"场地位置",type:"html-percent",render:i},{data:"Manager",title:"管理人",type:"html-percent"}];$("#siteList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:u})})}function showSiteNameModel(n){var i=125,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#siteName").html(n.datas[0].SiteName);$("#siteNameModel").modal("show")})}function showRegionDescriptionModel(n){var i=125,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#regionDescription").html(n.datas[0].RegionDescription);$("#regionDescriptionModel").modal("show")})}function showAddSite(){hideClassTip("adt");$("#addSiteName").val("");$("#addLocations").val("");$("#addManager").val("");$("#addModel").modal("show")}function addSite(){var n=128,r;if(!checkPermission(n)){layer.msg("没有权限");return}var t=$("#addSiteName").val().trim(),i=$("#addLocations").val().trim(),u=$("#addManager").val();if(isStrEmptyOrUndefined(t)){showTip($("#addSiteNameTip"),"车间名不能为空");return}if(isStrEmptyOrUndefined(i)){showTip($("#addLocationsTip"),"场地位置不能为空");return}r=function(){$("#addModel").modal("hide");var r={};r.opType=n;r.opData=JSON.stringify({SiteName:t,RegionDescription:i,Manager:u});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&getSiteList()})};showConfirm("添加",r)}function deleteSite(n,t){var i,r;if(t=unescape(t),i=129,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getSiteList()})};showConfirm("删除场地："+t,r)}function showUpdateSite(n,t,i,r){t=unescape(t);i=unescape(i);hideClassTip("adt");$("#updateId").html(n);$("#updateSiteName").val(t);$("#updateRegions").val(i);$("#updateManager").val(r);$("#updateSiteModal").modal("show")}function updateSite(){var n=127,r;if(!checkPermission(n)){layer.msg("没有权限");return}var u=parseInt($("#updateId").html()),t=$("#updateSiteName").val().trim(),i=$("#updateRegions").val().trim(),f=$("#updateManager").val();if(isStrEmptyOrUndefined(t)){showTip($("#updateSiteNameTip"),"车间名不能为空");return}if(isStrEmptyOrUndefined(i)){showTip($("#updateRegionsTip"),"场地位置不能为空");return}r=function(){$("#updateSiteModal").modal("hide");var r={};r.opType=n;r.opData=JSON.stringify({id:u,SiteName:t,RegionDescription:i,Manager:f});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&getSiteList()})};showConfirm("修改",r)}var op=function(n){var t="<li><a onclick=\"showUpdateSite({0}, '{1}', '{2}', '{3}')\">修改<\/a><\/li>".format(n.Id,escape(n.SiteName),escape(n.RegionDescription),escape(n.Manager)),i="<li><a onclick=\"deleteSite({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.SiteName+" "+n.RegionDescription));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>'.format(checkPermission(127)?t:"",checkPermission(129)?i:"")};