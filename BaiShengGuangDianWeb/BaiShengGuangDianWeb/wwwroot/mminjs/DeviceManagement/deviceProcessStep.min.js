function pageReady(){$(".ms2").css("width","100%");$(".ms2").select2();getDeviceProcessStepList();checkPermission(153)||$("#showAddModel").addClass("hidden")}function getDeviceProcessStepList(){var n=150;if(!checkPermission(n)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:n},function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var r=0,t=function(){return++r},i=function(n,t,i){return i.Description=i.Description?i.Description:"",i.Description.length>tdShowContentLength?i.Description.substr(0,tdShowContentLength)+'<a href = "javascript:showDescriptionModel({0})">...<\/a> '.format(i.Id):i.Description},u=checkPermission(152)||checkPermission(154)?[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"CategoryName",title:"设备类型"},{data:"StepName",title:"工序名"},{data:"Description",title:"备注",render:i},{data:null,title:"操作",render:op,orderable:!1}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"CategoryName",title:"设备类型"},{data:"StepName",title:"工序名"},{data:"Description",title:"备注",render:i}];$("#deviceProcessStepList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:u})})}function showDescriptionModel(n){var i=150,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#description").html(n.datas[0].Description);$("#descriptionModel").modal("show")})}function showAddModel(){var n,t;if($("#addStepName").val(""),$("#addDesc").val(""),addStepNameCheck(),n=140,!checkPermission(n)){layer.msg("没有权限");return}t={};t.opType=n;ajaxPost("/Relay/Post",t,function(n){var r,t,i;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#addSelect").empty(),r='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#addSelect").append(r.format(i.Id,i.CategoryName));hideTip($("#addStepNameTip"));$("#addModel").modal("show")})}function addStepNameCheck(){var n=$("#addStepName").val();$("#addIsSurvey").iCheck(n.indexOf("检验")>-1?"check":"uncheck")}function addModel(){var t=153,i,n,r,u;if(!checkPermission(t)){layer.msg("没有权限");return}if(i=$("#addSelect").val(),n=$("#addStepName").val().trim(),isStrEmptyOrUndefined(n)){showTip($("#addStepNameTip"),"工序名不能为空");return}r=$("#addDesc").val();u=function(){$("#addModel").modal("hide");var u={};u.opType=t;u.opData=JSON.stringify({DeviceCategoryId:i,StepName:n,IsSurvey:$("#addIsSurvey").is(":checked")==!0,Description:r});ajaxPost("/Relay/Post",u,function(n){layer.msg(n.errmsg);n.errno==0&&getDeviceProcessStepList()})};showConfirm("添加",u)}function deleteDeviceProcessStep(n,t){var i,r;if(t=unescape(t),i=154,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getDeviceProcessStepList()})};showConfirm("删除设备工序："+t,r)}function showUpdateModel(n,t,i,r,u){var f,e;if(i=unescape(i),r=unescape(r),f=140,!checkPermission(f)){layer.msg("没有权限");return}e={};e.opType=f;ajaxPost("/Relay/Post",e,function(f){var s,e,o;if(f.errno!=0){layer.msg(f.errmsg);return}for($("#updateSelect").empty(),s='<option value="{0}">{1}<\/option>',e=0;e<f.datas.length;e++)o=f.datas[e],$("#updateSelect").append(s.format(o.Id,o.CategoryName));hideTip($("#updateStepNameTip"));$("#updateId").html(n);$("#updateSelect").val(t);$("#updateStepName").val(i);$("#updateDesc").val(r);$("#updateIsSurvey").iCheck(u?"check":"uncheck");$("#updateModel").modal("show")})}function updateStepNameCheck(){var n=$("#updateStepName").val();$("#updateIsSurvey").iCheck(n.indexOf("检验")>-1?"check":"uncheck")}function updateModel(){var n=152,i,r;if(!checkPermission(n)){layer.msg("没有权限");return}var u=parseInt($("#updateId").html()),f=$("#updateSelect").val(),t=$("#updateStepName").val().trim();if(isStrEmptyOrUndefined(t)){showTip($("#updateStepNameTip"),"工序名不能为空");return}i=$("#updateDesc").val();r=function(){$("#updateModel").modal("hide");var r={};r.opType=n;r.opData=JSON.stringify({id:u,DeviceCategoryId:f,StepName:t,IsSurvey:$("#updateIsSurvey").is(":checked")==!0,Description:i});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&getDeviceProcessStepList()})};showConfirm("修改",r)}var op=function(n){var t="<li><a onclick=\"showUpdateModel({0}, '{1}', '{2}', '{3}', {4})\">修改<\/a><\/li>".format(n.Id,n.DeviceCategoryId,escape(n.StepName),escape(n.Description),n.IsSurvey),i="<li><a onclick=\"deleteDeviceProcessStep({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.StepName));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>'.format(checkPermission(152)?t:"",checkPermission(154)?i:"")};