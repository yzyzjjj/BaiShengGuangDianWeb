function pageReady(){getFirmwareList();checkPermission(133)||$("#showAddFirmwareModal").addClass("hidden")}function getFirmwareList(){var n=130;if(!checkPermission(n)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:n},function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var r=0,t=function(){return++r},u=checkPermission(132)||checkPermission(134)?[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"FirmwareName",title:"固件版本名称"},{data:"VarNumber",title:"变量数量"},{data:"FilePath",title:"程序文件的位置及名称"},{data:"Description",title:"描述"},{data:null,title:"操作",render:op}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"FirmwareName",title:"固件版本名称"},{data:"VarNumber",title:"变量数量"},{data:"FilePath",title:"程序文件的位置及名称"},{data:"Description",title:"描述"}],i=function(n,t,i){return i.Description=i.Description?i.Description:"",i.Description.length>tdShowContentLength?i.Description.substr(0,tdShowContentLength)+'<a href = "javascript:showDescriptionModel({0})">...<\/a> '.format(i.Id):i.Description},f=checkPermission(132)||checkPermission(134)?[{orderable:!1,targets:6},{targets:[5],render:i}]:[{targets:[5],render:i}];$("#firmLibraryList").DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:n.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:u,columnDefs:f})})}function showFilePathModel(n){var i=130,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#filePath").html(n.datas[0].FilePath);$("#filePathModel").modal("show")})}function showDescriptionModel(n){var i=130,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&$("#description").html(n.datas[0].Description);$("#descriptionModel").modal("show")})}function showAddFirmwareModal(){addFirmwareUpload==null&&(addFirmwareUpload=initFileInput("addFilePath",fileEnum.FirmwareLibrary));$("#addFilePath").fileinput("clear");$(".file-caption-name").prop("disabled",!0);hideClassTip("adt");$(".dd").val("");$("#addModel").modal("show")}function addFirmware(){var t=133,u;if(!checkPermission(t)){layer.msg("没有权限");return}var i=$("#addName").val(),r=$("#addNumber").val(),n=$("#addCommunication").val(),f=$("#addFilePath").val(),e=$("#addDesc").val();if(isStrEmptyOrUndefined(i)){showTip($("#addNameTip"),"名称不能为空");return}if(isStrEmptyOrUndefined(r)){showTip($("#addNumberTip"),"变量数量不能为空");return}if(isStrEmptyOrUndefined(n)&&(n=""),isStrEmptyOrUndefined(f)){showTip($("#addFilePathTip"),"请选择程序文件");return}fileCallBack[fileEnum.FirmwareLibrary]=function(u){if(u.errno==0){$("#addModel").modal("hide");var f={};f.opType=t;f.opData=JSON.stringify({FirmwareName:i,VarNumber:r,CommunicationProtocol:n,FilePath:u.data,Description:e});ajaxPost("/Relay/Post",f,function(n){layer.msg(n.errmsg);n.errno==0&&getFirmwareList()})}else layer.msg(u.errmsg)};u=function(){$("#addFilePath").fileinput("upload")};showConfirm("添加",u)}function deleteFirmware(n,t){var i,r;if(t=unescape(t),i=134,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFirmwareList()})};showConfirm("删除固件："+t,r)}function showUpdateFirmwareModal(n,t,i,r,u,f){t=unescape(t);i=unescape(i);r=unescape(r);u=unescape(u);f=unescape(f);updateFirmwareUpload==null&&(updateFirmwareUpload=initFileInput("updateFilePath",fileEnum.FirmwareLibrary));$("#updateFilePath").fileinput("clear");hideClassTip("adt");$(".dd").val("");$("#updateId").html(n);$("#updateName").val(t);$("#updateNumber").val(i);$("#updateCommunication").val(r);$(".file-caption-name").val(u);$(".file-caption-name").prop("disabled",!0);$("#oldUpdateFilePath").val(u);$("#updateDesc").val(f);$("#updateFirm").modal("show")}function updateFirmware(){var i=132,t;if(!checkPermission(i)){layer.msg("没有权限");return}var f=parseInt($("#updateId").html()),r=$("#updateName").val().trim(),u=$("#updateNumber").val().trim(),n=$("#updateCommunication").val().trim(),o=$("#updateFilePath").val().trim(),e=$("#updateDesc").val();if(isStrEmptyOrUndefined(r)){showTip($("#updateNameTip"),"名称不能为空");return}if(isStrEmptyOrUndefined(u)){showTip($("#updateNumberTip"),"变量数量不能为空");return}isStrEmptyOrUndefined(n)&&(n="");isStrEmptyOrUndefined(o)?(t=function(){$("#updateFirm").modal("hide");var t={};t.opType=i;t.opData=JSON.stringify({id:f,FirmwareName:r,VarNumber:u,CommunicationProtocol:n,FilePath:$("#oldUpdateFilePath").val(),Description:e});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFirmwareList()})},showConfirm("修改",t)):(fileCallBack[fileEnum.FirmwareLibrary]=function(t){if(t.errno==0){$("#updateFirm").modal("hide");var o={};o.opType=i;o.opData=JSON.stringify({id:f,FirmwareName:r,VarNumber:u,CommunicationProtocol:n,FilePath:t.data,Description:e});ajaxPost("/Relay/Post",o,function(n){layer.msg(n.errmsg);n.errno==0&&getFirmwareList()})}else layer.msg(t.errmsg)},t=function(){$("#updateFilePath").fileinput("upload")},showConfirm("修改",t))}var op=function(n){var t="<li><a onclick=\"showUpdateFirmwareModal({0}, '{1}', '{2}', '{3}', '{4}', '{5}')\">修改<\/a><\/li>".format(n.Id,escape(n.FirmwareName),escape(n.VarNumber),escape(n.CommunicationProtocol),escape(n.FilePath),escape(n.Description)),i="<li><a onclick=\"deleteFirmware({0}, '{1}')\">删除<\/a><\/li>".format(n.Id,escape(n.FirmwareName));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>'.format(checkPermission(132)?t:"",checkPermission(134)?i:"")},addFirmwareUpload=null,updateFirmwareUpload=null;