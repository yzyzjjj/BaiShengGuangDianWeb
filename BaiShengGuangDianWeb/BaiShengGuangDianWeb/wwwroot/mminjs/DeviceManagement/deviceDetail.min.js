function pageReady(){$("#detailFirmware").select2();checkPermission(108)?$("#upgradeFirmwareBtn").removeClass("hidden"):$("#upgradeFirmwareBtn").addClass("hidden");var n=getQueryString("id");n!=null&&(id=parseInt(n));getFirmwareList(function(){getControlList();getStateList()});$("#detailFirmware").on("select2:select",function(){$("#detailFirmware").val()==$("#detailFirmware").attr("oval")?$("#upgradeFirmwareBtn").attr("disabled","disabled"):$("#upgradeFirmwareBtn").removeAttr("disabled")})}function getControlList(){var t=100,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({hard:!0});ajaxPost("/Relay/Post",n,function(n){var r,u,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($(".ms2").empty(),$(".ms2").select2(),r=!1,u='<option value="{0}">{1}<\/option>',i=0;i<n.datas.length;i++)t=n.datas[i],$(".ms2").append(u.format(t.Id,t.Code)),t.Id==id&&(firstData=t,r=!0);!r&&n.datas.length>0&&(firstData=n.datas[0],id=1);selectChange(n.datas);$(".ms2").on("select2:select",function(t){id=parseInt($("#"+t.currentTarget.id+" option:checked").val());selectChange(n.datas)})})}function selectChange(n){for(var i,t=0;t<n.length;t++)i=n[t],i.Id==id&&(firstData=i);firstData==null&&n.length>0&&(firstData=n[0],id=1);firstData!=null&&($(".ms2").val(id).trigger("change"),$("#detailDeviceName").val(firstData.DeviceName),$("#detailMacAddress").val(firstData.MacAddress),$("#detailIp").val(firstData.Ip),$("#detailPort").val(firstData.Port),$("#detailIdentifier").val(firstData.Identifier),$("#detailDeviceModel").val(firstData.ModelName),$("#detailScript").val(firstData.ScriptName),$("#detailFirmware").val(firstData.FirmwareId).trigger("change"),$("#detailFirmware").attr("oval",firstData.FirmwareId),$("#detailHardware").val(firstData.HardwareName),$("#detailApplication").val(firstData.ApplicationName),$("#detailSite").val(firstData.SiteName+firstData.RegionDescription),$("#detailAdministrator").val(firstData.Administrator),$("#detailRemark").val(firstData.Remark));getStateList()}function getStateList(){var t,n;if($("#StateBox input").val("无数据"),t=109,!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({id:id});ajaxPost("/Relay/Post",n,function(n){var t;if(n.errno!=0){layer.msg(n.errmsg);return}for(t=0;t<n.datas.length;t++){var r=n.datas[t],i="",u=r.Item1,f=r.Item2;switch(u){case 1:f==0&&(i=firstData.DeviceStateStr);break;default:i=f}$("#StateBox").find("[name="+u+"]").val(i)}})}function getFirmwareList(n){var t=130;if(!checkPermission(t)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:t},function(t){var u,i,r;if(t.errno!=0){layer.msg(t.errmsg);return}for($("#detailFirmware").empty(),u='<option value="{0}" path="{2}">{1}<\/option>',i=0;i<t.datas.length;i++)r=t.datas[i],$("#detailFirmware").append(u.format(r.Id,r.FirmwareName,r.FilePath));n()})}function upgradeFirmware(){var i=108,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}t=$("#detailFirmware").val();n={};n.opType=i;n.opData=JSON.stringify({Type:fileEnum.FirmwareLibrary,DeviceId:$("#detailCode2").val(),FirmwareId:t,Path:$("#detailFirmware").children().filter("[value="+t+"]").attr("path")});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getControlList()})}var id=1,firstData=null;