function pageReady(){var n,t;$(".ads").css("width","100%");$(".ads").select2();getDataTypeList();getDeviceModelList();$("#fScriptVersion").change(function(){$(".sd ").addClass("hidden");var n=$("#fScriptVersion").val();$("#div"+n).removeClass("hidden")});$("#sScriptVersion").on("select2:select",function(){(sScrId=parseInt($("#sScriptVersion").val()),sScrId!=0)&&getScriptVersionDetailList()});$("#sDeviceModel").on("select2:select",function(){deModel=parseInt($("#sDeviceModel").val());getScriptVersionList()});$("#aDeviceModel").on("select2:select",function(){adeModel=parseInt($("#aDeviceModel").val());getScriptVersionList1()});$("#aScriptVersion").on("select2:select",function(){asScrId=parseInt($("#aScriptVersion").val())});$("#jScriptVersion").on("select2:select",function(){var n=$("#jScriptVersion").val();$("#jsonName").val(n)});if(($("#aDataType").change(function(){var t=$("#aDataType").val(),n=$("#fScriptVersion").val();switch(n){case"1":$("#jsonFile").val("");initDiv1()}}),$("#jsonFile").change(function(n){var t,i;(initDiv1(),t=n.target.files[0],isStrEmptyOrUndefined(t))||window.FileReader&&(i=new FileReader,i.onloadend=function(n){var s=n.target.result,e,i;try{var o=JSON.parse(s),h=$("#fScriptVersion").val(),f=parseInt($("#aDataType").val());for(jsonData=[],e=[],i=0;i<o.length;i++){var r=o[i],u=null,t=null;switch(f){case 1:u=r[2];t=r[0];break;case 2:case 3:u=r[1];t=r[4]}if(!isStrEmptyOrUndefined(u)&&!isStrEmptyOrUndefined(t)){if(f==2){if(t.indexOf("输入")<0)continue;t=t.replace("输入","")}if(f==3){if(t.indexOf("输出")<0)continue;t=t.replace("输出","")}e.indexOf(t)>=0||(e.push(t),jsonData.push({Id:jsonData.length+1,ScriptId:h,VariableName:u,PointerAddress:t}))}}$("#jsonList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:jsonData,aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"序号"},{data:"VariableName",title:"名称"},{data:"PointerAddress",title:"地址"}]})}catch(c){layer.msg("json数据格式有误")}},i.readAsText(t,"gb2312"))}),$("#addScriptVersionDeviceModel").select2({allowClear:!0,placeholder:"请选择"}),$("#updateScriptVersionDeviceModel").select2({allowClear:!0,placeholder:"请选择"}),n=113,checkPermission(n))&&(t={},t.opType=n,ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}scriptData=n.datas}),n=112,checkPermission(n))){ajaxPost("/Relay/Post",{opType:n},function(n){if(n.errno!=0){layer.msg(n.errmsg);return}valueType=n.datas});$("#udtScriptVersion").on("select2:select",function(){showUsuallyDictionaryTypeModel(!0)});checkPermission(111)||$("#showAddModel").addClass("hidden");checkPermission(114)||$("#showAddScriptVersionModel").addClass("hidden")}}function getScriptVersionAllList(n){var i=113,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}scriptData=t.datas;var r=0,i=function(){return++r},u=function(n){var t='<button type="button" class="btn btn-primary mbtn-group" onclick="showUpdateScriptVersionModel({0}, \'{1}\', \'{2}\')">修改<\/button>'.format(n.Id,escape(n.DeviceModelId),escape(n.ScriptName)),i='<button type="button" class="btn btn-danger mbtn-group" onclick="deleteScriptVersion({0}, \'{1}\')">删除<\/button>'.format(n.Id,escape(n.ScriptName));return'<div class="btn-group">{0}{1}<\/div>'.format(checkPermission(115)?t:"",checkPermission(116)?i:"")},f=checkPermission(115)||checkPermission(116)?[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"ScriptName",title:"脚本名称"},{data:"ValueNumber",title:"变量数"},{data:"InputNumber",title:"输入口数"},{data:"OutputNumber",title:"输出口数"},{data:null,title:"操作",render:u}]:[{data:null,title:"序号",render:i},{data:"Id",title:"Id",bVisible:!1},{data:"ScriptName",title:"脚本名称"},{data:"ValueNumber",title:"变量数"},{data:"InputNumber",title:"输入口数"},{data:"OutputNumber",title:"输出口数"}];$("#scriptVersionList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:f});n==1&&$("#scriptVersionModel").modal("show")})}function showManageModel(){getScriptVersionAllList(1)}function showAddScriptVersionModel(){hideClassTip("adt");$("#addScriptVersionModel").modal("show")}function addScriptVersion(){var r=114,n,t,i,u;if(!checkPermission(r)){layer.msg("没有权限");return}if(n=$("#addScriptVersionDeviceModel").val(),t=$("#addScriptVersionName").val().trim(),isStrEmptyOrUndefined(t)){showTip($("#addScriptVersionNameTip"),"脚本名称不能为空");return}if(i=n==null?"":n.join(","),i.length==0){layer.msg("请选择设备型号");return}u=function(){$("#addScriptVersionModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({DeviceModelId:i,ScriptName:t});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getScriptVersionAllList(0)})};showConfirm("添加",u)}function deleteScriptVersion(n,t){var i=116,r;if(!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getScriptVersionAllList(0)})};showConfirm("删除脚本："+unescape(t),r)}function showUpdateScriptVersionModel(n,t,i){t=unescape(t);i=unescape(i);$("#updateId").html(n);hideClassTip("adt");var r=[];isStrEmptyOrUndefined(t)||(r=t.split(",").map(Number));$("#updateScriptVersionDeviceModel").val(r).trigger("change");$("#updateScriptVersionName").val(i);$("#updateScriptVersionModel").modal("show")}function updateScriptVersion(){var r=115,n,t,i,u,f;if(!checkPermission(r)){layer.msg("没有权限");return}if(n=$("#updateScriptVersionDeviceModel").val(),t=$("#updateScriptVersionName").val().trim(),isStrEmptyOrUndefined(t)){showTip($("#updateScriptVersionNameTip"),"脚本名称不能为空");return}if(i=n==null?"":n.join(","),i.length==0){layer.msg("请选择设备型号");return}u=parseInt($("#updateId").html());f=function(){$("#updateScriptVersionModel").modal("hide");var n={};n.opType=r;n.opData=JSON.stringify({id:u,DeviceModelId:i,ScriptName:t});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getScriptVersionAllList(0)})};showConfirm("修改",f)}function getDataTypeList(){var n=112;if(!checkPermission(n)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:n},function(n){var u,i,f,t,r;if(n.errno!=0){layer.msg(n.errmsg);return}for(valueType=n.datas,$("#aDataType").empty(),u='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#aDataType").append(u.format(i.Id,i.TypeName));for($("#addDataType").empty(),f='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)r=n.datas[t],$("#addDataType").append(f.format(r.Id,r.TypeName))})}function getDeviceModelList(){$("#valList_wrapper").parent().empty().append('<table class="table table-hover table-striped" id="valList"><\/table>');$("#inList_wrapper").parent().empty().append('<table class="table table-hover table-striped" id="inList"><\/table>');$("#outList_wrapper").parent().empty().append('<table class="table table-hover table-striped" id="outList"><\/table>');deModel=0;var n=120;if(!checkPermission(n)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:n},function(n){var i,r,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#sDeviceModel").empty(),$("#addScriptVersionDeviceModel").empty(),$("#updateScriptVersionDeviceModel").empty(),i='<option value="{0}">{1}<\/option>',r=0;r<n.datas.length;r++)t=n.datas[r],deModel==0&&(deModel=t.Id),$("#sDeviceModel").append(i.format(t.Id,t.CategoryName+"-"+t.ModelName)),$("#addScriptVersionDeviceModel").append(i.format(t.Id,t.CategoryName+"-"+t.ModelName)),$("#updateScriptVersionDeviceModel").append(i.format(t.Id,t.CategoryName+"-"+t.ModelName));getScriptVersionList()})}function getScriptVersionList(){var t,n;if(sScrId=0,t=105,!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({id:deModel});ajaxPost("/Relay/Post",n,function(n){var r,t,i;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#sScriptVersion").empty(),r='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#sScriptVersion").append(r.format(i.Id,i.ScriptName));$("#sScriptVersion").val(0).trigger("update")})}function getScriptVersionDetailList(){var t=106,n;if(!checkPermission(t)){layer.msg("没有权限");return}sScrId!=0&&(n={},n.opType=t,n.opData=JSON.stringify({id:sScrId}),$("#valList").empty(),$("#inList").empty(),$("#outList").empty(),ajaxPost("/Relay/Post",n,function(n){function t(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],r.VariableTypeId==t&&u.push(r);return u}if(n.errno!=0){layer.msg(n.errmsg);return}var i=t(n.datas,1),r=0,u=function(){return++r};$("#valList").DataTable({pagingType:"full",destroy:!0,paging:!0,deferRender:!1,bLengthChange:!1,info:!1,searching:!0,autoWidth:!0,language:oLanguage,aLengthMenu:[20,40,60],iDisplayLength:20,data:i,columns:[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"VariableName",title:"名称"},{data:"PointerAddress",title:"地址"},{data:"Remark",title:"备注",bVisible:!1}]});var f=t(n.datas,2),e=0,o=function(){return++e};$("#inList").DataTable({pagingType:"full",destroy:!0,paging:!0,deferRender:!1,bLengthChange:!1,info:!1,searching:!0,autoWidth:!0,language:oLanguage,data:f,aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:o},{data:"Id",title:"Id",bVisible:!1},{data:"VariableName",title:"名称"},{data:"PointerAddress",title:"地址"},{data:"Remark",title:"备注",bVisible:!1}]});var s=t(n.datas,3),h=0,c=function(){return++h};$("#outList").DataTable({pagingType:"full",destroy:!0,paging:!0,deferRender:!1,bLengthChange:!1,info:!1,searching:!0,autoWidth:!0,language:oLanguage,data:s,aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:c},{data:"Id",title:"Id",bVisible:!1},{data:"VariableName",title:"名称"},{data:"PointerAddress",title:"地址"},{data:"Remark",title:"备注",bVisible:!1}]})}))}function getDeviceModelList1(n){adeModel=0;var t=120;if(!checkPermission(t)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:t},function(t){var u,r,i;if(t.errno!=0){layer.msg(t.errmsg);return}for($("#aDeviceModel").empty(),u='<option value="{0}">{1}<\/option>',r=0;r<t.datas.length;r++)i=t.datas[r],adeModel==0&&(adeModel=i.Id),$("#aDeviceModel").append(u.format(i.Id,i.CategoryName+"-"+i.ModelName));getScriptVersionList1(n)})}function getScriptVersionList1(n){var i,t;if(asScrId=0,i=105,!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({id:adeModel});ajaxPost("/Relay/Post",t,function(t){var u,r,i;if(t.errno!=0){layer.msg(t.errmsg);return}for($("#aScriptVersion").empty(),$("#jScriptVersion").empty(),u='<option value="{0}">{1}<\/option>',r=0;r<t.datas.length;r++)i=t.datas[r],asScrId==0&&(asScrId=i.Id),$("#aScriptVersion").append(u.format(i.Id,i.ScriptName)),$("#jScriptVersion").append(u.format(i.ScriptName,i.ScriptName));n==1&&$("#addModel").modal("show")})}function showAddModel(){reset();getDeviceModelList1(1)}function reset(){var t=$("#fScriptVersion").val(),n;switch(t){case"0":$("#avBody").empty();n='<tr id="av{0}"><td><label class="control-label" id="avx{0}">{0}<\/label><\/td><td><input class="form-control" id="avb{0}" maxlength="20"><\/td><td><input class="form-control" oninput="value=value.replace(/[^\\d]/g,\'\')" id="avd{0}" maxlength="5"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(1);$("#avBody").append(n);max=maxV=2;case"1":$("#jsonFile").val("");initDiv1()}}function initDiv1(){jsonData=null;$("#jsonList_wrapper").remove();$("#jsonList").remove();$("#div1").append('<table class="table table-hover table-striped" id="jsonList"><thead>        <tr>           <td>序号<\/td>  <td>变量名<\/td><td>地址<\/td>  <\/tr>          <\/thead>       <\/table>       ')}function addOther(){var n='<tr id="av{0}"><td><label class="control-label" id="avx{0}">{1}<\/label><\/td><td><input class="form-control" id="avb{0}" maxlength="20"><\/td><td><input class="form-control" oninput="value=value.replace(/[^\\d]/g,\'\')" id="avd{0}" maxlength="5"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(max,maxV);$("#avBody").append(n);max++;maxV++}function delSelf(n){var i,r,t;for($("#avBody").find("[id=av"+n+"]").remove(),max--,maxV--,i=1,r=$("#avBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function addValues(){var o=111,c,r,n,u,f,e,l;if(!checkPermission(o)){layer.msg("没有权限");return}var i=$("#fScriptVersion").val(),s=$("#sDeviceModel").val(),h=$("#aDataType").val(),t=null;switch(i){case"0":for(c=$("#aScriptVersion").val(),r=[],n=1;n<max;n++)if($("#av"+n).length>0){if(u=$("#avb"+n).val(),isStrEmptyOrUndefined(u)){layer.msg("名称不能为空");return}if(f=$("#avd"+n).val(),isStrEmptyOrUndefined(f)){layer.msg("地址不能为空");return}r.push({PointerAddress:f,VariableName:u})}t={Type:i,DeviceModelId:s,VariableType:h,ScriptId:c,DataNameDictionaries:r};break;case"1":if(e=$("#jsonName").val(),isStrEmptyOrUndefined(e)){layer.msg("脚本名称不能为空");return}if(jsonData==null||jsonData.length==0){layer.msg("请选择正确的json文件");return}t={Type:i,DeviceModelId:s,VariableType:h,ScriptName:e,DataNameDictionaries:jsonData};break;case"2":return;case"3":return;default:return}if(t.DataNameDictionaries.length==0){layer.msg("请输入数据");return}l=function(){$("#addModel").modal("hide");var n={};n.opType=o;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getDeviceModelList()})};showConfirm("添加",l)}function tableToExcel(){layer.msg("待完善")}function showUsuallyDictionaryTypeModel(n=false){var f,t,r,u,i;if(scriptData!=null&&scriptData.length>0){if(!n)for($("#udtScriptVersion").empty(),f='<option value="{0}">{1}<\/option>',t=0;t<scriptData.length;t++)r=scriptData[t],$("#udtScriptVersion").append(f.format(r.Id,r.ScriptName));if(u=118,!checkPermission(u)){layer.msg("没有权限");return}i={};i.opType=u;i.opData=JSON.stringify({id:$("#udtScriptVersion").val()});ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}usData=n.datas;showUsuallyDictionary();$("#usuallyDictionaryTypeModel").modal("show")})}else n||$("#usuallyDictionaryTypeModel").modal("show")}function showUsuallyDictionary(){var t=106,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({id:$("#udtScriptVersion").val()});ajaxPost("/Relay/Post",n,function(n){function i(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],r.VariableTypeId==t&&u.push(r);return u}var t;if(n.errno!=0){layer.msg(n.errmsg);return}t=[];t["1"]=i(n.datas,1);t["2"]=i(n.datas,2);t["3"]=i(n.datas,3);var r=0,u=function(){return++r},f=function(n){var t='<select class="mSel mSel1 form-control" v="{0}" id="val{0}" ov="{1}" did="{2}" vid="vid1_{3}"><\/select>'.format(r,n.VariableTypeId,n.Id,n.VariableNameId),i='<select class="mSel mSel2 form-control" v="{0}" id="dic{0}" ov="{1}" vid="vid2_{2}"><\/select>'.format(r,n.DictionaryId,n.VariableNameId);return'<div class="form-group">{0}{1}<\/div>'.format(t,i)};$("#udtList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:usData,aLengthMenu:[35,70,105],iDisplayLength:35,columns:[{data:null,title:"序号",render:u},{data:"Id",title:"Id",bVisible:!1},{data:"VariableName",title:"变量用途"},{data:null,title:"变量地址",render:f,sClass:"text-left"},],drawCallback:function(){for(var h,u,f,v,o,r,i,l=$(".mSel"),a=!0,n=0;n<l.length;n++)if(!$(l[n]).hasClass("done")){a=!1;break}if(!a&&($(".mSel2").select2(),$(".mSel1").empty(),h='<option value="{0}">{1}<\/option>',u=$(".mSel1"),u.length>0)){for(n=0;n<valueType.length;n++)r=valueType[n],$(".mSel1").append(h.format(r.Id,r.TypeName));for(f=[],i=0;i<u.length;i++){var s=$(u[i]),c=s.attr("v"),e=s.attr("ov");s.val(e).trigger("change");$("#dic"+c).addClass("vt"+e);f.indexOf(e)==-1&&f.push(e)}for(v in f)for(o=f[v],$(".vt"+o).empty(),n=0;n<t[o].length;n++)r=t[o][n],$(".vt"+o).append(h.format(r.PointerAddress,r.PointerAddress+"-"+r.VariableName));for(i=0;i<u.length;i++){var s=$(u[i]),c=s.attr("v"),e=$("#dic"+c).attr("ov");$("#dic"+c).val(e).trigger("update")}$(".mSel1").addClass("done");$(".mSel2").addClass("done");$(".mSel1").removeClass("mSel1");$(".mSel2").removeClass("mSel2")}}});$("#usuallyDictionaryTypeModel").modal("show")})}function updateUdt(){var r=$("#udtScriptVersion").val(),u,f,i,o,t,e,h;if(r!=null&&usData.length>0){if(u=119,!checkPermission(u)){layer.msg("没有权限");return}f=!1;i=[];for(o in usData){var n=usData[o],s=$("#udtList").find(".mSel").filter("[vid=vid1_"+n.VariableNameId+"]"),c=$("#udtList").find(".mSel").filter("[vid=vid2_"+n.VariableNameId+"]");s.length>0?(t=$(c).val(),e=$(s).val(),t==null&&(t="0"),(parseInt(e)!=n.VariableTypeId||parseInt(t)!=n.DictionaryId)&&(f=!0),i.push({Id:n.Id,ScriptId:r,VariableNameId:n.VariableNameId,DictionaryId:t,VariableTypeId:e})):i.push({Id:n.Id,ScriptId:r,VariableNameId:n.VariableNameId,DictionaryId:n.DictionaryId,VariableTypeId:n.VariableTypeId})}if(!f)return;h=function(){var n={};n.opType=u;n.opData=JSON.stringify(i);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&showUsuallyDictionaryTypeModel(!0)})};showConfirm("修改",h)}}function showUsuallyVariableTypeModel(){var n,t;if(dataStatisticType=[],n=157,!checkPermission(n)){layer.msg("没有权限");return}t={};t.opType=n;ajaxPost("/Relay/Post",t,function(n){var i,e,t;if(n.errno!=0){layer.msg(n.errmsg);return}var o=function(n){var t='<button type="button" class="btn btn-primary mbtn-group" onclick="showUpdateVariableTypeModel({0}, \'{1}\',\'{2}\')">修改<\/button>'.format(n.Id,escape(n.VariableName),n.StatisticType),i='<button type="button" class="btn btn-danger mbtn-group" onclick="deleteVariableType({0}, \'{1}\')">删除<\/button>'.format(n.Id,escape(n.VariableName));return'<div class="btn-group">{0}{1}<\/div>'.format(checkPermission(160)?t:"",checkPermission(161)?i:"")},s=0,r=function(){return++s},u=function(n,t,i){return i.StatisticType==0?"":i.StatisticType==1?"趋势图":i.StatisticType==2?"加工记录":void 0},f=function(n,t,i){return i.IsDetail==!0?"是":"否"},h=checkPermission(160)||checkPermission(161)?[{data:null,title:"序号",render:r},{data:"VariableName",title:"变量名称"},{data:"IsDetail",title:"是否为设备详情",render:f},{data:"StatisticType",title:"统计字段",render:u},{data:null,title:"操作",render:o}]:[{data:null,title:"序号",render:r},{data:"VariableName",title:"变量名称"},{data:"IsDetail",title:"是否为设备详情",render:f},{data:"StatisticType",title:"统计字段",render:u}],c=checkPermission(160)||checkPermission(161)?[{orderable:!1,targets:4}]:[];for($("#usuallyVariableTypeList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[0,"asc"],aLengthMenu:[15,30,60],iDisplayLength:15,columns:h,columnDefs:c}),$("#usuallyVariableTypeModel").modal("show"),i=0;i<n.datas.length;i++)dataStatisticType[i]=n.datas[i].StatisticType;for(dataStatisticType=dataStatisticType.filter(function(n,t){return dataStatisticType.indexOf(n)===t}),dataStatisticType=dataStatisticType.sort(function(n,t){return n>t?1:-1}),$("#updateStatisticType").empty(),e='<option value="{0}">{1}<\/option>',t=0;t<dataStatisticType.length;t++)dataStatisticType[t]==0&&(statisticTypeName="无"),dataStatisticType[t]==1&&(statisticTypeName="趋势图"),dataStatisticType[t]==2&&(statisticTypeName="加工记录"),$("#updateStatisticType").append(e.format(dataStatisticType[t],statisticTypeName))})}function deleteVariableType(n,t){var i=161,r;if(!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&showUsuallyVariableTypeModel()})};showConfirm("删除变量："+unescape(t),r)}function showAddUsuallyVariableTypeModel(){$("#addVariableName").val("");$("#addVariableSite").val("");$("#addDataType").val($("#addDataType option").eq(0).val()).trigger("change");$("#addUsuallyVariableTypeModel").modal("show")}function addVariableType(){var n=159,r;if(!checkPermission(n)){layer.msg("没有权限");return}var t=$("#addVariableName").val().trim(),u=$("#addDataType").val(),i=$("#addVariableSite").val().replace(/\b(0+)/gi,"");if(isStrEmptyOrUndefined(t)){showTip($("#addVariableNameTip"),"变量名称不能为空");return}if(isStrEmptyOrUndefined(i)){showTip($("#addVariableSiteTip"),"变量名称不能为空");return}r=function(){$("#addUsuallyVariableTypeModel").modal("hide");var r={};r.opType=n;r.opData=JSON.stringify({VariableTypeId:u,DictionaryId:i,VariableName:t});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);n.errno==0&&showUsuallyVariableTypeModel()})};showConfirm("添加",r)}function showUpdateVariableTypeModel(n,t,i){$("#updateVariableId").html(n);t=unescape(t);$("#updateVariableName").val(t);$("#updateStatisticType").val(i).trigger("change");$("#updateUsuallyVariableTypeModel").modal("show")}function updateVariableType(){var t=160,n,i,r,u;if(!checkPermission(t)){layer.msg("没有权限");return}if(n=$("#updateVariableName").val().trim(),i=$("#updateStatisticType").val().trim(),isStrEmptyOrUndefined(n)){showTip($("#updateVariableNameTip"),"变量名称不能为空");return}r=parseInt($("#updateVariableId").html());u=function(){$("#updateUsuallyVariableTypeModel").modal("hide");var u={};u.opType=t;u.opData=JSON.stringify({id:r,VariableName:n,StatisticType:i});ajaxPost("/Relay/Post",u,function(n){layer.msg(n.errmsg);n.errno==0&&showUsuallyVariableTypeModel()})};showConfirm("修改",u)}var jsonData=null,scriptData=null,valueType=null,deModel=0,sScrId=0,adeModel=0,asScrId=0,max=2,maxV=2,usData=null,statisticTypeName,dataStatisticType;