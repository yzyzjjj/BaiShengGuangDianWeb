function pageReady(){$(".ms2").select2();$("ul .setTitle").on("click",function(){var n=$(this).text();$("#pageTitle").text(`设备点检${n}`)});getWorkShop();surveyor();$("#selectWorkShop").on("select2:select",function(){_isConfigPage=!0;var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDevice"))});$("#selectWorkShopDevice").on("select2:select",function(){getDeviceCheckPlan()});$("#selectSpotPlan").on("select2:select",function(){getSpotPlanCheckList(0,$("#spotPlanCheckList"))});$("#selectWorkShopSet").on("select2:select",function(){var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDeviceSet"))});$("#selectSpotPlanSet").on("select2:select",function(){getSpotPlanCheckList(1,$("#spotPlanCheckListSet"))});$("#selectWorkShopDeviceSet, #selectWorkShopDeviceDel").select2({allowClear:!0,placeholder:"请选择"});$("#selectWorkShopDel").on("select2:select",function(){var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDeviceDel"))})}function getWorkShop(){var t=162,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var u;if(n.errno!=0){layer.msg(n.errmsg);return}$(".selectWorkShop").empty();for(var i=n.datas,f=i.length,r="",t=0;t<f;t++)u=i[t],r+='<option value = "{0}">{0}<\/option>'.format(u.SiteName);$(".selectWorkShop").append(r);getWorkShopDevice()})}function getWorkShopDevice(n,t){var r=163,i;if(!checkPermission(r)){layer.msg("没有权限");return}if(isStrEmptyOrUndefined(n)&&(n=$("#selectWorkShop").val(),isStrEmptyOrUndefined(n))){layer.msg("请选择车间");return}i={};i.opType=r;i.opData=JSON.stringify({workshopName:n});ajaxPost("/Relay/Post",i,function(n){var u;if(n.errno!=0){layer.msg(n.errmsg);return}isStrEmptyOrUndefined(t)?$(".selectWorkShopDevice").empty():t.empty();for(var f=n.datas,e=f.length,r="",i=0;i<e;i++)u=f[i],r+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Code);isStrEmptyOrUndefined(t)?$(".selectWorkShopDevice").append(r):t.append(r);_isConfigPage&&(_isConfigPage=!1,getDeviceCheckPlan());_pageRead&&(_pageRead=!1,getSpotPlan())})}function getDeviceCheckPlan(){var i=609,t,n;if(!checkPermission(i)){layer.msg("没有权限");return}if(t=$("#selectWorkShopDevice").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择设备");$("#selectSpotPlan").empty();return}n={};n.opType=i;n.opData=JSON.stringify({id:t});ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#selectSpotPlan").empty();for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.Plan);$("#selectSpotPlan").append(u);getSpotPlanCheckList(0,$("#spotPlanCheckList"))})}function getSpotPlan(){var t=600,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}$(".selectSpotPlan").empty();for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.Plan);$(".selectSpotPlan").append(u);getSpotPlanCheckList(1,$("#spotPlanCheckListSet"))})}function surveyor(){var t=254,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value = "{0}">{1}<\/option>'.format(i.Id,i.SurveyorName);_surveyorSelect=`<select class="form-control surveyor" item={0}>${u}</select>`})}function getSpotPlanCheckList(n,t){var r,i,u={},e,f;if(n){if(r=605,!checkPermission(r)){layer.msg("没有权限");return}if(i=$("#selectSpotPlanSet").val(),isStrEmptyOrUndefined(i))return;u.qId=i}else{if(r=610,!checkPermission(r)){layer.msg("没有权限");return}if(e=$("#selectWorkShopDevice").val(),isStrEmptyOrUndefined(e)){layer.msg("请选择设备");return}if(u.deviceId=e,i=$("#selectSpotPlan").val(),isStrEmptyOrUndefined(i))return;u.planId=i}f={};f.opType=r;f.opData=JSON.stringify(u);ajaxPost("/Relay/Post",f,function(i){if(i.errno!=0){layer.msg(i.errmsg);return}for(var r=i.datas,s=r.length,f=[],u=0;u<s;u++)r[u].Enable&&f.push(r[u]);r=f;var h=0,e=function(){return++h},o=function(n){var e=n.Interval,t="",f;switch(e){case 1:var r=n.Day,u=n.Month,i=n.NormalHour;r||u?(r&&(t=r==1?`每日${i}点`:`每${r}日${i}点`),u&&(t=u==1?`每月${i}点`:`每${u}月${i}点`)):t=`每日${i}点`;break;case 2:f="日一二三四五六";t=`每周${f[n.Week]}${n.WeekHour}点`;break;default:t=""}return t},c=function(n){return _surveyorSelect.format(n.Id)},l=n?[{data:null,title:"序号",render:e},{data:"Item",title:"点检名称"},{data:"Min",title:"下限"},{data:"Max",title:"上限"},{data:"Unit",title:"单位"},{data:"Reference",title:"参考标准"},{data:"Remarks",title:"备注"},{data:null,title:"提醒间隔",render:o},{data:null,title:"负责人",render:c}]:[{data:null,title:"序号",render:e},{data:"Item",title:"点检名称"},{data:"Min",title:"下限"},{data:"Max",title:"上限"},{data:"Unit",title:"单位"},{data:"Reference",title:"参考标准"},{data:"Remarks",title:"备注"},{data:null,title:"提醒间隔",render:o},{data:"SurveyorName",title:"负责人"}];t.DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:r,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:l})})}function spotPlanCheckReload(){getSpotPlanCheckList(0,$("#spotPlanCheckList"))}function setDeviceCheck(){var f=611,i,n,r,u,s,h;if(!checkPermission(f)){layer.msg("没有权限");return}if(i=$("#selectSpotPlanSet").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择点检计划");return}if(n=$("#selectWorkShopDeviceSet").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择设备");return}n=n.join();for(var e=[],o=$("#spotPlanCheckListSet tbody").find("tr"),c=o.length,t=0;t<c;t++){if(r=o.eq(t).find(".surveyor"),u=r.attr("item"),isStrEmptyOrUndefined(u)){layer.msg("未检测到点检项数据");return}s=r.val();e.push({ItemId:u,SurveyorId:s})}h=function(){var t={};t.opType=f;t.opData=JSON.stringify({PlanId:i,DeviceId:n,SpotCheckDevices:e});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#selectWorkShopDeviceSet").val(null).trigger("change"),getSpotPlanCheckList(1,$("#spotPlanCheckListSet")))})};showConfirm("设置设备点检",h)}function delDevicePlanModal(){$("#selectWorkShopDeviceDel").val(null).trigger("change");var n=$("#selectSpotPlanDel").find("option").eq(0).val();$("#selectSpotPlanDel").val(n).trigger("change");$("#delDevicePlanModal").modal("show")}function delDevicePlan(){var i=612,n,t,r;if(!checkPermission(i)){layer.msg("没有权限");return}if(n=$("#selectWorkShopDeviceDel").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择设备");return}if(n=n.join(),t=$("#selectSpotPlanDel").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择点检计划");return}r=function(){var r={};r.opType=i;r.opData=JSON.stringify({DeviceId:n,PlanId:t});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#delDevicePlanModal").modal("hide")})};showConfirm("删除设备计划：",r)}var _pageRead=!0,_isConfigPage=!0,_surveyorSelect=null;