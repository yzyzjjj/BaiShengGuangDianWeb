function pageReady(){_permissionList[280]={uIds:["delDevicePlanModalBtn"]};_permissionList[281]={uIds:["setDeviceCheckBtn"]};_permissionList=checkPermissionUi(_permissionList);$(".ms2").select2();$("ul .setTitle").on("click",function(){var n=$(this).text();$("#pageTitle").text(`设备点检${n}`)});getWorkShop();surveyor();$("#selectWorkShop").on("select2:select",function(){_isConfigPage=!0;var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDevice"))});$("#selectWorkShopDevice").on("select2:select",function(){getDeviceCheckPlan()});$("#selectSpotPlan").on("select2:select",function(){getSpotPlanCheckList(0,$("#spotPlanCheckList"))});$("#selectWorkShopSet").on("select2:select",function(){var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDeviceSet"))});$("#selectSpotPlanSet").on("select2:select",function(){getSpotPlanCheckList(1,$("#spotPlanCheckListSet"))});$("#selectWorkShopDeviceSet, #selectWorkShopDeviceDel").select2({allowClear:!0,placeholder:"请选择"});$("#selectWorkShopDel").on("select2:select",function(){var n=$(this).val();getWorkShopDevice(n,$("#selectWorkShopDeviceDel"))})}function getWorkShop(){var n={};n.opType=162;ajaxPost("/Relay/Post",n,function(n){var u;if(n.errno!=0){layer.msg(n.errmsg);return}$(".selectWorkShop").empty();for(var i=n.datas,f=i.length,r="",t=0;t<f;t++)u=i[t],r+='<option value = "{0}">{0}<\/option>'.format(u.SiteName);$(".selectWorkShop").append(r);getWorkShopDevice()})}function getWorkShopDevice(n,t){if(isStrEmptyOrUndefined(n)&&(n=$("#selectWorkShop").val(),isStrEmptyOrUndefined(n))){layer.msg("请选择车间");return}var i={};i.opType=163;i.opData=JSON.stringify({workshopName:n});ajaxPost("/Relay/Post",i,function(n){var u;if(n.errno!=0){layer.msg(n.errmsg);return}isStrEmptyOrUndefined(t)?$(".selectWorkShopDevice").empty():t.empty();for(var f=n.datas,e=f.length,r="",i=0;i<e;i++)u=f[i],r+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Code);isStrEmptyOrUndefined(t)?$(".selectWorkShopDevice").append(r):t.append(r);_isConfigPage&&(_isConfigPage=!1,getDeviceCheckPlan());_pageRead&&(_pageRead=!1,getSpotPlan())})}function getDeviceCheckPlan(){var t=$("#selectWorkShopDevice").val(),n;if(isStrEmptyOrUndefined(t)){layer.msg("请选择设备");$("#selectSpotPlan").empty();return}n={};n.opType=609;n.opData=JSON.stringify({id:t});ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}$("#selectSpotPlan").empty();for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.Plan);$("#selectSpotPlan").append(u);getSpotPlanCheckList(0,$("#spotPlanCheckList"))})}function getSpotPlan(){var n={};n.opType=600;ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}$(".selectSpotPlan").empty();for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value="{0}">{1}<\/option>'.format(i.Id,i.Plan);$(".selectSpotPlan").append(u);getSpotPlanCheckList(1,$("#spotPlanCheckListSet"))})}function surveyor(){var n={};n.opType=254;ajaxPost("/Relay/Post",n,function(n){var i;if(n.errno!=0){layer.msg(n.errmsg);return}for(var r=n.datas,f=r.length,u="",t=0;t<f;t++)i=r[t],u+='<option value = "{0}">{1}<\/option>'.format(i.Id,i.SurveyorName);_surveyorSelect=`<select class="form-control surveyor" item={0}>${u}</select>`})}function getSpotPlanCheckList(n,t){var f,i,r={},e,u;if(n){if(f=605,i=$("#selectSpotPlanSet").val(),isStrEmptyOrUndefined(i))return;r.qId=i}else{if(f=610,e=$("#selectWorkShopDevice").val(),isStrEmptyOrUndefined(e)){layer.msg("请选择设备");return}if(r.deviceId=e,i=$("#selectSpotPlan").val(),isStrEmptyOrUndefined(i))return;r.planId=i}u={};u.opType=f;u.opData=JSON.stringify(r);ajaxPost("/Relay/Post",u,function(i){if(i.errno!=0){layer.msg(i.errmsg);return}for(var r=i.datas,s=r.length,f=[],u=0;u<s;u++)r[u].Enable&&f.push(r[u]);r=f;var h=0,e=function(){return++h},o=function(n){var e=n.Interval,t="",f;switch(e){case 1:var r=n.Day,u=n.Month,i=n.NormalHour;r||u?(r&&(t=r==1?`每日${i}点`:`每${r}日${i}点`),u&&(t=u==1?`每月${i}点`:`每${u}月${i}点`)):t=`每日${i}点`;break;case 2:f="日一二三四五六";t=`每周${f[n.Week]}${n.WeekHour}点`;break;default:t=""}return t},c=function(n){return _surveyorSelect.format(n.Id)},l=n?[{data:null,title:"序号",render:e},{data:"Item",title:"点检名称"},{data:"Min",title:"下限"},{data:"Max",title:"上限"},{data:"Unit",title:"单位"},{data:"Reference",title:"参考标准"},{data:"Remarks",title:"备注"},{data:null,title:"提醒间隔",render:o},{data:null,title:"负责人",render:c}]:[{data:null,title:"序号",render:e},{data:"Item",title:"点检名称"},{data:"Min",title:"下限"},{data:"Max",title:"上限"},{data:"Unit",title:"单位"},{data:"Reference",title:"参考标准"},{data:"Remarks",title:"备注"},{data:null,title:"提醒间隔",render:o},{data:"SurveyorName",title:"负责人"}];t.DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:r,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:l})})}function spotPlanCheckReload(){getSpotPlanCheckList(0,$("#spotPlanCheckList"))}function planItemReload(){getSpotPlanCheckList(1,$("#spotPlanCheckListSet"))}function setDeviceCheck(){var u=$("#selectSpotPlanSet").val(),n,i,r,o,s;if(isStrEmptyOrUndefined(u)){layer.msg("请选择点检计划");return}if(n=$("#selectWorkShopDeviceSet").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择设备");return}n=n.join();for(var f=[],e=$("#spotPlanCheckListSet tbody").find("tr"),h=e.length,t=0;t<h;t++){if(i=e.eq(t).find(".surveyor"),r=i.attr("item"),isStrEmptyOrUndefined(r)){layer.msg("未检测到点检项数据");return}o=i.val();f.push({ItemId:r,SurveyorId:o})}s=function(){var t={};t.opType=611;t.opData=JSON.stringify({PlanId:u,DeviceId:n,SpotCheckDevices:f});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#selectWorkShopDeviceSet").val(null).trigger("change"),getSpotPlanCheckList(1,$("#spotPlanCheckListSet")))})};showConfirm("设置设备点检",s)}function delDevicePlanModal(){$("#selectWorkShopDeviceDel").val(null).trigger("change");var n=$("#selectSpotPlanDel").find("option").eq(0).val();$("#selectSpotPlanDel").val(n).trigger("change");$("#delDevicePlanModal").modal("show")}function delDevicePlan(){var n=$("#selectWorkShopDeviceDel").val(),t,i;if(isStrEmptyOrUndefined(n)){layer.msg("请选择设备");return}if(n=n.join(),t=$("#selectSpotPlanDel").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择点检计划");return}i=function(){var i={};i.opType=612;i.opData=JSON.stringify({DeviceId:n,PlanId:t});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);$("#delDevicePlanModal").modal("hide")})};showConfirm("删除设备计划：",i)}var _permissionList=[],_pageRead=!0,_isConfigPage=!0,_surveyorSelect=null;