function pageReady(){var i,n,t;$(".ms2").select2();$(".ms3").select2();$("#selectDevice,#selectDeviceDev").select2({allowClear:!0,placeholder:"请选择"});$("#selectWorkShop1").select2({allowClear:!0,placeholder:"请选择"});getWorkShopList();getDeviceList(1);getDeviceList(2);i=getMonthScope();$("#startDate,#selectDay,#startDate1,#startDateDev,#startDayTime").val(i.start).datepicker("update");$("#endDate,#conDay,#endDate1,#endDateDev,#endDayTime").val(i.end).datepicker("update");n=(new Date).format("hh-00-00");$("#startTime").val(n).timepicker("setTime",n);$("#endTime").val(n).timepicker("setTime",n);$("#startTime,#endTime").one("focus",function(){var t=$(".bootstrap-timepicker-widget").eq(0),n=$(t).find("table tbody tr");n.eq(0).find("td").eq(2).remove();n.eq(0).find("td").eq(3).remove();n.eq(1).find("td input").eq(1).prop("disabled",!0);n.eq(1).find("td input").eq(2).prop("disabled",!0);n.eq(2).find("td").eq(2).remove();n.eq(2).find("td").eq(3).remove()});$(".form_month").val(getNowMonth()).datepicker("update");$(".week").val(getWeek()).datepicker({format:"yyyy-mm-dd",language:"zh-CN",calendarWeeks:!0,autoclose:!0,todayBtn:"linked",onSelect:getWeeks}).on("hide",getWeeks);t=!0;$(".week").on("focus",function(){$(".cw").eq(1).text("周数");$(".datepicker .datepicker-days .active").siblings(".cw").css("backgroundColor","#ffff00");$(".datepicker .datepicker-days .active").siblings(".day").css("color","blue")});$("#selectWorkShop").on("select2:select",function(){getWorkShopDeviceList();$("#par .parCk").removeClass("hidden");t=!0});$("#selectWorkShopDev").on("select2:select",function(){getWorkShopDevList()});$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$("#par input,#par span").css("verticalAlign","middle");$("#shopPar input,#shopPar span").css("verticalAlign","middle");$("#devPar input,#devPar span").css("verticalAlign","middle");$("#selectDevice").on("change",function(){var n=$(this).val();isStrEmptyOrUndefined(n)?(t=!0,$("#par .parCk").removeClass("hidden"),$("#par label").find(".icb_minimal").iCheck("uncheck")):($("#par .parCk").addClass("hidden"),t&&(t=!1,$("#par label").find(".icb_minimal").iCheck("uncheck")))});$("#dayFaultAppearType").on("select2:select",function(){dayAppChart()});$("#weekFaultAppearType").on("select2:select",function(){weekAppChart()});$("#monthFaultAppearType").on("select2:select",function(){monthAppChart()});$("#shopFaultAppearType").on("select2:select",function(){shopAppChart()});$("#devFaultAppearType").on("select2:select",function(){devAppChart()})}function getWeeks(n){if(!isStrEmptyOrUndefined(n.date)){var t=$.datepicker.iso8601Week(n.date);$(this).prop("id")=="selectWeek"?(weekTimeOne=$("#selectWeek").val(),$("#selectWeek").val(weekTimeOne.slice(0,weekTimeOne.indexOf("-"))+"第"+t+"周")):(weekTimeTwo=$("#conWeek").val(),$("#conWeek").val(weekTimeTwo.slice(0,weekTimeTwo.indexOf("-"))+"第"+t+"周"))}}function getWorkShopList(){var n={};n.opType=162;ajaxPost("/Relay/Post",n,function(n){var i,t,r;if(n.errno!=0){layer.msg(n.errmsg);return}for(n.datas.sort(function(n,t){return n.SiteName>t.SiteName?1:-1}),$("#selectWorkShop,#selectWorkShopDay,#selectWorkShopWeek,#selectWorkShopMonth,#selectWorkShop1,#selectWorkShopDev,#selectWorkShopTime").empty(),i='<option value = "{0}">{1}<\/option>',$("#selectWorkShop,#selectWorkShopDay,#selectWorkShopWeek,#selectWorkShopMonth,#selectWorkShopDev,#selectWorkShopTime").append(i.format("所有车间","所有车间")),t=0;t<n.datas.length;t++)r=n.datas[t],$("#selectWorkShop,#selectWorkShopDay,#selectWorkShopWeek,#selectWorkShopMonth,#selectWorkShop1,#selectWorkShopDev,#selectWorkShopTime").append(i.format(r.SiteName,r.SiteName))})}function getWorkShopDeviceList(){var t=$("#selectWorkShop").val(),n;if(t=="所有车间"){$("#selectDevice").empty();getDeviceList(1);return}n={};n.opType=163;n.opData=JSON.stringify({workshopName:t});ajaxPost("/Relay/Post",n,function(n){var i,t,r;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#selectDevice").empty(),i='<option value="{0}">{0}<\/option>',$("#selectDevice").append("<option><\/option>"),t=0;t<n.datas.length;t++)r=n.datas[t],$("#selectDevice").append(i.format(r.Code))})}function getWorkShopDevList(){var t=$("#selectWorkShopDev").val(),n;if(t=="所有车间"){$("#selectDeviceDev").empty();getDeviceList(2);return}n={};n.opType=163;n.opData=JSON.stringify({workshopName:t});ajaxPost("/Relay/Post",n,function(n){var i,t,r;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#selectDeviceDev").empty(),i='<option value="{0}">{0}<\/option>',$("#selectDeviceDev").append("<option><\/option>"),t=0;t<n.datas.length;t++)r=n.datas[t],$("#selectDeviceDev").append(i.format(r.Code))})}function getDeviceList(n){var t={};t.opType=100;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}t.datas.sort((n,t)=>n.Code-t.Code);var r,i,u,f=t.datas.length;if(n==1)for($("#selectDevice").empty(),r='<option value="{0}">{0}<\/option>',$("#selectDevice").append("<option><\/option>"),i=0;i<f;i++)u=t.datas[i],$("#selectDevice").append(r.format(u.Code));else for($("#selectDeviceDev").empty(),r='<option value="{0}">{0}<\/option>',$("#selectDeviceDev").append("<option><\/option>"),i=0;i<f;i++)u=t.datas[i],$("#selectDeviceDev").append(r.format(u.Code))})}function getFaultChart(){var n,r,t;if(!$("#par label").find(".icb_minimal").is(":checked")){layer.msg("请选择参数");return}n=$("#selectWorkShop").val();n=="所有车间"&&(n="");var u=0,i=$("#startDate").val(),f=$("#endDate").val();if(exceedTime(i)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(i,f)){layer.msg("结束时间不能小于开始时间");return}r=$("#selectDevice").val();isStrEmptyOrUndefined(r)||(u=2);t={};t.opType=505;t.opData=JSON.stringify({WorkshopName:n,DeviceId:r,StartTime:i,EndTime:f,Compare:u});ajaxPost("/Relay/Post",t,function(n){var i,f,e,h,c,l,w,b,k;if(n.errno!=0){layer.msg(n.errmsg);return}for(FaultsData=n.datas,f=$("#par label").find(".icb_minimal").length,e=-1,$("#faultChart").empty(),i=0;i<f;i++)if(h=$("#par label").find(".icb_minimal")[i],c=$("#par label")[i],$(h).is(":checked")){e++;var a=[],v=[],o=[],t,u,y,p,r=[],s;r[$(c).text()]=$(h).val();s=$(c).text();for(t in r)r.hasOwnProperty(t)&&(o[t]=[]);for(u=0;u<n.datas.length;u++){y=n.datas[u].Date.split(" ")[0];a.push(y);p=n.datas[u];for(t in r)r.hasOwnProperty(t)&&o[t].push(p[r[t]])}l=0;for(t in r)r.hasOwnProperty(t)&&(v.push({name:t,type:"line",data:o[t]}),t=="上报故障总次数"&&($.each(o[t],function(n,t){return l+=t}),s=s+"(总:"+l+"次)"));w='<div id="chart'+e+'" style="width: 100%; height: 500px"><\/div>';$("#faultChart").append(w);b=echarts.init(document.getElementById("chart"+e));k={title:{text:s},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].seriesName=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i}},xAxis:{data:a,axisLine:{onZero:!1}},yAxis:{type:"value"},color:["green"],series:v,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};b.setOption(k,!0)}$("#faultChart").resize(function(){for(f=$("#faultChart").children().length,i=0;i<f;i++)echarts.init(document.getElementById("chart"+i)).resize()});$("#appSer").css("display","none");$("#appSer").fadeIn(1e3);getFaultAppChart()})}function getFaultAppChart(){for(var r=FaultsData,o=r.length,s=[],t=[],h,u,f,i,c,e,l,n=0;n<o;n++)h=FaultsData[n].Date.split(" ")[0],s.push(h),u=r[n].ReportSingleFaultType,u.length!=0&&$.each(u,function(n,i){t.push(i.FaultName)});t.length==0?$("#faults").addClass("hidden").siblings().removeClass("hidden"):($("#faults").removeClass("hidden").siblings().addClass("hidden"),t=t.filter(function(n,i){return t.indexOf(n)==i}),f=[],i=!0,$.each(t,function(t,u){var e=[],s;for(n=0;n<o;n++)s=r[n].ReportSingleFaultType,s.length!=0?($.each(s,function(n,t){u==t.FaultName&&(e.push(t.Count),i=!1)}),i&&e.push(0),i=!0):e.push(0);f.push({name:u,type:"line",data:e})}),$("#faultAppChart").empty(),c='<div id="appChart" style="width: 100%; height: 500px"><\/div>',$("#faultAppChart").append(c),e=echarts.init(document.getElementById("appChart")),l={tooltip:{trigger:"axis"},xAxis:{data:s,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},legend:{data:t},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:f,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}},e.setOption(l,!0),$("#faultAppChart").resize(function(){e.resize()}))}function dayChart(){var t=$("#selectWorkShop1").val(),i,r,n;if(t=="所有车间"&&(t=""),i=$("#selectDay").val(),r=$("#conDay").val(),exceedTime(i)){layer.msg("开始时间不能大于当前时间");return}n={};n.opType=505;n.opData=JSON.stringify({WorkshopName:t,StartTime:i,EndTime:r,Compare:3});ajaxPost("/Relay/Post",n,function(n){var r,t,s,h,u,c;if(n.errno!=0){layer.msg(n.errmsg);return}dayData=n.datas;for(var f=[],e=[],o=n.datas.length,i=0;i<o;i++)if(r=n.datas[i].Date.split(" ")[0],f.push(r),t=n.datas[i],s={name:r,type:"bar",data:[t.RepairCount,t.RepairFaultType,t.ReportFaultRate,t.ReportCount,t.ReportFaultType,t.FaultDevice]},e.push(s),o==2&&n.datas[0].Date==n.datas[1].Date)break;$("#dayConChart").empty();h='<div id="dayChart" style="width: 100%; height: 550px"><\/div>';$("#dayConChart").append(h);u=echarts.init(document.getElementById("dayChart"));c={title:{text:"日数据对比"},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].name=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i},axisPointer:{type:"shadow"}},legend:{data:f},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:["维修故障总次数","维修故障类型数量","上报故障故障率","上报故障总次数","上报故障类型数量","上报故障设备数量"]},color:["#9900ff","#3333ff"],series:e};u.setOption(c,!0);$("#dayConChart").resize(function(){u.resize()});$("#dayRight").css("display","none");$("#dayRight").fadeIn(1e3);dayDataDetails()})}function dayDataDetails(){var i;$("#dayFaultAppearType").empty();for(var u='<option value="{0}">{0}<\/option>',r=dayData.length,n=[],t=0;t<r;t++)if(i=dayData[t].ReportSingleFaultType,i.length!=0&&$.each(i,function(t,i){n.push(i.FaultName)}),r==2&&dayData[0].Date==dayData[1].Date)break;n.length!=0?(n=n.filter(function(t,i){return n.indexOf(t)==i}),$.each(n,function(n,t){$("#dayFaultAppearType").append(u.format(t))}),$("#dayApp").removeClass("hidden").siblings().addClass("hidden"),dayAppChart()):$("#dayApp").addClass("hidden").siblings().removeClass("hidden")}function dayAppChart(){for(var i=$("#dayFaultAppearType").val(),e=dayData.length,o=[],t=[],r=!0,s,u,h,f,c,n=0;n<e;n++)if(s=dayData[n].Date.split(" ")[0],o.push(s),u=dayData[n].ReportSingleFaultType,u.length!=0?($.each(u,function(n,u){u.FaultName==i&&(t.push(u.Count),r=!1)}),r&&t.push(0),r=!0):t.push(0),e==2&&dayData[0].Date==dayData[1].Date)break;$("#dayFaultAppearTypeChart").empty();h='<div id="dayAppChart" style="width: 100%; height: 470px"><\/div>';$("#dayFaultAppearTypeChart").append(h);f=echarts.init(document.getElementById("dayAppChart"));c={title:{text:i},tooltip:{trigger:"axis"},xAxis:{data:o,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},series:{name:i,type:"bar",data:t}};f.setOption(c,!0);$("#dayFaultAppearTypeChart").resize(function(){f.resize()})}function weekChart(){var t=$("#selectWorkShop1").val(),i,r,n;if(t=="所有车间"&&(t=""),i=weekTimeOne,r=weekTimeTwo,exceedTime(i)){layer.msg("开始时间不能大于当前时间");return}n={};n.opType=505;n.opData=JSON.stringify({WorkshopName:t,StartTime:i,EndTime:r,Compare:4});ajaxPost("/Relay/Post",n,function(n){var r,t,s,h,u,c;if(n.errno!=0){layer.msg(n.errmsg);return}weekData=n.datas;for(var f=[],e=[],o=n.datas.length,i=0;i<o;i++)if(r=$(".week").eq(i).val(),f.push(r),t=n.datas[i],s={name:r,type:"bar",data:[t.RepairCount,t.RepairFaultType,t.ReportFaultRate,t.ReportCount,t.ReportFaultType,t.FaultDevice]},e.push(s),o==2&&n.datas[0].Date==n.datas[1].Date)break;$("#weekConChart").empty();h='<div id="weekChart" style="width: 100%; height: 550px"><\/div>';$("#weekConChart").append(h);u=echarts.init(document.getElementById("weekChart"));c={title:{text:"周数据对比"},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].name=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i},axisPointer:{type:"shadow"}},legend:{data:f},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:["维修故障总次数","维修故障类型数量","上报故障故障率","上报故障总次数","上报故障类型数量","上报故障设备数量"]},color:["#9900ff","#3333ff"],series:e};u.setOption(c,!0);$("#weekConChart").resize(function(){u.resize()});$("#weekRight").css("display","none");$("#weekRight").fadeIn(1e3);weekDataDetails()})}function weekDataDetails(){var i;$("#weekFaultAppearType").empty();for(var u='<option value="{0}">{0}<\/option>',r=weekData.length,n=[],t=0;t<r;t++)if(i=weekData[t].ReportSingleFaultType,i.length!=0&&$.each(i,function(t,i){n.push(i.FaultName)}),r==2&&weekData[0].Date==weekData[1].Date)break;n.length!=0?(n=n.filter(function(t,i){return n.indexOf(t)==i}),$.each(n,function(n,t){$("#weekFaultAppearType").append(u.format(t))}),$("#weekApp").removeClass("hidden").siblings().addClass("hidden"),weekAppChart()):$("#weekApp").addClass("hidden").siblings().removeClass("hidden")}function weekAppChart(){for(var i=$("#weekFaultAppearType").val(),e=weekData.length,o=[],t=[],r=!0,s,u,h,f,c,n=0;n<e;n++)if(s=$(".week").eq(n).val(),o.push(s),u=weekData[n].ReportSingleFaultType,u.length!=0?($.each(u,function(n,u){u.FaultName==i&&(t.push(u.Count),r=!1)}),r&&t.push(0),r=!0):t.push(0),e==2&&weekData[0].Date==weekData[1].Date)break;$("#weekFaultAppearTypeChart").empty();h='<div id="weekAppChart" style="width: 100%; height: 470px"><\/div>';$("#weekFaultAppearTypeChart").append(h);f=echarts.init(document.getElementById("weekAppChart"));c={title:{text:i},tooltip:{trigger:"axis"},xAxis:{data:o,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},series:{name:i,type:"bar",data:t}};f.setOption(c,!0);$("#weekFaultAppearTypeChart").resize(function(){f.resize()})}function monthChart(){var t=$("#selectWorkShopMonth").val(),i,r,n;if(t=="所有车间"&&(t=""),i=$("#selectMonth").val(),r=$("#conMonth").val(),exceedTime(i)){layer.msg("开始时间不能大于当前时间");return}n={};n.opType=505;n.opData=JSON.stringify({WorkshopName:t,StartTime:i,EndTime:r,Compare:5});ajaxPost("/Relay/Post",n,function(n){var i,t,s,h,u,c;if(n.errno!=0){layer.msg(n.errmsg);return}monthData=n.datas;for(var f=[],e=[],o=n.datas.length,r=0;r<o;r++)if(i=n.datas[r].Date.split(" ")[0],i=i.slice(0,i.indexOf("-")+3),f.push(i),t=n.datas[r],s={name:i,type:"bar",data:[t.RepairCount,t.RepairFaultType,t.ReportFaultRate,t.ReportCount,t.ReportFaultType,t.FaultDevice]},e.push(s),o==2&&n.datas[0].Date==n.datas[1].Date)break;$("#monthConChart").empty();h='<div id="monthChart" style="width: 100%; height: 550px"><\/div>';$("#monthConChart").append(h);u=echarts.init(document.getElementById("monthChart"));c={title:{text:"月数据对比"},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].name=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i},axisPointer:{type:"shadow"}},legend:{data:f},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:["维修故障总次数","维修故障类型数量","上报故障故障率","上报故障总次数","上报故障类型数量","上报故障设备数量"]},color:["#9900ff","#3333ff"],series:e};u.setOption(c,!0);$("#monthConChart").resize(function(){u.resize()});$("#monthRight").css("display","none");$("#monthRight").fadeIn(1e3);monthDataDetails()})}function monthDataDetails(){var i;$("#monthFaultAppearType").empty();for(var u='<option value="{0}">{0}<\/option>',r=monthData.length,n=[],t=0;t<r;t++)if(i=monthData[t].ReportSingleFaultType,i.length!=0&&$.each(i,function(t,i){n.push(i.FaultName)}),r==2&&monthData[0].Date==monthData[1].Date)break;n.length!=0?(n=n.filter(function(t,i){return n.indexOf(t)==i}),$.each(n,function(n,t){$("#monthFaultAppearType").append(u.format(t))}),$("#monthApp").removeClass("hidden").siblings().addClass("hidden"),monthAppChart()):$("#monthApp").addClass("hidden").siblings().removeClass("hidden")}function monthAppChart(){for(var r=$("#monthFaultAppearType").val(),o=monthData.length,s=[],i=[],u=!0,t,f,h,e,c,n=0;n<o;n++)if(t=monthData[n].Date.split(" ")[0],t=t.slice(0,t.indexOf("-")+3),s.push(t),f=monthData[n].ReportSingleFaultType,f.length!=0?($.each(f,function(n,t){t.FaultName==r&&(i.push(t.Count),u=!1)}),u&&i.push(0),u=!0):i.push(0),o==2&&monthData[0].Date==monthData[1].Date)break;$("#monthFaultAppearTypeChart").empty();h='<div id="monthAppChart" style="width: 100%; height: 470px"><\/div>';$("#monthFaultAppearTypeChart").append(h);e=echarts.init(document.getElementById("monthAppChart"));c={title:{text:r},tooltip:{trigger:"axis"},xAxis:{data:s,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},series:{name:r,type:"bar",data:i}};e.setOption(c,!0);$("#monthFaultAppearTypeChart").resize(function(){e.resize()})}function shopChart(){var n=$("#selectWorkShop1").val(),t,r,i;if(isStrEmptyOrUndefined(n)||n.length<2){layer.msg("请选择两个及以上的车间");return}if(n=n.join(","),!$("#shopPar label").find(".icb_minimal").is(":checked")){layer.msg("请选择参数");return}if(t=$("#startDate1").val(),r=$("#endDate1").val(),exceedTime(t)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(t,r)){layer.msg("结束时间不能小于开始时间");return}i={};i.opType=505;i.opData=JSON.stringify({WorkshopName:n,StartTime:t,EndTime:r,Compare:1});ajaxPost("/Relay/Post",i,function(n){var i,r,c,l,t,o,k,y,p,d,g,nt;if(n.errno!=0){layer.msg(n.errmsg);return}for(shopData=n.datas,i=$("#selectWorkShop1").val(),$("#shopConChart").empty(),c=$("#shopPar label").find(".icb_minimal").length,l=-1,r=0;r<c;r++){var w=$("#shopPar label").find(".icb_minimal")[r],b=$("#shopPar label")[r],u=[],a=[],f=[],e,s,v,h;if($(w).is(":checked")){l++;u[$(b).text()]=$(w).val();a.push($(b).text());for(t in u)u.hasOwnProperty(t)&&(f[t]=[]);for(objectSort(n.datas,"Workshop"),objectSort(n.datas,"Date"),o=[],e=0;e<n.datas.length;e++){k=n.datas[e].Date.split(" ")[0];o.push(k);y=n.datas[e];for(t in u)if(u.hasOwnProperty(t))for(s=f[t].length%i.length;s<i.length;s++)if(i[s]==y.Workshop)if(f[t].push(y[u[t]]),e==n.datas.length-1&&f[t].length%i.length!=0){for(v=0;v<f[t].length%i.length;v++)f[t].push("x");break}else break;else f[t].push("x"),t==a[a.length-1]&&s==i.length-1&&e--}o=distinct(o);shopTime=o;p=[];for(t in u)if(u.hasOwnProperty(t))for(h=0;h<i.length;h++)p.push({name:i[h],type:"line",data:f[t].filter(function(n,t){return t%i.length==h})});d='<div id="shopChart'+l+'" style="width: 100%; height: 500px"><\/div>';$("#shopConChart").append(d);g=echarts.init(document.getElementById("shopChart"+l));nt={title:{text:a[0]},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].seriesName=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i}},xAxis:{data:o,axisLine:{onZero:!1}},yAxis:{type:"value"},legend:{data:i},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:p,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};g.setOption(nt,!0)}}$("#shopConChart").resize(function(){for(c=$("#shopConChart").children().length,r=0;r<c;r++)echarts.init(document.getElementById("shopChart"+r)).resize()});$("#shopRight").css("display","none");$("#shopRight").fadeIn(1e3);shopDataDetails()})}function shopDataDetails(){var i;$("#shopFaultAppearType").empty();for(var r='<option value="{0}">{0}<\/option>',u=shopData.length,n=[],t=0;t<u;t++)i=shopData[t].ReportSingleFaultType,i.length!=0&&$.each(i,function(t,i){n.push(i.FaultName)});n.length!=0?(n=n.filter(function(t,i){return n.indexOf(t)==i}),$.each(n,function(n,t){$("#shopFaultAppearType").append(r.format(t))}),$("#shopApp").removeClass("hidden").siblings().addClass("hidden"),shopAppChart()):$("#shopApp").addClass("hidden").siblings().removeClass("hidden")}function shopAppChart(){for(var h=$("#shopFaultAppearType").val(),i=$("#selectWorkShop1").val(),r=shopData.length,t=[],u=!0,v=0,c,f,e,o,l,s,a,n=0;n<r;n++)if(c=shopData[n].Workshop,f=shopData[n].ReportSingleFaultType,c==i[v++%i.length]?f.length!=0?($.each(f,function(n,i){i.FaultName==h&&(t.push(i.Count),u=!1)}),u&&t.push(0),u=!0):t.push(0):(t.push(0),n--),n==r-1&&t.length%i.length!=0)for(e=0;e<t.length%i.length;e++)t.push(0);for(o=[],r=i.length,n=0;n<r;n++)o.push({name:i[n],type:"line",data:t.filter(function(t,i){return i%r==n})});$("#shopFaultAppearTypeChart").empty();l='<div id="shopAppChart" style="width: 100%; height: 500px"><\/div>';$("#shopFaultAppearTypeChart").append(l);s=echarts.init(document.getElementById("shopAppChart"));a={title:{text:h},tooltip:{trigger:"axis"},xAxis:{data:shopTime,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},legend:{data:i},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:o,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};s.setOption(a,!0);$("#shopFaultAppearTypeChart").resize(function(){s.resize()})}function devChart(){var r=$("#selectWorkShopDev").val(),n,t,u,i;if(r=="所有车间"&&(r=""),n=$("#selectDeviceDev").val(),isStrEmptyOrUndefined(n)||n.length<2){layer.msg("请选择两个及以上的设备");return}if(n=n.join(","),!$("#devPar label").find(".icb_minimal").is(":checked")){layer.msg("请选择参数");return}if(t=$("#startDateDev").val(),u=$("#endDateDev").val(),exceedTime(t)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(t,u)){layer.msg("结束时间不能小于开始时间");return}i={};i.opType=505;i.opData=JSON.stringify({WorkshopName:r,DeviceId:n,StartTime:t,EndTime:u,Compare:2});ajaxPost("/Relay/Post",i,function(n){var i,r,c,l,t,o,k,y,p,d,g,nt;if(n.errno!=0){layer.msg(n.errmsg);return}for(devData=n.datas,i=$("#selectDeviceDev").val(),$("#devConChart").empty(),c=$("#devPar label").find(".icb_minimal").length,l=-1,r=0;r<c;r++){var w=$("#devPar label").find(".icb_minimal")[r],b=$("#devPar label")[r],u=[],a=[],f=[],e,s,v,h;if($(w).is(":checked")){l++;u[$(b).text()]=$(w).val();a.push($(b).text());for(t in u)u.hasOwnProperty(t)&&(f[t]=[]);for(o=[],e=0;e<n.datas.length;e++){k=n.datas[e].Date.split(" ")[0];o.push(k);y=n.datas[e];for(t in u)if(u.hasOwnProperty(t))for(s=f[t].length%i.length;s<i.length;s++)if(i[s]==y.Code)if(f[t].push(y[u[t]]),e==n.datas.length-1&&f[t].length%i.length!=0){for(v=0;v<f[t].length%i.length;v++)f[t].push("x");break}else break;else f[t].push("x"),t==a[a.length-1]&&s==i.length-1&&e--}o=distinct(o);devTime=o;p=[];for(t in u)if(u.hasOwnProperty(t))for(h=0;h<i.length;h++)p.push({name:i[h],type:"line",data:f[t].filter(function(n,t){return t%i.length==h})});d='<div id="devChart'+l+'" style="width: 100%; height: 500px"><\/div>';$("#devConChart").append(d);g=echarts.init(document.getElementById("devChart"+l));nt={title:{text:a[0]},tooltip:{trigger:"axis",formatter:function(n){for(var r,i="",t=0,u=n.length;t<u;t++)r=n[t].name,i+="{0}: {1}<br/>".format(n[t].seriesName,n[t].seriesName=="上报故障故障率"&&typeof n[t].value=="number"?(n[t].value*100).toFixed(2)+"%":n[t].value);return r+"<br/>"+i}},xAxis:{data:o,axisLine:{onZero:!1}},yAxis:{type:"value"},legend:{data:i},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:p,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};g.setOption(nt,!0)}}$("#devConChart").resize(function(){for(c=$("#devConChart").children().length,r=0;r<c;r++)echarts.init(document.getElementById("devChart"+r)).resize()});$("#devRight").css("display","none");$("#devRight").fadeIn(1e3);devDataDetails()})}function devDataDetails(){var i;$("#devFaultAppearType").empty();for(var r='<option value="{0}">{0}<\/option>',u=devData.length,n=[],t=0;t<u;t++)i=devData[t].ReportSingleFaultType,i.length!=0&&$.each(i,function(t,i){n.push(i.FaultName)});n.length!=0?(n=n.filter(function(t,i){return n.indexOf(t)==i}),$.each(n,function(n,t){$("#devFaultAppearType").append(r.format(t))}),$("#devApp").removeClass("hidden").siblings().addClass("hidden"),devAppChart()):$("#devApp").addClass("hidden").siblings().removeClass("hidden")}function devAppChart(){for(var h=$("#devFaultAppearType").val(),i=$("#selectDeviceDev").val(),r=devData.length,t=[],u=!0,v=0,c,f,e,o,l,s,a,n=0;n<r;n++)if(c=devData[n].Code,f=devData[n].ReportSingleFaultType,c==i[v++%i.length]?f.length!=0?($.each(f,function(n,i){i.FaultName==h&&(t.push(i.Count),u=!1)}),u&&t.push(0),u=!0):t.push(0):(t.push(0),n--),n==r-1&&t.length%i.length!=0)for(e=0;e<t.length%i.length;e++)t.push(0);for(o=[],r=i.length,n=0;n<r;n++)o.push({name:i[n],type:"line",data:t.filter(function(t,i){return i%r==n})});$("#devFaultAppearTypeChart").empty();l='<div id="devAppChart" style="width: 100%; height: 500px"><\/div>';$("#devFaultAppearTypeChart").append(l);s=echarts.init(document.getElementById("devAppChart"));a={title:{text:h},tooltip:{trigger:"axis"},xAxis:{data:devTime,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},legend:{data:i},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:o,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};s.setOption(a,!0);$("#devFaultAppearTypeChart").resize(function(){s.resize()})}function getFaultTimeChart(){var i=$("#selectWorkShopTime").val(),n,r,t;if(i=="所有车间"&&(i=""),n=$("#startDayTime").val(),r=$("#endDayTime").val(),exceedTime(n)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(n,r)){layer.msg("结束时间不能小于开始时间");return}var u=$("#startTime").val(),f=$("#endTime").val(),e=u.slice(0,u.indexOf(":")),o=f.slice(0,f.indexOf(":"));if(parseInt(e)>parseInt(o)){layer.msg("结束区间不能小于开始区间");return}t={};t.opType=505;t.opData=JSON.stringify({WorkshopName:i,StartTime:n,EndTime:r,StartHour:e,EndHour:o,Compare:6});ajaxPost("/Relay/Post",t,function(n){var o,s,h,u,c,f,l;if(n.errno!=0){layer.msg(n.errmsg);return}hourData=n.datas;for(var i=n.datas.length,r=[],e=[],t=0;t<i-1;t++)o=n.datas[t].Date.split(" ")[1],r.push(o),s=n.datas[t].ReportCount,e.push(s);h=i==0?"(总:0次)":"(总:"+n.datas[i-1].ReportCount+"次)";hourTime=r;u=[];u.push({name:"上报故障次数",type:"line",data:e});$("#faultTimeChart").empty();c='<div id="timeChart" style="width: 100%; height: 500px"><\/div>';$("#faultTimeChart").append(c);f=echarts.init(document.getElementById("timeChart"));l={title:{text:"上报故障次数"+h},tooltip:{trigger:"axis"},xAxis:{data:r,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},legend:{data:["上报故障次数"]},color:["red"],series:u,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}};f.setOption(l,!0);$("#faultTimeChart").resize(function(){f.resize()});$("#timeRight").css("display","none");$("#timeRight").fadeIn(1e3);timeAppChart()})}function timeAppChart(){for(var r=hourData,o=r.length-1,t=[],u,f,i,s,e,h,n=0;n<o;n++)u=r[n].ReportSingleFaultType,u.length!=0&&$.each(u,function(n,i){t.push(i.FaultName)});t.length==0?$("#timeApp").addClass("hidden").siblings().removeClass("hidden"):($("#timeApp").removeClass("hidden").siblings().addClass("hidden"),t=t.filter(function(n,i){return t.indexOf(n)==i}),f=[],i=!0,$.each(t,function(t,u){var e=[],s;for(n=0;n<o;n++)s=r[n].ReportSingleFaultType,s.length!=0?($.each(s,function(n,t){u==t.FaultName&&(e.push(t.Count),i=!1)}),i&&e.push(0),i=!0):e.push(0);f.push({name:u,type:"line",data:e})}),$("#timeFaultAppearTypeChart").empty(),s='<div id="timeAppChart" style="width: 100%; height: 500px"><\/div>',$("#timeFaultAppearTypeChart").append(s),e=echarts.init(document.getElementById("timeAppChart")),h={tooltip:{trigger:"axis"},xAxis:{data:hourTime,axisLine:{onZero:!1}},yAxis:{name:"故障次数",type:"value"},legend:{data:t},color:["green","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#660066"],series:f,dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:20,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},magicType:{type:["line","bar"]}}}},e.setOption(h,!0),$("#timeFaultAppearTypeChart").resize(function(){e.resize()}))}var weekTimeOne=getDate(),weekTimeTwo=getDate(),FaultsData,dayData,weekData,monthData,shopData,shopTime,devData,devTime,hourData,hourTime;