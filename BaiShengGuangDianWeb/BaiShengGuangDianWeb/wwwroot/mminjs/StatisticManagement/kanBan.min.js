function pageReady(){var n;$(".sidebar-mini").addClass("sidebar-collapse");_permissionList[675]={uIds:[]};_permissionList[676]={uIds:["firstNavLi","setKanBan"]};_permissionList[722]={uIds:["setTab","setTabLi"]};_permissionList[723]={uIds:["carouselTab","carouselTabLi"]};_permissionList=checkPermissionUi(_permissionList);!_permissionList[722].have&&_permissionList[723].have&&$("#carouselTabLi a").click();$("#kanBanList").select2();$("#deviceSelect").select2({allowClear:!0,placeholder:"请选择",multiple:!0});$("#navUl").on("click","a",function(){var n=$(this).attr("href").replace("#",""),e=n.replace("kanBan_",""),u;const f=parseInt(e);if(curId!=f){curId=f;let r=-1;const i=kanBans[curId];if(i&&(r=i.Type),timeEl=n,r==2&&$(`#${n}_deviceState`).empty(),curId>-1)dsDivs[curId]=[],dsPaths[curId]=[],page[curId]=0,setChart(n,curId,r),clearInterval(uiTime),clearInterval(dataTime),t=(i.UI<1?1:i.UI)*1e3,uiTime=setInterval(()=>{run||setChart(n,curId,r,!0)},t),t=(i.Second<1?1:i.Second)*1e3,dataTime=setInterval(()=>{run||setChart(n,curId,r)},t);else{for(u in kanBanProductItemsEl)~u.indexOf("_timer")&&stopTableEffect(kanBanProductItemsEl,u,u.replace("_timer",""));clearInterval(uiTime);clearInterval(dataTime)}}});$(".content").on("click",".fullScreenBtn",function(){var i=`#${$(this).attr("target")}`,n,t;if($(i).toggleClass("panel-fullscreen"),n=$(i).hasClass("panel-fullscreen"),$(this).toggleClass("glyphicon-fullscreen glyphicon-repeat").prop("title",n?"还原":"全屏放大"),n?$(this).addClass("fsb"):$(this).removeClass("fsb"),fullScreen(n),!n)for(t in kanBanProductItemsEl)~t.indexOf("_timer")&&stopTableEffect(kanBanProductItemsEl,t,t.replace("_timer",""))});setInterval(()=>{$(`#${timeEl}_time`).length>0&&$(`#${timeEl}_time`).text(getFullTime()),$(`#${carouselFlag}_time`).length>0&&$(`#${carouselFlag}_time`).text(getFullTime())},1e3);n=function(){$("#kanBanLength").val(($("#kanBanRow").val()>>0)*($("#kanBanCol").val()>>0));let n=$(this).val()>>0;n==0&&(n=1,$(this).val(n));n>15&&(n=15,$(this).val(n));const t=$("#kanBanType").val()>>0;t==3&&initColSet(!1)};$("#kanBanRow").on("input",n);$("#kanBanCol").on("input",n);$("#kanBanList").on("select2:select",function(){var t=$(this).val(),n,i,r;t&&(n=kanBans[t],$("#kanBanName").val(n.Name),$("#kanBanOrder").val(n.Order),$("#isShow").iCheck(n.IsShow?"check":"uncheck"),$("#setKanBan .stateEl").addClass("hidden"),$("#setKanBan .stateEl1").addClass("hidden"),$("#setKanBan .productEl").addClass("hidden"),$("#kanBanUI").val(n.UI),$("#kanBanSecond").val(n.Second),n.Type==2?($("#kanBanRow").val(n.Row),$("#kanBanCol").val(n.Col),$("#kanBanContentCol").val(n.ContentCol),$("#kanBanLength").val(n.Length),$("#setKanBan .stateEl").removeClass("hidden"),scriptIndexTmp=[],scriptTmp=[],n.ContentCol>2&&($("#kanBanItemColNameDiv").removeClass("hidden"),i=getFirstOrders(n.ContentCol),r=`（首列：${i.join()},不为空的列名）`,$("#kanBanContentColDesc").text(r),initColName(!0)),$("#kanBanScript").html("")):n.Type==3&&($("#kanBanRow").val(n.Row),$("#kanBanCol").val(n.Col),$("#setKanBan .productEl").removeClass("hidden"),initColSet(!0),initProduct(n.Type),showPreProduct()),$("#deviceSelect").val(n.DeviceIdList).trigger("change"))});$("#deviceSelect").on("select2:select",function(){var n=$(this).val();~n.indexOf("0")&&$(this).val(0).trigger("change")}).on("change",function(){let n=$(this).val();if(isStrEmptyOrUndefined(n)){scriptIndexTmp=[];scriptTmp=[];$("#kanBanScript").html("");return}var t=[];n.length==1&&~n.indexOf("0")&&(n=deviceTmp.map(n=>n.Id).filter(n=>n));const i=$("#kanBanType").val()>>0;i==2&&(n.forEach(n=>{if(n!=0){var i=deviceTmp[n].ScriptId;~t.indexOf(i)||t.push(i);~scriptIndexTmp.indexOf(i)?existArrayObj(scriptTmp[i].ds,"id",n)||scriptTmp[i].ds.push({id:n,code:deviceTmp[n].Code}):(scriptIndexTmp.push(i),scriptTmp[i]={sId:i,sName:deviceTmp[n].ScriptName,ds:[{id:n,code:deviceTmp[n].Code}]})}}),scriptIndexTmp=t,scriptTmp.forEach(t=>{const i=t.sId;if(~scriptIndexTmp.indexOf(i)){const t=scriptTmp[i].ds.map(n=>n.id);t.forEach(t=>{~n.indexOf(t)||removeArray(scriptTmp[i].ds,"id",t)});scriptTmp[i].ds.length==0&&delete scriptTmp[i]}else scriptTmp[i].div&&$(`#${scriptTmp[i].div}`).remove(),delete scriptTmp[i]}),getScriptList())});$("#kanBanType").on("change",function(){const n=$(this).val(),i=$(this).find(`[value=${n}]`).css("color");$(this).css("color",i);$("#setKanBan .stateEl").addClass("hidden");$("#setKanBan .productEl").addClass("hidden");const t=kanBans.filter(t=>t.Type==n&&t.Id!=0);let r=0;const u=t.reduce((t,i)=>i.Id!==0&&i.Type==n?`${t}<option value=${i.Id}>${++r}-${i.Name}</option>`:"","");if($("#kanBanList").html(u),t.length>0){const n=t[0];$("#kanBanList").val(n.Id).trigger("select2:select")}});$("#kanBanItemColSet").on("input",".kb_item_col2",function(){let n=$(this).val()>>0;const r=$(this).attr("id");let t=0;$("#kanBanItemColSet .kb_item_col2").each((n,i)=>{let u=$(i).attr("id");r!=u&&(t+=$(i).val()>>0)});const i=100-t;n>i&&(n=i,$(this).val(n));initColSet(!1)});$("#kanBanContentCol").on("input",function(){const n=$(this).val();let t="";if(n>2){var i=getFirstOrders(n);t=`（首列顺序：${i.join()}）`;$("#kanBanItemColNameDiv").removeClass("hidden");initColName(!1)}else $("#kanBanItemColNameDiv").addClass("hidden");$("#kanBanContentColDesc").text(t)});$("#kanBanScript").on("input",".order",function(){const i=$(this).closest("tr"),n=$("#kanBanContentCol").val()>>0,t=getMaxSet(n);onInput(this,5,2,1,t)});$("#kanBanScript").on("input",".subOrder",function(){const n=$(this).closest("tr");onInput(this,5,2,1,5)});$("#kanBanItems").on("click",".itemAddBtn",function(){const t=$(this),n=$(t).attr("value").trim()>>0,f=t.attr("name"),i=colSet[0].chose.length,r=$("#kanBanType").val(),e=kanBanItems[r]?kanBanItems[r]:[],u=e.filter(t=>t.Item==n);if(u.length>0){const t=u[0];addOrderData(t.FieldList);kanBanItemsTmp.push({Item:n,Col:0,Order:i,Shifts:0,Hour:0,Min:0,FieldList:t.FieldList});colSet[0].chose.push({name:f,val:n,col:0,order:i,height:100,dOrder:0,dField:t.FieldList.length?t.FieldList[0].Field:""});showPreProduct()}});$("#kanBanProductDetail").on("click",".itemDelBtn",function(){const t=$(this).closest(".kb_div1"),r=$(t).attr("value")>>0;var n=($(t).find(`.C_${r}`).val()>>0)-1,i=($(t).find(`.O_${r}`).val()>>0)-1;removeArray(kanBanItemsTmp,"Col",n,"Order",i);kanBanItemsTmp.forEach(t=>{t.Col==n&&t.Order>=i&&t.Order--});removeArray(colSet[n].chose,"col",n,"order",i);colSet[n].chose=colSet[n].chose.sort(sortOrder);for(let t=0,i=colSet[n].chose.length;t<i;t++)colSet[n].chose[t].order=t;showPreProduct()});$("#kanBanProductDetail").on("click",".upTr",function(){const i=$(this).closest(".kb_div1"),r=$(i).attr("value")>>0,n=($(i).find(`.C_${r}`).val()>>0)-1,t=($(i).find(`.O_${r}`).val()>>0)-1;colSet[n]&&colSet[n].chose&&(colSet[n].chose[t].order=t-1,colSet[n].chose[t-1].order=t,colSet[n].chose=colSet[n].chose.sort(sortOrder));var u=kanBanItemsTmp.filter(i=>i.Col==n&&i.Order==t),f=kanBanItemsTmp.filter(i=>i.Col==n&&i.Order==t-1);kanBanItemsTmp.forEach(n=>{n==u[0]&&(n.Order=t-1),n==f[0]&&(n.Order=t)});kanBanItemsTmp=kanBanItemsTmp.sort(firstBy("Col").thenBy("Order"));showPreProduct()});$("#kanBanProductDetail").on("click",".downTr",function(){const i=$(this).closest(".kb_div1"),r=$(i).attr("value")>>0,n=($(i).find(`.C_${r}`).val()>>0)-1,t=($(i).find(`.O_${r}`).val()>>0)-1;colSet[n]&&colSet[n].chose&&(colSet[n].chose[t].order=t+1,colSet[n].chose[t+1].order=t,colSet[n].chose=colSet[n].chose.sort(sortOrder));var u=kanBanItemsTmp.filter(i=>i.Col==n&&i.Order==t),f=kanBanItemsTmp.filter(i=>i.Col==n&&i.Order==t+1);kanBanItemsTmp.forEach(n=>{n==u[0]&&(n.Order=t+1),n==f[0]&&(n.Order=t)});kanBanItemsTmp=kanBanItemsTmp.sort(firstBy("Col").thenBy("Order"));showPreProduct()});$("#kanBanProductDetail").on("change",".colSet",function(){var e,i;const n=$(this).closest(".kb_div1"),t=$(n).attr("value")>>0,r=($(n).find(`.C_${t}`).attr("old")>>0)-1,tt=($(n).find(`.O_${t}`).attr("old")>>0)-1,u=($(n).find(`.C_${t}`).val()>>0)-1,f=($(n).find(`.O_${t}`).val()>>0)-1,v=$(n).find(`.N_${t}`).val().trim(),h=$(n).find(`.H_${t}`).val(),y=$(n).find(`.DF_${t}`).val(),p=$(n).find(`.DO_${t}`).val(),o=$(n).find(`.Time_${t}`).val()>>0,w=$(n).find(`.Range_${t}`).val()>>0,b=$(n).find(`.Step_${t}`).val()>>0,k=$(n).find(`.IsSum_${t}`).is(":checked");e=$(n).find(`.GroupItems_${t}`).val();isStrEmptyOrUndefined(e)&&(e=[]);e=[].concat(e);const d=$(n).find(`.Effect_${t}`).val()>>0,c=$(n).find(`.Shift_${t}`).val()>>0,g=$(n).find(`.Hour_${t}`).val()>>0,nt=$(n).find(`.Min_${t}`).val()>>0;if(r==u)colSet[u].chose.forEach(n=>{n.order==f&&(n.name=v,n.dField=y,n.dOrder=p,n.height=isStrEmptyOrUndefined(h)?-1:h>>0)}),i=kanBanItemsTmp.filter(n=>n.Col==u&&n.Order==f),kanBanItemsTmp.forEach(n=>{var t,r,u,f;if(n==i[0]){for(n.ConfigList||(n.ConfigList=[]),r=0;r<5;r++)n.ConfigList[r]||(n.ConfigList[r]=[]);for(t=0,r=0;r<8;r++)n.ConfigList[t][r]||(n.ConfigList[t][r]=0);~its.indexOf(n.Item)?(t=0,n.ConfigList[t][0]=c,n.ConfigList[t][1]=o,n.ConfigList[t][2]=w,n.ConfigList[t][3]=k?1:0,t=1,n.ConfigList[t][0]=b,t=2,n.Item==9&&(n.ConfigList[t]=e),t=3,n.Item==11&&(n.ConfigList[t]=e),u="",o==0?u="hour":o==1?u="mDate":o==2?u="week":o==3?u="month":o==4&&(u="year"),n.FieldList&&n.FieldList.length&&(n.FieldList[0].Func=JSON.stringify({special:u}))):(n.Shifts=c,n.Hour=g,n.Min=nt);const i=$("#kanBanType").val(),h=kanBanItems[i]?kanBanItems[i]:[],l=h.filter(t=>t.Item==n.Item),s=l[0];s&&s.Display!=1&&(t=0,f=7,n.ConfigList[t]||(n.ConfigList[t]=[]),n.ConfigList[t][f]=d)}});else{var i=colSet[r].chose.filter(n=>n.order==f),s=kanBanItemsTmp.filter(n=>n.Col==r&&n.Order==f),l=u,a=f;i.length&&s.length&&(removeArray(colSet[r].chose,"order",f),removeArray(kanBanItemsTmp,"Col",r,"Order",f),i[0].col=u,i[0].order=colSet[u].chose.length,colSet[u].chose.push(i[0]),l=i[0].col,a=i[0].order,s[0].Col=l,s[0].Order=a,kanBanItemsTmp.push(s[0]),colSet[r].chose.forEach((n,t)=>{if(n.order!=t){var i=kanBanItemsTmp.filter(t=>t.Col==r&&t.Order==n.order);kanBanItemsTmp.forEach(n=>{n==i[0]&&(n.Order=t)});n.order=t}}))}kanBanItemsTmp=kanBanItemsTmp.sort(firstBy("Col").thenBy("Order"));showPreProduct()});$("#kanBanProductDetail").on("change ifChanged",".dOther",function(){var e;const n=$(this).closest(".kb_div1"),t=$(n).attr("value")>>0,o=($(n).find(`.C_${t}`).attr("old")>>0)-1,f=($(n).find(`.C_${t}`).val()>>0)-1,s=($(n).find(`.O_${t}`).val()>>0)-1,r=$(n).find(`.Time_${t}`).val()>>0,h=$(n).find(`.Range_${t}`).val()>>0,c=$(n).find(`.Step_${t}`).val()>>0;var l=$(n).find(`.IsSum_${t}`).is(":checked"),u=$(n).find(`.IsCompare_${t}`).is(":checked"),i=$(n).find(`.GroupItems_${t}`).val();isStrEmptyOrUndefined(i)&&(i=[]);i=[].concat(i);const a=$(n).find(`.Shift_${t}`).val()>>0;o==f&&(e=kanBanItemsTmp.filter(n=>n.Col==f&&n.Order==s),kanBanItemsTmp.forEach(f=>{var o,s;if(f==e[0]){if(f.ConfigList||(f.ConfigList=[]),o=0,f.ConfigList[o]||(f.ConfigList[o]=[]),f.ConfigList[o][0]=a,f.ConfigList[o][1]=r,r==0&&(u=!1),f.ConfigList[o][2]=h,f.ConfigList[o][4]=u?1:0,f.ConfigList[o][3]=l?1:0,u){$(n).find(`.compareDiv_${t}`).removeClass("hidden");const i=$(n).find(`.cTimeType_${t}`).val()>>0;s=f.ConfigList[o][5]!=i;f.ConfigList[o][5]=i;const u=$(n).find(`.cTimeRangeType_${t}`).val()>>0;if(f.ConfigList[o][6]=u,o=4,f.ConfigList[o]||(f.ConfigList[o]=[]),$(n).find(`.cTimeRangeType`).addClass("hidden"),u==0){$(n).find(`.cTimeRangeType_0_${t}`).removeClass("hidden");$(n).find(`.cTimeRangeType_02_${t}`).text(timeTypes[i]);const r=$(n).find(`.cTimeRangeType_01_${t}`).val()>>0;f.ConfigList[o][0]=r}else if(u==1){$(n).find(`.cTimeRangeType_1_${t}`).removeClass("hidden");let u=$(n).find(`.cTimeRangeType_11_${r}_${i}_${t}`).val();u=u?u:[];f.ConfigList[o]=u;$(n).find(`.cTimeRangeType_div`).addClass("hidden");$(n).find(`.cTimeRangeType_div_${r}_${i}_${t}`).removeClass("hidden")}else u==2}else $(n).find(`.compareDiv_${t}`).addClass("hidden");o=1;f.ConfigList[o]||(f.ConfigList[o]=[]);f.ConfigList[o][0]=c;o=2;f.ConfigList[o]||(f.ConfigList[o]=[]);f.Item==9&&(f.ConfigList[o]=i);o=3;f.ConfigList[o]||(f.ConfigList[o]=[]);f.Item==11&&(f.ConfigList[o]=i)}}))});$("#kanBanProductDetail").on("click",".sUpTr",function(){const n=$(this).closest(".kb_div1"),i=$(n).attr("value")>>0,f=($(n).find(`.C_${i}`).val()>>0)-1,e=($(n).find(`.O_${i}`).val()>>0)-1,r=$(this).closest("tr"),t=$(r).attr("value")>>0,u=$(r).find(`.Or_${t}`).attr("value")>>0;var o=kanBanItemsTmp.filter(n=>n.Col==f&&n.Order==e);kanBanItemsTmp.forEach(n=>{if(n==o[0]){n.FieldList.forEach(n=>{n[trFlag]==t&&(n.Order=u-1),n[trFlag]==t-1&&(n.Order=u)});var i=n.FieldList.filter(n=>n.Order).sort(firstBy("Order")),r=n.FieldList.filter(n=>!n.Order).sort(firstBy("XvHao"));n.FieldList=i.concat(r);n.FieldList.forEach((n,t)=>{n[trFlag]=t})}});showPreProduct()});$("#kanBanProductDetail").on("click",".sDownTr",function(){const n=$(this).closest(".kb_div1"),i=$(n).attr("value")>>0,f=($(n).find(`.C_${i}`).val()>>0)-1,e=($(n).find(`.O_${i}`).val()>>0)-1,r=$(this).closest("tr"),t=$(r).attr("value")>>0,u=$(r).find(`.Or_${t}`).attr("value")>>0;var o=kanBanItemsTmp.filter(n=>n.Col==f&&n.Order==e);kanBanItemsTmp.forEach(n=>{if(n==o[0]){n.FieldList.forEach(n=>{n[trFlag]==t&&(n.Order=u+1),n[trFlag]==t+1&&(n.Order=u)});var i=n.FieldList.filter(n=>n.Order).sort(firstBy("Order")),r=n.FieldList.filter(n=>!n.Order).sort(firstBy("XvHao"));n.FieldList=i.concat(r);n.FieldList.forEach((n,t)=>{n[trFlag]=t+1})}});showPreProduct()});$("#kanBanProductDetail").on("change",".cb",function(){var t,n;const r=$(this).closest(".kb_div1"),i=$(r).attr("display")>>0;if(i==0){t=$(this).prop("checked");const i=$(this).closest(".kb_div1"),r=$(i).attr("value")>>0,u=($(i).find(`.C_${r}`).val()>>0)-1,f=($(i).find(`.O_${r}`).val()>>0)-1,e=$(this).closest("tr"),o=$(e).attr("value")>>0;n=kanBanItemsTmp.filter(n=>n.Col==u&&n.Order==f);kanBanItemsTmp.forEach(i=>{var u,r,f;i==n[0]&&(u=i.FieldList.length,i.FieldList.forEach(n=>{n[trFlag]==o&&(n.Order=t?u+1:0)}),r=i.FieldList.filter(n=>n.Order).sort(firstBy("Order")),r.forEach((n,t)=>{n.Order=t+1}),f=i.FieldList.filter(n=>!n.Order).sort(firstBy("XvHao")),i.FieldList=r.concat(f),i.FieldList.forEach((n,t)=>{n[trFlag]=t+1}))})}else if(i==1){const t=$(this).closest(".kb_div1"),i=$(t).attr("value")>>0,r=($(t).find(`.C_${i}`).val()>>0)-1,u=($(t).find(`.O_${i}`).val()>>0)-1,f=$(this).closest("tr"),e=$(f).attr("value")>>0;n=kanBanItemsTmp.filter(n=>n.Col==r&&n.Order==u);kanBanItemsTmp.forEach(t=>{t==n[0]&&t.FieldList.forEach(n=>{n.Order=n[trFlag]==e?1:0})})}else if(i==2){t=$(this).prop("checked");const i=$(this).closest(".kb_div1"),r=$(i).attr("value")>>0,f=($(i).find(`.C_${r}`).val()>>0)-1,e=($(i).find(`.O_${r}`).val()>>0)-1,o=$(this).closest("tr"),u=$(o).attr("value")>>0;n=kanBanItemsTmp.filter(n=>n.Col==f&&n.Order==e);kanBanItemsTmp.forEach(i=>{i==n[0]&&i.FieldList.forEach(n=>{n[trFlag]==u&&(n.Order=t?u:0)})})}showPreProduct()});$("#kanBanProductDetail").on("change",".fieldSet",function(){const n=$(this).closest(".kb_div1"),i=$(n).attr("value")>>0,r=($(n).find(`.C_${i}`).val()>>0)-1,u=($(n).find(`.O_${i}`).val()>>0)-1,f=$(this).closest("tr"),t=$(f).attr("value")>>0,e=$(n).find(`.Com_${t}`).val(),o=$(n).find(`.Wid_${t}`).val(),s=$(n).find(`.Func_${t}`).val(),h=$(n).find(`.Pre_${t}`).val(),c=$(n).find(`.Suf_${t}`).val();var l=kanBanItemsTmp.filter(n=>n.Col==r&&n.Order==u);kanBanItemsTmp.forEach(n=>{n==l[0]&&n.FieldList.forEach(n=>{n[trFlag]==t&&(n.Column=e,n.Width=o,n.Func=unescape(s),n.Pre=h,n.Suffix=c)})})});$(`#showFuncModal .color_custom`).colorpicker({color:defColor,format:"rgb"}).off("changeColor").on("changeColor",function(n){const t=n.color.toHex();t!="#ffffff"&&$(this).children("input").val(t)});var i=new Promise(n=>getWorkshop(n)),r=new Promise(n=>getStep(n)),u=new Promise(n=>getProduction(n)),f=new Promise(n=>getDevice(n)),e=new Promise(n=>getProcessor(n));i.then(()=>{Promise.all([r,u,f,e]).then(()=>{new Promise(n=>getKanBanList(n)).then(n=>{const i=n[0],t=n[1];t.length>0&&$("#kanBanList").trigger("select2:select")})})})}function initColName(n=true){let t=$("#kanBanContentCol").val()>>0;const u=$("#kanBanList").val(),i=kanBans[u];i&&(n&&(t=i.ContentCol),n&&(colName=i.ColName?i.ColName.split(","):[]));let r=colName.length;if(t>r)for(let n=colName.length,i=t;n<i;n++)colName[n]||(colName[n]="");else colName=sliceArray(colName,t);var f=Array.from($("#kanBanItemColName .kb_item_col2").map((n,t)=>t.value));for(let n=0,t=colName.length;n<t;n++){const t=f[n];t&&(colName[n]=t)}if(n){let n="";for(let i=0;i<t;i++){const t=colName[i];n+=`<div class="input-group kb_item_div1">
                    <span class="text-bold input-group-addon kb_item_col1">列${i+1}：</span>
                    <input class="form-control kb_item_col2" id="kanBanItemColName${i}" value=${t}>
                </div>`}$("#kanBanItemColName").html(n);return}if(r=$("#kanBanItemColName .kb_item_col2").length,t>r){let n="";for(let i=0,r=t;i<r;i++)$(`#kanBanItemColName${i}`).length||(n+=`<div class="input-group kb_item_div1">
                        <span class="text-bold input-group-addon kb_item_col1">列${i+1}：</span>
                        <input class="form-control kb_item_col2" id="kanBanItemColName${i}">
                    </div>`);$("#kanBanItemColName").append(n)}else{for(let n=r-1;n>=t;n--)$(`#kanBanItemColName${n}`).closest(".kb_item_div1").addClass("rm");$("#kanBanItemColName .rm").remove()}}function initColSet(n=true){var f,u,e,o,s,h,c;let t=$("#kanBanCol").val()>>0;const l=$("#kanBanList").val(),i=kanBans[l];i&&n&&(t=i.Col,colSet=i.ColSet?JSON.parse(i.ColSet):[],kanBanItemsTmp=i.ItemList?i.ItemList:[],f=kanBanItemsTmp.filter(n=>n.Col==0),f.length&&(kanBanItemsTmp.forEach(n=>{if(n.FieldList.forEach((n,t)=>{n[trFlag]=t}),!~its.indexOf(n.Item)&&n.Item!=12){var t=n.FieldList.filter(n=>n.Order).sort(firstBy("Order")),i=n.FieldList.filter(n=>!n.Order).sort(firstBy("XvHao"));n.FieldList=t.concat(i)}}),kanBanItemsTmp=kanBanItemsTmp.sort(firstBy("Col").thenBy("Order"))));let r=colSet.length;if(t>r)for(let n=colSet.length,i=t;n<i;n++)colSet[n]||(colSet[n]={width:0,chose:[]});else{for(let n=r-1;n>=t;n--){let t=colSet[0].chose.length;if(t)for(u=0,e=colSet[n].chose.length;u<e;u++){const i=colSet[n].chose[u];o=i.col;s=i.order;i.col=0;i.order=t++;colSet[0].chose.push(i);h=kanBanItemsTmp.filter(n=>n.Col==o&&n.Order==s);kanBanItemsTmp.forEach(n=>{n==h[0]&&(n.Col=i.col,n.Order=i.order)})}}colSet=sliceArray(colSet,t);kanBanItemsTmp=kanBanItemsTmp.sort(firstBy("Col").thenBy("Order"))}if(!n){c=Array.from($("#kanBanItemColSet .kb_item_col2").map((n,t)=>({width:t.value>>0})));for(let n=0,t=colSet.length;n<t;n++){const t=c[n];t&&(colSet[n].width=t.width)}}if(n){let n="";for(let i=0;i<t;i++){const t=colSet[i];n+=`<div class="input-group kb_item_div1">
                    <span class="text-bold input-group-addon kb_item_col1">列${i+1}：</span>
                    <input class="form-control kb_item_col2" id="kanBanItemCol${i}" value=${t.width} oninput="onInput(this, 3, 0);">
                    <span class="input-group-addon kb_item_col3">%</span>
                </div>`}$("#kanBanItemColSet").html(n);return}if(r=$("#kanBanItemColSet .kb_item_col2").length,t>r){let n="";for(let i=0,r=t;i<r;i++)$(`#kanBanItemCol${i}`).length||(n+=`<div class="input-group kb_item_div1">
                        <span class="text-bold input-group-addon kb_item_col1">列${i+1}：</span>
                        <input class="form-control kb_item_col2" id="kanBanItemCol${i}" value=0 oninput="onInput(this, 3, 0);">
                        <span class="input-group-addon kb_item_col3">%</span>
                    </div>`);$("#kanBanItemColSet").append(n)}else{for(let n=r-1;n>=t;n--)$(`#kanBanItemCol${n}`).closest(".kb_item_div1").addClass("rm");$("#kanBanItemColSet .rm").remove()}showPreProduct()}function initProduct(n){const i=$("#kanBanList").val(),t=kanBans[i];kanBanItemsTmp=[];t&&t.ItemList&&(kanBanItemsTmp=t.ItemList);const r=kanBanItems[n]?kanBanItems[n]:[],u=r.reduce((t,i)=>`${t}<pre class="flexStyle mPadding mMargin">
                        <button type="button" class="btn btn-success btn-xs itemAddBtn" value="${i.Item}" type="${n}" name="${i.Name}"><i class="fa fa-plus"></i></button>
                        <span class="textOverTop mPadding">${i.Name}</span>
                    </pre>`,"");$("#kanBanItems").html(u)}function showPreProduct(){$("#kanBanProduct h3").text($("#kanBanName").val());const n=$("#kanBanType").val(),t=kanBanItems[n]?kanBanItems[n]:[],i=colSet.length,r=colSet.reduce((n,r)=>{r.chose=r.chose.sort(sortOrder);const u=r.chose.length,f=u>1?5:4,e=u>1?"":" hidden",o=r.chose.reduce((n,r,o)=>{var h,o,c,b;const p=t.filter(n=>n.Item==r.val),k=kanBanItemsTmp.filter(n=>n.Col==r.col&&n.Order==r.order);if(!p.length||!k.length)return n;const l=p[0],s=k[0],vt=l.FieldList,v=s.FieldList,st=v.filter(n=>n.Order).length,ht=st>1;var it=0,nt=0,a=0,rt=10,ut=0,tt=0,d=0,y=0,w=[],ft=0,et=[],ot=[];let ct="",g="";for(s.ConfigList||(s.ConfigList=[]),o=0;o<5;o++)s.ConfigList[o]||(s.ConfigList[o]=[]);for(h=0,o=0;o<8;o++)s.ConfigList[h][o]||(s.ConfigList[h][o]=0);if(~its.indexOf(l.Item)){h=0;c=0;s.ConfigList[h]||(s.ConfigList[h]=[]);c=0;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=nt);nt=s.ConfigList[h][c];c=1;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=a);a=s.ConfigList[h][c];c=2;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=rt);rt=s.ConfigList[h][c];c=3;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=ut);ut=s.ConfigList[h][c];c=4;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=tt);tt=s.ConfigList[h][c];c=5;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=d);d=s.ConfigList[h][c];c=6;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=y);y=s.ConfigList[h][c];h=1;s.ConfigList[h]||(s.ConfigList[h]=[]);c=0;s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=ft);ft=s.ConfigList[h][c];h=2;s.ConfigList[h]||(s.ConfigList[h]=et);et=s.ConfigList[h];h=3;s.ConfigList[h]||(s.ConfigList[h]=ot);ot=s.ConfigList[h];h=4;s.ConfigList[h]||(s.ConfigList[h]=w);w=s.ConfigList[h];var lt=0,yt=[0,0];if(y==0?w.length&&(lt=w[0]):y==1?w.length>2&&(yt=w):y==2,b="",a==0?b="hour":a==1?b="mDate":a==2?b="week":a==3?b="month":a==4&&(b="year"),v&&v.length&&!v[0].Func&&(v[0].Func=JSON.stringify({special:b})),ct=setOptions(stepTmp,"StepName"),g+=`</br>
                    <label class="control-label">工序</label>
                    <select class="form-control dOther ms2m Step_${r.val}" value="${ft}">${ct}</select>`,l.Item!=10){let n="";l.Item==9?(n=setOptions(productionTmp,"ProductionProcessName"),g+=`计划号<select class="form-control dOther ms2 GroupItems_${r.val}" value="${et.join()}">${n}</select>`):l.Item==11&&(n=setOptions(processorTmp,"Name"),g+=`操作工<select class="form-control dOther ms2m GroupItems_${r.val}" value="${ot.join()}">${n}</select>`)}const n=timeTypes.reduce((n,t,i)=>i==0?n:n+timeUnderTypes(i).reduce((n,t,u)=>`${n}<div class="cTimeRangeType_div cTimeRangeType_div_${i}_${u}_${r.val} ${a==i&&d==u?"":"hidden"}">
                            <select class="form-control ms2 dOther cTimeRangeType_11_${i}_${u}_${r.val}" value="${w.join()}">
                                ${setOptionsArray(timeRanges(i,u))}
                            </select>
                        </div>`,""),"");g+=`<label class="control-label text-red">合计
                        <input type="checkbox" class="icb_minimal dOther cbs IsSum_${r.val}" value="${ut}">
                    </label>
                    <label class="control-label text-blue ${a!=0?"":"hidden"}">比较
                        <input type="checkbox" class="icb_minimal dOther cbc IsCompare_${r.val}" value="${tt}">
                    </label>
                    </br>
                    <div class="compareDiv_${r.val} ${a==0?"hidden":""}${tt==0?" hidden":""}">
                        <label class="control-label">比较时间</label>
                        <select class="form-control dOther cTimeType_${r.val}" value=${d}>${timeUnderOptions(a)}</select>
                        <select class="form-control dOther cTimeRangeType_${r.val}" value=${y}>${timeRangeOptions}</select>
                        <div class="input-group${y==0?"":" hidden"} cTimeRangeType cTimeRangeType_0_${r.val}">
                            <input class="form-control text-center dOther cTimeRangeType_01_${r.val}" style="width: 70px;" value=${lt} oninput="onInput(this, 3, 0, 0, 24);">
                            <div class="input-group-addon cTimeRangeType_02_${r.val}"">${timeTypes[d]}</div>
                        </div>
                        <div class="${y==1?"":" hidden"} cTimeRangeType cTimeRangeType_1_${r.val}">
                            ${n}
                        </div>
                    </div>`}else nt=k.length?s.Shifts:0;l.Display!=1&&(h=0,c=7,s.ConfigList[h]||(s.ConfigList[h]=[]),s.ConfigList[h].length<=c&&(s.ConfigList[h][c]=it),it=s.ConfigList[h][c]);const pt=v.reduce((n,t,i)=>{const h=vt.filter(n=>n.Field==t.Field),u=h.length?h[0]:null,c=u?u.Column:"",b=u?u.Axis:0,f=u?u.Required:!1,e=f||l.Item==12?!1:!0,o=u?u.DataType:"",k=!!FieldFunc[o],d=u?u.Special:"",g=k&&!!FieldFunc[o][d],s=t.Column?t.Column:"",a=t.Color?t.Color:"",v=t.Width?t.Width:"",y=t.Pre?t.Pre:"",p=t.Suffix?t.Suffix:"",w=t.Func?t.Func:"";return n+`<tr role="row" style="background-color: #f9f9f9;" value=${t[trFlag]}>
                        <td style="padding: 4px; border: 1px solid gray;">
                            ${l.Display==1&&b==0?``:l.Display==1&&!f?`<input type="radio" name="Radio_${r.col}_${r.order}" class="cb Cho_${i}" ${t.Order?"checked":""} value="0">`:`<input type="checkbox" ${f?"disabled":""} class="cb Cho_${i}" ${t.Order||f?"checked":""} value="0">`}
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;">${i+1}</td>
                        <td style="padding: 4px; border: 1px solid gray;">
                            ${c}
                        </td>
                        ${l.Display==1?``:`<td style="padding: 4px; border: 1px solid gray;" class="form-inline">
                            <input style="width: auto;${a?`color:${a};`:""}" class="form-control text-center no-padding fieldSet Com_${i}" old=${s} value=${s?s:""}>
                            <img class="mColorpicker Color_${i}"><i style="cursor: pointer;" class="CClear_${i}">清除</i>
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;">
                            <input class="form-control text-center no-padding fieldSet Wid_${i}" placeholder="自动" old=${v} value=${v}>
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;">
                            <button class="btn btn-primary btn-sm Func_${i}" old="${escape(w)}" value="${escape(w)}" onclick="showFunc(this, '${c}', '${o}', ${r.col}, ${r.order}, ${t[trFlag]})">设置</button>
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;">
                            <input class="form-control text-center no-padding fieldSet Pre_${i}" old=${y} value=${y}>
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;">
                            <input class="form-control text-center no-padding fieldSet Suf_${i}" old=${p} value=${p}>
                        </td>
                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline Or_${i}" value=${t.Order}>
                            ${e?`<span ${e?"":"disabled"} class="glyphicon glyphicon-arrow-up pointer text-green${i==0?" hidden":""} ${ht&&t.Order?"":" hidden"} sUpTr" aria-hidden="true" title="上移"></span>
                            <span ${e?"":"disabled"} class="glyphicon glyphicon-arrow-down pointer text-red${i+1==st?" hidden":""} ${ht&&t.Order?"":" hidden"}   sDownTr" aria-hidden="true" title="下移"></span>`:""}
                        </td>`}
                    </tr>`},"");let at="";return at=~its.indexOf(l.Item)?workshopTmp[workshopId].ShiftNameList.reduce((n,t,i)=>`${n}<option value="${i+1}">${t}</option>`,'<option value="0">全天<\/option>'):setOptions(shifts,"Type"),`${n}<div class="kb_div1" style="height: ${r.height==-1?"auto":`${r.height}%`}" col="${r.col}" order="${r.order}" value="${r.val}" display="${l.Display}" >
                    <div class="kb_border1">
                        <div class="kb_border3" style="padding: 5px;">
                            <table class="table table-striped no-margin">
                                <thead>
                                    <tr role="row">
                                        <th colspan="${f}" class="bg-green" style="padding: 4px; border: 1px solid gray; width: auto;">
                                            ${l.Name}
                                            <input class="form-control text-center colSet N_${r.val}" style="width: 50%;display: inline;" value=${r.name} length="30">
                                            <button type="button" class="btn btn-danger btn-xs itemDelBtn" value=${r.val} style="float: left;"><i class="fa fa-minus"></i></button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr role="row" class="odd">
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline">
                                            列
                                            <input class="form-control text-center no-padding colSet C_${r.val}" style="width: 40px;" old=${r.col+1} value=${r.col+1} oninput="onInput(this, 3, 0, 1, ${i});">
                                        </td>
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline">
                                            顺序
                                            <input class="form-control text-center no-padding colSet O_${r.val}" readonly="readonly" style="width: 40px;" old=${r.order+1} value=${r.order+1} oninput="onInput(this, 3, 0, 1);">
                                        </td>
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline">
                                            排序
                                            <select class="form-control colSet DF_${r.val}" value=${r.dField?r.dField:""} style="width: auto;">
                                                ${setOptionsWithKey(v,"Field","Column")}
                                            </select>
                                            <select class="form-control colSet DO_${r.val}" value=${r.dOrder?r.dOrder:0} style="width: auto;">
                                                <option value="0">正序</option>
                                                <option value="1">倒序</option>
                                            </select>
                                            ${p[0].Display==1?"":`<label class="control-label">切换</label>
                                            <select class="form-control colSet Effect_${r.val}" value=${it}>
                                                <option value="0">滚动</option>
                                                <option value="1">翻页</option>
                                            </select>`}
                                        </td>
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline">
                                            高度
                                            <input class="form-control text-center no-padding colSet H_${r.val}" style="width: 40px;" value="${r.height==-1?"":r.height}" oninput="onInput(this, 3, 0, 0, 100);">%
                                        </td>
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline ${e}">
                                            <span class="glyphicon glyphicon-arrow-up pointer text-green${o==0?" hidden":""} upTr" aria-hidden="true" title="上移"></span>
                                            <span class="glyphicon glyphicon-arrow-down pointer text-red${o+1==u?" hidden":""} downTr" aria-hidden="true" title="下移"></span>
                                        </td>
                                    </tr>
                                        ${!p[0].BShifts&&!p[0].BDuration?"":`<tr role="row" style="background-color: #f9f9f9;">
                                        <td style="padding: 4px; border: 1px solid gray;" class="form-inline" colspan="${f}" >
                                            <div class="form-group form-inline">
                                            ${p[0].BShifts?`<label class="control-label">班制</label>
                                                <select class="form-control colSet Shift_${r.val}" value=${nt}>${at}</select>`:""}
                                            ${p[0].BDuration?~its.indexOf(l.Item)?`<label class="control-label">时间类型</label>
                                                <select class="form-control colSet Time_${r.val}" value=${a}>${timeOptions}</select>
                                                <label class="control-label">时间范围</label>
                                                <div class="input-group">
                                                    <input class="form-control text-center colSet Range_${r.val}" style="width: 70px;" value=${rt} oninput="onInput(this, 3, 0, 1, 24);">
                                                    <div class="input-group-addon">${timeTypes[a]}</div>
                                                </div>
                                                ${g}`:`<label class="control-label">显示最近</label>
                                                <input class="form-control text-center colSet Hour_${r.val}" style="width: 70px;" value=${k.length?s.Hour:24} oninput="onInput(this, 3, 0, 0, 24);">
                                                <label class="control-label">小时</label>
                                                <input class="form-control text-center colSet Min_${r.val}" style="width: 70px;" value=${k.length?s.Min:0} oninput="onTimeLimitInput(this);">
                                                <label class="control-label">分</label>`:""}
                                            </div>
                                        </td>
                                    </tr>`}
                                </tbody>
                            </table>
                            <br>
                            ${v.length?`<table class="table table-striped no-margin">
                                <thead>
                                    <tr role="row">
                                        <th colspan="9" class="bg-gray" style="padding: 4px; border: 1px solid gray; width: auto;">
                                            列配置
                                        </th>
                                    </tr>
                                    <tr role="row" style="background-color: #f9f9f9;">
                                        <th style="padding: 4px; border: 1px solid gray; width: 80px;">
                                            选择
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: 80px;">
                                            序号
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            列名
                                        </th>
                                        ${l.Display==1?``:`<th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            自定义及颜色
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            列宽(px)
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            处理
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            前缀
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            后缀
                                        </th>
                                        <th style="padding: 4px; border: 1px solid gray; width: auto;">
                                            顺序
                                        </th>`}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pt}
                                </tbody>
                            </table>`:``}
                        </div>
                    </div>
                </div>`},"");return`${n}<div class="kb_item_pre_div3" style="width: ${r.width}%; overflow-y: auto;">
                    ${o}
                 </div>`},"");$(".dropdown-menu .colColor").remove();$("#kanBanProductDetail").html(r).find("select").each((n,t)=>{var i=$(t).attr("value"),r;$(t).hasClass("ms2m")?(~i.indexOf(",")?($(t).select2({matcher,allowClear:!0,placeholder:"请选择",multiple:!0,width:"55%"}),i=i.split(",")):$(t).select2({matcher,width:"120px"}),$(t).val(i).trigger("change")):$(t).hasClass("ms2")?($(t).select2({matcher,allowClear:!0,placeholder:"请选择",multiple:!0,width:"70%"}),r="",isStrEmptyOrUndefined(i)||(r=i.split(",")),$(t).val(r).trigger("change")):$(t).val(i)}).end().find(".icb_minimal").each((n,t)=>{var i=$(t).attr("value");$(t).iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-red",increaseArea:"20%"}).iCheck(i==1?"check":"unckeck")}).end().find(".kb_border3").each((n,t)=>{const i=$(t).closest(".kb_div1"),f=$(i).attr("value")>>0,r=($(i).find(`.C_${f}`).val()>>0)-1,u=($(i).find(`.O_${f}`).val()>>0)-1,e=colSet[r].chose[u].dOrder?colSet[r].chose[u].dOrder:0,o=colSet[r].chose[u].dField?colSet[r].chose[u].dField:"";$(t).find(`.DO_${f}`).val(e);$(t).find(`.DF_${f}`).val(o);var s=kanBanItemsTmp.filter(n=>n.Col==r&&n.Order==u);kanBanItemsTmp.forEach(n=>{n==s[0]&&(n.Top&&$(t).scrollTop(n.Top),n.Left&&$(t).scrollLeft(n.Left),n.FieldList.forEach((n,t)=>{const r=n.Color?n.Color:defColor;$(i).find(`.Color_${t}`).colorpicker({allowEmpty:!0,color:r,format:"rgb",customClass:"colColor"});$(i).find(`.CClear_${t}`).on("click",function(){$(this).siblings(`.Color_${t}`).colorpicker("setValue","")})}))});$(t).scroll(n=>{const t=$(n.target).closest(".kb_div1"),i=$(t).attr("value")>>0,r=($(t).find(`.C_${i}`).val()>>0)-1,u=($(t).find(`.O_${i}`).val()>>0)-1;var f=$(n.target).scrollTop(),e=$(n.target).scrollLeft(),o=kanBanItemsTmp.filter(n=>n.Col==r&&n.Order==u);kanBanItemsTmp.forEach(n=>{n==o[0]&&(n.Top=f,n.Left=e)})})}).end().find(".mColorpicker").on("changeColor",function(n){var t=n.color.toHex(),u;if(t!="#ffffff"){t=="#aN"&&(t="");$(this).siblings("input").css("color",t);const i=$(this).closest(".kb_div1"),r=$(i).attr("value")>>0,f=($(i).find(`.C_${r}`).val()>>0)-1,e=($(i).find(`.O_${r}`).val()>>0)-1,o=$(this).closest("tr"),s=$(o).attr("value")>>0;u=kanBanItemsTmp.filter(n=>n.Col==f&&n.Order==e);kanBanItemsTmp.forEach(n=>{n==u[0]&&n.FieldList.forEach(n=>{n[trFlag]==s&&(n.Color=t)})})}})}function showFunc(n,t,i,r,u,f){var h,c,o,s;const l=$(n).attr("value")?$(n).attr("value"):"[]",e=JSON.parse(unescape(l));$("#showFuncModal .modal-title").text(`${t}-逻辑处理`).attr("func",i).attr("c",r).attr("o",u).attr("pxh",f);h=e.special?e.special:"";$("#showFunc").html(setFieldOptions(i)).val("");$("#showFunc").val(h);c=e.bold?e.bold:0;$("#boldFunc").val(c);o=e.color?e.color:0;$("#conFunc").empty();$("#colorFunc").val(0).off("change").on("change",function(){var t=$(this).val(),n=$(this).find(`[value=${t}]`).attr("target");$(this).closest(".colorChose").siblings(".colorDiv").addClass("hidden");n&&$(this).closest(".colorChose").siblings(`.${n}`).removeClass("hidden")});$("#colorFunc").val(o).trigger("change");o==2&&e&&e.cons&&e.cons.length&&e.cons.forEach((n,t)=>{addConTr(n.color);const i=t+1,r=$(`#conFunc .ctr_${i}`);$(r).find(`.con_${i}`).val(n.con);$(r).find(`.conv_${i}`).val(n.conv);$(r).find(`.tcolor_${i}`).val(n.color);$(r).find(`.ccolor_${i}`).css("background-color",n.color)});s=defColor;o==3&&e&&e.cons&&e.cons.length&&(s=e.cons[0].color);$(`#showFuncModal .color_custom`).colorpicker("setValue",s);$("#showFuncModal").modal("show")}function addConTr(n){var u=n?n:defColor,f;const e=$("#conFunc tr").length,t=e+1;f=`<tr class="ctr_${t}">
            <td class="xh xh_${t}">
                ${t}
            </td>
            <td class="form-inline">
                <select class="form-control con_${t}" style="width: auto;">
                    ${conOptions}
                </select>
                <input type="text" class="form-control text-center conv_${t}" style="width: auto;">
            </td>
            <td>
                <div class="input-group color_${t}">
                  <input type="text" class="form-control hidden tcolor_${t}" style="width: auto;" readonly value="${u}">
                  <div class="input-group-addon" style="border-left: 1px solid #ccc;">
                    <i class="ccolor_${t}" style="background-color: ${u};"></i>
                  </div>
                </div>
            </td>
            <td>
                <button type="button" class="btn btn-danger btn-sm" onclick="delConTr(this)"><i class="fa fa-minus"></i></button>
            </td>
        </tr>`;$("#conFunc").append(f);$(`#conFunc .color_${t}`).colorpicker({color:u,format:"rgb"}).on("changeColor",function(n){const t=n.color.toHex();t!="#ffffff"&&$(this).children("input").val(t)});const o=getDate(),r=$("#showFuncModal .modal-title").attr("func"),i=$(`#conFunc .conv_${t}`);if(r==="int")$(i).on("input",function(){onInput(this,8,0)});else if(r==="decimal")$(i).on("input",function(){onInput(this,8,4)});else r==="datetime"?($(i).addClass("form_date").val(o),initDayTime($(i).closest("td"))):r==="date"&&($(i).addClass("form_date"),initDayTime($(i).closest("td")))}function delConTr(n){const t=$(n).closest("tr");t&&t.remove();const i=$("#conFunc tr");i.each((n,t)=>{$(t).find(`.xh`).text(n+1)})}function saveCons(n=false){var t=[],o;const s=$("#showFunc").val(),h=$("#boldFunc").val()>>0,i=$("#colorFunc").val()>>0;if(i==2){const n=$("#conFunc tr");if(!n.length)return void layer.msg("缺少条件配置!");n.each((n,i)=>{const r=n+1,u=$(i).find(`.con_${r}`).val()>>0,f=$(i).find(`.conv_${r}`).val(),e=$(i).find(`.tcolor_${r}`).val();t.push({xh:r,con:u,conv:f,color:e})})}else if(i==3){const n=$("#showFuncModal").find(`.tcolor_custom`).val();t.push({color:n})}const r=JSON.stringify({special:s,bold:h,color:i,cons:t}),u=$("#showFuncModal .modal-title").attr("c")>>0,f=$("#showFuncModal .modal-title").attr("o")>>0,e=$("#showFuncModal .modal-title").attr("pxh")>>0;$(`#kanBanProductDetail .kb_div1[col=${u}][order=${f}] .Func_${e}`).attr("value",r);o=kanBanItemsTmp.filter(n=>n.Col==u&&n.Order==f);kanBanItemsTmp.forEach(n=>{n==o[0]&&n.FieldList.forEach(n=>{n[trFlag]==e&&(n.Func=r)})});n&&$("#showFuncModal").modal("hide")}function getWorkshop(n){ajaxPost("/Relay/Post",{opType:162},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}workshopTmp=t.datas.sort(firstBy("Id"));workshopId=t.datas.length?workshopTmp[0].Id:0;n&&n(workshopTmp)},0)}function getStep(n){ajaxPost("/Relay/Post",{opType:150,opData:JSON.stringify({wId:workshopId,menu:!0})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}stepTmp=t.datas;n&&n(stepTmp)},0)}function getProduction(n){ajaxPost("/Relay/Post",{opType:215,opData:JSON.stringify({wId:workshopId,menu:!0})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}productionTmp=t.datas;n&&n(productionTmp)},0)}function getDevice(n){if(_permissionList[676].have){var t={opType:100,opData:JSON.stringify({wId:workshopId,script:!0,detail:!1})};ajaxPost("/Relay/Post",t,t=>{var i,e;if(t.errno!=0){layer.msg(t.errmsg);return}var r=SortNumberString(t.datas,"Code"),u='<option value="0">全部<\/option>',f=[];for(i=0,e=r.length;i<e;i++){const n=r[i];deviceTmp[n.Id]=n;u+=`<option value=${n.Id}>${n.Code}</option>`;f.push(n.Id)}$("#deviceSelect").empty().append(u);n(f)},0)}}function getProcessor(n){ajaxPost("/Relay/Post",{opType:248,opData:JSON.stringify({wId:workshopId,menu:!0})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}processorTmp=t.datas;n&&n(processorTmp)},0)}function getKanBanList(n){ajaxPost("/Relay/Post",{opType:509,opData:JSON.stringify({wId:workshopId,init:!0})},t=>{var r,l,f,e,u,o,tt,it,i,c,rt,p;if(t.errno!=0){layer.msg(t.errmsg);return}r=t.data;const w=r.length;if(!(w<=0)){l=`<div class="box box-primary">
                    <div class="box-header with-border">
                        <label class="control-label textOverTop no-margin middle">时间信息：<span id="{0}_time"></span></label>
                        <span class="glyphicon glyphicon-fullscreen pointer fullScreenBtn {1}" target="{0}"
                            style="position: absolute; right: 15px; top: 15px; font-size: 20px;z-index:1" title="全屏放大" aria-hidden="true"></span>
                    </div>
                    <div>
                         <div class="row">
                            <div class="col-md-4">
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">设备详情</h3>
                                    </div>
                                    <div class="box-body">
                                        <div class="flexStyle">
                                            <div id="{0}_detail" class="chart" style="width: 40%; height: 140px"></div>
                                            <div class="flexStyle" style="width: 60%;height: 150px;flex-flow: column;justify-content: space-around; align-items: flex-start;padding-left:5%">
                                                <label class="control-label textOverTop">运行时间：<span class="spanStyle" id="{0}_yxTime"></span></label>
                                                <label class="control-label textOverTop">加工时间：<span class="spanStyle" id="{0}_jgTime"></span></label>
                                                <label class="control-label textOverTop">闲置时间：<span class="spanStyle" id="{0}_xzTime"></span></label>
                                                <label class="control-label textOverTop">所有利用率：<span class="spanStyle" id="{0}_lly"></span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="box box-warning">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">日最大使用率</h3>
                                    </div>
                                    <div class="box-body">
                                        <div class="flexStyle">
                                            <div id="{0}_max" class="chart" style="width: 40%; height: 140px"></div>
                                            <div class="flexStyle" style="width: 60%;height: 150px;flex-flow: column;justify-content: space-around; align-items: flex-start;padding-left:5%">
                                                <label class="control-label textOverTop">日最大同时使用台数：<span class="spanStyle" id="{0}_maxTs"></span></label>
                                                <label class="control-label textOverTop">日最大使用台数：<span class="spanStyle" id="{0}_maxTNum"></span></label>
                                                <label class="control-label textOverTop">日最大使用率：<span class="spanStyle" id="{0}_maxSyl"></span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="box box-warning">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">日最小使用率</h3>
                                    </div>
                                    <div class="box-body">
                                        <div class="flexStyle">
                                            <div id="{0}_min" class="chart" style="width: 40%; height: 140px"></div>
                                            <div class="flexStyle" style="width: 60%;height: 150px;flex-flow: column;justify-content: space-around; align-items: flex-start;padding-left:5%">
                                                <label class="control-label textOverTop">日最小同时使用台数：<span class="spanStyle" id="{0}_minTs"></span></label>
                                                <label class="control-label textOverTop">日最小使用台数：<span class="spanStyle" id="{0}_minTNum"></span></label>
                                                <label class="control-label textOverTop">日最小使用率：<span class="spanStyle" id="{0}_minSyl"></span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">设备状态</h3>
                                    </div>
                                    <div class="box-body">
                                        <div style="width: 100%;display:flex;flex-wrap:wrap">
                                            <div id="{0}_state_all" class="chart" style="height:180px;width:33.33%"></div>
                                            <div id="{0}_state_normal" class="chart" style="height:180px;width:33.33%"></div>
                                            <div id="{0}_state_process" class="chart" style="height:180px;width:33.33%"></div>
                                            <div id="{0}_state_idle" class="chart" style="height:180px;width:33.33%"></div>
                                            <div id="{0}_state_fault" class="chart" style="height:180px;width:33.33%"></div>
                                            <div id="{0}_state_error" class="chart" style="height:180px;width:33.33%"></div>
                                        </div>
                                        <label class="control-label textOverTop">当前加工设备：</label>
                                        <div id="{0}_dev" style="width: 100%;display:flex;flex-wrap:wrap"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="box box-success">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">单台加工利用率</h3>
                                    </div>
                                    <div class="box-body">
                                        <div id="{0}_bar" class="chart" style="width: 100%; height: 480px"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box box-success">
                            <div class="box-header with-border">
                                <h3 class="box-title">生产数据</h3>
                            </div>
                            <div class="box-body">
                                <div>
                                    <label class="control-label textOverTop"><span class="text-red">加工设备数：</span><span class="spanStyle" id="{0}_devs"></span></label>
                                    <label class="control-label textOverTop"><span class="text-red">加工数：</span><span class="spanStyle" id="{0}_pros"></span></label>
                                    <label class="control-label textOverTop"><span class="text-red">合格数：</span><span class="spanStyle" id="{0}_heGes"></span></label>
                                    <label class="control-label textOverTop"><span class="text-red">裂片数：</span><span class="spanStyle" id="{0}_liePians"></span></label>
                                    <label class="control-label textOverTop"><span class="text-red">合格率：</span><span class="spanStyle" id="{0}_rates"></span></label>
                                </div>
                                <div style="overflow-y: auto">
                                    <table border="1" class="table-td">
                                        <tbody>
                                            <tr id="{0}_devOps">
                                                <td class="text-red bg-info">机台号</td>
                                            </tr>
                                            <tr id="{0}_proOps">
                                                <td class="text-red bg-info">加工数</td>
                                            </tr>
                                            <tr id="{0}_heGeOps">
                                                <td class="text-red bg-info">合格数</td>
                                            </tr>
                                            <tr id="{0}_liePianOps">
                                                <td class="text-red bg-info">裂片数</td>
                                            </tr>
                                            <tr id="{0}_rateOps">
                                                <td class="text-red bg-info">合格率</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;const b=`<div class="kb_div1">
                <div class="kb_border1">
                <div class="kb_border2">
                <div class="form-group no-margin ttDiv">
                    <label class="control-label textOverTop no-margin middle kb_time1">时间信息：<span id="{0}_time"></span></label>
                    <h3 class="text-bold kb_title1" style="color: cyan; padding: 10px;">监控平台</h3>
                    <span class="glyphicon glyphicon-fullscreen pointer kb_fullscreen1 fullScreenBtn {1}" target="{0}" title="全屏放大" aria-hidden="true"></span>
                    <div class="form-group no-margin mPadding">
                        <label class="control-label text-bold no-margin bg-green mPadding text-center" style="width: 15%; font-size: 17px;">
                            加工：<label class="control-label no-margin" id="{0}_jg" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin mPadding text-center" style="width: 15%; font-size: 17px; background: #ffd400; color:white;">
                            准备：<label class="control-label no-margin" id="{0}_zb" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin mPadding text-center" style="width: 15%; font-size: 17px; background: #f47920; color:white;">
                            闲置：<label class="control-label no-margin" id="{0}_xz" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin bg-blue mPadding text-center" style="width: 15%; font-size: 17px;">
                            正常：<label class="control-label no-margin" id="{0}_zc" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin bg-red mPadding text-center" style="width: 15%; font-size: 17px;">
                            故障：<label class="control-label no-margin" id="{0}_gz" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin mPadding text-center" style="width: 15%; font-size: 17px; background: gray; color:white;">
                            未连接：<label class="control-label no-margin" id="{0}_wlj" style="font-size: 17px;">0</label>
                        </label>
                        <label class="control-label text-bold no-margin mPadding text-center" style="width: 15%; color: cyan; font-size: 17px;">
                            共：<label class="control-label no-margin" id="{0}_sum" style="font-size: 17px;">0</label>台
                        </label>
                    </div>
                </div>
                <div class="box box-primary no-box-shadow no-margin kb_div2 dsDiv">
                    <div class="box-header no-padding">
                    </div>
                    <div class="box-body no-padding">
                        <div class="kb_flex_div1" id="{0}_deviceState">
                        </div>
                    </div>
                </div>
                </div>
                </div>
            </div>`,k=`<div class="form-group no-margin">
                        <div class="form-group text-center no-margin">
                <label class="control-label textOverTop no-margin middle kb_time1" style="transform: translateY(-50%);">时间信息：<span id="{0}_time"></span></label>
                <h3 class="text-bold kb_title1" style="color: cyan; padding: 10px;">{1}</h3>
                <span class="glyphicon glyphicon-fullscreen pointer kb_fullscreen2 fullScreenBtn {2}" target="{0}" title="全屏放大" aria-hidden="true"></span>
                        </div>
                <div class="box box-primary kb_body no-border-top no-margin">
                    <div class="box-body kb_item_pre_div2" id="{0}_productDiv">{3}
                    </div>
                </div>
            </div>`;f=`<div class="kb_div1" style="height: {2}" val="{3}">
                <div class="kb_border1">
                    <div class="kb_border2">
                        <div class="form-group text-center no-margin" style="">
                            <h4 class="text-bold kb_title2"><span class="tt1">{1}</span><span class="tt2"></span></h4>
                        </div>
                        <div class="table-responsive mailbox-messages no-margin" style="border: 0;width:100%">
                            {0}
                        </div>
                    </div>
                </div>
            </div>`;e=`<div class="tab-pane {2} {3}" id="{0}">{1}</div>`;const a=`<div class="item kb_body" id="{0}">{1}<div class="carousel-caption text-primary"><h3 class="text-primary isShow hidden">{2}</h3></div></div>`;let v=!_permissionList[676].have;u=$("#kanBanType").val();$("#kanBanType").html(setOptions(t.menu,"Type",!0));u?$("#kanBanType").val(u):$("#kanBanType").trigger("change");u=$("#kanBanType").val();const d=$("#kanBanList").val()>>0,y=r.filter(n=>n.Type==u&&n.Id!=0);let ut=0;const ft=y.reduce((n,t)=>t.Id!==0&&t.Type==u?`${n}<option value=${t.Id}>${++ut}-${t.Name}</option>`:"","");if($("#kanBanList").html(ft),d)$("#kanBanList").val(d);else if(y.length>0){const n=y[0];$("#kanBanList").val(n.Id)}for(o in t.item)kanBanItems[o]=[],t.item[o].forEach(n=>{kanBanItems[o][n.Item]=n});shifts=t.shift;var g="",nt="",s="",h="";carouselTmp=[];tt=0;for(let n=0;n<w;n++){const t=r[n];kanBans[t.Id]=t;const u=$("#kanBanType").find(`[value=${t.Type}]`).css("color");if(g+=`<div class="flexStyle pointer choseBox mPadding">
                        <label class="flexStyle pointer">
                            <input type="checkbox" class="icb_minimal" value=${t.Id}>
                            <span style="margin-left: 5px">${t.Name}</span>
                        </label>
                    </div>`,t.IsShow){it=v&&n==0?' class="active"':"";i=`kanBan_${t.Id}`;nt+=`<li${it}><a href="#${i}" class="kanBan text-bold" data-toggle="tab" aria-expanded="false" style="${u?`color: ${u};`:""}">${t.Name}(${t.Order})</a></li>`;const r=`carousel_${i}`;c=v&&n==0?" active":" fade in";switch(t.Type){case 1:s+=e.format(i,l.format(i,""),"",c);h=a.format(r,l.format(r,"hidden"),t.Name);break;case 2:s+=e.format(i,b.format(i,""),"kb_body",c);h=a.format(r,b.format(r,"hidden"),t.Name);break;case 3:t.ColSet||(t.ColSet="[]");rt=JSON.parse(t.ColSet);p=[];t.ItemList&&t.ItemList.forEach(n=>{p[n.Item]=n});function n(n){return rt.reduce((i,r)=>{var u=r.chose.reduce((i,r)=>{var u="";const e=p[r.val];if(e){const o=e.FieldList?e.FieldList.filter(n=>n.Order):[],i=kanBanItems[t.Type][r.val];i.Display==0?u=f.format(getTableW(`${n}_${r.col}_${r.order}`,o,3),r.name?r.name:i.Name,r.height==-1?"auto":`${r.height}%`,r.val):i.Display==1?u=f.format(getChartW(`${n}_${r.col}_${r.order}`),r.name?r.name:i.Name,r.height==-1?"auto":`${r.height}%`,r.val):i.Display==2&&(u=f.format(getTableT(`${n}_${r.col}_${r.order}`),r.name?r.name:i.Name,r.height==-1?"auto":`${r.height}%`,r.val))}return i+u},"");return`${i}<div class="" style="width: ${r.width}%; height: 100%;">
                                            ${u}
                                        </div>`},"")}s+=e.format(i,k.format(i,t.Name,"",n(i)),"kb_body",c);h=a.format(r,k.format(r,t.Name,"hidden",n(r)),t.Name)}carouselTmp[t.Id]||(carouselTmp[t.Id]={});carouselTmp[t.Id]={carouselLi:`<li data-target="#carousel-example-generic" data-slide-to=${tt++}></li>`,carouselTab:h}}}$("#carouselDiv").empty().append(g).find(`.icb_minimal`).iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-green",increaseArea:"20%"}).on("ifChanged",function(){const n=$(this).val();$(this).is(":checked")?carouselChose.push({id:n,Order:kanBans[n].Order}):removeArray(carouselChose,"id",n);carouselChose.sort(sortOrder)});$("#firstNavLi").nextAll().remove().end().after(nt).end();v&&$("#tabBox a:not(:first)").first().click();$("#setKanBan").nextAll().remove().end().after(s);$("#kanBanType").val(3).trigger("change");$("#kanBanList").val(19).trigger("select2:select");r=r.filter(n=>n.Id!==0);n&&n(r)}},0)}function clearProductPre(){kanBanItemsTmp=[];colSet.forEach(n=>{n.chose=[]});showPreProduct()}function setAddKanBan(n){const u=$("#kanBanName").val().trim();if(isStrEmptyOrUndefined(u))return void layer.msg("看板名称不能为空");const i=$("#kanBanType").val()>>0;if(isStrEmptyOrUndefined(i))return void layer.msg("看板类型错误");const o=$("#kanBanOrder").val()>>0,f=$("#deviceSelect").val();if(isStrEmptyOrUndefined(f))return void layer.msg("请选择设备");const s=$("#kanBanUI").val()>>0,h=$("#kanBanSecond").val()>>0,c=$("#kanBanRow").val()>>0,l=$("#kanBanCol").val()>>0,e=$("#kanBanContentCol").val()>>0,a=Array.from($("#kanBanItemColName .kb_item_col2").map((n,t)=>t.value)),v=$("#isShow").is(":checked");let r=[];scriptIndexTmp.forEach(n=>{var t=scriptTmp[n];const i=`${t.divVal}Data`,u=`${t.divIn}Data`,f=`${t.divOut}Data`;t&&t[i]&&t[u]&&t[f]&&(r=r.concat(t[i],t[u],t[f]))});const t={Type:i,IsShow:v,Name:u,DeviceIds:f.join(","),Order:o,UI:s,Second:h,Row:c,Col:l,ContentCol:e,ColName:"",ColSet:"[]",Variables:"[]",Items:"[]"};if(i==2){t.ColName=a.join();const n=getMaxSet(e);t.Variables=JSON.stringify(r.filter(t=>t.Order<=n))}else if(i==3){for(var y in kanBanItemsTmp){const n=kanBanItemsTmp[y];if(!n.FieldList||!n.FieldList.length||!n.FieldList.filter(n=>n.Order).length)return void layer.msg("请选择列")}t.Items=JSON.stringify(kanBanItemsTmp);t.ColSet=JSON.stringify(colSet)}if(!n){const n=$("#kanBanList").val();if(isStrEmptyOrUndefined(n))return void layer.msg("请选择需要修改的看板");t.Id=n>>0}const p={opType:n?510:511,opData:JSON.stringify(t)};ajaxPost("/Relay/Post",p,n=>{layer.msg(n.errmsg),n.errno==0&&(pTableOrChart=[],getKanBanList())})}function getFieldList(n){var t="[]";return n.FieldList&&n.FieldList.length&&(n.FieldList.forEach(n=>getFieldList(n)),t=JSON.stringify(n.FieldList)),n.Fields=t,n}function delKanBanList(){var n=$("#kanBanList").val(),t;if(isStrEmptyOrUndefined(n)){layer.msg("请选择需要删除的看板");return}t=()=>{var t={opType:512,opData:JSON.stringify({id:n})};ajaxPost("/Relay/Post",t,n=>{layer.msg(n.errmsg),n.errno==0&&getKanBanList()})};showConfirm(`删除：${$("#kanBanList :selected").text()}`,t)}function getMaxSet(n){return n==2?6:(n-3)*5+10}function getFirstOrders(n){var i,t,r;if(n>2){const u=n-1,f=getMaxSet(n),e=Math.floor(f/u);for(i=[],t=0;t<e;t++)r=1+u*t,i.push(r)}return i}function getScriptList(){var n={opType:106,opData:JSON.stringify({sIds:scriptIndexTmp.join()})};ajaxPost("/Relay/Post",n,n=>{if(n.errno!=0){layer.msg(n.errmsg);return}var r=`<div class="box box-info" id="{0}">
                <div class="box-header with-border">
                    <h3 class="box-title"><lable class="text-red text-bold name">{1}</lable> - <lable class="text-blue text-bold code" title="{2}">{3}</lable></h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    </div>
                    <h4>
                        <lable class="text-red text-bold">已选:<lable class="text-blue text-bold chosed"></lable></lable>
                    </h4>
                </div>
                <div class="box-body">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs ui-sortable-handle">
                            <li class="active"><a href="#{0}_kanBanDeviceDataDiv" data-toggle="tab" aria-expanded="true">设备数据</a></li>
                            <li><a href="#{0}_kanBanProductDataDiv" data-toggle="tab" aria-expanded="true">生产数据</a></li>
                            <li><a href="#{0}_kanBanPreDiv" data-toggle="tab" aria-expanded="true">内容预览</a></li>
                        </ul>
                        <div class="tab-content no-padding" style="position: relative">
                            <div class="tab-pane active" id="{0}_kanBanDeviceDataDiv">
                                <div class="form-group">
                                    <div class="col-md-4">
                                        <label class="control-label">变量：</label>
                                        <div class="flexStyle" style="justify-content: flex-end">
                                            <select class="form-control thText" style="max-width: 80px" onchange="dataTableSearch.call(this, '{4}')">
                                                <option value="1">名称</option>
                                                <option value="2">地址</option>
                                                <option value="0">序号</option>
                                            </select>
                                            <select class="form-control sym" style="max-width: 100px" onchange="dataTableSearch.call(this, '{4}')">
                                                <option value="2">包含</option>
                                                <option value="0">等于</option>
                                                <option value="1">不等于</option>
                                            </select>
                                            <input type="text" class="form-control val" placeholder="搜索" style="max-width: 150px" oninput="dataTableSearch.call(this, '{4}')">
                                        </div>
                                        <div class="table-responsive mailbox-messages">
                                            <table class="table table-hover table-striped table-condensed" id="{4}"></table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="control-label">输入：</label>
                                        <div class="flexStyle" style="justify-content: flex-end">
                                            <select class="form-control thText" style="max-width: 80px" onchange="dataTableSearch.call(this, '{5})'">
                                                <option value="1">名称</option>
                                                <option value="2">地址</option>
                                                <option value="0">序号</option>
                                            </select>
                                            <select class="form-control sym" style="max-width: 100px" onchange="dataTableSearch.call(this, '{5}')">
                                                <option value="2">包含</option>
                                                <option value="0">等于</option>
                                                <option value="1">不等于</option>
                                            </select>
                                            <input type="text" class="form-control val" placeholder="搜索" style="max-width: 150px" oninput="dataTableSearch.call(this, '{5}')">
                                        </div>
                                        <div class="table-responsive mailbox-messages">
                                            <table class="table table-hover table-striped table-condensed" id="{5}"></table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="control-label">输出：</label>
                                        <div class="flexStyle" style="justify-content: flex-end">
                                            <select class="form-control thText" style="max-width: 80px" onchange="dataTableSearch.call(this, '{6}')">
                                                <option value="1">名称</option>
                                                <option value="2">地址</option>
                                                <option value="0">序号</option>
                                            </select>
                                            <select class="form-control sym" style="max-width: 100px" onchange="dataTableSearch.call(this, '{6}')">
                                                <option value="2">包含</option>
                                                <option value="0">等于</option>
                                                <option value="1">不等于</option>
                                            </select>
                                            <input type="text" class="form-control val" placeholder="搜索" style="max-width: 150px" oninput="dataTableSearch.call(this, '{6}')">
                                        </div>
                                        <div class="table-responsive mailbox-messages">
                                            <table class="table table-hover table-striped table-condensed" id="{6}"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade in" id="{0}_kanBanProductDataDiv">
                                <div class="table-responsive mailbox-messages">
                                    <table class="table table-hover table-striped table-condensed" id="{7}"></table>
                                </div>
                            </div>
                            <div class="tab-pane fade in" id="{0}_kanBanPreDiv">
                                <div class="kb_device_div1" id="{0}_kanBanContentPre">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;const u=$("#kanBanList").val(),t=kanBans[u],i=n.datas;scriptIndexTmp.forEach(n=>{if(scriptTmp[n]){const s=scriptTmp[n],y=s.sName;let h=SortNumberString(s.ds,"code").map(n=>n.code).join(),w=`${h.length>tdShowLengthLong?`${h.substring(0,tdShowLengthLong)}...`:h}`;var u=i.filter(t=>t.ScriptId==n&&t.VariableTypeId==1),f=i.filter(t=>t.ScriptId==n&&t.VariableTypeId==2),e=i.filter(t=>t.ScriptId==n&&t.VariableTypeId==3),o=kanBanItems[t.Type]?Object.values(kanBanItems[t.Type]):[];s.divVal=`valList_${n}`;s.divIn=`insList_${n}`;s.divOut=`outList_${n}`;s.divProduct=`productList_${n}`;const a=`${s.divVal}Data`,v=`${s.divIn}Data`,l=`${s.divOut}Data`,p=`${s.divProduct}Data`,b=[s.divVal,s.divIn,s.divOut,s.divProduct],c=[a,v,l,p];if(s.div)$(`#${s.div}>.box-header .name`).text(y),$(`#${s.div}>.box-header .code`).text(h),$(`#${s.div} .val`).text(""),updateTable(_dataTableData[s.divVal],u),updateTable(_dataTableData[s.divIn],f),updateTable(_dataTableData[s.divOut],e),updateTable(_dataTableData[s.divProduct],o);else{s.div=`sc_${n}`;s[`${s.divVal}Trs`]=[];s[`${s.divIn}Trs`]=[];s[`${s.divOut}Trs`]=[];s[`${s.divProduct}Trs`]=[];s[`${s.divVal}Data`]=[];s[`${s.divIn}Data`]=[];s[`${s.divOut}Data`]=[];s[`${s.divProduct}Data`]=[];$("#kanBanScript").append(r.format(s.div,y,h,w,s.divVal,s.divIn,s.divOut,s.divProduct));let i=dataTableConfig(0,!0);i.bLengthChange=!1;i.iDisplayLength=20;i.dom='<"pull-left"l><"pull-right hidden"f>rt<"text-center"i><"table-flex"p>';i.addColumns([{data:"VariableName",title:"名称"},{data:"PointerAddress",title:"地址",sClass:"add"},{data:null,title:"自定义名称",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ScriptId==n.ScriptId&&t.VariableTypeId==n.VariableTypeId&&t.PointerAddress==n.PointerAddress),u=i.length>0?i[0].VariableName:"";return tableSet.emptyInput("name no-padding",u)}},{data:null,title:"显示顺序",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ScriptId==n.ScriptId&&t.VariableTypeId==n.VariableTypeId&&t.PointerAddress==n.PointerAddress),u=i.length>0&&i[0].Order>0?i[0].Order:"1";return tableSet.numberInput("order",`50px,5,2,1,99999,0`,u)}},{data:null,title:"子顺序",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ScriptId==n.ScriptId&&t.VariableTypeId==n.VariableTypeId&&t.PointerAddress==n.PointerAddress),u=i.length>0&&i[0].SubOrder>0?i[0].SubOrder:"1";return tableSet.numberInput("subOrder",`50px,5,2,1,99999,0`,u)}},{data:null,title:"分隔符",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ScriptId==n.ScriptId&&t.VariableTypeId==n.VariableTypeId&&t.PointerAddress==n.PointerAddress),u=i.length>0&&!isStrEmptyOrUndefined(i[0].Delimiter)?i[0].Delimiter:"";return tableSet.emptyInput("delimiter no-padding",`30,30`,u)}}]);i.updateData(u);i.drawCallback=function(){const r=`${s.divVal}Trs`,t=a,i=0;initCheckboxAddEvent.call(this,s[r],(r,u)=>{const f=$(r).find(".name").val(),e=$(r).find(".order").val()>>0,o=$(r).find(".subOrder").val()>>0,h=$(r).find(".delimiter").val();s[t].push({Type:i,Id:u.Id,ScriptId:n,VariableTypeId:1,PointerAddress:u.PointerAddress,VariableName:f?f:"",VName:u.VariableName,Order:e?e:1,SubOrder:o?o:1,Delimiter:h?h:""})},(n,r)=>{removeArray(s[t],"Id",r.Id,"Type",i)},!1,"Checked");initInputChangeEvent.call(this,(n,r)=>{const u=$(n).find(".name").val(),f=$(n).find(".order").val()>>0,e=$(n).find(".subOrder").val()>>0,o=$(n).find(".delimiter").val();s[t].length>0&&s[t].every(n=>n.Id==r.Id&&n.Type==i?(n.VariableName=u,n.Order=f,n.SubOrder=e,n.Delimiter=o,!1):!0);updateChoseTitle(s,c)})};i.createdRow=function(i,r){var u=!1;const f=0;t.VariableList.every(t=>t.Type==f&&r.ScriptId==t.ScriptId&&r.VariableTypeId==t.VariableTypeId&&r.PointerAddress==t.PointerAddress?(u=!0,s[a].push({Type:f,Id:r.Id,ScriptId:n,VariableTypeId:1,VariableName:t.VariableName,VName:r.VariableName,PointerAddress:r.PointerAddress,Order:t.Order,SubOrder:t.SubOrder,Delimiter:t.Delimiter}),!1):!0);$(i).find(".isEnable").iCheck(u?"check":"uncheck");u&&$(i).find(".textOn").text("").addClass("hidden").siblings(".textIn").removeClass("hidden")};_dataTableData[s.divVal]=$(`#${s.divVal}`).DataTable(i);i.updateData(f);i.drawCallback=function(){const r=`${s.divIn}Trs`,t=v,i=0;initCheckboxAddEvent.call(this,s[r],(r,u)=>{const f=$(r).find(".name").val(),e=$(r).find(".order").val()>>0,o=$(r).find(".subOrder").val()>>0,h=$(r).find(".delimiter").val();s[t].push({Type:i,Id:u.Id,ScriptId:n,VariableTypeId:2,PointerAddress:u.PointerAddress,VariableName:f?f:"",VName:u.VariableName,Order:e?e:1,SubOrder:o?o:1,Delimiter:h?h:""})},(n,r)=>{removeArray(s[t],"Id",r.Id,"Type",i)},!1,"Checked");initInputChangeEvent.call(this,(n,r)=>{const u=$(n).find(".name").val(),f=$(n).find(".order").val()>>0,e=$(n).find(".subOrder").val()>>0,o=$(n).find(".delimiter").val();s[t].length>0&&s[t].every(n=>n.Id==r.Id&&n.Type==i?(n.VariableName=u,n.Order=f,n.SubOrder=e,n.Delimiter=o,!1):!0);updateChoseTitle(s,c)})};i.createdRow=function(i,r){var u=!1;const f=0;t.VariableList.every(t=>t.Type==f&&r.ScriptId==t.ScriptId&&r.VariableTypeId==t.VariableTypeId&&r.PointerAddress==t.PointerAddress?(u=!0,s[v].push({Id:r.Id,ScriptId:n,VariableTypeId:2,VariableName:t.VariableName,VName:r.VariableName,PointerAddress:t.PointerAddress,Order:t.Order,SubOrder:t.SubOrder,Delimiter:t.Delimiter}),!1):!0);$(i).find(".isEnable").iCheck(u?"check":"uncheck");u&&$(i).find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")};_dataTableData[s.divIn]=$(`#${s.divIn}`).DataTable(i);i.updateData(e);i.drawCallback=function(){const r=`${s.divOut}Trs`,t=l,i=0;initCheckboxAddEvent.call(this,s[r],(r,u)=>{const f=$(r).find(".name").val(),e=$(r).find(".order").val()>>0,o=$(r).find(".subOrder").val()>>0,h=$(r).find(".delimiter").val();s[t].push({Type:i,Id:u.Id,ScriptId:n,VariableTypeId:3,PointerAddress:u.PointerAddress,VariableName:f?f:"",VName:u.VariableName,Order:e?e:1,SubOrder:o?o:1,Delimiter:h?h:""})},(n,r)=>{removeArray(s[t],"Id",r.Id,"Type",i)},!1,"Checked");initInputChangeEvent.call(this,(n,r)=>{const u=$(n).find(".name").val(),f=$(n).find(".order").val()>>0,e=$(n).find(".subOrder").val()>>0,o=$(n).find(".delimiter").val();s[t].length>0&&s[t].every(n=>n.Id==r.Id&&n.Type==i?(n.VariableName=u,n.Order=f,n.SubOrder=e,n.Delimiter=o,!1):!0);updateChoseTitle(s,c)})};i.createdRow=function(i,r){var u=!1;const f=0;t.VariableList.every(t=>t.Type==f&&r.ScriptId==t.ScriptId&&r.VariableTypeId==t.VariableTypeId&&r.PointerAddress==t.PointerAddress?(u=!0,s[l].push({Id:r.Id,ScriptId:n,VariableTypeId:3,VariableName:t.VariableName,VName:r.VariableName,PointerAddress:t.PointerAddress,Order:t.Order,SubOrder:t.SubOrder,Delimiter:t.Delimiter}),!1):!0);$(i).find(".isEnable").iCheck(u?"check":"uncheck");u&&$(i).find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")};_dataTableData[s.divOut]=$(`#${s.divOut}`).DataTable(i);i.modifyColumns([{data:"Type",title:"名称"},{data:null,title:"自定义名称",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ItemType==n.Id),u=i.length>0?i[0].Type:"";return tableSet.input("name",u)}},{data:null,title:"显示顺序",render:n=>{const r=0;var i=t.VariableList.filter(t=>t.Type==r&&t.ItemType==n.Id),u=i.length>0&&i[0].Order>0?i[0].Order:"1";return tableSet.numberInput("order",`50px,5,2,1,99999,0`,u)}}]);i.updateData(o);i.drawCallback=function(){const r=`${s.divProduct}Trs`,t=p,i=0;initCheckboxAddEvent.call(this,s[r],(r,u)=>{const f=$(r).find(".name").val(),e=$(r).find(".order").val()>>0,o=$(r).find(".subOrder").val()>>0,h=$(r).find(".delimiter").val();s[t].push({Type:i,Id:u.Id,ScriptId:n,ItemType:u.Id,VariableName:f?f:"",VName:u.Type,Order:e?e:1,SubOrder:o?o:1,Delimiter:h?h:""})},(n,r)=>{removeArray(s[t],"Id",r.Id,"Type",i)},!1,"Checked");initInputChangeEvent.call(this,(n,r)=>{const u=$(n).find(".name").val(),f=$(n).find(".order").val()>>0,e=$(n).find(".subOrder").val()>>0,o=$(n).find(".delimiter").val();s[t].length>0&&s[t].every(n=>n.Id==r.Id&&n.Type==i?(n.VariableName=u,n.Order=f,n.SubOrder=e,n.Delimiter=o,!1):!0);updateChoseTitle(s,c)})};i.createdRow=function(i,r){var u=!1;const f=1;t.VariableList.every(t=>t.Type==f&&r.Id==t.Id&&r.ItemType==t.ItemType?(u=!0,s[l].push({Type:f,Id:r.Id,ScriptId:n,ItemType:r.Id,VariableName:t.VariableName,VName:r.Type,Order:t.Order,SubOrder:t.SubOrder,Delimiter:t.Delimiter}),!1):!0);$(i).find(".isEnable").iCheck(u?"check":"uncheck");u&&$(i).find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")};_dataTableData[s.divProduct]=$(`#${s.divProduct}`).DataTable(i)}updateChoseTitle(s,c)}})},0)}function changeContentColPre(n,t,i){var u,e,r;let f="";if(t==2)f=n.reduce((n,t)=>`${n}<div class="form-group no-margin" style="height:calc(100%/6);">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-margin text-blue no-padding kb_param1">
                        <label class=" control-label no-margin text-blue no-padding">${t.VName}</label>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-margin text-blue no-padding kb_param1">
                        <label class="control-label no-margin text-blue no-padding">${t.V}</label>
                    </div>
                </div>`,"");else if(t>2){const o=t-1;let s="";if(n.length>0){const t=Math.max.apply(null,n.map(n=>n.Order))+1,i=Math.floor(t/o);for(u=0;u<i;u++){let t="";e=o*u+1;let i="";for(r=0;r<o;r++){const u=n.filter(n=>n.Order==e+r);if(u.length>0&&!isStrEmptyOrUndefined(u[0].VName)){i=u[0].VName;t+=`<td><label class="control-label no-margin text-blue no-padding">${i}</label></td>`;break}}for(i===""&&(t+=`<td><label class="control-label no-margin text-blue no-padding">${i}</label></td>`),r=0;r<o;r++){const i=n.filter(n=>n.Order==e+r);let u="";i.length>0&&(u=i[0].V);t+=`<td><label class="control-label no-margin text-blue no-padding">${u}</label></td>`}s+=`<tr>${t}</tr>`}}f=`<table border="0" cellspacing="0" cellpadding="0" style="width:100%;">
                <thead>
                    <tr>
                        ${i.reduce((n,i)=>`${n}<th style="width:calc(100%/${t})"><label class="control-label no-margin no-padding">${i}</label></th>`,"")}
                    </tr>
                </thead>
                    ${s}
                <tbody>
                </tbody>
            </table>`}return f}function getChoseLength(n,t){return t.reduce((t,i)=>t+n[i].length,0)}function updateChoseTitle(n,t){const i=t.reduce((t,i)=>t.concat(n[i]),[]).sort(sortOrder).map(n=>`[${n.VName} (<span class="text-orange">${n.Order},${n.SubOrder},${n.Delimiter}</span>)]`);$(`#${n.div} .chosed`).html(i.join())}function dataTableSearch(n){const r=_dataTableData[n],i=$(this).parent();var t=i.find(".val").val().trim();if(r.columns([0,1,2,3]).search("").draw(),!isStrEmptyOrUndefined(t)){const n=i.find(".sym").val();n==0?t=`^${t}$`:n==1&&(t=`^(?!${t}$).+$`);const u=(i.find(".thText").val()>>0)+1;r.columns(u).search(t,!0,!1).draw()}}function fullScreenCarousel(){var n=`<div class="">
            <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators isShow hidden">{0}</ol>
                <div class="carousel-inner">{1}</div>
                <a class="left carousel-control isShow hidden" href="#carousel-example-generic" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left text-primary" aria-hidden="true"></span>
                </a>
                <a class="right carousel-control isShow hidden" href="#carousel-example-generic" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right text-primary" aria-hidden="true"></span>
                </a>
            </div>
        </div>`;if(carouselChose.length){const t=carouselChose.reduce((n,t)=>`${n}${carouselTmp[t.id].carouselLi}`,""),i=carouselChose.reduce((n,t)=>`${n}${carouselTmp[t.id].carouselTab}`,"");_carouselBox=n.format(t,i);carouselChose.forEach(n=>{page[n.id]=0,dsDivs[n.id]=[],dsPaths[n.id]=[]});carouselId=0;carouselIndex=0;$("#fullScreenCarousel").empty().append(_carouselBox);$("#fullScreenCarousel").find("ol li:first").addClass("active");$("#fullScreenCarousel").find(".item:first").addClass("active");$("#fullScreenCarousel").animate({top:0,opacity:1},1e3,"linear",()=>{});carouselFlag=$("#fullScreenCarousel .item:first").attr("id");setFullScreenCarousel(carouselFlag);$("#carousel-example-generic").carousel({interval:1e4}).off("slide.bs.carousel").on("slide.bs.carousel",n=>{if(carouselFlag=n.relatedTarget.id,carouselId=carouselFlag.replace("carousel_kanBan_",""),kanBans[carouselId]){if($(`#fullScreenCarousel .ftitle`).length&&$(`#fullScreenCarousel .ftitle`).text(` - ${kanBans[carouselId].Name}`),carouselFlag=="")return;setChart(carouselFlag,carouselId,kanBans[carouselId].Type,!0)}}).on("mouseenter",()=>$("#carousel-example-generic .isShow").removeClass("hidden")).on("mouseleave",()=>$("#carousel-example-generic .isShow").addClass("hidden")).on("mousemove",()=>{$("html").css({cursor:"default"}),checkMouseMove&&clearTimeout(checkMouseMove),checkMouseMove=setTimeout(function(){console.log("hide");$("html").css({cursor:"none"});$("#carousel-example-generic").trigger("mouseleave")},5e3)})}}function setFullScreenCarousel(){(clearInterval(carouselTime),carouselFlag!="")&&(carouselTime=setInterval(()=>{if(carouselId=carouselFlag.replace("carousel_kanBan_",""),kanBans[carouselId]){if($(`#fullScreenCarousel .ftitle`).text(` - ${kanBans[carouselId].Name}`),carouselFlag=="")return;setChart(carouselFlag,carouselId,kanBans[carouselId].Type,!0)}},5e3))}function cancelFullScreenCarousel(){for(var n in kanBanProductItemsEl)~n.indexOf("_timer")&&stopTableEffect(kanBanProductItemsEl,n,n.replace("_timer",""));checkMouseMove&&clearTimeout(checkMouseMove);clearInterval(carouselTime);carouselFlag="";$("#carousel-example-generic").carousel("pause").off("slide.bs.carousel mouseenter mouseleave");$("#fullScreenCarousel").animate({top:"-100%",opacity:0},1e3,"linear",function(){$(this).empty();fullScreen(!1)})}function setChart(n,t,i,r=false){var u,f;if(!run){run=!0;u=`#${n}`;const e=page[t]?page[t]:0;f={opType:509,opData:JSON.stringify({qId:t,page:e})};ajaxPost("/Relay/Post",f,e=>{var h,nt,s,ni,ai,vi,yi,ti,pi,ii,wi,lt,ri,ui,b,v,rr,ur,ot,fr,fi,at,ei,vt,er,o,st,c,l,y,g,p,oi,bt,kt,si,cr,li,gt,et,ct,a,yt,pt,it,wt;run=!1;const ut="text-red",ft="text-gray";if(ni=new Date,a||(a=e.time,tn=ni),a!=e.time&&(a=e.time,tn=ni),e.errno==0?(ai=$(`${u}_time`).text(),vi=e.time,Math.abs(dateDiffSec(vi,ai))>60?($(`${u}_time`).toggleClass(ut),$(`${u}_time`).toggleClass(ft)&&$(`${u}_time`).removeClass(ft)):($(`${u}_time`).toggleClass(ft),$(`${u}_time`).hasClass(ut)&&$(`${u}_time`).removeClass(ut))):($(`${u}_time`).hasClass(ut)||$(`${u}_time`).addClass(ut),$(`${u}_time`).hasClass(ft)&&$(`${u}_time`).removeClass(ft),run=!1),s=e.data,i==1){if(e.errno!=0)return;yi=setPieChart(`${u}_detail`,"Rate",s.AllProcessRate,"#0099ff");$(`${u}_yxTime`).text(codeTime(s.RunTime));$(`${u}_jgTime`).text(codeTime(s.ProcessTime));$(`${u}_xzTime`).text(codeTime(s.IdleTime));$(`${u}_lly`).text(yi);ti=`${s.MaxUse}台`;pi=setPieChart(`${u}_max`,`Max
${ti}`,s.MaxUseRate,"#00a65a");$(`${u}_maxTs`).text(`${s.MaxSimultaneousUseRate}台`);$(`${u}_maxTNum`).text(ti);$(`${u}_maxSyl`).text(pi);ii=`${s.MinUse}台`;wi=setPieChart(`${u}_min`,`Min
${ii}`,s.MinUseRate,"#f39c12");$(`${u}_minTs`).text(`${s.MinSimultaneousUseRate}台`);$(`${u}_minTNum`).text(ii);$(`${u}_minSyl`).text(wi);var w=s.AllDevice,bi=s.NormalDevice,ki=s.ProcessDevice,di=s.IdleDevice,gi=s.FaultDevice,nr=s.ConnectErrorDevice;for(setPieChart(`${u}_state_all`,`${w}台`,w/w,"green","总设备"),setPieChart(`${u}_state_normal`,`${bi}台`,bi/w,"blue","正常运行"),setPieChart(`${u}_state_process`,`${ki}台`,ki/w,"#0099ff","加工中"),setPieChart(`${u}_state_idle`,`${di}台`,di/w,"#cc33ff","闲置中"),setPieChart(`${u}_state_fault`,`${gi}台`,gi/w,"red","故障中"),setPieChart(`${u}_state_error`,`${nr}台`,nr/w,"#ff00cc","连接异常"),ri=s.UseCodeList||[],nt="",h=0,lt=ri.length;h<lt;h++)nt+=`<div style="border:1px solid;padding:5px 10px;margin:3px;border-radius:20%;background:#bfa;font-weight:bold">${ri[h]}</div>`;$(`${u}_dev`).empty().append(nt||'<label style="color:red;font-size:18px">无<\/label>');var tr=s.SingleProcessRate,tt=[],ir=[];for(h=0,lt=tr.length;h<lt;h++)ui=tr[h],tt.push(ui.Code),ir.push((ui.Rate*100).toFixed(2));et={tooltip:{trigger:"axis",formatter:"{a}<br/>{b} : {c}%",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"3%",top:"6%",bottom:"8%",containLabel:!0},xAxis:{type:"category",axisLine:{onZero:!1},data:tt},yAxis:{name:"百分比",type:"value",scale:!0,axisLabel:{show:!0,formatter:"{value}%"}},series:{name:"利用率",type:"bar",areaStyle:{normal:{}},barWidth:"60%",label:{show:!0,position:"top",formatter:"{c}%"},itemStyle:{color:n=>n.value<30?"red":"green"},data:ir},dataZoom:[{type:"inside"},{handleIcon:_handleIcon,handleSize:"80%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}]};echarts.init($(`${u}_bar`)[0]).setOption(et,!0);$(u).off("resize").on("resize",function(){clearTimeout(this.time);this.time=setTimeout(()=>{for(var t=$(this).find(".chart"),n=0,i=t.length;n<i;n++)echarts.init(t[n]).resize()},200)});b=s.ProductionList;const n=b.reduce((n,t)=>`${n}<td class="text-blue">${t.Code}</td>`,""),t=b.reduce((n,t)=>`${n}<td>${t.DayTotal}</td>`,""),i=b.reduce((n,t)=>`${n}<td>${t.DayQualified}</td>`,""),r=b.reduce((n,t)=>`${n}<td>${t.DayUnqualified}</td>`,""),f=b.reduce((n,t)=>`${n}<td>${t.DayQualifiedRate}%</td>`,""),o=b?b.filter(n=>n.DayTotal>0).length:0;$(`${u}_devs`).text(o);$(`${u}_pros`).text(s.DayTotal);$(`${u}_heGes`).text(s.DayQualified);$(`${u}_liePians`).text(s.DayUnqualified);$(`${u}_rates`).text(`${s.DayQualifiedRate}%`);$(`${u}_devOps`).find("td:not(:first)").remove().end().append(n);$(`${u}_proOps`).find("td:not(:first)").remove().end().append(t);$(`${u}_heGeOps`).find("td:not(:first)").remove().end().append(i);$(`${u}_liePianOps`).find("td:not(:first)").remove().end().append(r);$(`${u}_rateOps`).find("td:not(:first)").remove().end().append(f)}else if(i==2){if(v=`${u}_deviceState`,e.errno!=0){dsDivs[t].forEach(n=>{$(`#${n}`).addClass("hi")});$(`${v} .hi`).css("display","none").removeClass("hi");return}rr=`<div id="{0}" class="kb_device_div1 ds" style="display:none;">
                    <div style="height: 33%;position: relative;display: flex;">
                        <div style="width: 35%;position: relative;">
                            <img id="{0}_img" class="kb_img1" src="">
                        </div>
                        <div style="width: 50%;position: relative;">
                            <label id="{0}_code" class="text-blue" style="margin: 0;font-size: 16px;"></label>
                            <br>
                            <label id="{0}_mc" class="" style="margin: 0;white-space: nowrap;color: #f15a22;"></label>
                            <br>
                            <label id="{0}_ws" class="" style="margin: 0;white-space: nowrap;color: #005831;"></label>
                        </div>
                        <div id="{0}_state" style="width: 23px;height: 23px;position: absolute;top: 0;right: 0;/* float: right; */"></div>
                    </div>
                    <div style="top: 2%; height: 65%; position: relative;" id="{0}_detail"></div>
                </div>`;const i=dsDivs[t].length;if(i!==e.len){nt="";ur=Math.abs(e.len-i);for(let r=0;r<ur;r++){const u=`${n}_ds${i+r}`;i<e.len?(dsDivs[t].push(u),nt+=rr.format(u)):i>e.len&&removeArray(dsDivs[t],u)}i<e.len?$(`${v}`).append(nt):i>e.len&&$(`${v} .rm`).remove()}const y=$(`${u} .dsDiv`);y.length>0&&(ot=$(window).height(),$(`${u}`).css("height",`${ot}px`),ot=$(`${u} .kb_border2`).height()>>0,fr=$(`${u} .ttDiv`).height()>>0,$(`${u} .dsDiv`).css("height",`${ot-fr}px`));const o=SortNumberString(s,"Code");let c=o.length;if(!c){dsDivs[t].forEach(n=>{$(`#${n}`).addClass("hi")});$(`${v} .hi`).css("display","none").removeClass("hi");$(v).append('<div class="no-data" style="font:bold 25px/35px 微软雅黑;color:red">无数据<\/div>');return}const a=`${v} .no-data`;$(a).length>0&&$(a).remove();fi=n=>{function it(n,t,i){var u,o,r;let e="";const f=t-1;if(n.length>0){const h=Math.max.apply(null,n.map(n=>n.Order))+1,s=Math.floor(h/f);if(t==2)for(u=0;u<s;u++){let i="";const t=n.filter(n=>n.Order==u+1);if(t.length){for(r=0;r<f;r++)if(!isStrEmptyOrUndefined(t[r].VName)){i=t[r].VName;break}let n=!1;const u=t.reduce((t,i,r)=>(isStrEmptyOrUndefined(i.V)||(n=!0),r==0?`${t}${i.V}`:`${t}${n?i.Delimiter:""}${i.V}`),"");e+=`<div class="form-group no-margin" style="height:calc(100%/6);">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-margin text-blue no-padding kb_param1">
                                                <label class=" control-label no-margin text-blue no-padding">${i}</label>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 no-margin text-blue no-padding kb_param1">
                                                <label class="control-label no-margin text-blue no-padding">${u}</label>
                                            </div>
                                        </div>`}}else if(t>2){let h="";for(u=0;u<s;u++){let t="";o=f*u+1;let i="";for(r=0;r<f;r++){const u=n.filter(n=>n.Order==o+r);if(u.length>0&&!isStrEmptyOrUndefined(u[0].VName)){i=u[0].VName;t+=`<td><label class="control-label no-margin text-blue no-padding">${i}</label></td>`;break}}for(i===""&&(t+=`<td><label class="control-label no-margin text-blue no-padding">${i}</label></td>`),r=0;r<f;r++){const i=n.filter(n=>n.Order==o+r);let u="";if(i.length>0){let n=!1;u=i.reduce((t,i,r)=>(isStrEmptyOrUndefined(i.V)||(n=!0),r==0?`${t}${i.V}`:`${t}${n?i.Delimiter:""}${i.V}`),"")}t+=`<td><label class="control-label no-margin text-blue no-padding">${u}</label></td>`}h+=`<tr>
                                    ${t}
                                </tr>`}e=`<table border="0" cellspacing="0" cellpadding="0" style="width:100%;">
                                <thead>
                                    <tr>
                                        ${i.reduce((n,i)=>`${n}<th style="width:calc(100%/${t})"><label class="control-label no-margin no-padding">${i}</label></th>`,"")}
                                    </tr>
                                </thead>
                                    ${h}
                                <tbody>
                                </tbody>
                            </table>`}}return e}var l,a,f,s;if(n)for(c=n.length,h=0;h<c;h++)l=n[h],dsPaths[t][l.name]||(dsPaths[t][l.name]=l.path);const tt=Object.keys(dsPaths[t]).length;if(!(tt<=0)){for(a=[],o.forEach(n=>a[n.Id]=1),h=0;h<i;h++){const n=`${u}_ds${h}`;if(f=o[h],f){s="red";switch(f.DeviceStateStr){case"加工中":s="#00A65C";break;case"准备中":s="#ffd400";break;case"待机":case"流程升级中":case"固件升级中":case"设备重启中":case"连接正常":s="#f47920";break;case"已报修":case"已确认":case"维修中":s="red";break;default:s="gray"}const i=it(f.Data,e.cCol,e.cName);$(`${n}_img`).attr("src",dsPaths[t][f.Icon]);$(`${n}_code`).text(f.Code);$(`${n}_mc`).text(`${f.CategoryName}-${f.ModelName}`);$(`${n}_ws`).text(f.SiteName);$(`${n}_state`).css("background",s);$(`${n}_detail`).html(i);$(`${n}`).addClass("sh")}else $(`${n}`).addClass("hi")}$(`${v} .sh`).css("display","block").removeClass("sh");$(`${v} .hi`).css("display","none").removeClass("hi");$(`${u}_jg`).text(e.jg);$(`${u}_zb`).text(e.zb);$(`${u}_xz`).text(e.xz);$(`${u}_zc`).text(e.zc);$(`${u}_gz`).text(e.gz);$(`${u}_wlj`).text(e.wlj);$(`${u}_sum`).text(e.sum);var y=$(".ds"),p=y.length>0?($(y[0]).css("margin").replace("px","")>>0)*2:5,rt=($(v).css("padding").replace("px","")>>0)*2;if(e.row>0){var w=$(v).width(),b=Math.floor(w/(def+p)),ut=e.col>b?b:e.col,k=Math.floor(w/ut)-p,ft=$(window).height();$(`${u}`).css("height",`${ft}px`);var d=$(v).closest(".dsDiv").height(),g=Math.floor(d/def),et=e.row>g?g:e.row,nt=Math.floor(d/et)-rt;$(".ds").css("flex-basis",`${k<def?def:k}px`).css("height",`${nt<def?def:nt}px`)}r&&(page[t]=++e.cp)}};const l=[];for(h=0;h<c;h++)at=o[h],dsPaths[t][at.Icon]||~l.lastIndexOf(at.Icon)||l.push(at.Icon);if(l.length>0){f={type:fileEnum.Device,files:JSON.stringify(l)};f.dir="";for(ei in fileEnum)if(fileEnum[ei]==f.type){f.dir=ei;break}if(isStrEmptyOrUndefined(f.dir))return void layer.msg("文件类型不存在！");getFilePath(f,fi,0)}else fi()}else if(i==3){if(e.errno!=0)return;if(!e.data)return;var s=e.data,lr=e.colSet?JSON.parse(e.colSet):[],ar=`${u}_productDiv`,ot=$(window).height(),vr=$(`${u} .kb_title1`).closest("div").height()>>0;for($(`${ar}`).css("height",`${ot-vr}px`),vt=0,er=e.items.length;vt<er;vt++){const t=e.items[vt],b=t.Item,r=kanBanItems[i][b],v=lr[t.Col].chose[t.Order];if(t&&r&&v){const nt=r.FieldList?r.FieldList:[],f=[];nt.forEach(n=>{f[n.Field]=n});const ut=t.FieldList?t.FieldList:[],h=ut.filter(n=>n.Order).sort(firstBy("Order")),w=[];if(h.forEach(n=>{w[n.Field]=n}),h&&h.length){const lt=h.filter(n=>n.Field==trFlag);lt.length||h.unshift({Order:0,Column:"序号",Field:trFlag,Width:xvHaoTdWidth});const ft=`${t.Item}_${t.Col}_${t.Order}`,i=`${u}_${t.Col}_${t.Order}`,ot=$(`${i}`).closest(".kb_border2").height(),at=$(`${i}`).closest(".kb_border2").width(),vt=$(`${i}`).closest(".kb_border2").find("h4").height(),e=ot-vt;if($(`${i}`).closest(".table-responsive").css("height",`${Math.floor(e*100/ot)}%`),$(`${i}`).closest(".kb_border2").find(".tt1").text(v.name),!s.hasOwnProperty(ft))continue;if(o=s[ft],st=0,r.Display==0){c=0;l=7;t.ConfigList&&t.ConfigList[c]&&t.ConfigList[c].length>l&&(st=t.ConfigList[c][l]);const s=v.dOrder=="0"?"asc":"desc";o=o.sort(firstBy(v.dField,s));$(`${i}`).closest(".kb_border2").find(".tt2").text(`(${o.length})`);addOrderData(o);let u=$(`${i} tbody tr`);if(u.length){const n=$(`${i} tr.max`),c=$(n).attr(trFlag)>>0;let e=!1;if(u.each((n,t)=>{const i=$(t).attr(trFlag),r=o.filter(n=>n[trFlag]==i);r.length||($(t).remove(),e=!0)}),e&&u.length>0&&(u=$(`${i} tbody tr`),y=[],u.each((n,t)=>{var i=$(t).attr(trFlag)>>0;y[i]=t}),a=Object.values(y),a.forEach((n,t)=>{$(n).attr(trFlag,t+1);var i="";(s=="asc"&&o.length==t+1||s=="desc"&&t==0)&&(i=`max`,$(n).addClass(i))}),u=$(`${i} tbody tr`)),!e){const i=o.length-u.length;if(o.length>u.length){n.removeClass("max");let f=[];f=s=="asc"?sliceArray(o,i,u.length):sliceArray(o,i,0);const e=getItemTrs(f,r,t,s);s=="asc"?n.after(e):n.before(e)}let e=[];e=s=="asc"?sliceArray(o,u.length,0):sliceArray(o,o.length,i);y=[];u.each((n,t)=>{var i=$(t).attr(trFlag)>>0;y[i]=t});a=Object.values(y);a.length&&a.forEach((n,t)=>{var i,a,c;const l=e[t],r=$(n);for(i=0,a=h.length;i<a;i++){const n=h[i];var s=l[n.Field],v=n.Pre?n.Pre:"",y=n.Suffix?n.Suffix:"",p=n.Width&&n.Width!=="auto"?`width: ${n.Width}px;`:`width: auto;`,o="",u="";if(f[n.Field]&&n.Func){const t=JSON.parse(n.Func);if(t.color==1?u=n.Color:t.color==2&&t.cons.every(n=>meetCondition(s,n.con,n.conv)?(u=n.color,!1):!0),t.special){const i=f[n.Field].DataType;s=FieldFunc[i][t.special].func(s)}t.bold&&(o="text-bold")}u=u?`color: ${u};`:`color: "";`;const t=l[trFlag],e=`${v}${s}${y}`,a=r.attr(trFlag)>>0,w=r.find(`td:nth-child(${i+1})`).text();a!=t&&r.attr(trFlag,t);w!=e&&r.find(`td:nth-child(${i+1})`).html(e);c=r.find(`td:nth-child(${i+1})`).hasClass("text-bold");o&&!c?r.find(`td:nth-child(${i+1})`).addClass(o):!o&&c&&r.find(`td:nth-child(${i+1})`).removeClass(o);r.find(`td:nth-child(${i+1})`).attr("style",p);r.find(`td:nth-child(${i+1})`).attr("style",u)}})}}else o.length&&$(`${i} tbody`).html(getItemTrs(o,r,t,s));yt=$(`${i} tr`).height();pt=e-$(`${i} tbody`).closest(".kb_item_tablebox").css("padding").replace("px","")*2;u=$(`${i} tbody tr`);it=Math.floor(pt/yt)-1;const p=`${n}_${t.Col}_${t.Order}_timer`;u.length>it&&!kanBanProductItemsEl[p]?scrollTable(kanBanProductItemsEl,p,`${n}_${t.Col}_${t.Order}`):u.length<=it&&(wt=getItemTrs(o,r,t,s),$(`${i} tbody`).html(wt),st==0&&kanBanProductItemsEl[p]?stopTableEffect(kanBanProductItemsEl,p,`${n}_${t.Col}_${t.Order}`):st==1&&console.log("turn"+t.Item))}else if(r.Display==1){if(!o.length)continue;if(!h.length)continue;g=h[0];p="";switch(r.DisplayType){case 0:p="line";break;case 1:p="bar";break;case 2:p="pie"}if(isStrEmptyOrUndefined(p))continue;if(oi=nt.filter(n=>n.Axis==0),!oi.length)continue;bt=oi[0];kt=bt.Field;const n=v.dOrder=="0"?"asc":"desc";if(o=o.sort(firstBy(v.dField,n)),si=ut.filter(n=>n.Field==kt),!si.length)continue;var ht=si[0],hi=null,or=null,ci=null,dt=0,sr=0,hr=0;if(~its.indexOf(b)&&ht.Func){const n=JSON.parse(ht.Func);n.special&&(hi=FieldFunc[bt.DataType][n.special].func,or=1,t.ConfigList&&(c=0,t.ConfigList.length>c&&(l=1,t.ConfigList[c].length>l&&(dt=t.ConfigList[c][l]),ci=timeTypes[dt],l=4,t.ConfigList[c].length>l&&(sr=t.ConfigList[c][l]),l=5,t.ConfigList[c].length>l&&(hr=t.ConfigList[c][l]))))}var tt=distinct(o.map(n=>hi?hi(n[kt],or):n[kt])),k=[],d=distinct(o.map(n=>n.Data).filter(n=>n));sr?(li=CompareTimeFunc[timeTypes[dt]][timeTypes[hr]].func,gt=distinct(o.map(n=>li(n[ht.Field],1)).filter(n=>n)),d.length?gt.forEach(n=>{var t=o.filter(t=>CompareTimeFunc[timeTypes[dt]][special].func(t[ht.Field])==n).map(n=>n[g.Field]);k.push({name:n,type:p,label:{show:!0,position:"top",fontWeight:"bold",fontSize:14},lineStyle:{width:3},data:t})}):gt.forEach(n=>{var t=o.filter(t=>li(t[ht.Field],1)==n).map(n=>n[g.Field]);k.push({name:n,type:p,label:{show:!0,position:"top",fontWeight:"bold",fontSize:14},lineStyle:{width:3},data:t})}),d=gt):d.length?d.forEach(n=>{var t=o.filter(t=>t.Data==n).map(n=>n[g.Field]);k.push({name:n,type:p,label:{show:!0,position:"top",fontWeight:"bold",fontSize:14},lineStyle:{width:3},data:t})}):(cr=o.map(n=>n[g.Field]),k.push({type:p,label:{show:!0,position:"top",fontWeight:"bold",fontSize:14},lineStyle:{width:3},data:cr}));et={tooltip:{trigger:"axis"},grid:{left:"3%",right:"6%",bottom:"3%",containLabel:!0},color:["#00a65a","red","#ff00ff","#cc3300","#ff9900","#9933ff","blue","#0099ff","#6135066"],xAxis:{name:ci?ci:bt.Field,nameTextStyle:{color:"white",fontWeight:"bold",fontSize:14},type:"category",boundaryGap:!1,data:tt,axisLine:{lineStyle:{color:"white",fontWeight:"bold",fontSize:19}}},yAxis:{name:g?g.Column:"",nameTextStyle:{color:"white",fontWeight:"bold",fontSize:14},type:"value",axisLine:{lineStyle:{color:"white",fontWeight:"bold",fontSize:16}}},legend:{icon:"circle",data:d,textStyle:{color:"white",fontWeight:"bold",fontSize:16}},series:k};pTableOrChart[i]?(ct=!1,isEqual(pTableOrChart[i].lData,d)||(ct=!0),isEqual(pTableOrChart[i].xData,tt)||(ct=!0),isEqual(pTableOrChart[i].series,k)||(ct=!0),ct&&(pTableOrChart[i].chart.setOption(et,!0),pTableOrChart[i].lData=d,pTableOrChart[i].xData=tt,pTableOrChart[i].series=k)):(pTableOrChart[i]={lData:d,xData:tt,series:k,chart:echarts.init($(i)[0])},pTableOrChart[i].chart.setOption(et,!0),$(i).resize(function(){for(var n in pTableOrChart){const t=pTableOrChart[n];t.chart&&t.chart.resize()}}))}else if(r.Display==2){c=0;l=7;t.ConfigList&&t.ConfigList[c]&&t.ConfigList[c].length>l&&(st=t.ConfigList[c][l]);const u=v.dOrder=="0"?"asc":"desc";o=o.sort(firstBy(v.dField,u));var yr=at-xvHaoTdWidth-$(`${i} tbody`).closest(".kb_item_tablebox").css("padding").replace("px","")*2,rt=Math.floor(yr/trackTdWidth)+1,pr=getTrackHead(i,rt,f,w);$(`${i}`).closest(".kb_border2").find(".tt2").text(`(${o.length})`);addOrderData(o);let r=$(`${i} tbody tr`);if(!r.length||pr)o.length&&$(`${i} tbody`).html(getTrackTrs(rt,o,f,w,u));else{const n=$(`${i} tr.max`),e=$(n).attr(trFlag)>>0;let t=!1;if(r.each((n,i)=>{const r=$(i).attr(trFlag),u=o.filter(n=>n[trFlag]==r);u.length||($(i).remove(),t=!0)}),t&&r.length>0&&(r=$(`${i} tbody tr`),y=[],r.each((n,t)=>{var i=$(t).attr(trFlag)>>0;y[i]=t}),a=Object.values(y),a.forEach((n,t)=>{$(n).attr(trFlag,t+1);var i="";(u=="asc"&&o.length==t+1||u=="desc"&&t==0)&&(i=`max`,$(n).addClass(i))}),r=$(`${i} tbody tr`)),!t){const t=o.length-r.length;if(o.length>r.length){n.removeClass("max");let i=[];i=u=="asc"?sliceArray(o,t,r.length):sliceArray(o,t,0);const e=getTrackTrs(rt,i,f,w,u);u=="asc"?n.after(e):n.before(e)}let i=[];i=u=="asc"?sliceArray(o,r.length,0):sliceArray(o,o.length,t);y=[];r.each((n,t)=>{var i=$(t).attr(trFlag)>>0;y[i]=t});a=Object.values(y);a.length&&a.forEach((n,t)=>{var r,h;const e=i[t];var o=[e].concat(e.FenKas),s=rt-2,c=s-o.length;o.length>s&&(o=sliceArray(o,o.length,-c));const u=$(n);for(r=0;r<rt;r++)if(r==0){const n=e[trFlag],t=e[trFlag],i=u.attr(trFlag)>>0,f=u.find(`td:nth-child(${r+1})`).text();i!=n&&u.attr(trFlag,n);f!=t&&u.find(`td:nth-child(${r+1})`).html(t)}else if(r==1){h=["Creator","Time","Production","FlowCard","FlowCards"];const n=h.reduce((n,t)=>{var u=f[t],r=w[t],o,i;return!r||!u||!u.Required&&!r.Order?n:(o=t=="FlowCards"?e[t].join("<br>"):e[t],i=getDataSet(o,f,r),n+`<p class="${i.bold} text-wrap" style="${i.width}${i.color}">${i.pre}${i.d}${i.suffix}</p>`)},""),t=u.find(`td:nth-child(${r+1})`).html();t!=n&&u.find(`td:nth-child(${r+1})`).html(n)}else{const t=o[r-2],n=getTrackContent(t,f,w),i=u.find(`td:nth-child(${r+1})`).html();i!=n&&u.find(`td:nth-child(${r+1})`).html(n)}})}}yt=$(`${i} tbody tr`).height();pt=e-$(`${i} tbody`).closest(".kb_item_tablebox").css("padding").replace("px","")*2;r=$(`${i} tbody tr`);it=Math.floor(pt/yt)-1;const s=`${n}_${t.Col}_${t.Order}_timer`;r.length>it&&!kanBanProductItemsEl[s]?scrollTable(kanBanProductItemsEl,s,`${n}_${t.Col}_${t.Order}`):r.length<=it&&(wt=getTrackTrs(rt,o,f,w,u),$(`${i} tbody`).html(wt),kanBanProductItemsEl[s]&&stopTableEffect(kanBanProductItemsEl,s,`${n}_${t.Col}_${t.Order}`))}}}}}},0)}}function getItemTrs(n,t,i,r){const u=[];t.FieldList&&t.FieldList.forEach(n=>{u[n.Field]=n});const f=i.FieldList?i.FieldList.filter(n=>n.Order):[],e=f.filter(n=>n.Field=="XvHao");return e.length||f.unshift({Order:0,Column:"序号",Field:trFlag,Width:xvHaoTdWidth}),n.reduce((t,i,e)=>{const s=f.reduce((n,t,r)=>{var e=i[t.Field],h=t.Pre?t.Pre:"",c=t.Suffix?t.Suffix:"",l=t.Width&&t.Width!=="auto"?`width: ${t.Width}px;`:`width: auto;`,o="",f="",r,s;if(u[t.Field]&&t.Func){const n=JSON.parse(t.Func);if(n.color==1)f=t.Color;else if(n.color==2)for(r=0,s=n.cons.length;r<s;r++){const t=n.cons[r];if(meetCondition(e,t.con,t.conv)){f=t.color;break}}if(n.special){const i=u[t.Field].DataType;e=FieldFunc[i][n.special].func(e)}n.bold&&(o="text-bold")}return f=f?`color: ${f};`:``,n+`<td class="${o}" style='${l}${f}'>${h}${e}${c}</td>`},"");var o="";return(r=="asc"&&n.length==e+1||r=="desc"&&e==0)&&(o=` class="max"`),t+`<tr${o} ${trFlag}=${i[trFlag]}>${s}</tr>`},"")}function getTrackHead(n,t,i,r){var h=$(`${n} thead>tr:first>th`).length,o,e,f,s,u;if(h==t)return!1;for(o=["序号","流程卡"],e=0;e<t-2;e++)o.push(e+1);if((f="FlowCard",!i[f])||(s=i[f],!r[f]))return!1;u=r[f];const c=o.reduce((n,t,r)=>{var e=u.Width&&u.Width!=="auto"?`width: ${u.Width}px;`:`width: auto;`,o="",f="",r,h;if(r==0)e=`width: ${xvHaoTdWidth}px;`;else{if(s&&u.Func){const n=JSON.parse(u.Func);if(n.color==1)f=u.Color;else if(n.color==2)for(r=0,h=n.cons.length;r<h;r++){const i=n.cons[r];if(meetCondition(t,i.con,i.conv)){f=i.color;break}}if(n.special){const r=i[u.Field].DataType;t=FieldFunc[r][n.special].func(t)}n.bold&&(o="text-bold")}f=f?`color: ${f};`:``}return n+`<th class="${o}" style='${e}${f}'>${t}</th>`},"");return $(`${n} thead>tr:first`).html(c),!0}function getTrackTrs(n,t,i,r,u){return t.reduce((f,e,o)=>{var v=["Creator","Time","Production","FlowCard","FlowCards"].reduce((n,t)=>{var o=i[t],f=r[t],s,u;return!f||!o||!o.Required&&!f.Order?n:(s=t=="FlowCards"?e[t].join("<br>"):e[t],u=getDataSet(s,i,f),n+`<p class="${u.bold} text-wrap" style='${u.width}${u.color}'>${u.pre}${u.d}${u.suffix}</p>`)},""),h=`<td>${e[trFlag]}</td>
                    <td class="kb_step_div1">${v}</td>`,s=[e].concat(e.FenKas),a=n-2,c=a-s.length,l;return s.length>a&&(s=sliceArray(s,s.length,-c)),h+=s.reduce((n,t)=>n+minimize(`<td class="kb_step_div1">
                        ${getTrackContent(t,i,r)}
                </td>`),""),c>0&&(h+=`<td class="kb_step_div1"></td>`.repeat(c)),l="",(u=="asc"&&t.length==o+1||u=="desc"&&o==0)&&(l=" max"),f+`<tr class="kb_step_tr1${l}" ${trFlag}=${e[trFlag]}>${h}</tr>`},"")}function getDataSet(n,t,i){var o=i&&i.Pre?i.Pre:"",s=i&&i.Suffix?i.Suffix:"",h=i&&i.Width&&i.Width!=="auto"?`width: ${i.Width}px;`:`width: auto;`,f="",r="",u,e;if(i&&t[i.Field]&&i.Func){const o=JSON.parse(i.Func);if(o.color==1)r=i.Color;else if(o.color==2)for(u=0,e=o.cons.length;u<e;u++){const t=o.cons[u];if(meetCondition(n,t.con,t.conv)){r=t.color;break}}else o.color==3&&o.cons&&o.cons.length&&(r=o.cons[0].color);if(o.special){const r=t[i.Field].DataType;n=FieldFunc[r][o.special].func(n,1)}o.bold&&(f="text-bold")}return r=r?`color: ${r};`:``,{xvHao:i[trFlag],d:n,pre:o,suffix:s,width:h,bold:f,color:r}}function getTrackContent(n,t,i){var y="",b,o,h,l,c,s;if(!n)return y;var r="StepName",u=n[r],f=i[r],e=getDataSet(u,t,f);r="IsPart";b=n[r];r="Processor";u=n[r];f=i[r];o=getDataSet(u,t,f);r="Total";u=n[r];f=i[r];h=getDataSet(u,t,f);r="Qualified";u=n[r];f=i[r];l=getDataSet(u,t,f);r="Unqualified";u=n[r];f=i[r];var a=getDataSet(u,t,f),p="QualifiedRate",w="UnqualifiedRate",v=null;i[p]?(r=p,u=n[r],f=i[r],v=getDataSet(u,t,f)):i[w]&&(r=w,u=n[r],f=i[r],v=getDataSet(u,t,f));p="StartTime";w="EndTime";c=null;i[p]?(r=p,u=n[r],f=i[r],c=getDataSet(u,t,f)):i[w]&&(r=w,u=n[r],f=i[r],c=getDataSet(u,t,f));r="CostTime";u=n[r];f=i[r];s=getDataSet(u,t,f);switch(n.State){case 0:y=`<div class="kb_step_wait_div">
                    <p class="no-margin ${e.bold}" style="${e.width}${e.color}">
                        ${e.pre}${e.d}${e.suffix}
                        ${b?`<span style="font-size: 1.8rem;color:red;">*</span>`:""}
                    </p>
                    <p class="no-margin ${o.bold}" style="font-size: 1.8rem;${o.width}${o.color}">
                        ${o.pre}${o.d}${o.suffix}
                    </p>
                    <p class="no-margin ${e.bold}" style="font-size: 1.8rem;${h.width}${h.color}">
                        <span style="font-size: 1.8rem;${h.width}${h.color}">${h.pre}${h.d}${h.suffix}</span>
                        /<span style="font-size: 1.8rem;${l.width}${l.color}">${l.pre}-${l.suffix}</span>
                        /<span style="font-size: 1.8rem;${a.width}${a.color}">${a.pre}-${a.suffix}</span>
                    </p>
                    <p class="no-margin ${s.bold}" style="font-size: 1.8rem;${s.width}${s.color}">
                        ${s.pre}${s.d}${s.suffix}
                    </p>
                </div>`;break;case 1:y=`<div class="kb_step_doing_div">
                    <p class="no-margin ${e.bold}" style='${e.width}${e.color}'>
                        ${e.pre}${e.d}${e.suffix}
                        ${b?`<span style="font-size: 1.8rem;color:red;">*</span>`:""}
                    </p>
                    <p class="no-margin ${o.bold}" style="font-size: 1.8rem;${o.width}${o.color}">
                        ${o.pre}${o.d}${o.suffix}
                    </p>
                    <p class="no-margin" style="font-size: 1.8rem;">
                        <span style="font-size: 1.8rem;${h.width}${h.color}">${h.pre}${h.d}${h.suffix}</span>
                        /<span style="font-size: 1.8rem;${l.width}${l.color}">${l.pre}-${l.suffix}</span>
                        /<span style="font-size: 1.8rem;${a.width}${a.color}">${a.pre}-${a.suffix}</span>
                    </p>
                        ${c?`<p class="no-margin ${c.bold}" style="font-size: 1.8rem;${c.width}${c.color}">
                        ${c.pre}${c.d}${c.suffix}
                    </p>`:""}
                    <p class="no-margin ${s.bold}" style="font-size: 1.8rem;${s.width}${s.color}">
                        ${s.pre}${s.d}${s.suffix}
                    </p>
                </div>`;break;case 2:y=`<div class="kb_step_done_div">
                    <p class="no-margin ${e.bold}" style="${e.width}${e.color}">
                        ${e.pre}${e.d}${e.suffix}
                        ${b?`<span style="font-size: 1.8rem;color:red;">*</span>`:""}
                    </p>
                    <p class="no-margin ${o.bold}" style="font-size: 1.8rem;${o.width}${o.color}">
                        ${o.pre}${o.d}${o.suffix}
                    </p>
                    <p class="no-margin" style="font-size: 1.8rem;">
                        <span style="font-size: 1.8rem;${h.width}${h.color}">${h.pre}${h.d}${h.suffix}</span>
                        /<span style="font-size: 1.8rem;${l.width}${l.color}">${l.pre}${l.d}${l.suffix}</span>
                        /<span style="font-size: 1.8rem;${a.width}${a.color}">${a.pre}${a.d}${a.suffix}</span>
                        ${v?`(<span style="font-size: 1.8rem;${v.width}${v.color}">${v.pre}${v.d}%${v.suffix}</span>)`:""}
                    </p>
                    ${c?`<p class="no-margin ${c.bold}" style="font-size: 1.8rem;${c.width}${c.color}">
                        ${c.pre}${c.d}${c.suffix}
                    </p>`:""}
                    <p class="no-margin ${s.bold}" style="font-size: 1.8rem;${s.width}${s.color}">
                        ${s.pre}${s.d}${s.suffix}
                    </p>
                </div>`}return minimize(y)}function setPieChart(n,t,i,r,u){i=i||0;var e=`${(i*100).toFixed(2)}%`,f={color:["#cdcdcd",r],series:{type:"pie",center:["50%","50%"],radius:["65%","100%"],hoverAnimation:!1,animation:!1,silent:!0,label:{show:!0,position:"center",formatter:`${t}
${e}`,textStyle:{color:r,fontSize:18,fontWeight:700}},data:[1-i,i]}};return u&&(f.title={text:u,left:"center",textStyle:{color:r,fontSize:16}},f.series.center=["50%","57%"],f.series.radius=["57%","85%"]),echarts.init($(n)[0]).setOption(f,!0),e}var def=175,curId=-1,t=0,uiTime=0,dataTime=0,run=!1,page=[],timeEl="",dsDivs=[],dsPaths=[],carouselTmp=[],carouselChose=[],carouselIndex=0,carouselId=0,carouselTime=0,carouselFlag="",xvHaoTdWidth=60,trackTdWidth=150,scriptIndexTmp=[],scriptTmp=[],kanBans=[],kanBanItems=[],shifts=[],kanBanItemsTmp=[],trFlag="XvHao",its,workshopId,workshopTmp,stepTmp,deviceTmp,processorTmp,_carouselBox,_dataTableData,tt,tn,pTableOrChart;$(document).on("keydown",function(n){n.keyCode==27&&($(".content").find(".fullScreenBtn.fsb").click(),cancelFullScreenCarousel&&cancelFullScreenCarousel())});var kanBanProductItemsEl=[],kanBanProductItemsTables=[],tableSet=tableDefault(),_permissionList=[];let colName=[];let colSet=[];its=[9,10,11];workshopId=0;workshopTmp=[];stepTmp=[];processorTmp=[];deviceTmp=[];processorTmp=[];_dataTableData={};let checkMouseMove;pTableOrChart=[];