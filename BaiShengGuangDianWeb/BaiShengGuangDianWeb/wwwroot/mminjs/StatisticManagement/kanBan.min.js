function pageReady(){getBoardData()}function getBoardData(){var t=504,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var nt,tt,it,rt,ut,l,t,ft,et,y,r,u,a,e,p,o,v,ot,s,w,st,ht,h,b,k,ct,lt,c,d,g,at;if(n.errno!=0){layer.msg(n.errmsg);return}if(!isStrEmptyOrUndefined(n.data)){var i=[],f=[],vt=n.data.AllDevice+",总设备";for(i.push(vt),nt=n.data.NormalDevice+",正常运行",i.push(nt),tt=n.data.ProcessDevice+",加工中",i.push(tt),it=n.data.IdleDevice+",闲置中",i.push(it),rt=n.data.FaultDevice+",故障中",i.push(rt),ut=n.data.ConnectErrorDevice+",连接异常",i.push(ut),$("#deviceChart").empty(),l=["green","blue","#0099ff","#cc33ff","red","#ff00cc"],t=0;t<i.length;t++)$("#deviceChart").append('<div class="col-sm-2" style="width: 32%; height: 170px; display: -webkit-inline-box; margin: 0; padding: 0;" id="deviceChart'+t+'"><\/div>'),f[t]={value:i[t].slice(0,i[t].indexOf(",")),name:i[t].slice(i[t].indexOf(",")+1)},ft=echarts.init(document.getElementById("deviceChart"+t)),et={title:{text:f[t].name,left:"center",textStyle:{color:l[t],fontSize:16}},tooltip:{trigger:"item",formatter:"{a}<br/>{b} : {c}台 ({d}%)"},color:["#cdcdcd",l[t]],series:[{name:"设备状态",type:"pie",radius:["57%","85%"],center:["50%","57%"],animationDuration:0,hoverAnimation:!1,silent:!0,label:{normal:{show:!0,position:"center",formatter:f[t].value+"台\n"+(f[t].value/n.data.AllDevice*100).toFixed(2)+"%",textStyle:{color:l[t],fontSize:18,fontWeight:700}}},data:[{value:n.data.AllDevice-parseInt(i[t].slice(0,i[t].indexOf(","))),name:"其他台数"},f[t]]}]},ft.setOption(et,!0);y=n.data.SingleProcessRate;y.sort(function(n,t){return n.Id>t.Id?1:-1});r=[];u=[];$.each(y,function(n,t){r.push(t.Code);u.push((t.Rate*100).toFixed(2))});$("#codeRateChart").empty();$("#codeRateChart").append('<div style="width: 100%; height: 488px" id="codeRate"><\/div>');a=echarts.init(document.getElementById("codeRate"));e={title:{text:"单台加工利用率"},tooltip:{trigger:"axis",formatter:"{a}<br/>{b} : {c}%"},xAxis:{type:"category",axisLabel:{rotate:40,textStyle:{fontSize:12}},axisLine:{onZero:!1},data:function(){for(var n=[],t=0;t<r.length;t++)if(n.length!=20)n.push(r[t]);else break;return n}()},yAxis:{name:"百分比",type:"value",scale:!0,axisLabel:{show:!0,formatter:"{value} %"}},series:[{name:"利用率",type:"bar",areaStyle:{normal:{}},label:{normal:{show:!0,position:"top",formatter:"{c}%"}},itemStyle:{normal:{color:function(n){return n.data<30?"red":"green"}}},data:function(){for(var n=[],t=0;t<u.length;t++)if(n.length!=20)n.push(u[t]);else break;return n}()}]};a.setOption(e,!0);r.length>20&&(o=19,v=19,p=setInterval(function(){for(var n,i,t=e.series[0].data,f=0;f<20;f++)t.shift(),o++,isStrEmptyOrUndefined(u[o])&&u[o]!=0?t.push(""):t.push(u[o]);for(n=e.xAxis.data,i=0;i<20;i++)n.shift(),v++,isStrEmptyOrUndefined(r[v])?n.push(""):n.push(r[v]);a.setOption(e,!0);(n[n.length-1]==r[r.length-1]||isStrEmptyOrUndefined(n[n.length-1]))&&(clearInterval(p),setTimeout(getBoardData,4e3))},5e3));r.length<=20&&(clearInterval(p),setTimeout(getBoardData,4e3));ot=n.data.UseCodeList;$("#codeRateChart").append('<div style="width:100%;height:77px"><span style="font-size:18px;font-weight:bold;margin-left:5px">当前加工设备：<\/span><br><pre id="useList" style="font-size:18px;font-weight:bold;color:blue;""><\/pre><\/div>');$.each(ot,function(n,t){$("#useList").append("<span style='margin-left:10px'>"+t+"<\/span>")});s=n.data.AllProcessRate;$("#codeTimeList").empty();$("#codeTimeList").append('<div id="codeRates" style="float: left;width: 40%;height: 140px;"><\/div><pre id = "codeTime" style = "width: 60%; float: left;font-size: 15px;line-height: 25px;font-weight:bold;font-family:"微软雅黑""><\/pre>');w=echarts.init(document.getElementById("codeRates"));st={tooltip:{trigger:"item",formatter:"{a}<br/>{b} : {c}台 ({d}%)"},color:["#cdcdcd","#0099ff"],series:[{name:"总利用率",type:"pie",center:["50%","50%"],radius:["65%","98%"],hoverAnimation:!1,animation:!1,silent:!0,label:{normal:{show:!0,position:"center",formatter:"Rate\n"+(s*100).toFixed(2)+"%",textStyle:{color:"#0099ff",fontSize:18,fontWeight:700}}},data:[{value:1-s,name:"其他利用率"},{value:s,name:"所有利用率"}]}]};w.setOption(st,!0);$("#codeTime").empty();$("#codeTime").append("<div>运行时间：<span class='par'>"+codeTime(n.data.RunTime)+"<\/span><\/div>");$("#codeTime").append("<div>加工时间：<span class='par'>"+codeTime(n.data.ProcessTime)+"<\/span><\/div>");$("#codeTime").append("<div>闲置时间：<span class='par'>"+codeTime(n.data.IdleTime)+"<\/span><\/div>");$("#codeTime").append("<div>所有利用率：<span class='par'>"+(s*100).toFixed(2)+"%<\/span><\/div>");$("#maxList").empty();$("#maxList").append('<div id="maxChart" style="float: left;width: 40%;height: 140px;"><\/div><pre id = "maxDevice" style = "width: 60%; float: left;font-size: 15px;line-height: 40px;font-weight:bold;margin-top:-3px;font-family:"微软雅黑""><\/pre>');$("#maxDevice").empty();ht=n.data.MaxSimultaneousUseRate;$("#maxDevice").append("<div>日最大同时使用台数：<span class='par'>"+ht+"台<\/span><\/div>");h=n.data.MaxUse;$("#maxDevice").append("<div>日最大使用台数：<span class='par'>"+h+"台<\/span><\/div>");b=n.data.MaxUseRate;$("#maxDevice").append("<div>日最大使用率：<span class='par'>"+(b*100).toFixed(2)+"%<\/span><\/div>");k=echarts.init(document.getElementById("maxChart"));ct={tooltip:{trigger:"item",formatter:"{a}<br/>{b} : {c}台 ({d}%)"},color:["#cdcdcd","#0099ff"],series:[{name:"设备状态",type:"pie",radius:["67%","100%"],center:["50%","50%"],animationDuration:0,hoverAnimation:!1,silent:!0,label:{normal:{show:!0,position:"center",formatter:"Max\n"+h+"台\n"+(b*100).toFixed(2)+"%",textStyle:{color:"#0099ff",fontSize:13}}},data:[{value:n.data.AllDevice-h,name:"其他台数"},{value:h,name:"日最大使用台数"}]}]};k.setOption(ct,!0);$("#minList").empty();$("#minList").append('<div id="minChart" style="float: left;width: 40%;height: 140px;"><\/div><pre id = "minDevice" style = "width: 60%; float: left;font-size: 15px;line-height: 40px;font-weight:bold;margin-top:-3px;font-family:"微软雅黑""><\/pre>');$("pre").css("backgroundColor","white").css("border",0);$("#minDevice").empty();lt=n.data.MinSimultaneousUseRate;$("#minDevice").append("<div>日最小同时使用台数：<span class='par'>"+lt+"台<\/span><\/div>");c=n.data.MinUse;$("#minDevice").append("<div>日最小使用台数：<span class='par'>"+c+"台<\/span><\/div>");d=n.data.MinUseRate;$("#minDevice").append("<div>日最小使用率：<span class='par'>"+(d*100).toFixed(2)+"%<\/span><\/div>");$(".par").css("fontSize",24).css("color","blue");g=echarts.init(document.getElementById("minChart"));at={tooltip:{trigger:"item",formatter:"{a}<br/>{b} : {c}台 ({d}%)"},color:["#cdcdcd","#0099ff"],series:[{name:"设备状态",type:"pie",radius:["67%","100%"],center:["50%","50%"],animationDuration:0,hoverAnimation:!1,silent:!0,label:{normal:{show:!0,position:"center",formatter:"Min\n"+c+"台\n"+(d*100).toFixed(2)+"%",textStyle:{color:"#0099ff",fontSize:13}}},data:[{value:n.data.AllDevice-c,name:"其他台数"},{value:c,name:"日最小使用台数"}]}]};g.setOption(at,!0);$("section").resize(function(){for(var n=0;n<i.length;n++)echarts.init(document.getElementById("deviceChart"+n)).resize();a.resize();w.resize();k.resize();g.resize()})}},0)}