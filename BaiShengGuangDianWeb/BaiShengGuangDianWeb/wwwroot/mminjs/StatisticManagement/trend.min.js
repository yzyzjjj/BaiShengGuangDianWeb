function pageReady(){_permissionList[689]={uIds:["createChartBtn0"]};_permissionList[690]={uIds:["createChartBtn1"]};_permissionList=checkPermissionUi(_permissionList);$(".ms2").select2();getDeviceChart();getDevicePar();$("#selectDevice").select2();$("#selectStartDate").val(getDate()).datepicker("update");$("#selectEndDate").val(getDate()).datepicker("update");$("#device").click(function(){time=null;v=null;$("#main").empty();$("#selectDevice").val($("#selectDevice option").eq(0).val()).trigger("change");$("#selectStartDate").val(getDate()).datepicker("update");$("#selectEndDate").val(getDate()).datepicker("update");$("#selectStartTime").val(getTime()).timepicker("setTime",getTime());$("#selectEndTime").val(getTime()).timepicker("setTime",getTime());$("#selectPar .icb_minimal").iCheck("uncheck");$("#deviceCode").text("趋势图");$("#body").css("display","none");$("#body").slideDown();$("#body2").addClass("hidden");$("#body1").removeClass("hidden");$("#button2").addClass("hidden");$("#button1").removeClass("hidden")});$("#flowCard").click(function(){time=null;v=null;$("#main").empty();$("#inputFlowCard").val("");$("#selectProcess").empty();$("#selectProcess").parent().addClass("hidden");$("#selectPar .icb_minimal").iCheck("uncheck");$("#deviceCode").text("趋势图");$("#body1").addClass("hidden");$("#body2").removeClass("hidden");$("#button1").addClass("hidden");$("#button2").removeClass("hidden");$("#body").css("display","none");$("#body").slideDown()});$("#flowCardEmpty").click(function(){$("#inputFlowCard").val("")});$("#inputFlowCard").on("input",function(){$("#main").empty();$("#deviceCode").text("趋势图");$("#selectProcess").empty();$("#selectProcess").parent().addClass("hidden");$("#selectPar .icb_minimal").iCheck("uncheck")})}function getDeviceChart(){var n={};n.opType=100;ajaxPost("/Relay/Post",n,function(n){var r,t,i;if(n.errno!=0){layer.msg(n.errmsg);return}for(n.datas.sort((n,t)=>n.Code-t.Code),$("#selectDevice").empty(),r='<option value="{0}">{1}<\/option>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#selectDevice").append(r.format(i.Id,i.Code))})}function getDevicePar(){parList=[];var n={};n.opType=500;ajaxPost("/Relay/Post",n,function(n){var r,t,i;if(n.errno!=0){layer.msg(n.errmsg);return}for(r='<div class="form-inline" style="margin:10px 0 0 20px"><input type="checkbox" value="{0},{1}"class="icb_minimal"><label class="control-label" style="margin-left:5px">{1}<\/label><\/div>',t=0;t<n.datas.length;t++)i=n.datas[t],$("#selectPar").append(r.format(i.Id,i.VariableName));$("#selectPar .icb_minimal").iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#selectPar .icb_minimal").on("ifChanged",function(){var n=$(this),t=n.attr("value");n.is(":checked")?parList.push(t):parList.splice(parList.indexOf(t),1)})})}function createChart(n){var t,y,i,nt,tt,h,it,rt,w,r,ut,k,a;if(time=[],v={},n==0){var ft=$("#selectDevice").val(),u=$("#selectStartDate").val()+" "+$("#selectStartTime").val(),f=$("#selectEndDate").val()+" "+$("#selectEndTime").val();if(exceedTime(u)){layer.msg("开始时间不能大于当前时间");return}if(exceedTime(f)){layer.msg("结束时间不能大于当前时间");return}if(compareDate(u,f)){layer.msg("结束时间不能小于开始时间");return}var d=864e5,g=2592e6,e=new Date(f)-new Date(u);if(e>d){layer.msg("时间范围不能超过一天");return}if(t=0,g>e&&e>=d&&(t=1),e>=g&&(t=2),parList.sort(function(n,t){return parseInt(n.slice(0,n.indexOf(",")))>parseInt(t.slice(0,t.indexOf(",")))?1:-1}),y=parList.join(),isStrEmptyOrUndefined(y)){layer.msg("请选择参数");$("#deviceCode").text("趋势图");return}var p=y.split(","),o=[],s=[];for(i=0;i<p.length;i++)i%2==0?o.push(p[i]):s.push(p[i]);nt=o.join(",");tt=$("#selectDevice").find("option:selected").text();$("#deviceCode").text(tt);h={};h.opType=501;h.opData=JSON.stringify({DeviceId:ft,StartTime:u,EndTime:f,Field:nt,DataType:t});ajaxPost("/Relay/Post",h,function(n){var l,h,a,u,f,e,r,y,i,c;if(n.errno!=0){layer.msg(n.errmsg);return}for(l=o.length,h=0,a=n.datas.length;h<a;h++)for(u=n.datas[h],t==2&&time.push(u.time.split(" ")[0]),t==1&&time.push(u.time),t==0&&(f=u.time.split(" ")[1],f.slice(0,1)==0?time.push(f.slice(1,f.length)):time.push(f)),e=0;e<l;e++)r="v"+o[e],isStrEmptyOrUndefined(v[r])&&(v[r]=[]),y=s[e],y.indexOf("转速")!=-1?v[r].push(Math.round(u[r]/100)):v[r].push(u[r]);for($("#main").empty(),i=0;i<s.length;i++){c='<div id="chart'+i+'" style="width: 100%; height: 500px"><\/div>';i>0?$("#main").append('<div class="box-footer">'+c+"<\/div>"):$("#main").append(c);var p=s[i],w=echarts.init(document.getElementById("chart"+i)),b={title:{text:p},tooltip:{trigger:"axis"},xAxis:{type:"category",data:time},yAxis:{type:"value"},series:[{name:p,type:"line",data:v[Object.keys(v)[i]],showSymbol:!1,sampling:"average",showAllSymbol:!1}],dataZoom:[{type:"slider",start:0,end:20},{type:"inside",start:0,end:20}],toolbox:{top:18,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{}}}};w.setOption(b,!0)}$("#main").resize(function(){for(var t=$("#main").children().length,n=0;n<t;n++)echarts.init(document.getElementById("chart"+n)).resize()})})}if(n==1){if(isStrEmptyOrUndefined($("#selectProcess").val())){layer.msg("请先输入流程卡号查询选择工序");return}if(it=$("#selectProcess").val().trim(),rt=$("#selectProcess option:selected").attr("order"),parList.sort(function(n,t){return parseInt(n.slice(0,n.indexOf(",")))>parseInt(t.slice(0,t.indexOf(",")))?1:-1}),w=parList.join(),isStrEmptyOrUndefined(w)){layer.msg("请选择参数");$("#deviceCode").text("趋势图");return}var b=w.split(","),c=[],l=[];for(r=0;r<b.length;r++)r%2==0?c.push(b[r]):l.push(b[r]);ut=c.join(",");k=$("#selectProcess option:selected").attr("device");isStrEmptyOrUndefined(k)?$("#deviceCode").text("趋势图"):$("#deviceCode").text(k);a={};a.opType=503;a.opData=JSON.stringify({FlowCardId:it,Order:rt,Field:ut});ajaxPost("/Relay/Post",a,function(n){var r,i,t,u;if(n.errno!=0){layer.msg(n.errmsg);return}for(t=0;t<n.datas.length;t++)for(time[t]=n.datas[t].time,r=0;r<c.length;r++)i="v"+c[r],isStrEmptyOrUndefined(v[i])&&(v[i]=[]),v[i].push(n.datas[t][i]);for($("#main").empty(),t=0;t<l.length;t++){u='<div id="chart'+t+'" style="width: 100%; height: 500px"><\/div>';t>0?$("#main").append('<div class="box-footer">'+u+"<\/div>"):$("#main").append(u);var f=l[t],e=echarts.init(document.getElementById("chart"+t)),o={title:{text:f},tooltip:{trigger:"axis"},xAxis:{data:time},yAxis:{},series:[{name:f,type:"line",data:v[Object.keys(v)[t]]}],dataZoom:[{type:"slider",start:0,end:100},{type:"inside",start:0,end:100}],toolbox:{top:18,left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{}}}};e.setOption(o,!0)}$("#main").resize(function(){for(var n=0;n<l.length;n++)echarts.init(document.getElementById("chart"+n)).resize()})})}}function queryFlowCard(){var t=$("#inputFlowCard").val().trim(),n;if(isStrEmptyOrUndefined(t)){showTip("inputFlowCardTip","流程卡号不能为空");$("#inputFlowCardTip").removeClass("hidden");return}n={};n.opType=202;n.opData=JSON.stringify({FlowCard:t});ajaxPost("/Relay/Post",n,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#selectProcess").empty(),r='<option value="{0}" order="{1}" device="{3}">{2}<\/option>',i=0;i<n.processSteps.length;i++)t=n.processSteps[i],$("#selectProcess").append(r.format(t.FlowCardId,t.ProcessStepOrder,t.CategoryName+"-"+t.StepName,t.Code));if(n.processSteps.length==0){layer.msg("该流程卡号没有工序");$("#selectProcess").parent().addClass("hidden");return}$("#selectProcess").parent().removeClass("hidden")})}var _permissionList=[],parList=null,time=null,v=null;