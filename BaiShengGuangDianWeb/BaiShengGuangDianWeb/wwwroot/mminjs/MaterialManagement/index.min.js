function pageReady(){_permissionList[534]={uIds:["createQrModalBtn"]};_permissionList[535]={uIds:[]};_permissionList[536]={uIds:["showConsumeModelBtn"]};_permissionList[537]={uIds:["showReversalModelBtn"]};_permissionList[538]={uIds:["putLogBtn"]};_permissionList[539]={uIds:["receiveLogBtn"]};_permissionList[540]={uIds:["handleLogBtn"]};_permissionList=checkPermissionUi(_permissionList);_permissionList[535].have||$(".fastIncreaseModelBtn").addClass("hidden");$(".ms2").select2();var n=new Promise(n=>categorySelect(n)),t=new Promise(n=>nameSelect(n,!0,"Select")),i=new Promise(n=>supplierSelect(n,!0,"Select")),r=new Promise(n=>specificationSelect(n,!0,"Select")),u=new Promise(n=>siteSelect(n));Promise.all([n,t,i,r,u]).then(()=>{getMaterialList("Select")});$("#categorySelect").on("select2:select",function(){var n=new Promise(function(n){nameSelect(n,!1,"Select")}),t=new Promise(function(n){supplierSelect(n,!1,"Select")}),i=new Promise(function(n){specificationSelect(n,!1,"Select")});Promise.all([n,t,i]).then(()=>{getMaterialList("Select")})});$("#nameSelect").on("select2:select",function(){var n=new Promise(function(n){supplierSelect(n,!1,"Select")}),t=new Promise(function(n){specificationSelect(n,!1,"Select")});Promise.all([n,t]).then(()=>{getMaterialList("Select"),qrSiteSet("Select")})});$("#supplierSelect").on("select2:select",function(){var n=new Promise(function(n){specificationSelect(n,!1,"Select")});Promise.all([n]).then(()=>{getMaterialList("Select"),qrSiteSet("Select")})});$("#specificationSelect").on("select2:select",function(){getMaterialList("Select");qrSiteSet("Select")});$("#siteSelect").on("select2:select",function(){getMaterialList("Select")});$("#categoryQr").on("select2:select",function(){nameSelect(null,!1,"Qr");supplierSelect(null,!1,"Qr");specificationSelect(null,!1,"Qr");qrSiteSet("Qr")});$("#nameQr").on("select2:select",function(){supplierSelect(null,!1,"Qr");specificationSelect(null,!1,"Qr");qrSiteSet("Qr")});$("#supplierQr").on("select2:select",function(){specificationSelect(null,!1,"Qr");qrSiteSet("Qr")});$("#qrCodeList").on("click",".delQrCode",function(){var t,i,n;for($(this).parent().parent().remove(),t=$("#qrCodeList .printBox"),t.prop("style","float:left"),i=t.length,n=0;n<i;n++)(n+1)%24||t.eq(n).prop("style","page-break-after:always")});$("#increaseList,#consumePlanList,#consumeOtherList,#reversalList,#fastIncreaseList").on("click",".scanPrint",function(){new Promise(n=>showPrintModal(n)).then(n=>{if(n){var t=n.split(",")[0];$(this).next().val(t).trigger("change").trigger("select2:select")}})});$("#increaseList,#consumePlanList,#consumeOtherList,#reversalList,#fastIncreaseList").on("focus",".zeroNum",function(){var n=$(this).val();n==0&&$(this).val("")});$("#increaseList,#consumePlanList,#consumeOtherList,#reversalList,#fastIncreaseList").on("blur",".zeroNum",function(){var n=$(this).val();isStrEmptyOrUndefined(n)&&$(this).val("0")});$("#increaseList,#consumePlanList,#consumeOtherList,#reversalList,#fastIncreaseList").on("select2:select",".category,.name,.supplier,.specification,.site,.price,.code",function(n){var t=$(n.delegateTarget).data("index"),i=$(n.target).data("flag");typeof i=="undefined"?codeGanged.call(this,t):codeNoGanged.call(this,i,t);t==0?$("#copyBtn,#exportBtn").attr("disabled",!0):t==4&&$("#fastCopyBtn,#fastExportBtn").attr("disabled",!0)});$("#increaseList").on("change",".source",function(){var t=$(this).val(),n=$(this).parents("tr"),i;t=="计划退回"?($(this).next().removeClass("hidden"),n.find(".planList").trigger("change").trigger("select2:select")):($(this).next().addClass("hidden"),i=selectOp(_codeAllData,"Id","Code"),n.find(".code").empty().append(i).trigger("select2:select"),n.find(".stockNum").prop("placeholder",""));t=="采购"?n.find(".ms2").select2({width:"120px",tags:!0,createTag,matcher}):n.find(".ms2").select2({width:"120px",matcher})});$("#increaseList").on("select2:select",".planList",function(){var t=$(this).val(),n=$(this).parents("tr");new Promise(n=>planSend(n,t)).then(t=>{var i=n.find(".code"),r;i.empty().append(t).trigger("select2:select");r=i.find(":selected").attr("actual");n.find(".stockNum").prop("placeholder",`货品领用数量：${r}`)})});$("#increaseList").on("input",".stockNum",function(){var t=$(this).val(),i=$(this).parents("tr"),n=i.find(".code :selected").attr("actual");!!n&&parseFloat(t)>parseFloat(n)&&layer.msg("入库数量大于货品领用数量")});$("#consumePlanSelect").on("select2:select",function(){$("#consumePlanList").empty();$("#consumePlanCondition").val("");getPlanCode()});$("#planInto,#otherInto").on("change",function(n){var r=n.target.files,t=new FileReader,i;t.readAsBinaryString(r[0]);$(this).val("");i=$(this).data("index");t.onload=n=>{var t,r,u,f,o,e;try{t=XLSX.read(n.target.result,{type:"binary"})}catch(s){layer.msg("文件类型不正确");return}r=[];for(u in t.Sheets)t.Sheets.hasOwnProperty(u)&&(t.Sheets[u]["!ref"]=t.Sheets[u]["!ref"].replace("A1","A2"),r=r.concat(XLSX.utils.sheet_to_json(t.Sheets[u])));for(f=0,o=r.length;f<o;f++)e=_codeNameData[r[f]["货品编号"]],e&&addListTr(i,e)}});$("#logPlanSelect").on("select2:select",function(n,t){var i=$(this).val();myPromise({opType:704,opData:JSON.stringify({planId:i,stock:!0})}).then(n=>{var i=selectOp(n,"BillId","Code");$("#logBillSelect").append(`<option value="0">所有</option>${i}`);t&&$("#logBillSelect").val(t).trigger("change");getLogList()})});$("#logBillSelect").on("select2:select",()=>getLogList());pcAndroid()||$(".icon-saoyisao").addClass("hidden");$(".maxHeight").css("maxHeight",innerHeight*.7)}function scanAdd(n){new Promise(n=>showPrintModal(n)).then(t=>{if(t){var i=t.split(",")[0];addListTr(n,i)}})}function refresh(){$("#siteSelect").val(0).trigger("change");$("#categorySelect").val(0).trigger("change").trigger("select2:select")}function planSend(n,t){var i={};i.opType=700;i.opData=JSON.stringify({qId:t,first:!0,simple:!1});ajaxPost("/Relay/Post",i,function(t){var r;if(t.errno!=0){layer.msg(t.errmsg);return}for(var u=t.datas[0].FirstBill,e=u.length,f="",i=0;i<e;i++)r=u[i],f+='<option value = "{0}" actual = "{2}">{1}<\/option>'.format(r.BillId,r.Code,r.ActualConsumption);isStrEmptyOrUndefined(n)||n(f)},0)}function qrSiteSet(n){new Promise(function(t){getMaterialList(n,t)}).then(t=>{for(var f={},e='<option value = "0">所有位置<\/option>',o=t.length,u,r,i=0;i<o;i++)u=t[i],r=u.SiteId,f[r]||(f[r]=1,e+='<option value = "{0}">{1}<\/option>'.format(r,u.Site));$(`#site${n}`).empty();$(`#site${n}`).append(e)})}function categorySelect(n){var t={};t.opType=816;ajaxPost("/Relay/Post",t,function(t){var u;if(t.errno!=0){layer.msg(t.errmsg);return}$("#categorySelect").empty();for(var f=t.datas,e=f.length,r='<option value = "0">所有类别<\/option>',i=0;i<e;i++)u=f[i],r+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Category);$("#categorySelect").append(r);n!=null&&n(r)})}function nameSelect(n,t=false,i){var f={},r,u;if(!t){if(r=$(`#category${i}`).val(),isStrEmptyOrUndefined(r)){layer.msg("请选择货品类别");return}r!=0&&(f.categoryId=r)}u={};u.opType=824;u.opData=JSON.stringify(f);ajaxPost("/Relay/Post",u,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,o=e.length,u='<option value = "0">所有名称<\/option>',r=0;r<o;r++)f=e[r],u+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.Name);$(`#name${i}`).empty();$(`#name${i}`).append(u);n!=null&&n(u)})}function supplierSelect(n,t=false,i){var e={},r,u,f;if(!t){if(r=$(`#category${i}`).val(),isStrEmptyOrUndefined(r)){layer.msg("请选择货品类别");return}if(r!=0&&(e.categoryId=r),u=$(`#name${i}`).val(),isStrEmptyOrUndefined(u)){layer.msg("请选择货品名称");return}u!=0&&(e.nameId=u)}f={};f.opType=831;f.opData=JSON.stringify(e);ajaxPost("/Relay/Post",f,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,o=e.length,u='<option value = "0">所有供应商<\/option>',r=0;r<o;r++)f=e[r],u+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.Supplier);$(`#supplier${i}`).empty();$(`#supplier${i}`).append(u);n!=null&&n(u)})}function specificationSelect(n,t=false,i){var r={},u,f,e,o;if(!t){if(u=$(`#category${i}`).val(),isStrEmptyOrUndefined(u)){layer.msg("请选择货品类别");return}if(u!=0&&(r.categoryId=u),f=$(`#name${i}`).val(),isStrEmptyOrUndefined(f)){layer.msg("请选择货品名称");return}if(f!=0&&(r.nameId=f),e=$(`#supplier${i}`).val(),isStrEmptyOrUndefined(e)){layer.msg("请选择供应商名称");return}e!=0&&(r.supplierId=e)}o={};o.opType=839;o.opData=JSON.stringify(r);ajaxPost("/Relay/Post",o,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,o=e.length,u='<option value = "0">所有规格<\/option>',r=0;r<o;r++)f=e[r],u+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.Specification);$(`#specification${i}`).empty();$(`#specification${i}`).append(u);n!=null&&n(u)})}function siteSelect(n){var t={};t.opType=847;ajaxPost("/Relay/Post",t,function(t){var u;if(t.errno!=0){layer.msg(t.errmsg);return}$("#siteSelect").empty();for(var f=t.datas,e=f.length,r='<option value = "0">所有位置<\/option>',i=0;i<e;i++)u=f[i],r+='<option value = "{0}">{1}<\/option>'.format(u.Id,u.Site);$("#siteSelect").append(r);n!=null&&n(r)})}function getMaterialList(n,t){var i={},s=$(`#category${n}`).val(),r,u,f,e,o;if(isStrEmptyOrUndefined(s)){layer.msg("请选择货品类别");return}if(s!=0&&(i.categoryId=s),r=$(`#name${n}`).val(),isStrEmptyOrUndefined(r)){layer.msg("请选择货品名称");return}if(r!=0&&(i.nameId=r),u=$(`#supplier${n}`).val(),isStrEmptyOrUndefined(u)){layer.msg("请选择供应商名称");return}if(u!=0&&(i.supplierId=u),f=$(`#specification${n}`).val(),isStrEmptyOrUndefined(f)){layer.msg("请选择规格名称");return}if(f!=0&&(i.specificationId=f),e=$(`#site${n}`).val(),isStrEmptyOrUndefined(e)){layer.msg("请选择位置");return}e!=0&&(i.siteId=e);o={};o.opType=800;o.opData=JSON.stringify(i);ajaxPost("/Relay/Post",o,function(i){var u,r,e,f;if(i.errno!=0){layer.msg(i.errmsg);return}if(t!=null&&n=="Qr"){t(i.datas);return}for(_codeIdData={},u=i.datas,r=0,e=u.length;r<e;r++)f=u[r],_codeIdData[f.Id]=f;$("#codeCount").text(i.Count);$("#codeSum").text(i.Sum);var h=function(n){return`<button type="button" class="btn btn-info btn-sm" onclick="showDetailModel(${n})">查看</button>`},c=function(n){return n.Number<n.Stock?`<strong class="text-red">${n.Number}</strong>`:`<span>${n.Number}</span>`},l=function(n){var t=n.slice(0,n.indexOf(" "));return t=="0001-01-01"?"":t},a=function(n){var t=n.slice(0,n.indexOf(" "));return t=="0001-01-01"?"":t},v=function(n){return n.length>tdShowLength?`<span title="${n}" onclick="showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title="${n}">${n}</span>`},o=_permissionList[538].have,s=_permissionList[539].have,y=function(n){var t=`${o?'<button type="button" class="btn btn-success btn-sm" onclick="showLogModel(1, {0})">入库<\/button>':""}
                    ${s?'<button type="button" class="btn btn-success btn-sm" onclick="showLogModel(2, {0})">领用<\/button>':""}`;return t.format(n.Id)};$("#materialList").DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",filename:`物料详情_${getDate()}`,exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]}}],destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i.datas,aaSorting:[[0,"asc"]],aLengthMenu:[50,100,150,200],iDisplayLength:50,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"Code",title:"货品编号"},{data:"Category",title:"类别"},{data:"Name",title:"名称"},{data:null,title:"库存数量",render:c},{data:"Supplier",title:"供应商"},{data:"Specification",title:"规格"},{data:"Site",title:"位置"},{data:"Unit",title:"单位"},{data:"Price",title:"价格"},{data:"Stock",title:"最低库存",sClass:"text-blue"},{data:"InTime",title:"上次入库",render:l},{data:"OutTime",title:"上次领用",render:a},{data:"Remark",title:"备注",render:v},{data:"Id",title:"详情",render:h,orderable:!1},{data:null,title:"日志",render:y,orderable:!1,visible:o||s}]})})}function gangedSelect(n,t){ajaxPost("/Relay/Post",n,n=>{if(n.errno!=0){layer.msg(n.errmsg);return}t(n.datas)},0)}function myPromise(n){return new Promise(t=>gangedSelect(n,t))}function gangedObj(n,t){for(var r,u,i={},f=0,e=n.length;f<e;f++)r=n[f],u=r[t],i[u]?i[u].push(r):i[u]=[r];return i}function selectOp(n,t,i){var e,u,r,o,f;for(n=n||[],e='<option value="{0}">{1}<\/option>',u="",r=0,o=n.length;r<o;r++)f=n[r],u+=e.format(f[t],f[i]);return u}function setTableTr(n){for(var i=$(`${n} tr`),t=0,r=i.length;t<r;t++)i.eq(t).find(".num").text(t+1)}function resetList(n,t){$(n).empty();t==0?$("#copyBtn,#exportBtn").attr("disabled",!0):t==4&&$("#fastCopyBtn,#fastExportBtn").attr("disabled",!0)}function addListTr(n,t,i){var r="",u="",e={width:"120px",matcher},f;switch(n){case 0:r="#increaseList";u=_gangedTr;e.tags=!0;e.createTag=createTag;$("#copyBtn,#exportBtn").attr("disabled",!0);break;case 1:r="#consumePlanList";u=_gangedPlanTr;consumePlanDittoAuto(r);break;case 2:r="#consumeOtherList";u=_gangedOtherTr;consumePlanDittoAuto(r);break;case 3:r="#reversalList";u=_reversalTr;break;case 4:r="#fastIncreaseList";u=_gangedFastTr;e.tags=!0;e.createTag=createTag;$("#fastCopyBtn,#fastExportBtn").attr("disabled",!0)}i?(i.after(u),f=i.next()):($(r).append(u),f=$(`${r} tr:last`),t?f.find(".code").val(t).trigger("change").trigger("select2:select"):f.find(".code").trigger("select2:select"),$(`${r}Table`).scrollTop($(`${r}Table`)[0].scrollHeight));pcAndroid()||f.find(".scanPrint").addClass("hidden");f.find(".ms2").select2(e);setTableTr(r)}function delTr(n){var t=$(this).parents("tr");t.remove();setTableTr(n);n!="#increaseList"&&consumePlanDittoAuto(n)}function initGangedData(n){_codeData={};_codeIdData={};_siteObj={};_priceData={};var t=myPromise({opType:800}),i=myPromise({opType:816}),r=myPromise({opType:824}),u=myPromise({opType:831}),f=myPromise({opType:839}),e=myPromise({opType:847}),o=myPromise({opType:852}),s=myPromise({opType:700});Promise.all([t,i,r,u,f,e,o,s]).then(t=>{var s,r,i,f,u,e,h,o;for(_nameData=gangedObj(t[2],"CategoryId"),_supplierData=gangedObj(t[3],"NameId"),_specificationData=gangedObj(t[4],"SupplierId"),_siteData=t[5],s=gangedObj(_siteData,"Id"),_codeAllData=t[0],r=0,f=_codeAllData.length;r<f;r++)i=_codeAllData[r],u=i.SpecificationId,e=i.SiteId,_codeData[`${u}${e}${i.Price}`]=i,_codeIdData[i.Id]=i,_siteObj[u]?_siteObj[u].push(s[e][0]):_siteObj[u]=s[e],_siteObj[u]=[...new Set(_siteObj[u])];for(h=t[6],r=0,f=h.length;r<f;r++)i=h[r],o=`${i.SpecificationId}${i.SiteId}`,_priceData[o]?_priceData[o].push(i):_priceData[o]=[i];var c=selectOp(t[7],"Id","Plan"),l=selectOp(_codeAllData,"Id","Code"),a=selectOp(t[1],"Id","Category");n({planOp:c,codeOp:l,categoryOp:a})})}function codeGanged(n){var v=$(this).val(),t=$(this).parents("tr"),i=_codeIdData[v]||"",u=i.CategoryId||"",f=i.NameId||"",e=i.SupplierId||"",r=i.SpecificationId||"",o=i.SiteId||"",s,h,c,l,a;t.find(".category").val(u).trigger("change");s=selectOp(_nameData[u],"Id","Name");t.find(".name").empty().append(s).val(f).trigger("change");h=selectOp(_supplierData[f],"Id","Supplier");t.find(".supplier").empty().append(h).val(e).trigger("change");c=selectOp(_specificationData[e],"Id","Specification");t.find(".specification").empty().append(c).val(r).trigger("change");l=selectOp(r==""?_siteData:_siteObj[r],"Id","Site");t.find(".site").empty().append(l).val(o).trigger("change");a=selectOp(_priceData[`${r}${o}`],"Price","Price");t.find(".price").empty().append(a).val(i.Price||0).trigger("change");TrNoEqual(n,t,i)}function TrNoEqual(n,t,i){var f,e,r,u;switch(n){case 0:t.find(".unit label").text(i.Unit||"");t.find(".number label").text(i.Number||0);i==""?t.find(".textIn").addClass("hidden").siblings(".textOn").removeClass("hidden"):t.find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden");f=$(this).find(":selected").attr("actual");f&&t.find(".stockNum").prop("placeholder",`货品领用数量：${f}`);break;case 1:e=$("#consumePlanSelect").val();r=_planBillData[i.Id]||"";t.find(".planConsume").text(r.PlannedConsumption||0);t.find(".actualConsume").text(r.ActualConsumption||0);t.find(".refresh-btn").attr("onclick",`refreshNumber(${i.Id||0},'#consumePlanList')`);u=t.find(".log-btn");u.attr("onclick",`showLogModel(2,${i.Id},${e})`);r?u.removeClass("hidden"):u.addClass("hidden");break;case 2:t.find(".refresh-btn").attr("onclick",`refreshNumber(${i.Id||0},'#consumeOtherList')`);t.find(".log-btn").attr("onclick",`showLogModel(2,${i.Id||0})`);break;case 3:t.find(".unit").text(i.Unit||"");t.find(".refresh-btn").attr("onclick",`refreshNumber(${i.Id||0},'#reversalList')`);t.find(".log-btn").attr("onclick",`showLogModel(3,${i.Id||0})`);t.find(".remark").val(i.Remark||"");break;case 4:t.find(".unit label").text(i.Unit||"");i==""?t.find(".textIn").addClass("hidden").siblings(".textOn").removeClass("hidden"):t.find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")}n!=0&&n!=4&&t.find(".number").text(i.Number||0);t.find(".show-btn").attr("onclick",`showDetailModel(${i.Id||0})`)}function codeNoGanged(n,t){var i=$(this).parents("tr"),s=i.find(".code :selected").data("select2Tag"),v=i.find(".name"),y=i.find(".supplier"),h=i.find(".specification"),c=i.find(".site"),p=i.find(".price"),f=h.val()||"",l=c.val()||"",et=i.find(".code").val(),w,b,k,d,g,nt,tt,it,e,r,u,a,ft;switch(n){case 0:w=i.find(".category").val()||"";b=selectOp(_nameData[w],"Id","Name");v.empty().append(b);case 1:k=v.val()||"";d=selectOp(_supplierData[k],"Id","Supplier");y.empty().append(d);case 2:g=y.val()||"";nt=selectOp(_specificationData[g],"Id","Specification");h.empty().append(nt);case 3:f=h.val()||"";tt=s||!et?selectOp(_siteData,"Id","Site"):selectOp(f==""?_siteData:_siteObj[f],"Id","Site");c.empty().append(tt);case 4:l=c.val()||"";it=s?"":selectOp(_priceData[`${f}${l}`],"Price","Price");p.empty().append(it);case 5:if(e=p.val()||"",e=e.replace("tag",""),r=_codeData[`${f}${l}${e}`]||"",s?r!=""&&(i.find(".code").val(r.Id).trigger("change"),i.find(".textOn").addClass("hidden").siblings(".textIn").removeClass("hidden")):i.find(".code").val(r.Id||"").trigger("change"),!r.Id){var rt=i.find(".name :selected").text(),ut=i.find(".supplier :selected").text(),o=i.find(".specification :selected").text();if(!isStrEmptyOrUndefined(rt)&&!isStrEmptyOrUndefined(ut)&&!isStrEmptyOrUndefined(o)){for(o=o.replace(/[&\|\\\*^%$#@\-]/g,""),u=`${rt.toPinYin()}${ut.toPinYin()}${o.toPinYin()}`,a=0;_codeNameData[u];)a++,u+=a+"";ft=`<option value="tag${u}" data-select2-tag="true">${u}</option>`;i.find(".code").append(ft).val(`tag${u}`).trigger("change")}}TrNoEqual(t,i,r)}}function getCodeName(){var n,i,t;for(_codeNameData={},n=0,i=_codeAllData.length;n<i;n++)t=_codeAllData[n],_codeNameData[t.Code]=t.Id}function showIncreaseModel(){$("#addIncreaseListBtn,#copyBtn,#exportBtn").attr("disabled",!0);$("#increaseList").empty();new Promise(n=>initGangedData(n)).then(n=>{getCodeName(),_gangedTr=`<tr>
            <td class="num"></td>
            <td>
                <div class="flexStyle" style="justify-content:center">
                    <select class="form-control source" style="width:110px">
                        <option>采购</option>
                        <option>退回</option>
                        <option>计划退回</option>
                    </select>
                    <div class="hidden" style="width:110px"><select class="ms2 form-control planList">${n.planOp}</select></div>
                </div>
            </td>
            ${_noCodeTds.format(n.categoryOp)}${_increaseEqualTds.format(n.codeOp,0)}
            <td class="number"><label class="control-label textIn"></label><input type="tel" value="0" class="form-control text-center zeroNum hidden textOn" onkeyup="onInput(this, 8, 1)" onblur="onInputEnd(this)" style="min-width:70px"></td>
            <td><button class="btn btn-info btn-sm show-btn" type="button" onclick="showDetailModel()">查看</button></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delTr.call(this,'#increaseList')"><i class="fa fa-minus"></i></button></td>
            </tr>`,$("#addIncreaseListBtn").attr("disabled",!1),$("#increaseModal").modal("show")})}function showFastIncreaseModel(){$("#addFastIncreaseListBtn,#fastCopyBtn,#fastExportBtn").attr("disabled",!0);$("#fastIncreaseList").empty();new Promise(n=>initGangedData(n)).then(n=>{getCodeName(),_gangedFastTr=`<tr>
            <td class="num"></td>
            ${_noCodeTds.format(n.categoryOp)}${_increaseEqualTds.format(n.codeOp,4)}
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delTr.call(this,'#fastIncreaseList')"><i class="fa fa-minus"></i></button></td>
            </tr>`,$("#addFastIncreaseListBtn").attr("disabled",!1),$("#fastIncreaseModal").modal("show")})}function copyTr(n){var t=$(this).parents("tr"),r,u,f,e;addListTr(n,null,t);var i=t.next(),o=t.find(".stockNum").val().trim(),s=t.find(".purchase").val().trim();if(i.find(".stockNum").val(o),i.find(".purchase").val(s),r=(n,t)=>t.empty().append(n.html()).val(n.val()).trigger("change"),n===0&&(u=t.find(".source").val(),i.find(".source").val(u),u=="计划退回"&&(i.find(".planList").parent().removeClass("hidden"),i.find(".planList").val(t.find(".planList").val()).trigger("change"),r(t.find(".code"),i.find(".code"))),i.find(".number").replaceWith(t.find(".number").clone(!0)),i.find(".show-btn").replaceWith(t.find(".show-btn").clone(!0))),f=t.find(".code").val(),e=t.find(".code :selected").data("select2Tag"),!e&&f){i.find(".code").val(f).trigger("change").trigger("select2:select");return}r(t.find(".code"),i.find(".code"));r(t.find(".category"),i.find(".category"));r(t.find(".name"),i.find(".name"));r(t.find(".supplier"),i.find(".supplier"));r(t.find(".specification"),i.find(".specification"));r(t.find(".price"),i.find(".price"));r(t.find(".site"),i.find(".site"));i.find(".unit").replaceWith(t.find(".unit").clone(!0))}function increase(n){for(var d,v,u,y,f,p,e,o,w,s,b,tt,h,it,rt,st,k=[],ht=n?"#fastIncrease":"#increase",ut=$(`${ht}List tr`),c=0,ct=ut.length;c<ct;c++){var i=c+1,t=ut.eq(c),l=t.find(".code :selected"),r=l.val();if(isStrEmptyOrUndefined(r)){layer.msg(`序列${i}：货品编号不能为空`);return}d=l.data("select2Tag");r=d?"0":r;var g=l.text(),nt=t.find(".category :selected"),a=nt.val();if(isStrEmptyOrUndefined(a)){layer.msg(`序列${i}：请选择类别`);return}if(a=nt.data("select2Tag")?"0":a,v=t.find(".name :selected"),u=v.val(),isStrEmptyOrUndefined(u)){layer.msg(`序列${i}：请选择名称`);return}if(u=v.data("select2Tag")?"0":u,y=t.find(".supplier :selected"),f=y.val(),isStrEmptyOrUndefined(f)){layer.msg(`序列${i}：请选择供应商`);return}if(f=y.data("select2Tag")?"0":f,p=t.find(".specification :selected"),e=p.val(),isStrEmptyOrUndefined(e)){layer.msg(`序列${i}：请选择规格`);return}if(e=p.data("select2Tag")?"0":e,o=t.find(".price :selected").text(),isStrEmptyOrUndefined(o)){layer.msg(`序列${i}：请选择单价`);return}if(parseFloat(o)!=o){layer.msg(`序列${i}：单价不合法`);return}if(w=t.find(".site :selected"),s=w.val(),isStrEmptyOrUndefined(s)){layer.msg(`序列${i}：请选择位置`);return}if(s=w.data("select2Tag")?"0":s,d){if(b=t.find(".unit input").val().trim(),isStrEmptyOrUndefined(b)){layer.msg(`序列${i}：请输入单位`);return}tt=n?0:t.find(".number input").val().trim()}else b=t.find(".unit label").text(),tt=n?_codeIdData[r].Stock:t.find(".number label").text();if(h=t.find(".stockNum").val(),isStrEmptyOrUndefined(h)){layer.msg(`序列${i}：${g}: 入库数量不能为空`);return}if(parseFloat(h)<=0){layer.msg(`序列${i}：${g}: 入库数量需大于0`);return}if(!n&&(it=l.attr("actual"),!!it&&parseFloat(h)>parseFloat(it))){layer.msg(`序列${i}：入库数量大于货品领用数量`);return}if(rt=t.find(".purchase").val().trim(),isStrEmptyOrUndefined(rt)){layer.msg(`序列${i}：采购/退回人不能为空`);return}var ft=t.find(".source"),et=n?"采购":ft.val(),ot={CategoryId:a,Category:nt.text(),NameId:u,Name:v.text(),SupplierId:f,Supplier:y.text(),SpecificationId:e,Specification:p.text(),SiteId:s,Site:w.text(),Code:g,Unit:b,Price:o,Stock:tt,Purpose:et,RelatedPerson:rt,BillId:r,Number:h};n||et!="计划退回"||(ot.PlanId=ft.next().find(".planList").val());k.push(ot)}if(k.length<=0){layer.msg("请输入货品");return}st=()=>{var t={};t.opType=801;t.opData=JSON.stringify({Bill:k});ajaxPost("/Relay/Post",t,function(t){layer.msg(t.errmsg);t.errno==0&&(n?$("#fastCopyBtn,#fastExportBtn").attr("disabled",!1):$("#copyBtn,#exportBtn").attr("disabled",!1),getMaterialList("Select"))})};showConfirm("入库",st)}function exportExcel(n){for(var u=$(`${n} tr`),i=[],r=0,e=u.length;r<e;r++){var t=u.eq(r),f=t.find(".code :selected"),o=f.data("select2Tag");i.push({Code:f.text(),Category:t.find(".category :selected").text(),Name:t.find(".name :selected").text(),Supplier:t.find(".supplier :selected").text(),Specification:t.find(".specification :selected").text(),Price:t.find(".price :selected").text(),Site:t.find(".site :selected").text(),Unit:o?t.find(".unit input").val().trim():t.find(".unit label").text()})}if(!i.length){layer.msg("请先添加货品");return}$("<table><\/table>").DataTable({dom:"B",buttons:[{extend:"excel",filename:`入库日志_${getDate()}`}],destroy:!0,data:i,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"Code",title:"货品编号"},{data:"Category",title:"类别"},{data:"Name",title:"名称"},{data:"Supplier",title:"供应商"},{data:"Specification",title:"规格型号"},{data:"Price",title:"单价"},{data:"Site",title:"位置"},{data:"Unit",title:"单位"}]}).buttons(".buttons-excel").trigger()}function copyTable(n){var i=$(`${n} tr`),t,r,u;for(_copyData=[],t=0,r=i.length;t<r;t++)u=i.eq(t).find(".code :selected").text().trim(),_copyData.push(u);layer.msg(_copyData.length?"拷贝成功":"请先添加货品")}function getPlanCode(){$("#addConsumePlanListBtn").attr("disabled",!0);var n=$("#consumePlanSelect").val();_planBillData={};isStrEmptyOrUndefined(n)||myPromise({opType:704,opData:JSON.stringify({planId:n,stock:!0})}).then(n=>{for(var i,t=0,r=n.length;t<r;t++)i=n[t],_planBillData[i.BillId]=i;$("#addConsumePlanListBtn").attr("disabled",!1)})}function showConsumeModel(){$("#addConsumePlanListBtn,#addConsumeOtherListBtn").attr("disabled",!0);$("#planConsumeLi").attr("aria-expanded")=="false"&&$("#planConsumeLi").click();$("#consumePlanCondition,#consumeOther,#consumeOtherCondition").val("");$("#consumePlanSelect,#consumePlanList,#consumeOtherList,#logPlanSelect").empty();new Promise(n=>initGangedData(n)).then(n=>{$("#consumePlanSelect").append(n.planOp);$("#logPlanSelect").append(`<option value="0">所有</option>${n.planOp}`);getPlanCode();getCodeName();var t=`<tr>
            <td class="num"></td>
            <td>
                <span class="iconfont icon-saoyisao scanPrint" style="font-size:30px;cursor:pointer;vertical-align:middle"></span>
                <select class="ms2 form-control code">${n.codeOp}</select>
            </td>
            ${_noCodeTds.format(n.categoryOp)}
            <td><input class="form-control text-center receive zeroNum" type="tel" value="0" onkeyup="onInput(this, 8, 1)" onblur="onInputEnd(this)" style="width:140px;margin:auto"></td>
            {0}
            <td class="form-inline">
                <span class="number"></span>
                <button type="button" class="btn btn-danger btn-xs pull-right refresh-btn" onclick="refreshNumber()"><i class="fa fa-refresh"></i></button>
            </td>
            <td>
                <div class="flexStyle" style="width:150px">
                    <input class="form-control text-center recipient" type="tel" maxlength="64">
                    <button class="btn btn-primary btn-sm conPlanDitto" style="margin-left:3px" onclick="consumePlanDitto.call(this)">同上</button>
                </div>
            </td>
            <td><button class="btn btn-info btn-sm show-btn" type="button" onclick="showDetailModel()">详情</button></td>
            <td><button class="btn btn-success btn-sm log-btn" type="button" onclick="showLogConsumeModel()">查看</button></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delTr.call(this,'{1}')"><i class="fa fa-minus"></i></button></td>
            </tr>`;_gangedPlanTr=t.format('<td class="planConsume"><\/td><td class="actualConsume"><\/td>',"#consumePlanList");_gangedOtherTr=t.format("","#consumeOtherList");$("#addConsumeOtherListBtn").attr("disabled",!1);$("#consumeModal").modal("show")})}function refreshNumber(n,t){var i={};i.opType=800;i.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",i,i=>{var f,o,r,e,s,h,u;if(i.errno!=0){layer.msg(i.errmsg);return}for(f=i.datas[0].Number,o=$(`${t} tr`),r=0,e=o.length;r<e;r++)s=o.eq(r),h=s.find(".code :selected").val(),n==h&&s.find(".number").text(f);for(r=0,e=_codeAllData.length;r<e;r++)if(u=_codeAllData[r],u.Id==n){u.Number=f;_codeData[`${u.SpecificationId}${u.SiteId}${u.Price}`].Number=f;_codeIdData[n].Number=f;break}})}function consumePlanDittoAuto(n){$(n).find(".conPlanDitto").css("visibility","visible");$(`${n} tr:not(.hidden):first .conPlanDitto`).css("visibility","hidden")}function searchTr(n){var u=$(this).parent(),e=u.find(".val").val().trim(),f=$(`${n} tr`),t,o,s,i,h,r,c;if(isStrEmptyOrUndefined(e))f.removeClass("hidden");else{t=new Function;o=u.find(".sym").val();switch(o){case"0":t=(n,t)=>n==t;break;case"1":t=(n,t)=>n!=t;break;case"2":t=(n,t)=>n.indexOf(t)!=-1}for(s=u.find(".thText").val(),i=0,h=f.length;i<h;i++)r=f.eq(i),c=r.find(`.${s} :selected`).text(),t(c,e)?r.removeClass("hidden"):r.addClass("hidden")}consumePlanDittoAuto(n)}function consumePlanDitto(){var n=$(this).parents("tr"),t=n.prevAll(":not(.hidden):first"),i=t.find(".recipient").val().trim();n.find(".recipient").val(i)}function consumeConfirm(){var o,t,a=$("#planConsumeLi").attr("aria-expanded")=="true",r,s,i,v,n,f,e,l;if(a){if(o="#consumePlanList",t=$("#consumePlanSelect :selected").text(),isStrEmptyOrUndefined(t)){layer.msg("请选择计划号");return}}else if(o="#consumeOtherList",t=$("#consumeOther").val().trim(),isStrEmptyOrUndefined(t)){layer.msg("请输入用途");return}for(r=[],_consumeConfirmData=[],s=$(`${o} tr`),i=0,v=s.length;i<v;i++){var u=i+1,h=s.eq(i),c=h.find(".code").val();if(isStrEmptyOrUndefined(c)){layer.msg(`序列${u}：请选择货品编号`);return}if(n=_codeIdData[c],isStrEmptyOrUndefined(n)){layer.msg(`序列${u}：货品编号不存在, 无法领用`);return}if(f=h.find(".receive").val().trim(),f>>0<=0){layer.msg(`序列${u}：领用数量必须大于0`);return}if(e=h.find(".recipient").val().trim(),isStrEmptyOrUndefined(e)){layer.msg(`序列${u}：请输入领用人`);return}l={RelatedPerson:e,BillId:c,Number:f};a||(l.Purpose=t);_consumeConfirmData.push(l);r.push({Code:n.Code,Category:n.Category,Name:n.Name,Supplier:n.Supplier,Specification:n.Specification,Price:n.Price,Site:n.Site,Number:f,RelatedPerson:e})}if(!r.length){layer.msg("请先添加货品");return}$("#consumePurpose").text(t);$("#consumeConfirmList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:r,aaSorting:[[0,"asc"]],aLengthMenu:[40,80,120],iDisplayLength:40,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"Code",title:"货品编号"},{data:"Category",title:"货品类别"},{data:"Name",title:"货品名称"},{data:"Supplier",title:"供应商"},{data:"Specification",title:"规格型号"},{data:"Price",title:"单价"},{data:"Site",title:"位置"},{data:"Number",title:"领用数量"},{data:"RelatedPerson",title:"领用人"}]});$("#consumeConfirmModal").modal("show")}function consume(){var n=802,t=function(){var t={},i;t.opType=n;i={Bill:_consumeConfirmData};$("#planConsumeLi").attr("aria-expanded")=="true"&&(i.PlanId=$("#consumePlanSelect").val());t.opData=JSON.stringify(i);ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&($("#consumeConfirmModal,#consumeModal").modal("hide"),getMaterialList("Select"))})};showConfirm("领用",t)}function receiveStick(n){var r=_copyData.length,t,i;if(!r){layer.msg("请先拷贝入库数据");return}for(t=0;t<r;t++)i=_codeNameData[_copyData[t]],i&&addListTr(n,i)}function showReversalModel(){$("#addReversalListBtn").attr("disabled",!0);$("#reversalList").empty();new Promise(n=>initGangedData(n)).then(n=>{_reversalTr=`<tr>
            <td class="num"></td>
            <td>
                <span class="iconfont icon-saoyisao scanPrint" style="font-size:30px;cursor:pointer;vertical-align:middle"></span>
                <select class="ms2 form-control code">${n.codeOp}</select>
            </td>
            ${_noCodeTds.format(n.categoryOp)}
            <td class="unit"></td>
            <td class="form-inline">
                <span class="number"></span>
                <button type="button" class="btn btn-danger btn-xs pull-right refresh-btn" onclick="refreshNumber()"><i class="fa fa-refresh"></i></button>
            </td>
            <td><input type="tel" class="form-control text-center upNumber zeroNum" value="0" onkeyup="onInput(this, 8, 1)" onblur="onInputEnd(this)" style="width:140px;margin:auto"></td>
            <td class="no-padding"><textarea class="form-control remark" maxlength="500" style="resize: vertical;width:150px;margin:auto"></textarea></td>
            <td><button class="btn btn-info btn-sm show-btn" type="button" onclick="showDetailModel()">详情</button></td>
            <td><button class="btn btn-success btn-sm log-btn" type="button" onclick="showLogConsumeModel()">查看</button></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="delTr.call(this,'#reversalList')"><i class="fa fa-minus"></i></button></td>
            </tr>`,$("#addReversalListBtn").attr("disabled",!1),$("#reversalModal").modal("show")})}function reversalConModal(){var o=$("#reversalList tr"),t,s=o.length,i,h,n,f,e;if(!s){layer.msg("请添加货品");return}for(i=[],_reversalConList=[],h=getCookieTokenInfo().name,t=0;t<s;t++){var c=t+1,r=o.eq(t),u=r.find(".code").val();if(isStrEmptyOrUndefined(u)){layer.msg("请选择货品编号");return}if(n=_codeIdData[u],isStrEmptyOrUndefined(n)){layer.msg(`序列${c}：货品编号不存在, 请重新选择`);return}f=r.find(".upNumber").val().trim();e=r.find(".remark").val().trim();i.push({code:n.Code,category:n.Category,name:n.Name,supplier:n.Supplier,specification:n.Specification,price:n.Price,site:n.Site,number:f,remark:e});_reversalConList.push({BillId:u,Number:f,Remark:e,RelatedPerson:h})}$("#reversalConList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:i,aaSorting:[[0,"asc"]],aLengthMenu:[40,80,120],iDisplayLength:40,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"code",title:"货品编号"},{data:"category",title:"货品类别"},{data:"name",title:"货品名称"},{data:"supplier",title:"供应商"},{data:"specification",title:"规格型号"},{data:"price",title:"单价"},{data:"site",title:"位置"},{data:"number",title:"库存修改",sClass:"text-info"},{data:"remark",title:"备注",sClass:"text-info"}]});$("#reversalConModal").modal("show")}function reversalCon(){var n=()=>{var n={},t;n.opType=804;t={Bill:_reversalConList};n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,n=>{layer.msg(n.errmsg),n.errno==0&&($("#reversalConModal,#reversalModal").modal("hide"),getMaterialList("Select"))})};showConfirm("冲正",n)}function showLogModel(n,t,i){_logType=n;$("#logStartDate,#logEndDate").off("changeDate").val(getDate()).datepicker("update").on("changeDate",()=>getLogList());$("#logBillSelect").empty();$("#logPlanBox,#billInfo").addClass("hidden");$("#billInfo .spanStyle").text("");var r="";switch(n){case 0:r="操作日志";break;case 1:r="入库日志";break;case 2:r="领用日志";break;case 3:r="冲正日志"}if($("#logTitle").text(r),i){if($("#logPlanBox").removeClass("hidden"),isStrEmptyOrUndefined(t)||!_planBillData[t]){layer.msg("计划中不存在该货品编号或货品编号不存在");return}$("#logPlanSelect").val(i).trigger("change").trigger("select2:select",t)}else myPromise({opType:800}).then(n=>{var i=selectOp(n,"Id","Code");$("#logBillSelect").append(`<option value="0">所有编号</option>${i}`);t&&($("#logBillSelect").val(t).trigger("change"),$("#billInfo").removeClass("hidden"));getLogList()})}function getLogList(){var r=$("#logStartDate").val(),u=$("#logEndDate").val(),n,f,i,t,e;if(!isStrEmptyOrUndefined(r)&&!isStrEmptyOrUndefined(u)){if(r+=" 00:00:00",u+=" 23:59:59",compareDate(r,u)){layer.msg("结束时间不能小于开始时间");return}if(n={startTime:r,endTime:u},_logType&&(n.type=_logType,_logType!=2||$("#consumeModal").is(":hidden")||(n.purposeId=$("#planConsumeLi").attr("aria-expanded")=="true"?1:2,$("#logPlanBox").is(":hidden")||(f=$("#logPlanSelect").val(),isStrEmptyOrUndefined(f)||f==0||(n.planId=f)))),i=$("#logBillSelect").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择货品编号");return}i!=0?(n.billId=i,t=_codeIdData[i],$("#logCategory").html(t.Category),$("#logName").html(t.Name),$("#logSupplier").html(t.Supplier),$("#logSpecification").html(t.Specification),$("#logPrice").html(t.Price),$("#billInfo").removeClass("hidden")):$("#billInfo").addClass("hidden");e={};e.opType=803;e.opData=JSON.stringify(n);ajaxPost("/Relay/Post",e,n=>{if(n.errno!=0){layer.msg(n.errmsg);return}var e=n=>n==1?'<span class="text-success">入库<\/span>':'<span class="text-danger">领用<\/span>',f=n=>n.Type==1?`<span class="text-success">+${n.Number}</span>`:`<span class="text-danger">-${n.Number}</span>`,o=n=>`<span class="text-${n.Number>n.OldNumber?"success":"danger"}">${n.Number}</span>`,r=[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"Time",title:"时间"}],u=[{data:"Category",title:"类别"},{data:"Name",title:"名称"},{data:"Supplier",title:"供应商"},{data:"Specification",title:"规格型号"},{data:"Price",title:"单价"},{data:"Site",title:"位置",bVisible:!1},{data:"Unit",title:"单位",bVisible:!1}],t=null,i=null;switch(_logType){case 0:t=[...r,{data:"Code",title:"货品编号"},{data:"Type",title:"入/出",render:e},{data:"Purpose",title:"来源/用途"},...u,{data:null,title:"数量",render:f},{data:"OldNumber",title:"旧值",bVisible:!1},{data:"RelatedPerson",title:"相关人"},{data:"Manager",title:"物管员"}];i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];break;case 1:t=[...r,{data:"Code",title:"货品编号"},...u,{data:null,title:"数量",render:f},{data:"OldNumber",title:"旧值",bVisible:!1},{data:"Purpose",title:"货品来源"},{data:"RelatedPerson",title:"采购/退回人"},{data:"Manager",title:"物管员"},{data:null,title:"",bVisible:!1}];i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14];break;case 2:t=[...r,{data:"Purpose",title:"用途"},{data:"Code",title:"货品编号"},...u,{data:null,title:"数量",render:f},{data:"OldNumber",title:"旧值",bVisible:!1},{data:"RelatedPerson",title:"领用人"},{data:"Manager",title:"物管员"},{data:null,title:"",bVisible:!1}];i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14];break;case 3:t=[...r,{data:"Code",title:"货品编号"},...u,{data:"OldNumber",title:"修改前"},{data:null,title:"修改后",render:o},{data:"Remark",title:"备注"},{data:"Manager",title:"物管员"},{data:null,title:"",bVisible:!1},{data:null,title:"",bVisible:!1}];i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13]}$("#logList").DataTable({dom:'<"pull-left"l><"pull-right"B><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',buttons:[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",filename:`${$("#logTitle").text().trim()}_${getDate()}`,exportOptions:{columns:i}}],destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aaSorting:[[0,"asc"]],aLengthMenu:[40,80,120],iDisplayLength:40,columns:t})});$("#logModal").modal("show")}}function showDetailModel(n){if(n!=0){var t={};t.opType=800;t.opData=JSON.stringify({qId:n});ajaxPost("/Relay/Post",t,n=>{if(n.errno==0){var i=n.datas[0];$("#detailCode").text(i.Code);$("#detailCategory").text(i.Category);$("#detailName").text(i.Name);$("#detailSupplier").text(i.Supplier);$("#detailSpecification").text(i.Specification);$("#detailSite").text(i.Site);$("#detailImgList").empty();i.ImageList.length>0&&(t={type:fileEnum.Material,files:i.Images},ajaxPost("/Upload/Path",t,n=>{var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(r='<div class="imgOption col-lg-2 col-md-3 col-sm-4 col-xs-6"><div class="thumbnail"><img src={0} style="height:200px"><div class="caption text-center"><\/div><\/div><\/div>',i="",t=0;t<n.data.length;t++)i+=r.format(n.data[t].path);$("#detailImgList").append(i)}));$("#showDetailModel").modal("show")}else layer.msg(n.errmsg)})}}function createQrModal(){$("#qrCodeList").empty();var n=new Promise(n=>categorySelect(n)),t=new Promise(n=>nameSelect(n,!0,"Qr")),i=new Promise(n=>supplierSelect(n,!0,"Qr")),r=new Promise(n=>specificationSelect(n,!0,"Qr")),u=new Promise(n=>siteSelect(n,!0));Promise.all([n,t,i,r,u]).then(n=>{$("#categoryQr").empty().append(n[0]),$("#nameQr").empty().append(n[1]),$("#supplierQr").empty().append(n[2]),$("#specificationQr").empty().append(n[3]),$("#siteQr").empty().append(n[4])});$("#createQrModal").modal("show")}function getQrList(){new Promise(function(n){getMaterialList("Qr",n)}).then(n=>{for(var u=n.length,f="",e=[],r=0,i,t=0;t<u;t++)r++,r==24&&(r=0),i=n[t],f+='<div class="printBox" style={6}><div style="width: 230px; height: 115px; border: 1px solid; display: flex;position:relative"><div style="width: 50%; height: 100%"><div class="createQrCode" style="margin: 4px"><\/div><\/div><span class="glyphicon glyphicon-remove delQrCode pointer" aria-hidden="true" style="position:absolute;right:3px;top:3px;font-size:20px;color:red"><\/span><div style="width: 50%; height: 100%; text-align: center;display:flex;flex-direction:column;justify-content:center;font-size:12px"><span class="textOverTop">{0}<\/span><span class="textOverTop">{1}<\/span><span class="textOverTop">{2}<\/span><span class="textOverTop">{3}<\/span><span class="textOverTop">{4}<\/span><span class="textOverTop">{5}<\/span><\/div><\/div><\/div>'.format(i.Code,i.Category,i.Name,i.Supplier,i.Specification,i.Site,r?"float:left":"page-break-after:always"),e.push(`${i.BillId},${i.Code}`);for($("#qrCodeList").empty().append(f),t=0;t<u;t++)new QRCode($("#qrCodeList .createQrCode")[t],{text:e[t],width:105,height:105,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});$("#qrCodeList .createQrCode").prop("title","")})}var _permissionList=[],_qrCode=null,_logConsumePlanBill=null,_codeAllData=null,_codeData=null,_codeIdData=null,_nameData=null,_supplierData=null,_specificationData=null,_siteData=null,_siteObj=null,_priceData=null,_noCodeTds=`<td><select class="ms2 form-control category" data-flag="0">{0}</select></td>
    <td><select class="ms2 form-control name" data-flag="1"></select></td>
    <td><select class="ms2 form-control supplier" data-flag="2"></select></td>
    <td><select class="ms2 form-control specification" data-flag="3"></select></td>
    <td><select class="ms2 form-control price" data-flag="5"></select></td>
    <td><select class="ms2 form-control site" data-flag="4"></select></td>`,_increaseEqualTds=`<td><input class="form-control text-center stockNum zeroNum" type="tel" value="0" onkeyup="onInput(this, 8, 1)" onblur="onInputEnd(this)" style="width:140px;margin:auto"></td>
            <td class="unit"><label class="control-label textIn"></label><input class="form-control text-center hidden textOn" maxlength="4" style="min-width:70px"></td>
            <td>
               <div class="flexStyle" style="width:160px">
                   <input class="form-control text-center purchase" maxlength="64">
                   <button class="btn btn-primary btn-sm pull-right" type="button" onclick="copyTr.call(this,{1})" style="margin-left:3px" title="复制"><i class="fa fa-copy"></i></button>
               </div>
            </td>
            <td>
                <span class="iconfont icon-saoyisao scanPrint" style="font-size:30px;cursor:pointer;vertical-align:middle"></span>
                <select class="ms2 form-control code">{0}</select>
            </td>`,_gangedTr=null,_gangedFastTr=null,_copyData=[],_planBillData=null,_gangedPlanTr=null,_gangedOtherTr=null,_codeNameData=null,_consumeConfirmData=null,_reversalTr=null,_reversalConList=null,_logType=null;