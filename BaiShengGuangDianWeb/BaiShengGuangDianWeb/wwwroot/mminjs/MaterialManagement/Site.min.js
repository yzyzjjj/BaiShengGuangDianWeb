function pageReady(){getCargoSiteList()}function getCargoSiteList(){var t=847,n;if(!checkPermission(t)){layer.msg("没有权限");return}_siteIdData=[];_siteNameData=[];n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=function(n){return`<span class="textOn siteOld">${n}</span><input type="text" class="form-control text-center textIn site hidden" maxlength="20" style="width:120px" value=${n}>`},u=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+`<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"></textarea>`},f=0,e=function(){return++f};$("#cargoSiteList").DataTable({destroy:!0,paging:!0,searching:!0,language:{url:"/content/datatables_language.json"},data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i},{data:null,title:"序号",render:e},{data:"Site",title:"位置",render:r},{data:"Remark",title:"备注",render:u}],columnDefs:[{orderable:!1,targets:0}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#cargoSiteList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),t=$(this).val(),i=n.find(".siteOld").text();if($(this).is(":checked")){_siteIdData.push(t);_siteNameData.push(i);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var r=n.find(".textOn"),u=r.eq(0).text(),f=r.eq(1).attr("title");n.find(".site").val(u);n.find(".remark").val(f)}else _siteIdData.splice(_siteIdData.indexOf(t),1),_siteNameData.splice(_siteNameData.indexOf(i),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateSite(){var f=848,n,r,o,u,s,h;if(!checkPermission(f)){layer.msg("没有权限");return}for(var e=$("#cargoSiteList tbody").find("tr"),t=[],i=0,c=e.length;i<c;i++)if(n=e.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(o=r.val(),u=n.find(".site").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("位置不能为空");return}s=n.find(".remark").val().trim();t.push({Site:u,Remark:s,Id:o})}if(!t.length){layer.msg("请选择要保存的数据");return}h=function(){var n={};n.opType=f;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCargoSiteList()})};showConfirm("保存",h)}function addSiteModal(){$("#addSite").val("");$("#addRemark").val("");$("#addSiteModal").modal("show")}function addSite(){var t=849,n,i,r;if(!checkPermission(t)){layer.msg("没有权限");return}if(n=$("#addSite").val().trim(),isStrEmptyOrUndefined(n)){layer.msg("新位置不能为空");return}i=$("#addRemark").val().trim();r=function(){var r={};r.opType=t;r.opData=JSON.stringify({Site:n,Remark:i});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#addSiteModal").modal("hide");n.errno==0&&getCargoSiteList()})};showConfirm("添加",r)}function delSite(){var n=850,t,i;if(!checkPermission(n)){layer.msg("没有权限");return}if(!_siteIdData.length){layer.msg("请选择要删除的货品位置");return}t=_siteNameData.join("<br>");i=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_siteIdData});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getCargoSiteList()})};showConfirm(`删除以下货品位置：<pre style="color:red">${t}</pre>`,i)}var _siteIdData=[],_siteNameData=[];