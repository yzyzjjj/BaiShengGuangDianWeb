function pageReady(){_permissionList[584]={uIds:["updateSiteBtn"]};_permissionList[585]={uIds:["addSiteModalBtn"]};_permissionList[586]={uIds:["delSiteBtn"]};_permissionList=checkPermissionUi(_permissionList);getCargoSiteList()}function getCargoSiteList(){_siteIdData=[];_siteNameData=[];var n={};n.opType=847;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=function(n){return`<span class="textOn siteOld">${n}</span><input type="text" class="form-control text-center textIn site hidden" maxlength="20" style="width:120px" value=${n}>`},u=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+'<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"><\/textarea>'},f=function(n,t,i,r){return++r.row},e=_permissionList[584].have||_permissionList[586].have;$("#cargoSiteList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i,orderable:!1,visible:e},{data:null,title:"序号",render:f},{data:"Site",title:"位置",render:r},{data:"Remark",title:"备注",render:u}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#cargoSiteList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),t=$(this).val(),i=n.find(".siteOld").text();if($(this).is(":checked")){_siteIdData.push(t);_siteNameData.push(i);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var r=n.find(".textOn"),u=r.eq(0).text(),f=r.eq(1).attr("title");n.find(".site").val(u);n.find(".remark").val(f)}else _siteIdData.splice(_siteIdData.indexOf(t),1),_siteNameData.splice(_siteNameData.indexOf(i),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateSite(){for(var f=$("#cargoSiteList tbody").find("tr"),t=[],i=0,h=f.length,n,r,e,u,o,s;i<h;i++)if(n=f.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(e=r.val(),u=n.find(".site").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("位置不能为空");return}o=n.find(".remark").val().trim();t.push({Site:u,Remark:o,Id:e})}if(!t.length){layer.msg("请选择要保存的数据");return}s=function(){var n={};n.opType=848;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCargoSiteList()})};showConfirm("保存",s)}function addSiteModal(){$("#addSite").val("");$("#addRemark").val("");$("#addSiteModal").modal("show")}function addSite(){var n=$("#addSite").val().trim(),t,i;if(isStrEmptyOrUndefined(n)){layer.msg("新位置不能为空");return}t=$("#addRemark").val().trim();i=function(){var i={};i.opType=849;i.opData=JSON.stringify({Site:n,Remark:t});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);$("#addSiteModal").modal("hide");n.errno==0&&getCargoSiteList()})};showConfirm("添加",i)}function delSite(){if(!_siteIdData.length){layer.msg("请选择要删除的货品位置");return}var n=_siteNameData.join("<br>"),t=function(){var n={};n.opType=850;n.opData=JSON.stringify({ids:_siteIdData});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCargoSiteList()})};showConfirm(`删除以下货品位置：<pre style="color:red">${n}</pre>`,t)}var _permissionList=[],_siteIdData=[],_siteNameData=[];