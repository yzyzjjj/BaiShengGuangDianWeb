function pageReady(){$(".ms2").select2();siteSelect();var n,t,i,r=new Promise(function(n){categorySelect(n)}),u=new Promise(function(n){nameSelect(n,"0",!1)}),f=new Promise(function(n){supplierSelect(n,"0","0",!1)}),e=new Promise(function(n){specificationSelect(n,"0","0","0",!1)}),o=new Promise(function(n){siteSelect(n)});Promise.all([r,u,f,e,o]).then(()=>{getMaterialList()});$("#categorySelect").on("select2:select",function(){n=$(this).val();new Promise(function(t){nameSelect(t,n,!1)}).then(function(i){return t=$("#nameSelect").val(),isStrEmptyOrUndefined(t)&&($("#supplierSelect").empty(),$("#specificationSelect").empty()),new Promise(function(r){i(r,n,t,!1)})}).then(function(r){return i=$("#supplierSelect").val(),isStrEmptyOrUndefined(i)&&$("#specificationSelect").empty(),new Promise(function(u){r(u,n,t,i,!1)})}).then(function(n){n()})});$("#nameSelect").on("select2:select",function(){n=$("#categorySelect").val();t=$(this).val();new Promise(function(i){supplierSelect(i,n,t,!1)}).then(function(r){return i=$("#supplierSelect").val(),isStrEmptyOrUndefined(i)&&$("#specificationSelect").empty(),new Promise(function(u){r(u,n,t,i,!1)})}).then(function(n){n()})});$("#supplierSelect").on("select2:select",function(){n=$("#categorySelect").val();t=$("#nameSelect").val();i=$(this).val();new Promise(function(r){specificationSelect(r,n,t,i,!1)}).then(function(n){n()})});$("#specificationSelect").on("select2:select",function(){getMaterialList()});$("#siteSelect").on("select2:select",function(){getMaterialList()});$("#MaterialList").on("change",".category",function(){var r=$(this).parents("tr");n=$(this).val();new Promise(function(t){nameSelect(t,n,!0)}).then(function(i){return r.find(".name").empty(),r.find(".name").append(i),t=r.find(".name").val(),isStrEmptyOrUndefined(i)&&(r.find(".supplier").empty(),r.find(".specification").empty()),new Promise(function(i){supplierSelect(i,n,t,!0)})}).then(function(u){return r.find(".supplier").empty(),r.find(".supplier").append(u),i=r.find(".supplier").val(),isStrEmptyOrUndefined(u)&&r.find(".specification").empty(),new Promise(function(r){specificationSelect(r,n,t,i,!0)})}).then(function(n){r.find(".specification").empty();r.find(".specification").append(n)})});$("#MaterialList").on("change",".name",function(){var r=$(this).parents("tr");n=r.find(".category").val();t=$(this).val();new Promise(function(i){supplierSelect(i,n,t,!0)}).then(function(u){return r.find(".supplier").empty(),r.find(".supplier").append(u),i=r.find(".supplier").val(),isStrEmptyOrUndefined(u)&&r.find(".specification").empty(),new Promise(function(r){specificationSelect(r,n,t,i,!0)})}).then(function(n){r.find(".specification").empty();r.find(".specification").append(n)})});$("#MaterialList").on("change",".supplier",function(){n=tr.find(".category").val();t=tr.find(".name").val();i=$(this).val();new Promise(function(r){specificationSelect(r,n,t,i,!0)}).then(function(n){tr.find(".specification").empty();tr.find(".specification").append(n)})});$("#addCategorySelect").on("select2:select",function(){n=$(this).val();new Promise(function(t){nameSelect(t,n,!0)}).then(function(i){return $("#addNameSelect").empty(),$("#addNameSelect").append(i),t=$("#addNameSelect").val(),isStrEmptyOrUndefined(i)&&($("#addSupplierSelect").empty(),$("#addSpecificationSelect").empty()),new Promise(function(i){supplierSelect(i,n,t,!0)})}).then(function(r){return $("#addSupplierSelect").empty(),$("#addSupplierSelect").append(r),i=$("#addSupplierSelect").val(),isStrEmptyOrUndefined(r)&&$("#addSpecificationSelect").empty(),new Promise(function(r){specificationSelect(r,n,t,i,!0)})}).then(function(n){$("#addSpecificationSelect").empty();$("#addSpecificationSelect").append(n)})});$("#addNameSelect").on("select2:select",function(){n=$("#addCategorySelect").val();t=$(this).val();new Promise(function(i){supplierSelect(i,n,t,!0)}).then(function(r){return $("#addSupplierSelect").empty(),$("#addSupplierSelect").append(r),i=$("#addSupplierSelect").val(),isStrEmptyOrUndefined(r)&&$("#addSpecificationSelect").empty(),new Promise(function(r){specificationSelect(r,n,t,i,!0)})}).then(function(n){$("#addSpecificationSelect").empty();$("#addSpecificationSelect").append(n)})});$("#addSupplierSelect").on("select2:select",function(){n=$("#addCategorySelect").val();t=$("#addNameSelect").val();i=$(this).val();new Promise(function(r){specificationSelect(r,n,t,i,!0)}).then(function(n){$("#addSpecificationSelect").empty();$("#addSpecificationSelect").append(n)})});$("#imgOldList").on("click",".delImg",function(){$(this).parents(".imgOption").remove();var n=$(this).val();_imgNameData.splice(_imgNameData.indexOf(n),1)});$("#batchAddMaterialModal").attr("data-backdrop","static")}function categorySelect(n){var i=816,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var u;if(t.errno!=0){layer.msg(t.errmsg);return}$(".categorySelect").empty();for(var f=t.datas,o=f.length,e='<option value = "{0}">{1}<\/option>',r="",i=0;i<o;i++)u=f[i],r+=e.format(u.Id,u.Category);$("#categorySelect").append(e.format(0,"所有类别"));$(".categorySelect").append(r);_categorySelect=`<select class="form-control textIn category hidden" style="width:100px">${r}</select>`;isStrEmptyOrUndefined(n)||n(nameSelect)})}function nameSelect(n,t,i){var f=824,u,r;if(!checkPermission(f)){layer.msg("没有权限");return}if(u={},isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}t!=0&&(u.categoryId=t);r={};r.opType=f;r.opData=JSON.stringify(u);ajaxPost("/Relay/Post",r,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,s=e.length,o='<option value = "{0}">{1}<\/option>',u="",r=0;r<s;r++)f=e[r],u+=o.format(f.Id,f.Name);i||($("#nameSelect").empty(),$("#nameSelect").append(o.format(0,"所有名称")),$("#nameSelect").append(u));isStrEmptyOrUndefined(n)||(i?n(u):n(supplierSelect))},!i)}function supplierSelect(n,t,i,r){var e=831,u,f;if(!checkPermission(e)){layer.msg("没有权限");return}if(u={},isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}if(t!=0&&(u.categoryId=t),isStrEmptyOrUndefined(i)){layer.msg("请选择货品名称");return}i!=0&&(u.nameId=i);f={};f.opType=e;f.opData=JSON.stringify(u);ajaxPost("/Relay/Post",f,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,s=e.length,o='<option value = "{0}">{1}<\/option>',u="",i=0;i<s;i++)f=e[i],u+=o.format(f.Id,f.Supplier);r||($("#supplierSelect").empty(),$("#supplierSelect").append(o.format(0,"所有供应商")),$("#supplierSelect").append(u));isStrEmptyOrUndefined(n)||(r?n(u):n(specificationSelect))},!r)}function specificationSelect(n,t,i,r,u){var o=839,f,e;if(!checkPermission(o)){layer.msg("没有权限");return}if(f={},isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}if(t!=0&&(f.categoryId=t),isStrEmptyOrUndefined(i)){layer.msg("请选择货品名称");return}if(i!=0&&(f.nameId=i),isStrEmptyOrUndefined(r)){layer.msg("请选择货品供应商");return}r!=0&&(f.supplierId=r);e={};e.opType=o;e.opData=JSON.stringify(f);ajaxPost("/Relay/Post",e,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,s=e.length,o='<option value = "{0}">{1}<\/option>',r="",i=0;i<s;i++)f=e[i],r+=o.format(f.Id,f.Specification);u||($("#specificationSelect").empty(),$("#specificationSelect").append(o.format(0,"所有规格")),$("#specificationSelect").append(r));isStrEmptyOrUndefined(n)||(u?n(r):n(getMaterialList))},!u)}function siteSelect(n){var i=847,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var u;if(t.errno!=0){layer.msg(t.errmsg);return}$("#addSiteSelect").empty();for(var f=t.datas,o=f.length,e='<option value = "{0}">{1}<\/option>',r="",i=0;i<o;i++)u=f[i],r+=e.format(u.Id,u.Site);$("#addSiteSelect").append(r);$("#siteSelect").empty();$("#siteSelect").append(e.format(0,"所有位置"));$("#siteSelect").append(r);_siteSelect=`<select class="form-control textIn site hidden" style="width:100px">${r}</select>`;isStrEmptyOrUndefined(n)||n("success")})}function getMaterialList(){var o=808,n,t,i,r,u,f,e;if(!checkPermission(o)){layer.msg("没有权限");return}if(_materialIdData=[],_materialNameData=[],n={},t=$("#categorySelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}if(t!=0&&(n.categoryId=t),i=$("#nameSelect").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择货品名称");return}if(i!=0&&(n.nameId=i),r=$("#supplierSelect").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择货品供应商");return}if(r!=0&&(n.supplierId=r),u=$("#specificationSelect").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择货品规格");return}if(u!=0&&(n.specificationId=u),f=$("#siteSelect").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择位置");return}f!=0&&(n.siteId=f);e={};e.opType=o;e.opData=JSON.stringify(n);ajaxPost("/Relay/Post",e,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=0,u=function(){return++r},f=function(n){return`<span class="textOn codeOld">${n}</span><input type="text" class="form-control text-center textIn code hidden" maxlength="20" style="width:120px" value=${n}>`},e=function(n){return`<span class="textOn" id=${n.CategoryId}>${n.Category}</span>${_categorySelect}`},o=function(n){return`<span class="textOn" id=${n.NameId}>${n.Name}</span><select class="form-control textIn name hidden" style="width:100px"></select>`},s=function(n){return`<span class="textOn" id=${n.SupplierId}>${n.Supplier}</span><select class="form-control textIn supplier hidden" style="width:100px"></select>`},h=function(n){return`<span class="textOn" id=${n.SpecificationId}>${n.Specification}</span><select class="form-control textIn specification hidden" style="width:100px"></select>`},c=function(n){return`<span class="textOn">${n}</span><input type="text" class="form-control text-center textIn unit hidden" maxlength="20" style="width:80px" value=${n}>`},l=function(n){return`<span class="textOn" id=${n.SiteId}>${n.Site}</span>${_siteSelect}`},a=function(n){return"<button type=\"button\" class=\"btn btn-info btn-sm\" style=\"vertical-align:middle\" onclick=\"showImgModel({0},'{1}','{2}','{3}','{4}','{5}','{6}','{7}')\">查看<\/button>".format(n.Id,escape(n.Code),escape(n.Category),escape(n.Name),escape(n.Supplier),escape(n.Specification),escape(n.ImageList),escape(n.Site))},v=function(n){return`<span class="textOn">${n}</span><input type="text" class="form-control text-center textIn price hidden" maxlength="10" style="width:80px" value=${n}>`},y=function(n){return`<span class="textOn">${n}</span><input type="text" class="form-control text-center textIn stock hidden" maxlength="10" style="width:80px" value=${n}>`},p=function(n){return n==null&&(n=""),(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+`<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"></textarea>`};$("#MaterialList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i},{data:null,title:"序号",render:u},{data:"Code",title:"货品编号",render:f},{data:null,title:"类别",render:e},{data:null,title:"名称",render:o},{data:null,title:"供应商",render:s},{data:null,title:"规格",render:h},{data:"Unit",title:"单位",render:c},{data:null,title:"位置",render:l},{data:null,title:"货品图片",render:a},{data:"Price",title:"参考价格",render:v},{data:"Stock",title:"最低库存",render:y},{data:"Remark",title:"备注",render:p}],columnDefs:[{orderable:!1,targets:0}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#MaterialList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),f=$(this).val(),e=n.find(".codeOld").text();if($(this).is(":checked")){_materialIdData.push(f);_materialNameData.push(e);var t=n.find(".textOn"),o=t.eq(0).text(),i=t.eq(1).attr("id"),r,u;new Promise(function(n){nameSelect(n,i,!0)}).then(function(u){return n.find(".name").empty(),n.find(".name").append(u),r=t.eq(2).attr("id"),new Promise(function(n){supplierSelect(n,i,r,!0)})}).then(function(f){return n.find(".supplier").empty(),n.find(".supplier").append(f),u=t.eq(3).attr("id"),new Promise(function(n){specificationSelect(n,i,r,u,!0)})}).then(function(f){n.find(".specification").empty();n.find(".specification").append(f);var e=t.eq(4).attr("id"),s=t.eq(5).text(),h=t.eq(6).attr("id"),c=t.eq(7).text(),l=t.eq(8).text(),a=t.eq(9).attr("title");n.find(".code").val(o);n.find(".category").val(i);n.find(".name").val(r);n.find(".supplier").val(u);n.find(".specification").val(e);n.find(".unit").val(s);n.find(".site").val(h);n.find(".price").val(c);n.find(".stock").val(l);n.find(".remark").val(a);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden")})}else _materialIdData.splice(_materialIdData.indexOf(f),1),_materialNameData.splice(_materialNameData.indexOf(e),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateMaterial(){var c=809,n,r,a,u,f,e,o,s,h,v,y;if(!checkPermission(c)){layer.msg("没有权限");return}for(var l=$("#MaterialList tbody").find("tr"),t=[],i=0,p=l.length;i<p;i++)if(n=l.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(a=r.val(),u=n.find(".code").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("货品编号不能为空");return}if(f=n.find(".specification").val(),isStrEmptyOrUndefined(f)){layer.msg("请选择货品规格");return}if(e=n.find(".unit").val().trim(),isStrEmptyOrUndefined(e)){layer.msg("单位不能为空");return}if(o=n.find(".site").val(),isStrEmptyOrUndefined(o)){layer.msg("请选择货品场地");return}if(s=n.find(".price").val().trim(),isStrEmptyOrUndefined(s)){layer.msg("参考价格不能为空");return}if(h=n.find(".stock").val().trim(),isStrEmptyOrUndefined(h)){layer.msg("最低库存不能为空");return}v=n.find(".remark").val().trim();t.push({SpecificationId:f,SiteId:o,Code:u,Unit:e,Price:s,Stock:h,Remark:v,Id:a})}if(!t.length){layer.msg("请选择要保存的数据");return}y=function(){var n={};n.opType=c;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getMaterialList()})};showConfirm("保存",y)}function addMaterialModal(){var n,t,i,r;_addFirmwareUpload==null&&(_addFirmwareUpload=initFileInputMultiple("addImg",fileEnum.Material));$("#addImg").fileinput("clear");$("#addImgBox").find(".file-caption-name").attr("readonly",!0).attr("placeholder","请选择图片...");n=$("#categorySelect").val();n==0&&(n=$("#addCategorySelect option").eq(0).val());$("#addCategorySelect").val(n).trigger("change");new Promise(function(t){nameSelect(t,n,!0)}).then(function(i){return $("#addNameSelect").empty(),$("#addNameSelect").append(i),t=$("#addNameSelect").val(),new Promise(function(i){supplierSelect(i,n,t,!0)})}).then(function(r){return $("#addSupplierSelect").empty(),$("#addSupplierSelect").append(r),i=$("#addSupplierSelect").val(),new Promise(function(r){specificationSelect(r,n,t,i,!0)})}).then(function(n){$("#addSpecificationSelect").empty();$("#addSpecificationSelect").append(n)});r=$("#addSiteSelect option").eq(0).val();$("#addSiteSelect").val(r).trigger("change");$("#addCode").val("");$("#addStock").val("");$("#addUnit").val("");$("#addPrice").val("");$("#addRemark").val("");$("#addMaterialModal").modal("show")}function addMaterial(){var e=810,o,s,h,t,i,r,u,f,n,c,l;if(!checkPermission(e)){layer.msg("没有权限");return}if(o=$("#addCategorySelect").val(),isStrEmptyOrUndefined(o)){layer.msg("请选择类别");return}if(s=$("#addNameSelect").val(),isStrEmptyOrUndefined(s)){layer.msg("请选择名称");return}if(h=$("#addSupplierSelect").val(),isStrEmptyOrUndefined(h)){layer.msg("请选择供应商");return}if(t=$("#addSpecificationSelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择规格");return}if(i=$("#addSiteSelect").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择位置");return}if(r=$("#addCode").val().trim(),isStrEmptyOrUndefined(r)){layer.msg("请输入编号");return}if(u=$("#addStock").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("请输入最低库存");return}if(f=$("#addUnit").val().trim(),isStrEmptyOrUndefined(f)){layer.msg("请输入单位");return}n=$("#addPrice").val().trim();isStrEmptyOrUndefined(n)&&(n=0);c=$("#addRemark").val().trim();fileCallBack[fileEnum.Material]=function(o){var s,l,h;if(o.errno==0){s=[];for(l in o.data)s.push(o.data[l].newName);s=JSON.stringify(s);h={};h.opType=e;h.opData=JSON.stringify([{SpecificationId:t,SiteId:i,Code:r,Unit:f,Price:n,Stock:u,Images:s,Remark:c}]);ajaxPost("/Relay/Post",h,function(n){layer.msg(n.errmsg);$("#addMaterialModal").modal("hide");n.errno==0&&getMaterialList()})}};l=function(){$("#addImg").fileinput("upload")};showConfirm("添加",l)}function delMaterial(){var n=811,t,i;if(!checkPermission(n)){layer.msg("没有权限");return}if(!_materialIdData.length){layer.msg("请选择要删除的货品编号");return}t=_materialNameData.join("<br>");i=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_materialIdData});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getMaterialList()})};showConfirm(`删除以下货品编号：<pre style="color:red">${t}</pre>`,i)}function showImgModel(n,t,i,r,u,f,e,o){if(_updateFirmwareUpload==null&&(_updateFirmwareUpload=initFileInputMultiple("updateImg",fileEnum.Material)),$("#updateImg").fileinput("clear"),$("#updateImgBox").find(".file-caption-name").attr("readonly",!0).attr("placeholder","请选择张图片..."),$("#checkId").text(n),t=unescape(t),$("#codeName").text(t),i=unescape(i),$("#categoryName").text(i),r=unescape(r),$("#nameName").text(r),u=unescape(u),$("#supplierName").text(u),f=unescape(f),$("#specificationName").text(f),o=unescape(o),$("#siteName").text(o),e=unescape(e),$("#imgOld").empty(),$("#imgOldList").empty(),_imgNameData=[],isStrEmptyOrUndefined(e))$("#imgOld").append('图片：<font style="color:red" size=5>无<\/font>');else{$("#imgOld").append("图片：");e=e.split(",");_imgNameData=e;var s={type:fileEnum.Material,files:JSON.stringify(e)};ajaxPost("/Upload/Path",s,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for(r='<div class="imgOption col-lg-2 col-md-3 col-sm-4 col-xs-6"><div class="thumbnail"><img src={0} style="height:200px"><div class="caption text-center"><button type="button" class="btn btn-default glyphicon glyphicon-trash delImg" value="{1}"><\/button><\/div><\/div><\/div>',i="",t=0;t<n.data.length;t++)i+=r.format(n.data[t].path,e[t]);$("#imgOldList").append(i)})}$("#showImgModel").modal("show")}function updateImg(){var n=809,t;if(!checkPermission(n)){layer.msg("没有权限");return}fileCallBack[fileEnum.Material]=function(t){var u,f,i,e,r;if(t.errno==0){u=[];for(f in t.data)u.push(t.data[f].newName);i=_imgNameData.concat(u);i=JSON.stringify(i);e=$("#checkId").text();r={};r.opType=n;r.opData=JSON.stringify([{UpdateImage:!0,Images:i,Id:e}]);ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#showImgModel").modal("hide");n.errno==0&&getMaterialList()})}};t=function(){$("#updateImg").fileinput("upload")};showConfirm("操作",t)}function batchAddMaterialModal(){if(!checkPermission(810)){layer.msg("没有权限");return}$("#batchAddMaterial").removeAttr("disabled");$(".batchAddBtn").attr("disabled","disabled");resetBatchAddList();var n=new Promise(function(n){var t={};t.opType=816;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}_categoryData=t.datas;n("success")},0)}),t=new Promise(function(n){var t={};t.opType=824;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}_nameData=t.datas;n("success")},0)}),i=new Promise(function(n){var t={};t.opType=831;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}_supplierData=t.datas;n("success")},0)}),r=new Promise(function(n){var t={};t.opType=839;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}_specificationData=t.datas;n("success")},0)}),u=new Promise(function(n){var t={};t.opType=847;ajaxPost("/Relay/Post",t,function(t){if(t.errno!=0){layer.msg(t.errmsg);return}_siteData=t.datas;n("success")},0)});Promise.all([n,t,i,r,u]).then(()=>{$(".batchAddBtn").removeAttr("disabled")});$("#batchAddMaterialModal").modal("show")}function resetBatchAddList(){batchAddMax=batchAddMaxV=0;$("#batchAddList").empty()}function addOneBatchAddList(n=0,t=0,i=0,r=0,u=0){var e,o,f;if(batchAddMax++,batchAddMaxV++,e=batchAddMax,o=`
        <tr id="batchAdd${e}" value="${e}" xh="${batchAddMaxV}">
            <td style="vertical-align: inherit;"><span class="control-label xh" id="batchAddXh${e}">${batchAddMaxV}</span></td>
            <td><select class="ms2 form-control" id="batchAddLb${e}"></select></td>
            <td><select class="ms2 form-control" id="batchAddMc${e}"></select></td>
            <td><select class="ms2 form-control" id="batchAddGys${e}"></select></td>
            <td><select class="ms2 form-control" id="batchAddGg${e}"></select></td>
            <td><select class="ms2 form-control" id="batchAddWz${e}"></select></td>
            <td><input class="form-control text-center" id="batchAddBh${e}" maxlength="50"></td>
            <td><input class="form-control text-center" id="batchAddKc${e}" value="0" onkeyup="onInput(this, 8, 0)" onblur="onInputEnd(this)"></td>
            <td><input class="form-control text-center" id="batchAddDw${e}" maxlength="50"></td>
            <td><input class="form-control text-center" id="batchAddJg${e}" value="0" onkeyup="onInput(this, 8, 2)" onblur="onInputEnd(this)"></td>
            <td>
                <button type="button" class="btn btn-primary btn-sm" id="copyBatchAddList${e}" onclick="copyBatchAddList(${e})"><i class="fa fa-copy"></i></button>
                <button type="button" class="btn btn-danger btn-sm" id="delBatchAddList${e}" onclick="delBatchAddList(${e})"><i class="fa fa-minus"></i></button>
            </td>
        </tr>`,$("#batchAddList").append(o),f="#batchAddLb"+e,_categoryData&&_categoryData.length>0){n==0&&(n=_categoryData[0].Id);updateBatchAddSelect(f,n,_categoryData,"Category");$(f).on("select2:select",function(){var o,u,e;for(n=$(this).val(),o=$(this).parents("tr:first").attr("value"),u=0;u<_nameData.length;u++)if(e=_nameData[u],e.CategoryId==n){t=e.Id;break}for(f="#batchAddMc"+o,t=updateBatchAddSelect(f,t,_nameData,"Name","CategoryId",n),u=0;u<_supplierData.length;u++)if(e=_supplierData[u],e.NameId==t){i=e.Id;break}for(f="#batchAddGys"+o,i=updateBatchAddSelect(f,i,_supplierData,"Supplier","NameId",t),u=0;u<_specificationData.length;u++)if(e=_specificationData[u],e.SupplierId==i){r=e.Id;break}f="#batchAddGg"+o;updateBatchAddSelect(f,r,_specificationData,"Specification","SupplierId",i)});f="#batchAddMc"+e;t==0?t=updateBatchAddSelect(f,t,_nameData,"Name","CategoryId",n):updateBatchAddSelect(f,t,_nameData,"Name","CategoryId",n);$(f).on("select2:select",function(){var e,n,u;for(t=$(this).val(),e=$(this).parents("tr:first").attr("value"),n=0;n<_supplierData.length;n++)if(u=_supplierData[n],u.NameId==t){i=u.Id;break}for(f="#batchAddGys"+e,i=updateBatchAddSelect(f,i,_supplierData,"Supplier","NameId",t),n=0;n<_specificationData.length;n++)if(u=_specificationData[n],u.SupplierId==i){r=u.Id;break}f="#batchAddGg"+e;updateBatchAddSelect(f,r,_specificationData,"Specification","SupplierId",i)});f="#batchAddGys"+e;i==0?i=updateBatchAddSelect(f,i,_supplierData,"Supplier","NameId",t):updateBatchAddSelect(f,i,_supplierData,"Supplier","NameId",t);$(f).on("select2:select",function(){var u,n,t;for(i=$(this).val(),u=$(this).parents("tr:first").attr("value"),n=0;n<_specificationData.length;n++)if(t=_specificationData[n],t.SupplierId==i){r=t.Id;break}f="#batchAddGg"+u;updateBatchAddSelect(f,r,_specificationData,"Specification","SupplierId",i)});f="#batchAddGg"+e;updateBatchAddSelect(f,r,_specificationData,"Specification","SupplierId",i);f="#batchAddWz"+e;u=updateBatchAddSelect(f,u,_siteData,"Site");$("#batchAdd"+e).find(".ms2").css("width","100%");$("#batchAdd"+e).find(".ms2").select2({width:"120px"})}}function updateBatchAddSelect(n,t,i,r,u="",f=-1){var h=0,o,s,e;for($(n).empty(),o="",s=0;s<i.length;s++)e=i[s],f!=-1?f!=0&&e[u]==f&&(o+=`<option value="${e.Id}">${e[r]}</option>`,h==0&&(h=e.Id)):o+=`<option value="${e.Id}">${e[r]}</option>`;return $(n).append(o),t!=0&&$(n).val(t).trigger("change"),h}function delBatchAddList(n){var i,r,t,u;for($("#batchAddList").find(`tr[value=${n}]:first`).remove(),batchAddMaxV--,i=1,r=$("#batchAddList tr"),t=0;t<r.length;t++)$(r[t]).attr("xh",i),u=$(r[t]).attr("value"),$("#batchAddXh"+u).html(i),i++}function copyBatchAddList(n){var t=$(`#batchAddLb${n}`).val(),i=$(`#batchAddMc${n}`).val(),r=$(`#batchAddGys${n}`).val(),u=$(`#batchAddGg${n}`).val(),f=$(`#batchAddWz${n}`).val();addOneBatchAddList(t,i,r,u,f)}function batchAddMaterial(){for(var h=810,t=[],s,n=1;n<=batchAddMax;n++)if($("#batchAddBh"+n).length>0){var i=$("#batchAddGg"+n).val(),r=$("#batchAddWz"+n).val(),u=$("#batchAddBh"+n).val().trim(),f=$("#batchAddKc"+n).val().trim(),e=$("#batchAddDw"+n).val().trim(),o=$("#batchAddJg"+n).val().trim();if(isStrEmptyOrUndefined(i)){layer.msg("请选择规格");return}if(isStrEmptyOrUndefined(r)){layer.msg("请选择位置");return}if(isStrEmptyOrUndefined(u)){layer.msg("货品编号不能为空");return}if(isStrEmptyOrUndefined(f)){layer.msg("请输入最低库存");return}if(isStrEmptyOrUndefined(e)){layer.msg("请输入单位");return}if(isStrEmptyOrUndefined(o)){layer.msg("请输入价格");return}t.push({SpecificationId:i,SiteId:r,Code:u,Stock:f,Unit:e,Price:o})}if(t.length<=0){layer.msg("请输入货品");return}s=function(){function i(){$("#batchAddMaterial").removeAttr("disabled")}$("#batchAddMaterial").attr("disabled","disabled");var n={};n.opType=h;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){var o=n.errmsg,s,r,u,i,f,e,t,h;if(n.errno==0)$("#batchAddMaterialModal").modal("hide"),getMaterialList();else if(n.datas.length>0){for(s=`[{0},{1}]`,r=[],u=0;u<n.datas.length;u++)if(i=n.datas[u],typeof i=="string")r.push(i);else{for(f="",e="",t=0;t<_specificationData.length;t++)_specificationData[t].Id==i.SpecificationId&&(f=_specificationData[t].Specification);for(t=0;t<_siteData.length;t++)_siteData[t].Id==i.SiteId&&(e=_siteData[t].Site);f!=""&&e!=""&&r.push(s.format(f,e))}h=`<span class='text-red'>${r.join(", ")}</span></br>`;o=h+o}layer.msg(o);$("#batchAddMaterial").removeAttr("disabled")});setTimeout(i,1e4)};showConfirm("添加",s)}var _categorySelect=null,_siteSelect=null,_addFirmwareUpload=null,_materialIdData=[],_materialNameData=[],_updateFirmwareUpload=null,_imgNameData=null,_categoryData=null,_nameData=null,_supplierData=null,_specificationData=null,_siteData=null,batchAddMax=0,batchAddMaxV=0;