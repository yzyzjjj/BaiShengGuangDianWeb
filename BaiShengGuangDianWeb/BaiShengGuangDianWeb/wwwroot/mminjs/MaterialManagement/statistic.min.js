function pageReady(){$(".ms2").select2({matcher});$("#materialMonth").val(getNowMonth()).datepicker("update");new Promise(n=>getAllSelect(n)).then(n=>allCodeSelect(n,0));$("#materialCategory").on("select2:select",function(){new Promise(n=>getAllSelect(n,{categoryId:$(this).val(),siteId:-1})).then(n=>allCodeSelect(n,1))});$("#materialName").on("select2:select",function(){new Promise(n=>getAllSelect(n,{categoryId:$("#materialCategory").val(),nameId:$(this).val(),siteId:-1})).then(n=>allCodeSelect(n,2))});$("#materialSupplier").on("select2:select",function(){new Promise(n=>getAllSelect(n,{categoryId:$("#materialCategory").val(),nameId:$("#materialName").val(),supplierId:$(this).val(),siteId:-1})).then(n=>allCodeSelect(n,3))});$("#materialSpecification,#materialSite").on("select2:select",()=>getMaterialList());$("#materialMonth").on("changeDate",()=>getMaterialList());const n=dataTableConfig();n.dom='<"pull-left"l><"pull-right"B><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>';n.buttons=[{extend:"excel",text:"导出Excel",className:"btn-primary btn-sm",filename:`月度物料结存表_${getDate()}`}];n.addColumns([{data:"Code",title:"物料编码"},{data:"Category",title:"类别"},{data:"Name",title:"名称"},{data:"Supplier",title:"供应商"},{data:"Specification",title:"规格"},{data:"Site",title:"位置"},{data:"Unit",title:"单位"},{data:"TodayPrice",title:"价格"},{data:"Stock",title:"最低库存"},{data:"LastNumber",title:"月初数量"},{data:"LastAmount",title:"月初金额"},{data:"Increase",title:"本月入库数量"},{data:"IncreaseAmount",title:"本月入库金额"},{data:"Consume",title:"本月领用数量"},{data:"ConsumeAmount",title:"本月领用金额"},{data:"TodayNumber",title:"本月结存数量"},{data:"TodayAmount",title:"本月结存金额"}]);_materialTable=$("#materialList").DataTable(n);$("#materialList").addClass("hidden")}function getAllSelect(n,t){const i={};i.opType=805;t&&(i.opData=JSON.stringify(t));ajaxPost("/Relay/Post",i,t=>{if(t.errno!=0){layer.msg(t.errmsg);return}n&&n(t)})}function allCodeSelect(n,t){switch(t){case 0:$("#materialCategory").empty().append(`<option value="0">所有类别</option>${setOptions(n.Categories,"Category")}`);$("#materialSite").empty().append(`<option value="0">所有位置</option>${setOptions(n.Sites,"Site")}`);case 1:$("#materialName").empty().append(`<option value="0">所有名称</option>${setOptions(n.Names,"Name")}`);case 2:$("#materialSupplier").empty().append(`<option value="0">所有供应商</option>${setOptions(n.Suppliers,"Supplier")}`);case 3:$("#materialSpecification").empty().append(`<option value="0">所有规格</option>${setOptions(n.Specifications,"Specification")}`)}getMaterialList()}function getMaterialList(){$("#materialInfo").addClass("hidden");let n=$("#materialMonth").val();if(isStrEmptyOrUndefined(n)){layer.msg("请选择月份");return}n+="-01";const i=$("#materialCategory").val();if(isStrEmptyOrUndefined(i)){layer.msg("请选择类别");return}const r=$("#materialName").val();if(isStrEmptyOrUndefined(r)){layer.msg("请选择名称");return}const u=$("#materialSupplier").val();if(isStrEmptyOrUndefined(u)){layer.msg("请选择供应商");return}const f=$("#materialSpecification").val();if(isStrEmptyOrUndefined(f)){layer.msg("请选择规格");return}const e=$("#materialSite").val();if(isStrEmptyOrUndefined(e)){layer.msg("请选择位置");return}const t={};t.opType=891;t.opData=JSON.stringify({day:n,interval:3,categoryId:i,nameId:r,supplierId:u,specificationId:f,siteId:e});ajaxPost("/Relay/Post",t,n=>{if(n.errno!=0){layer.msg(n.errmsg);return}const t=n.datas;let i=0,r=0,u=0;for(let n=0,f=t.length;n<f;n++){const f=t[n];i+=f.IncreaseAmount;r+=f.ConsumeAmount;u+=f.TodayAmount}$("#entryMoney").text(parseFloat(i.toFixed(5)));$("#consumeMoney").text(parseFloat(r.toFixed(5)));$("#cashMoney").text(parseFloat(u.toFixed(5)));$("#materialInfo").removeClass("hidden");$("#materialList").removeClass("hidden");updateTable(_materialTable,t)})}let _materialTable=null;