function pageReady(){$(".ms2").select2();var n=new Promise(function(n){categorySelect(n)});n.then(function(n){return new Promise(function(t){n(t)})}).then(function(n){n()});$("#categorySelect").on("select2:select",function(){var n=new Promise(function(n){nameSelect(n)});n.then(function(n){n()})});$("#nameSelect").on("select2:select",function(){getSupplierList()});$("#supplierList").on("change",".category",function(){var n=$(this).parents("tr"),t=$(this).val();new Promise(function(n){tableNameSelect(n,t,null,0)}).then(function(t){n.find(".name").empty();n.find(".name").append(t)})});$("#addCategorySelect").on("select2:select",function(){var n=$(this).val();tableNameSelect(null,n,$("#addNameSelect"),1)})}function categorySelect(n){var i=816,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;ajaxPost("/Relay/Post",t,function(t){var u;if(t.errno!=0){layer.msg(t.errmsg);return}$(".categorySelect").empty();for(var f=t.datas,e=f.length,o='<option value = "{0}">{1}<\/option>',r="",i=0;i<e;i++)u=f[i],r+=o.format(u.Id,u.Category);e&&$("#categorySelect").append(o.format(0,"所有类别"));$(".categorySelect").append(r);_categorySelect=`<select class="form-control textIn category hidden" style="width:100px">${r}</select>`;isStrEmptyOrUndefined(n)||n(nameSelect)})}function nameSelect(n){var u=824,r,t,i;if(!checkPermission(u)){layer.msg("没有权限");return}if(r={},t=$("#categorySelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}t!=0&&(r.categoryId=t);i={};i.opType=u;i.opData=JSON.stringify(r);ajaxPost("/Relay/Post",i,function(t){var r;if(t.errno!=0){layer.msg(t.errmsg);return}$("#nameSelect").empty();for(var u=t.datas,f=u.length,e='<option value = "{0}">{1}<\/option>',o="",i=0;i<f;i++)r=u[i],o+=e.format(r.Id,r.Name);f&&$("#nameSelect").append(e.format(0,"所有名称"));$("#nameSelect").append(o);isStrEmptyOrUndefined(n)||n(getSupplierList)})}function tableNameSelect(n,t,i,r){var f=824,u;if(!checkPermission(f)){layer.msg("没有权限");return}u={};u.opType=f;u.opData=JSON.stringify({categoryId:t});ajaxPost("/Relay/Post",u,function(t){var f;if(t.errno!=0){layer.msg(t.errmsg);return}for(var e=t.datas,o=e.length,u="",r=0;r<o;r++)f=e[r],u+='<option value = "{0}">{1}<\/option>'.format(f.Id,f.Name);isStrEmptyOrUndefined(i)||(i.empty(),i.append(u));isStrEmptyOrUndefined(n)||n(u)},r)}function getSupplierList(){var u=831,n,t,i,r;if(!checkPermission(u)){layer.msg("没有权限");return}if(_supplierIdData=[],_supplierNameData=[],n={},t=$("#categorySelect").val(),isStrEmptyOrUndefined(t)){layer.msg("请选择货品类别");return}if(t!=0&&(n.categoryId=t),i=$("#nameSelect").val(),isStrEmptyOrUndefined(i)){layer.msg("请选择货品名称");return}i!=0&&(n.nameId=i);r={};r.opType=u;r.opData=JSON.stringify(n);ajaxPost("/Relay/Post",r,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=0,u=function(){return++r},f=function(n){return`<span class="textOn" id=${n.CategoryId}>${n.Category}</span>${_categorySelect}`},e=function(n){return`<span class="textOn" id=${n.NameId}>${n.Name}</span><select class="form-control textIn name hidden" style="width:100px"></select>`},o=function(n){return`<span class="textOn supplierOld">${n}</span><input type="text" class="form-control text-center textIn supplier hidden" maxlength="20" style="width:120px" value=${n}>`},s=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+`<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"></textarea>`};$("#supplierList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i,orderable:!1},{data:null,title:"序号",render:u},{data:null,title:"类别",render:f},{data:null,title:"名称",render:e},{data:"Supplier",title:"供应商",render:o},{data:"Remark",title:"备注",render:s}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#supplierList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),r=$(this).val(),u=n.find(".supplierOld").text(),t,i;$(this).is(":checked")?(_supplierIdData.push(r),_supplierNameData.push(u),t=n.find(".textOn"),i=t.eq(0).attr("id"),new Promise(function(n){tableNameSelect(n,i,null,0)}).then(function(r){n.find(".name").empty();n.find(".name").append(r);var u=t.eq(1).attr("id"),f=t.eq(2).text(),e=t.eq(3).attr("title");n.find(".category").val(i);n.find(".name").val(u);n.find(".supplier").val(f);n.find(".remark").val(e);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden")})):(_supplierIdData.splice(_supplierIdData.indexOf(r),1),_supplierNameData.splice(_supplierNameData.indexOf(u),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden"))})}})})}function updateSupplier(){var e=832,n,r,s,u,f,h,c;if(!checkPermission(e)){layer.msg("没有权限");return}for(var o=$("#supplierList tbody").find("tr"),t=[],i=0,l=o.length;i<l;i++)if(n=o.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(s=r.val(),u=n.find(".name").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择名称");return}if(f=n.find(".supplier").val().trim(),isStrEmptyOrUndefined(f)){layer.msg("供应商不能为空");return}h=n.find(".remark").val().trim();t.push({NameId:u,Supplier:f,Remark:h,Id:s})}if(!t.length){layer.msg("请选择要保存的数据");return}c=function(){var n={};n.opType=e;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getSupplierList()})};showConfirm("保存",c)}function addSupplierModal(){var n=$("#categorySelect").val();n==0&&(n=$("#addCategorySelect option").eq(0).val());$("#addCategorySelect").val(n).trigger("change");tableNameSelect(null,n,$("#addNameSelect"),0);$("#addSupplier").val("");$("#addRemark").val("");$("#addSupplierModal").modal("show")}function addSupplier(){var i=833,r,n,t,u,f;if(!checkPermission(i)){layer.msg("没有权限");return}if(r=$("#addCategorySelect").val(),isStrEmptyOrUndefined(r)){layer.msg("请选择类别");return}if(n=$("#addNameSelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择名称");return}if(t=$("#addSupplier").val().trim(),isStrEmptyOrUndefined(t)){layer.msg("新供应商不能为空");return}u=$("#addRemark").val().trim();f=function(){var r={};r.opType=i;r.opData=JSON.stringify({NameId:n,Supplier:t,Remark:u});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#addSupplierModal").modal("hide");n.errno==0&&getSupplierList()})};showConfirm("添加",f)}function delSupplier(){var n=834,t,i;if(!checkPermission(n)){layer.msg("没有权限");return}if(!_supplierIdData.length){layer.msg("请选择要删除的货品供应商");return}t=_supplierNameData.join("<br>");i=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_supplierIdData});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getSupplierList()})};showConfirm(`删除以下货品供应商：<pre style="color:red">${t}</pre>`,i)}var _categorySelect=null,_supplierIdData=[],_supplierNameData=[];