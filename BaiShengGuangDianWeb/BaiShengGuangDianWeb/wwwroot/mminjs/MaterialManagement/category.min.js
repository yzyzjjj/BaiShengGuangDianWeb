function pageReady(){getCategoryList()}function getCategoryList(){var t=816,n;if(!checkPermission(t)){layer.msg("没有权限");return}_categoryIdData=[];_categoryNameData=[];n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=0,u=function(){return++r},f=function(n){return`<span class="textOn categoryOld">${n}</span><input type="text" class="form-control text-center textIn category hidden" maxlength="20" style="width:120px" value=${n}>`},e=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+`<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"></textarea>`};$("#categoryList").DataTable({destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i,orderable:!1},{data:null,title:"序号",render:u},{data:"Category",title:"类别",render:f},{data:"Remark",title:"备注",render:e}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#categoryList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),t=$(this).val(),i=n.find(".categoryOld").text();if($(this).is(":checked")){_categoryIdData.push(t);_categoryNameData.push(i);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var r=n.find(".textOn"),u=r.eq(0).text(),f=r.eq(1).attr("title");n.find(".category").val(u);n.find(".remark").val(f)}else _categoryIdData.splice(_categoryIdData.indexOf(t),1),_categoryNameData.splice(_categoryNameData.indexOf(i),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateCategory(){var f=817,n,r,o,u,s,h;if(!checkPermission(f)){layer.msg("没有权限");return}for(var e=$("#categoryList tbody").find("tr"),t=[],i=0,c=e.length;i<c;i++)if(n=e.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(o=r.val(),u=n.find(".category").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("类别不能为空");return}s=n.find(".remark").val().trim();t.push({Category:u,Remark:s,Id:o})}if(!t.length){layer.msg("请选择要保存的数据");return}h=function(){var n={};n.opType=f;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCategoryList()})};showConfirm("保存",h)}function addCategoryModal(){$("#addCategory").val("");$("#addRemark").val("");$("#addCategoryModal").modal("show")}function addCategory(){var t=818,n,i,r;if(!checkPermission(t)){layer.msg("没有权限");return}if(n=$("#addCategory").val().trim(),isStrEmptyOrUndefined(n)){layer.msg("新类别不能为空");return}i=$("#addRemark").val().trim();r=function(){var r={};r.opType=t;r.opData=JSON.stringify({Category:n,Remark:i});ajaxPost("/Relay/Post",r,function(n){layer.msg(n.errmsg);$("#addCategoryModal").modal("hide");n.errno==0&&getCategoryList()})};showConfirm("添加",r)}function delCategory(){var n=819,t,i;if(!checkPermission(n)){layer.msg("没有权限");return}if(!_categoryIdData.length){layer.msg("请选择要删除的货品类别");return}t=_categoryNameData.join("<br>");i=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_categoryIdData});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getCategoryList()})};showConfirm(`删除以下货品类别：<pre style="color:red">${t}</pre>`,i)}var _categoryIdData=[],_categoryNameData=[];