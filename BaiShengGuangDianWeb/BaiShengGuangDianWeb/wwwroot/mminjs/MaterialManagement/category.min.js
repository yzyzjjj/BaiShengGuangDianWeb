function pageReady(){_permissionList[554]={uIds:["updateCategoryBtn"]};_permissionList[555]={uIds:["addCategoryModalBtn"]};_permissionList[556]={uIds:["delCategoryBtn"]};_permissionList=checkPermissionUi(_permissionList);getCategoryList()}function getCategoryList(){_categoryIdData=[];_categoryNameData=[];var n={};n.opType=816;ajaxPost("/Relay/Post",n,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=function(n,t,i,r){return++r.row},u=function(n){return`<span class="textOn categoryOld">${n}</span><input type="text" class="form-control text-center textIn category hidden" maxlength="20" style="width:120px" value=${n}>`},f=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+'<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"><\/textarea>'},e=_permissionList[554].have||_permissionList[556].have;$("#categoryList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i,orderable:!1,visible:e},{data:null,title:"序号",render:r},{data:"Category",title:"类别",render:u},{data:"Remark",title:"备注",render:f}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#categoryList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),t=$(this).val(),i=n.find(".categoryOld").text();if($(this).is(":checked")){_categoryIdData.push(t);_categoryNameData.push(i);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var r=n.find(".textOn"),u=r.eq(0).text(),f=r.eq(1).attr("title");n.find(".category").val(u);n.find(".remark").val(f)}else _categoryIdData.splice(_categoryIdData.indexOf(t),1),_categoryNameData.splice(_categoryNameData.indexOf(i),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateCategory(){for(var f=$("#categoryList tbody").find("tr"),t=[],i=0,h=f.length,n,r,e,u,o,s;i<h;i++)if(n=f.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(e=r.val(),u=n.find(".category").val().trim(),isStrEmptyOrUndefined(u)){layer.msg("类别不能为空");return}o=n.find(".remark").val().trim();t.push({Category:u,Remark:o,Id:e})}if(!t.length){layer.msg("请选择要保存的数据");return}s=function(){var n={};n.opType=817;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCategoryList()})};showConfirm("保存",s)}function addCategoryModal(){$("#addCategory").val("");$("#addRemark").val("");$("#addCategoryModal").modal("show")}function addCategory(){var n=$("#addCategory").val().trim(),t,i;if(isStrEmptyOrUndefined(n)){layer.msg("新类别不能为空");return}t=$("#addRemark").val().trim();i=function(){var i={};i.opType=818;i.opData=JSON.stringify({Category:n,Remark:t});ajaxPost("/Relay/Post",i,function(n){layer.msg(n.errmsg);$("#addCategoryModal").modal("hide");n.errno==0&&getCategoryList()})};showConfirm("添加",i)}function delCategory(){if(!_categoryIdData.length){layer.msg("请选择要删除的货品类别");return}var n=_categoryNameData.join("<br>"),t=function(){var n={};n.opType=819;n.opData=JSON.stringify({ids:_categoryIdData});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getCategoryList()})};showConfirm(`删除以下货品类别：<pre style="color:red">${n}</pre>`,t)}var _permissionList=[],_categoryIdData=[],_categoryNameData=[];