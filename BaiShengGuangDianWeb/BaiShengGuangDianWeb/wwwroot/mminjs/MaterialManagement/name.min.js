function pageReady(){$(".ms2").select2();surveyor();$("#categorySelect").on("select2:select",function(){getNameList()})}function surveyor(){var t=816,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;ajaxPost("/Relay/Post",n,function(n){var r;if(n.errno!=0){layer.msg(n.errmsg);return}$("#categorySelect").empty();for(var u=n.datas,f=u.length,e='<option value = "{0}">{1}<\/option>',i="",t=0;t<f;t++)r=u[t],i+=e.format(r.Id,r.Category);f&&$("#categorySelect").append(e.format(0,"所有类别"));$("#categorySelect").append(i);$("#addCategorySelect").append(i);_categorySelect=`<select class="form-control textIn category hidden" style="width:100px">${i}</select>`;getNameList()})}function getNameList(){var r=824,i,n,t;if(!checkPermission(r)){layer.msg("没有权限");return}if(_nameIdData=[],_nameNameData=[],i={},n=$("#categorySelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择货品类别");return}n!=0&&(i.categoryId=n);t={};t.opType=r;t.opData=JSON.stringify(i);ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=0,u=function(){return++r},f=function(n){return`<span class="textOn" id=${n.CategoryId}>${n.Category}</span>${_categorySelect}`},e=function(n){return`<span class="textOn nameOld">${n}</span><input type="text" class="form-control text-center textIn name hidden" maxlength="20" style="width:120px" value=${n}>`},o=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+`<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"></textarea>`};$("#nameList").DataTable({dom:'<"pull-left"l><"pull-right"f>rtip',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i},{data:null,title:"序号",render:u},{data:null,title:"类别",render:f},{data:"Name",title:"名称",render:e},{data:"Remark",title:"备注",render:o}],columnDefs:[{orderable:!1,targets:0}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#nameList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),i=$(this).val(),r=n.find(".nameOld").text();if($(this).is(":checked")){_nameIdData.push(i);_nameNameData.push(r);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var t=n.find(".textOn"),u=t.eq(0).attr("id"),f=t.eq(1).text(),e=t.eq(2).attr("title");n.find(".category").val(u);n.find(".name").val(f);n.find(".remark").val(e)}else _nameIdData.splice(_nameIdData.indexOf(i),1),_nameNameData.splice(_nameNameData.indexOf(r),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateName(){var e=825,n,r,s,u,f,h,c;if(!checkPermission(e)){layer.msg("没有权限");return}for(var o=$("#nameList tbody").find("tr"),t=[],i=0,l=o.length;i<l;i++)if(n=o.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(s=r.val(),u=n.find(".category").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择货品类别");return}if(f=n.find(".name").val().trim(),isStrEmptyOrUndefined(f)){layer.msg("名称不能为空");return}h=n.find(".remark").val().trim();t.push({CategoryId:u,Name:f,Remark:h,Id:s})}if(!t.length){layer.msg("请选择要保存的数据");return}c=function(){var n={};n.opType=e;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getNameList()})};showConfirm("保存",c)}function addNameModal(){var n=$("#categorySelect").val(),t;n==0?(t=$("#addCategorySelect option").eq(0).val(),$("#addCategorySelect").val(t).trigger("change")):$("#addCategorySelect").val(n).trigger("change");$("#addName").val("");$("#addRemark").val("");$("#addNameModal").modal("show")}function addCategory(){var i=826,n,t,r,u;if(!checkPermission(i)){layer.msg("没有权限");return}if(n=$("#addCategorySelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择类别");return}if(t=$("#addName").val().trim(),isStrEmptyOrUndefined(t)){layer.msg("新名称不能为空");return}r=$("#addRemark").val().trim();u=function(){var u={};u.opType=i;u.opData=JSON.stringify({CategoryId:n,Name:t,Remark:r});ajaxPost("/Relay/Post",u,function(t){if(layer.msg(t.errmsg),$("#addNameModal").modal("hide"),t.errno==0){var i=$("#categorySelect").val();(i==0||i==n)&&getNameList()}})};showConfirm("添加",u)}function delName(){var n=827,t,i;if(!checkPermission(n)){layer.msg("没有权限");return}if(!_nameIdData.length){layer.msg("请选择要删除的货品名称");return}t=_nameNameData.join("<br>");i=function(){var t={};t.opType=n;t.opData=JSON.stringify({ids:_nameIdData});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getNameList()})};showConfirm(`删除以下货品名称：<pre style="color:red">${t}</pre>`,i)}var _categorySelect=null,_nameIdData=[],_nameNameData=[];