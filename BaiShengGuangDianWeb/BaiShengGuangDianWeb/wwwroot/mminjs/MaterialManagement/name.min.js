function pageReady(){_permissionList[561]={uIds:["updateNameBtn"]};_permissionList[562]={uIds:["addNameModalBtn"]};_permissionList[563]={uIds:["delNameBtn"]};_permissionList=checkPermissionUi(_permissionList);$(".ms2").select2();surveyor();$("#categorySelect").on("select2:select",function(){getNameList()})}function surveyor(){var n={};n.opType=816;ajaxPost("/Relay/Post",n,function(n){var r;if(n.errno!=0){layer.msg(n.errmsg);return}$("#categorySelect").empty();for(var u=n.datas,f=u.length,e='<option value = "{0}">{1}<\/option>',i="",t=0;t<f;t++)r=u[t],i+=e.format(r.Id,r.Category);f&&$("#categorySelect").append(e.format(0,"所有类别"));$("#categorySelect").append(i);$("#addCategorySelect").append(i);_categorySelect=`<select class="form-control textIn category hidden" style="width:100px">${i}</select>`;getNameList()})}function getNameList(){var i,n,t;if(_nameIdData=[],_nameNameData=[],i={},n=$("#categorySelect").val(),isStrEmptyOrUndefined(n)){layer.msg("请选择货品类别");return}n!=0&&(i.categoryId=n);t={};t.opType=824;t.opData=JSON.stringify(i);ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas,i=function(n){return`<input type="checkbox" class="icb_minimal isEnable" value=${n}>`},r=function(n,t,i,r){return++r.row},u=function(n){return`<span class="textOn" id=${n.CategoryId}>${n.Category}</span>${_categorySelect}`},f=function(n){return`<span class="textOn nameOld">${n}</span><input type="text" class="form-control text-center textIn name hidden" maxlength="20" style="width:120px" value=${n}>`},e=function(n){return(n.length>tdShowLength?`<span title = "${n}" class="textOn" onclick = "showAllContent('${escape(n)}')">${n.substring(0,tdShowLength)}...</span>`:`<span title = "${n}" class="textOn">${n}</span>`)+'<textarea class="form-control textIn remark hidden" maxlength = "500" style = "resize: vertical;width:250px;margin:auto"><\/textarea>'},o=_permissionList[561].have||_permissionList[563].have;$("#nameList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t,aaSorting:[[1,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:"Id",title:"选择",render:i,orderable:!1,visible:o},{data:null,title:"序号",render:r},{data:null,title:"类别",render:u},{data:"Name",title:"名称",render:f},{data:"Remark",title:"备注",render:e}],drawCallback:function(){$(this).find(".icb_minimal").iCheck({labelHover:!1,cursor:!0,checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",increaseArea:"20%"});$("#nameList .isEnable").on("ifChanged",function(){var n=$(this).parents("tr"),i=$(this).val(),r=n.find(".nameOld").text();if($(this).is(":checked")){_nameIdData.push(i);_nameNameData.push(r);n.find(".textIn").removeClass("hidden").siblings(".textOn").addClass("hidden");var t=n.find(".textOn"),u=t.eq(0).attr("id"),f=t.eq(1).text(),e=t.eq(2).attr("title");n.find(".category").val(u);n.find(".name").val(f);n.find(".remark").val(e)}else _nameIdData.splice(_nameIdData.indexOf(i),1),_nameNameData.splice(_nameNameData.indexOf(r),1),n.find(".textOn").removeClass("hidden").siblings(".textIn").addClass("hidden")})}})})}function updateName(){for(var e=$("#nameList tbody").find("tr"),t=[],i=0,c=e.length,n,r,o,u,f,s,h;i<c;i++)if(n=e.eq(i),r=n.find(".isEnable"),r.is(":checked")){if(o=r.val(),u=n.find(".category").val(),isStrEmptyOrUndefined(u)){layer.msg("请选择货品类别");return}if(f=n.find(".name").val().trim(),isStrEmptyOrUndefined(f)){layer.msg("名称不能为空");return}s=n.find(".remark").val().trim();t.push({CategoryId:u,Name:f,Remark:s,Id:o})}if(!t.length){layer.msg("请选择要保存的数据");return}h=function(){var n={};n.opType=825;n.opData=JSON.stringify(t);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getNameList()})};showConfirm("保存",h)}function addNameModal(){var n=$("#categorySelect").val(),t;n==0?(t=$("#addCategorySelect option").eq(0).val(),$("#addCategorySelect").val(t).trigger("change")):$("#addCategorySelect").val(n).trigger("change");$("#addName").val("");$("#addRemark").val("");$("#addNameModal").modal("show")}function addCategory(){var n=$("#addCategorySelect").val(),t,i,r;if(isStrEmptyOrUndefined(n)){layer.msg("请选择类别");return}if(t=$("#addName").val().trim(),isStrEmptyOrUndefined(t)){layer.msg("新名称不能为空");return}i=$("#addRemark").val().trim();r=function(){var r={};r.opType=826;r.opData=JSON.stringify({CategoryId:n,Name:t,Remark:i});ajaxPost("/Relay/Post",r,function(t){if(layer.msg(t.errmsg),$("#addNameModal").modal("hide"),t.errno==0){var i=$("#categorySelect").val();(i==0||i==n)&&getNameList()}})};showConfirm("添加",r)}function delName(){if(!_nameIdData.length){layer.msg("请选择要删除的货品名称");return}var n=_nameNameData.join("<br>"),t=function(){var n={};n.opType=827;n.opData=JSON.stringify({ids:_nameIdData});ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getNameList()})};showConfirm(`删除以下货品名称：<pre style="color:red">${n}</pre>`,t)}var _permissionList=[],_categorySelect=null,_nameIdData=[],_nameNameData=[];