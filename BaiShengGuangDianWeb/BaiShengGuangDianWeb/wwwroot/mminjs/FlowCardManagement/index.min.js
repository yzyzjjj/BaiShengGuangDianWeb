function pageReady(){$(".ms2").css("width","100%");$(".ms2").select2();$("#selectPlanList").select2();$("#selectJhList").select2();$("#selectYlList").select2();$("#flowCardStartDate").val(getDate()).datepicker("update");$("#flowCardEndDate").val(getDate()).datepicker("update");$("#jhStartDate").val(getDate()).datepicker("update");$("#jhEndDate").val(getDate()).datepicker("update");$("#ylStartDate").val(getDate()).datepicker("update");$("#ylEndDate").val(getDate()).datepicker("update");checkPermission(210)||$("#showAddFlowCardModel").addClass("hidden");checkPermission(220)||$("#showProductionProcessModel").addClass("hidden");checkPermission(237)||$("#showAddRawMateriaModel").addClass("hidden");selectPlan();selectRaw();$(".fcHead input,.fcHead span").css("verticalAlign","middle");$(".jhHead input,.jhHead span").css("verticalAlign","middle");$(".ylHead input,.ylHead span").css("verticalAlign","middle");$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"});$(".fcHead label").on("ifChanged",function(){var n=$(this).index();$(this).find(".icb_minimal").is(":checked")?($(".fcBody").eq(n).removeClass("hidden"),n==1&&($("#flowCardStartDate").val(getDate()).datepicker("update"),$("#flowCardEndDate").val(getDate()).datepicker("update"))):($(".fcBody").eq(n).addClass("hidden"),n==0&&$("#flowCardId").val(""),n==2&&$("#selectPlanList").val($("#selectPlanList").find("option:first").val()).trigger("change"));$(".fcHead .icb_minimal").is(":checked")?$("#fcBtn").addClass("hidden"):$("#fcBtn").removeClass("hidden")});$(".jhHead label").on("ifChanged",function(){var n=$(this).index();$(this).find(".icb_minimal").is(":checked")?($(".jhBody").eq(n).removeClass("hidden"),n==1&&($("#jhStartDate").val(getDate()).datepicker("update"),$("#jhEndDate").val(getDate()).datepicker("update"))):($(".jhBody").eq(n).addClass("hidden"),n==0&&$("#selectJhList").val($("#selectJhList").find("option:first").val()).trigger("change"));$(".jhHead .icb_minimal").is(":checked")?$("#jhBtn").addClass("hidden"):$("#jhBtn").removeClass("hidden")});$(".ylHead label").on("ifChanged",function(){var n=$(this).index();$(this).find(".icb_minimal").is(":checked")?($(".ylBody").eq(n).removeClass("hidden"),n==1&&($("#ylStartDate").val(getDate()).datepicker("update"),$("#ylEndDate").val(getDate()).datepicker("update"))):($(".ylBody").eq(n).addClass("hidden"),n==0&&$("#selectYlList").val($("#selectYlList").find("option:first").val()).trigger("change"));$(".ylHead .icb_minimal").is(":checked")?$("#ylBtn").addClass("hidden"):$("#ylBtn").removeClass("hidden")});pcAndroid()?$("#upload").addClass("hidden"):$("#scanning").addClass("hidden");$("#scanning").on("click",function(){new Promise(function(n){showPrintModal(n)}).then(n=>{n&&$("#flowCardId").val(n.split(",")[2])})});$("#upload").on("click",function(){$("#file").trigger("click")});$("#file").on("change",function(){addCover();new Promise(function(n){printImgUp(n,this)}.bind(this)).then(n=>{removeCover(),$(this).val(""),n&&$("#flowCardId").val(n.split(",")[2])})})}function showAddFlowCardModel(){hideClassTip("adt");$("#afRawMaterialQuantity").val("");$("#afStartFlowCard").val("");$("#afFlowCardNumber").val("1");$("#afSender").val("");$("#afInboundNum").val("");$("#afRemarks").val("");var n=new Promise(function(n){var i=215,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var f,r,i,u;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}for($("#afProductionProcess").empty(),f='<option value="{0}">{1}<\/option>',r="",i=0;i<t.datas.length;i++)u=t.datas[i],r+=f.format(u.Id,u.ProductionProcessName);$("#afProductionProcess").append(r)},0)}),t=new Promise(function(n){var i=232,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",t,function(t){var f,r,i,u;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}for($("#afRawMateria").empty(),f='<option value="{0}">{1}<\/option>',r="",i=0;i<t.datas.length;i++)u=t.datas[i],r+=f.format(u.Id,u.RawMateriaName);$("#afRawMateria").append(r)},0)});Promise.all([n,t]).then(()=>{$("#addFlowCardModel").modal("show")})}function addFlowCard(){var i=210,f,n,o;if(!checkPermission(i)){layer.msg("没有权限");return}var s=$("#afProductionProcess").val().trim(),h=$("#afRawMateria").val().trim(),t=$("#afRawMaterialQuantity").val().trim(),c=$("#afPriority").val().trim(),l=$("#afInboundNum").val().trim(),a=$("#afRemarks").val().trim(),v=$("#afSender").val().trim(),r=$("#afStartFlowCard").val().trim(),u=$("#afFlowCardNumber").val().trim();if(isStrEmptyOrUndefined(t)){showTip($("#afRawMaterialQuantityTip"),"原料数量不能为空");return}if(f=parseInt(t),f<=0){showTip($("#afRawMaterialQuantityTip"),"原料数量必须大于0");return}if(isStrEmptyOrUndefined(r)){showTip($("#afStartFlowCardTip"),"起始流程卡号不能为空");return}if(isStrEmptyOrUndefined(u)){showTip($("#afFlowCardNumberTip"),"流程卡数不能为空");return}var y=parseInt(r),p=parseInt(u),e=[];for(n=0;n<p;n++)e.push({FlowCardName:y+n,ProductionProcessId:s,RawMateriaId:h,RawMaterialQuantity:t,Sender:v,InboundNum:l,Priority:c,Remarks:a});o=function(){$("#addFlowCardModel").modal("hide");var n={};n.opType=i;n.opData=JSON.stringify(e);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg)})};showConfirm("添加",o)}function selectPlan(){var t=215,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var r,i,t;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#selectPlanList").empty(),$("#selectJhList").empty(),r="<option value='{0}'>{0}<\/option>",i=0;i<n.datas.length;i++)t=n.datas[i],$("#selectPlanList").append(r.format(t.ProductionProcessName,t.ProductionProcessName)),$("#selectJhList").append(r.format(t.ProductionProcessName,t.ProductionProcessName))})}function selectRaw(){var t=232,n;if(!checkPermission(t)){layer.msg("没有权限");return}n={};n.opType=t;n.opData=JSON.stringify({menu:!0});ajaxPost("/Relay/Post",n,function(n){var u,t,i,r;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#selectYlList").empty(),u="<option value='{0}'>{0}<\/option>",t=[],i=0;i<n.datas.length;i++)r=n.datas[i],t.push(u.format(r.RawMateriaName,r.RawMateriaName));t=t.join("");$("#selectYlList").append(t)},0)}function getFlowCardList(){var e=200,i,n,u,t,r,f;if(!checkPermission(e)){layer.msg("没有权限");return}if(i={},n={},i.opType=e,$(".fcHead .icb_minimal").is(":checked")){if(u=$("#flowCardId").val().trim(),$(".fcHead .icb_minimal").eq(0).is(":checked")){if(isStrEmptyOrUndefined(u)){layer.msg("请输入流程卡号");return}n.flowCardName=u}if(t=$("#flowCardStartDate").val()+" 00:00:00",r=$("#flowCardEndDate").val()+" 23:59:59",exceedTime(t)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(t,r)){layer.msg("结束时间不能小于开始时间");return}if($(".fcHead .icb_minimal").eq(1).is(":checked")){if(isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(r)){layer.msg("请选择创建时间");return}n.startTime=t;n.endTime=r}if(f=$("#selectPlanList").val(),$(".fcHead .icb_minimal").eq(2).is(":checked")){if(isStrEmptyOrUndefined(f)){layer.msg("请选择计划号");return}n.productionProcessName=f}i.opData=JSON.stringify(n)}ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var f=function(n){var t='<button type="button" class="btn btn-primary" onclick="showUpdateFlowCard({0})">修改<\/button>'.format(n.Id),i='<button type="button" class="btn btn-info" onclick="showChangeFlowCard({0}, \'{1}\')">更新<\/button>'.format(n.Id,escape(n.FlowCardName)),r='<button type="button" class="btn btn-danger" onclick="deleteFlowCard({0}, \'{1}\')">删除<\/button>'.format(n.Id,escape(n.FlowCardName));return"{0}{1}{2}".format(checkPermission(207)?t:"",checkPermission(208)?i:"",checkPermission(211)?r:"")},e=0,t=function(){return++e},i=function(n){return n.ProcessTime=="0001-01-01 00:00:00"&&(n.ProcessTime=""),n.ProcessTime},r=function(n){return isStrEmptyOrUndefined(n.StepName)?"未开始加工":n.CategoryName+"-"+n.StepName},u=function(n){var t=n.Priority;return t==2?'<span class="text-red"><span class="hidden">2<\/span>高<\/span>':t==1?'<span class="text-warning"><span class="hidden">1<\/span>中<\/span>':'<span class="text-success"><span class="hidden">0<\/span>低<\/span>'},o=checkPermission(207)||checkPermission(208)||checkPermission(211)?[{data:null,title:"操作",render:f},{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"CreateTime",title:"创建时间"},{data:"TypeName",title:"卡类型"},{data:"ProductionProcessName",title:"计划号"},{data:"FlowCardName",title:"流程卡号"},{data:"RawMateriaName",title:"原料批次"},{data:null,title:"优先级",render:u},{data:null,title:"当前工序",render:r,sClass:"text-info"},{data:null,title:"加工时间",render:i,sClass:"text-info"},{data:"QualifiedNumber",title:"当前合格数",sClass:"text-info"},{data:"Code",title:"当前机台号",sClass:"text-info"}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"CreateTime",title:"创建时间"},{data:"TypeName",title:"卡类型"},{data:"ProductionProcessName",title:"计划号"},{data:"FlowCardName",title:"流程卡号"},{data:"RawMateriaName",title:"原料批次"},{data:null,title:"优先级",render:u},{data:null,title:"当前工序",render:r,sClass:"text-info"},{data:null,title:"加工时间",render:i,sClass:"text-info"},{data:"QualifiedNumber",title:"当前合格数",sClass:"text-info"},{data:"Code",title:"当前机台号",sClass:"text-info"}],s=checkPermission(207)||checkPermission(208)||checkPermission(211)?[[1,"asc"]]:[[0,"asc"]],h=checkPermission(207)||checkPermission(208)||checkPermission(211)?[{orderable:!1,targets:0}]:"";$("#flowCardList").DataTable({destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:oLanguage,data:n.datas,aaSorting:s,aLengthMenu:[20,40,60],iDisplayLength:20,columns:o,columnDefs:h});$("#flowCardList tbody").on("focus","tr",function(){trOne=this})})}function deleteFlowCard(n,t){var i,r;if(t=unescape(t),i=211,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&getFlowCardList()})};showConfirm("删除流程卡："+t,r)}function showUpdateFlowCard(n){var t=function(){var i,r,t;if(hideClassTip("adt"),$("#ufGGBody").empty(),$("#ufGXBody").empty(),ufGGmax=ufGGmaxV=ufGXmax=ufGXmaxV=1,i=201,!checkPermission(i)){layer.msg("没有权限");return}(n!=-1||ufRecover!=1)&&(n==-1&&(ufRecover=1),r=n==-1?$("#updateFCId").html():n,t={},t.opType=i,t.opData=JSON.stringify({id:r}),ajaxPost("/Relay/Post",t,function(t){var i,e,o,f,c,s,h,u,l;if(t.errno!=0){layer.msg(t.errmsg);return}for(i=t.datas[0],$("#updateFCId").html(r),$("#ufProductionProcess").val(i.ProductionProcessName),$("#ufRawMateria").val(i.RawMateriaName),$("#ufPriority").val(i.Priority),$("#ufRawMaterialQuantity").val(i.RawMaterialQuantity),$("#ufFlowCardName").val(i.FlowCardName),$("#ufSender").val(i.Sender),$("#ufInboundNum").val(i.InboundNum),$("#ufRemarks").val(i.Remarks),u=0;u<i.Specifications.length;u++)o=i.Specifications[u],e='<tr id="ufGG{0}" value="{2}"><td><label class="control-label" id="ufGGx{0}">{1}<\/label><\/td><td><input class="form-control" value="{3}" id="ufGGm{0}" maxlength="20"><\/td><td><input class="form-control" value="{4}" id="ufGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(ufGGmax,ufGGmaxV,o.Id,o.SpecificationName,o.SpecificationValue),$("#ufGGBody").append(e),ufGGmax++,ufGGmaxV++;for(u=0;u<i.ProcessSteps.length;u++)f=i.ProcessSteps[u],e='<tr id="ufGX{0}" value="{2}"><td><label class="control-label" id="ufGXx{0}">{1}<\/label><\/td><td><select class="ms2 yc form-control" id="ufGXm{0}"><\/td><td><input class="form-control" value="{3}" id="ufGXz{0}" onblur="autoCal(this, \'ufGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" value="{4}" id="ufGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(ufGXmax,ufGXmaxV,f.Id,f.ProcessStepRequirements,f.ProcessStepRequirementMid),$("#ufGXBody").append(e),ufGXmax++,ufGXmaxV++;if(DeviceProcessData!=null){for($(".yc").empty(),c='<option value="{0}">{1}-{2}<\/option>',s=0;s<DeviceProcessData.length;s++)h=DeviceProcessData[s],$(".yc").append(c.format(h.Id,h.CategoryName,h.StepName));for($(".yc").css("width","100%"),$(".yc").select2(),u=0;u<i.ProcessSteps.length;u++)f=i.ProcessSteps[u],l="#ufGXm"+(u+1),$(l).val(f.ProcessStepId).trigger("change")}n!=-1?$("#updateFlowCardModel").modal("show"):ufRecover=0}))};checkDeviceProcessData(t)}function updateFlowCard(){var h=207,u,f,n,t,e,o,i,l,s,a,r,v,y;if(!checkPermission(h)){layer.msg("没有权限");return}var p=$("#ufPriority").val().trim(),c=$("#ufRawMaterialQuantity").val().trim(),w=$("#ufSender").val().trim(),b=$("#ufInboundNum").val().trim(),k=$("#ufRemarks").val().trim();if(isStrEmptyOrUndefined(c)){showTip($("#ufRawMaterialQuantityTip"),"原料数量不能为空");return}if(u=parseInt(c),u<=0){showTip($("#ufRawMaterialQuantityTip"),"原料数量必须大于0");return}for(f=[],n=1;n<ufGGmax;n++)if($("#ufGG"+n).length>0){if(e=$("#ufGGm"+n).val().trim(),isStrEmptyOrUndefined(e)){layer.msg("规格名不能为空");return}if(o=$("#ufGGz"+n).val().trim(),isStrEmptyOrUndefined(o)){layer.msg("规格值不能为空");return}t=$("#ufGG"+n).attr("value");f.push({Id:t,SpecificationName:e,SpecificationValue:o})}for(i=[],l=1,n=1;n<ufGXmax;n++)if($("#ufGX"+n).length>0){if(s=$("#ufGXm"+n).val().trim(),isStrEmptyOrUndefined(s)){layer.msg("工序名称不能为空");return}if(a=$("#ufGXz"+n).val().trim(),r=$("#ufGXh"+n).val().trim(),isStrEmptyOrUndefined(r)||parseFloat(r)<=0){layer.msg("合格值必须大于0");return}t=$("#ufGX"+n).attr("value");i.push({Id:t,ProcessStepOrder:l++,ProcessStepId:s,ProcessStepRequirements:a,ProcessStepRequirementMid:r})}if(i.length<=0){layer.msg("请填写工序");return}v={id:parseInt($("#updateFCId").html()),RawMaterialQuantity:u,Sender:w,InboundNum:b,Remarks:k,Priority:p,Specifications:f,ProcessSteps:i};y=function(){$("#updateFlowCardModel").modal("hide");var n={};n.opType=h;n.opData=JSON.stringify(v);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getFlowCardList()})};showConfirm("修改",y)}function ufResetGG(){$("#ufGGBody").empty();var n='<tr id="ufGG{0}"><td><label class="control-label" id="ufGGx{0}">{0}<\/label><\/td><td><input class="form-control" id="ufGGm{0}" maxlength="20"><\/td><td><input class="form-control" id="ufGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(1);$("#ufGGBody").append(n);ufGGmax=ufGGmaxV=2}function ufAddOtherGG(){var n='<tr id="ufGG{0}" value="0"><td><label class="control-label" id="ufGGx{0}">{1}<\/label><\/td><td><input class="form-control" id="ufGGm{0}" maxlength="20"><\/td><td><input class="form-control" id="ufGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(ufGGmax,ufGGmaxV);$("#ufGGBody").append(n);ufGGmax++;ufGGmaxV++}function ufGGDelSelf(n){var i,r,t;for($("#ufGGBody").find("[id=ufGG"+n+"]").remove(),ufGGmaxV--,i=1,r=$("#ufGGBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function ufResetGX(){var r,n,u,t,i;if(ufGXmax=ufGXmaxV=1,$("#ufGXBody").empty(),r='<tr id="ufGX{0}" value="0"><td><label class="control-label" id="ufGXx{0}">{0}<\/label><\/td><td><select class="ms2 form-control" id="ufGXm{0}"><\/select> <td><input class="form-control" id="ufGXz{0}" onblur="autoCal(this, \'ufGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" id="ufGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(ufGXmax),$("#ufGXBody").append(r),DeviceProcessData!=null){for(n="#ufGXm"+ufGXmax,$(n).empty(),u='<option value="{0}">{1}-{2}<\/option>',t=0;t<DeviceProcessData.length;t++)i=DeviceProcessData[t],$(n).append(u.format(i.Id,i.CategoryName,i.StepName));$(n).css("width","100%");$(n).select2()}ufGXmax=ufGXmaxV=2}function ufAddOtherGX(){var u='<tr id="ufGX{0}" value="0"><td><label class="control-label" id="ufGXx{0}">{1}<\/label><\/td><td><select class="ms2 form-control" id="ufGXm{0}"><\/select> <td><input class="form-control" id="ufGXz{0}" onblur="autoCal(this, \'ufGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" id="ufGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="ufGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(ufGXmax,ufGXmaxV),n,r,t,i;if($("#ufGXBody").append(u),DeviceProcessData!=null){for(n="#ufGXm"+ufGXmax,$(n).empty(),r='<option value="{0}">{1}-{2}<\/option>',t=0;t<DeviceProcessData.length;t++)i=DeviceProcessData[t],$(n).append(r.format(i.Id,i.CategoryName,i.StepName));$(n).css("width","100%");$(n).select2()}ufGXmax++;ufGXmaxV++}function ufGXDelSelf(n){var i,r,t;for($("#ufGXBody").find("[id=ufGX"+n+"]").remove(),ufGXmaxV--,i=1,r=$("#ufGXBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function showChangeFlowCard(n,t){var r,u,i;if($("#cfGXBody").empty(),gxLength=1,r=202,!checkPermission(r)){layer.msg("没有权限");return}(n!=-1||cfRecover!=1)&&(n==-1&&(cfRecover=1),u=n==-1?$("#changeFCId").html():n,i={},i.opType=r,i.opData=JSON.stringify({Id:u}),ajaxPost("/Relay/Post",i,function(i){function ut(n,t){return n.ProcessStepOrder>t.ProcessStepOrder?1:-1}var o,s,h;if(i.errno!=0){layer.msg(i.errmsg);return}$("#changeFCId").html(u);$("#changeFCName").html(t);for(var e='<option value="{0}">{1}<\/option>',r=0,v=function(n){return n.CategoryName+"-"+n.StepName},y=function(n){return r=n.ProcessStepOrder,'<span oValue="{1}" id="c1f{0}">{0}<\/span>'.format(r,n.Id)},c=e.format(0,"无"),f=0;f<i.processors.length;f++)o=i.processors[f],c+=e.format(o.Id,o.ProcessorName);var p=function(n){return'<select class="can1 ms2 form-control" id="c2f{0}" oValue="{2}">{1}<\/select>'.format(r,c,n.ProcessorId)},w=function(n){var i='<input type="text" id="c31f{0}" class="can1 form_date form-control {4}" value="{2}" style="width:90px"><input type="text" id="c32f{0}" class="can1 form_time form-control {4}" value="{3}" style="width:75px"><input type="text" id="c3f{0}" value="{1}" oValue="{1}" class="hidden">',t;return n.ProcessTime=="0001-01-01 00:00:00"||n.ProcessTime==null?(n.ProcessTime="",i.format(r,n.ProcessTime,"","","hidden")):(t=n.ProcessTime.split(" "),i.format(r,n.ProcessTime,t[0],t[1],""))},l=e.format(0,"无");for(f=0;f<i.surveyors.length;f++)s=i.surveyors[f],l+=e.format(s.Id,s.SurveyorName);var b=function(n){return'<select class="can2 ms2 form-control" id="c4f{0}" oValue="{2}">{1}<\/select>'.format(r,l,n.SurveyorId)},k=function(n){var i='<input type="text" id="c51f{0}" class="can2 form_date form-control {4}" value="{2}" style="width:90px"><input type="text" id="c52f{0}" class="can2 form_time form-control {4}" value="{3}" style="width:75px"><input type="text" id="c5f{0}" value="{1}" oValue="{1}" class="hidden">',t;return n.SurveyTime=="0001-01-01 00:00:00"||n.SurveyTime==null?(n.SurveyTime="",i.format(r,n.SurveyTime,"","","hidden")):(t=n.SurveyTime.split(" "),i.format(r,n.SurveyTime,t[0],t[1],""))},d=function(n){return'<input class="can1 can2 form-control" id="c6f{0}" style="width:100%" value="{1}" oValue="{1}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9">'.format(r,n.QualifiedNumber)},g=function(n){return'<input class="can1 can2 form-control" id="c7f{0}" style="width:100%" value="{1}" oValue="{1}" oninput="value=value.replace(/[^\\d]/g,\'\')" maxlength="9">'.format(r,n.UnqualifiedNumber)},a=e.format(0,"无");for(f=0;f<i.deviceIds.length;f++)h=i.deviceIds[f],a+=e.format(h.Id,h.Code);var nt=function(n){return'<select class="can1 ms2 form-control" id="c8f{0}" oValue="{2}">{1}<\/select>'.format(r,a,n.DeviceId)},tt=function(n){return'<input class="can1 can2 form-control" id="c9f{0}" style="width:100%" value="{1}" oValue="{1}" onblur="autoCal(this, \'c10f{0}\')" maxlength="20">'.format(r,n.QualifiedRange)},it=function(n){return'<input class="can1 can2 form-control" id="c10f{0}" style="width:100%" value="{1}" oValue="{1}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10">'.format(r,n.QualifiedMode)},rt=function(n){return n.IsSurvey?'<button class="btn btn-info edit2-btn" type="button" id="c11f{0}">检验<\/button>'.format(r):'<button class="btn btn-success edit1-btn" type="button" id="c11f{0}">加工<\/button>'.format(r)};$("#gxList").DataTable({destroy:!0,bSort:!1,paging:!1,deferRender:!1,bLengthChange:!1,info:!1,searching:!1,language:oLanguage,data:i.processSteps.sort(ut),aaSorting:[[0,"asc"]],columns:[{data:null,title:"序号",render:y},{data:"MarkedDateTime",title:"修改时间"},{data:null,title:"工序名称",render:v},{data:"ProcessStepRequirements",title:"加工要求"},{data:null,title:"加工人",render:p},{data:null,title:"加工时间",render:w},{data:null,title:"机台号",render:nt},{data:null,title:"检验人",render:b},{data:null,title:"检验时间",render:k},{data:null,title:"合格数",render:d},{data:null,title:"不合格数",render:g},{data:null,title:'成厚范围(<span class="text-info">例:0.2～0.3mm<\/span>)',render:tt},{data:null,title:'成厚均值(<span class="text-info">例:0.25<\/span>)',render:it},{data:null,title:"操作",render:rt},],drawCallback:function(){var r;for($(".ms2").select2(),$(".can1").attr("disabled","disabled"),$(".can2").attr("disabled","disabled"),$("#gxList th").css("padding-right","8px"),r=0;r<i.processSteps.length;r++){var u=r+1,n=$("#c2f"+u),t=n.attr("ovalue");n.val(t).trigger("change");n=$("#c4f"+u);t=n.attr("ovalue");n.val(t).trigger("change");n=$("#c8f"+u);t=n.attr("ovalue");n.val(t).trigger("change")}$("#gxList tbody").on("click",".edit1-btn",function(){var f=$(this).parents("tr").children().find(".can1"),n=$($(this).parents("tr").children()[0]).text(),t=$("#c31f"+n),i=$("#c32f"+n),e=$("#c3f"+n),r,u;t.removeClass("hidden");i.removeClass("hidden");r=e.attr("ovalue");isStrEmptyOrUndefined(r)?(t.val(getDate()).datepicker("update"),i.val(getTime())):(u=r.split(" "),t.val(u[0]),i.val(u[1]));f.removeAttr("disabled");f.css("background-color","white");$(this).html("取消");$(this).removeClass("edit1-btn");$(this).addClass("cancel1-btn");$(this).removeClass("btn-success");$(this).addClass("btn-danger")});$("#gxList tbody").on("click",".edit2-btn",function(){var f=$(this).parents("tr").children().find(".can2"),n=$($(this).parents("tr").children()[0]).text(),t=$("#c51f"+n),i=$("#c52f"+n),e=$("#c5f"+n),r,u;t.removeClass("hidden");i.removeClass("hidden");r=e.attr("ovalue");isStrEmptyOrUndefined(r)?(t.val(getDate()).datepicker("update"),i.val(getTime())):(u=r.split(" "),t.val(u[0]),i.val(u[1]));f.removeAttr("disabled");f.css("background-color","white");$(this).html("取消");$(this).removeClass("edit2-btn");$(this).addClass("cancel2-btn");$(this).removeClass("btn-info");$(this).addClass("btn-danger")});$("#gxList tbody").on("click",".cancel1-btn",function(){var n=$(this).parents("tr").children().find(".can1"),r,u;n.attr("disabled","disabled");r=n.filter("input");$.each(r,function(n,t){var i=$(t).attr("ovalue");$(t).val(i)});u=n.filter("select");$.each(u,function(n,t){var i=$(t).attr("ovalue");$(t).val(i).trigger("change")});var t=$($(this).parents("tr").children()[0]).text(),f=$("#c31f"+t),e=$("#c32f"+t),s=$("#c3f"+t),o=s.attr("ovalue"),i;isStrEmptyOrUndefined(o)?(f.addClass("hidden"),e.addClass("hidden")):(i=o.split(" "),f.val(i[0]),e.val(i[1]));n.css("background-color","#eee");$(this).html("加工");$(this).removeClass("cancel1-btn");$(this).addClass("edit1-btn");$(this).removeClass("btn-danger");$(this).addClass("btn-success")});$("#gxList tbody").on("click",".cancel2-btn",function(){var n=$(this).parents("tr").children().find(".can2"),r,u,i;n.attr("disabled","disabled");r=n.filter("input");$.each(r,function(n,t){var i=$(t).attr("ovalue");$(t).val(i)});u=n.filter("select");$.each(u,function(n,t){var i=$(t).attr("ovalue");$(t).val(i).trigger("change")});var t=$($(this).parents("tr").children()[0]).text(),f=$("#c51f"+t),e=$("#c52f"+t),s=$("#c5f"+t),o=s.attr("ovalue");isStrEmptyOrUndefined(o)?(f.addClass("hidden"),e.addClass("hidden")):(i=o.split(" "),f.val(i[0]),e.val(i[1]));n.css("background-color","#eee");$(this).html("检验");$(this).removeClass("cancel2-btn");$(this).addClass("edit2-btn");$(this).removeClass("btn-danger");$(this).addClass("btn-info")});initTime()}});n!=-1?$("#changeFlowCardModel").modal("show"):cfRecover=0}))}function initTime(){$("#gxList .form_date,.form_time").attr("readonly",!0);$("#gxList .form_date").datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$("#gxList .form_time").timepicker({language:"zh-CN",showMeridian:!1,minuteStep:1,showSeconds:!0,secondStep:1})}function changeFlowCard(){var l=208,t,a,v,s,y,h,p,w,b,k,u,i,c,n,r,f,e,d;if(!checkPermission(l)){layer.msg("没有权限");return}var g=parseInt($("#changeFCId").html()),nt=$("#gxList tbody").children(),o=[];for(t=1;t<=nt.length;t++){for(i=1;i<=10;i++){c=$("#c{1}f{0}".format(t,i));n=c.val();switch(i){case 1:n=$(c).attr("ovalue");a=n;break;case 2:v=n;break;case 3:r=$("#c{1}1f{0}".format(t,i));f=$("#c{1}2f{0}".format(t,i));n=r.hasClass("hidden")?n:"{0} {1}".format($(r).val(),$(f).val());s=isStrEmptyOrUndefined(n)?null:n;break;case 4:y=n;break;case 5:r=$("#c{1}1f{0}".format(t,i));f=$("#c{1}2f{0}".format(t,i));n=r.hasClass("hidden")?n:"{0} {1}".format($(r).val(),$(f).val());h=isStrEmptyOrUndefined(n)?null:n;break;case 6:p=n;break;case 7:w=n;break;case 8:b=n;break;case 9:k=n;break;case 10:if(u=n,($("#c11f{0}".format(t)).hasClass("cancel1-btn")||$("#c11f{0}".format(t)).hasClass("cancel2-btn"))&&(isStrEmptyOrUndefined(u)||parseFloat(u)<=0)){layer.msg("成厚均值必须大于0");return}}}e={Id:a,FlowCardId:g,ProcessorId:v,SurveyorId:y,QualifiedNumber:p,UnqualifiedNumber:w,DeviceId:b,QualifiedRange:k,QualifiedMode:u};s!=null&&(e.ProcessTime=s);h!=null&&(e.SurveyTime=h);o.push(e)}o.length<=0||$("#gxList").find(".cancel1-btn").length<=0&&$("#gxList").find(".cancel2-btn").length<=0||(d=function(){var n={};n.opType=l;n.opData=JSON.stringify(o);ajaxPost("/Relay/Post",n,function(n){if(layer.msg(n.errmsg),n.errno==0){showChangeFlowCard(-1);var t=$("#changeFCName").html();getChangeFCName(t)}})},showConfirm("修改",d))}function getChangeFCName(n){var i=200,t;if(!checkPermission(i)){layer.msg("没有权限");return}t={};t.opType=i;t.opData=JSON.stringify({flowCardName:n});ajaxPost("/Relay/Post",t,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=n.datas[0],i=t.CategoryName+"-"+t.StepName,r=t.QualifiedNumber;$(trOne).find(".text-info").eq(0).html(i);$(trOne).find(".text-info").eq(2).html(r)})}function getProductionProcessList(){var f=215,i,n,u,t,r;if(!checkPermission(f)){layer.msg("没有权限");return}if(i={},n={},i.opType=f,$(".jhHead .icb_minimal").is(":checked")){if(u=$("#selectJhList").val(),$(".jhHead .icb_minimal").eq(0).is(":checked")){if(isStrEmptyOrUndefined(u)){layer.msg("请选择计划号");return}n.productionName=u}if(t=$("#jhStartDate").val()+" 00:00:00",r=$("#jhEndDate").val()+" 23:59:59",exceedTime(t)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(t,r)){layer.msg("结束时间不能小于开始时间");return}if($(".jhHead .icb_minimal").eq(1).is(":checked")){if(isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(r)){layer.msg("请选择修改时间");return}n.startTime=t;n.endTime=r}i.opData=JSON.stringify(n)}ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var t=checkPermission(218),i=checkPermission(221),u='<button type="button" class="btn btn-primary" onclick="showProductionProcessModel({0})">详情<\/button>',f='<button type="button" class="btn btn-danger" onclick="deleteProductionProcess({0}, \'{1}\')">删除<\/button>',e=function(n){var r=u.format(n.Id),e=f.format(n.Id,escape(n.ProductionProcessName));return(t?r:"")+(i?e:"")},r=function(n,t,i,r){return r.row+1},o=t||i?[{data:null,title:"操作",render:e},{data:null,title:"序号",render:r},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"ProductionProcessName",title:"计划号"},{data:"FlowCardCount",title:"总流程卡数",sClass:"text-info"},{data:"AllRawMaterialQuantity",title:"总原料数",sClass:"text-info"},{data:"Complete",title:"已完成流程卡数",sClass:"text-success"},{data:"RawMaterialQuantity",title:"已完成原料数",sClass:"text-success"},{data:"QualifiedNumber",title:"总产量",sClass:"text-warning"},{data:"PassRate",title:"总合格率",sClass:"text-warning"}]:[{data:null,title:"序号",render:r},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"ProductionProcessName",title:"计划号"},{data:"FlowCardCount",title:"总流程卡数",sClass:"text-info"},{data:"AllRawMaterialQuantity",title:"总原料数",sClass:"text-info"},{data:"Complete",title:"已完成流程卡数",sClass:"text-success"},{data:"RawMaterialQuantity",title:"已完成原料数",sClass:"text-success"},{data:"QualifiedNumber",title:"总产量",sClass:"text-warning"},{data:"PassRate",title:"总合格率",sClass:"text-warning"},],s=t||i?[[1,"asc"]]:[[0,"asc"]],h=t||i?[{orderable:!1,targets:0}]:"";$("#productionProcessList").DataTable({destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:oLanguage,data:n.datas,aaSorting:s,aLengthMenu:[20,40,60],iDisplayLength:20,columns:o,columnDefs:h})})}function deleteProductionProcess(n,t){var i,r;if(t=unescape(t),i=221,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&(selectPlan(),getProductionProcessList())})};showConfirm("删除计划号："+t+"<p style='color:red'>该计划号的所有工艺也会被删除<\/p>",r)}function showProductionProcess(n){var t,i;if(hideClassTip("adt"),t=216,!checkPermission(t)){layer.msg("没有权限");return}i={};i.opType=t;ajaxPost("/Relay/Post",i,function(t){var u,r,i;if(t.errno!=0){layer.msg(t.errmsg);return}for($("#addSiteName").empty(),u='<option value="{0}">{1}<\/option>',r=0;r<t.datas.length;r++)i=t.datas[r],$("#addSiteName").append(u.format(i.Id,i.SiteName,i.RegionDescription,i.Manager));$("#updateId").html(n);$("#updateSiteName").val(adSiteNames);$("#updateRegions").val(locationsReg);$("#updateManager").val(manergerMan);$("#updateSite").modal("show")})}function showProductionProcessModel(n){var t=function(){var i,t,r;if(hideClassTip("adt"),$(".pp").addClass("hidden"),n!=0){if($("#uppBtn").removeClass("hidden"),$("#ppReBtn").removeClass("hidden"),$("#apGGBody").empty(),$("#apGXBody").empty(),apGGmax=apGGmaxV=apGXmax=apGXmaxV=1,i=216,!checkPermission(i)){layer.msg("没有权限");return}if(n==-1&&recover==1)return;n==-1&&(recover=1);t={};t.opType=i;r=n==-1?$("#updateppId").html():n;t.opData=JSON.stringify({id:r});ajaxPost("/Relay/Post",t,function(t){var u,e,f,o,c,s,h,i,l;if(t.errno!=0){layer.msg(t.errmsg);return}for(u=t.datas[0],$("#updateppId").html(r),$("#productionProcessName").val(u.ProductionProcessName),i=0;i<u.Specifications.length;i++)e=u.Specifications[i],o='<tr id="apGG{0}" value="{2}"><td><label class="control-label" id="apGGx{0}">{1}<\/label><\/td><td><input class="form-control" value="{3}" id="apGGm{0}" maxlength="20"><\/td><td><input class="form-control" value="{4}" id="apGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(apGGmax,apGGmaxV,e.Id,e.SpecificationName,e.SpecificationValue),$("#apGGBody").append(o),apGGmax++,apGGmaxV++;for(i=0;i<u.ProcessSteps.length;i++)f=u.ProcessSteps[i],o='<tr id="apGX{0}" value="{2}"><td><label class="control-label" id="apGXx{0}">{1}<\/label><\/td><td><select class="ms2 yc form-control" id="apGXm{0}"><\/td><td><input class="form-control" value="{3}" id="apGXz{0}" onblur="autoCal(this, \'apGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" value="{4}" id="apGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(apGXmax,apGXmaxV,f.Id,f.ProcessStepRequirements,f.ProcessStepRequirementMid),$("#apGXBody").append(o),apGXmax++,apGXmaxV++;if(DeviceProcessData!=null){for($(".yc").empty(),c='<option value="{0}">{1}-{2}<\/option>',s=0;s<DeviceProcessData.length;s++)h=DeviceProcessData[s],$(".yc").append(c.format(h.Id,h.CategoryName,h.StepName));for($(".yc").css("width","100%"),$(".yc").select2(),i=0;i<u.ProcessSteps.length;i++)f=u.ProcessSteps[i],l="#apGXm"+(i+1),$(l).val(f.ProcessStepId).trigger("change")}$(".dd").addClass("hidden");n!=-1?$("#productionProcessModel").modal("show"):recover=0})}else $("#appBtn").removeClass("hidden"),$("#productionProcessName").val(""),addResetGG(),addResetGX(),lastType!=n&&($("#productionProcessName").val(""),$("#appBtn").removeClass("hidden"),addResetGG(),addResetGX(),$(".dd").removeClass("hidden")),$("#productionProcessModel").modal("show");lastType=n};checkDeviceProcessData(t)}function checkDeviceProcessData(n){if(DeviceProcessData==null){var t=150;if(!checkPermission(t)){layer.msg("没有权限");return}ajaxPost("/Relay/Post",{opType:t},function(t){if(t.errno!=0){layer.msg(t.errmsg);return}DeviceProcessData=t.datas;n()})}else n()}function addResetGG(){$("#apGGBody").empty();var n='<tr id="apGG{0}"><td><label class="control-label" id="apGGx{0}">{0}<\/label><\/td><td><input class="form-control" id="apGGm{0}" maxlength="20"><\/td><td><input class="form-control" id="apGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(1);$("#apGGBody").append(n);lastType==0?$(".dd").removeClass("hidden"):$(".dd").addClass("hidden");apGGmax=apGGmaxV=2}function addOtherGG(){var n='<tr id="apGG{0}" value="0"><td><label class="control-label" id="apGGx{0}">{1}<\/label><\/td><td><input class="form-control" id="apGGm{0}" maxlength="20"><\/td><td><input class="form-control" id="apGGz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGGDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(apGGmax,apGGmaxV);$("#apGGBody").append(n);apGGmax++;apGGmaxV++}function apGGDelSelf(n){var i,r,t;for($("#apGGBody").find("[id=apGG"+n+"]").remove(),apGGmaxV--,i=1,r=$("#apGGBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function addResetGX(){var r,n,u,t,i;if(apGXmax=apGXmaxV=1,$("#apGXBody").empty(),r='<tr id="apGX{0}" value="0"><td><label class="control-label" id="apGXx{0}">{0}<\/label><\/td><td><select class="ms2 form-control" id="apGXm{0}"><\/select> <td><input class="form-control" id="apGXz{0}" onblur="autoCal(this, \'apGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" id="apGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(apGXmax),$("#apGXBody").append(r),DeviceProcessData!=null){for(n="#apGXm"+apGXmax,$(n).empty(),u='<option value="{0}">{1}-{2}<\/option>',t=0;t<DeviceProcessData.length;t++)i=DeviceProcessData[t],$(n).append(u.format(i.Id,i.CategoryName,i.StepName));$(n).css("width","100%");$(n).select2()}lastType==0?$(".dd").removeClass("hidden"):$(".dd").addClass("hidden");apGXmax++;apGXmaxV++}function addOtherGX(){var u='<tr id="apGX{0}" value="0"><td><label class="control-label" id="apGXx{0}">{1}<\/label><\/td><td><select class="ms2 form-control" id="apGXm{0}"><\/select> <td><input class="form-control" id="apGXz{0}" onblur="autoCal(this, \'apGXh{0}\')" maxlength="100"><\/td><td><input class="form-control text-center" id="apGXh{0}" onkeyup="onInput(this)" onblur="onInputEnd(this)" maxlength="10"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="apGXDelSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(apGXmax,apGXmaxV),n,r,t,i;if($("#apGXBody").append(u),DeviceProcessData!=null){for(n="#apGXm"+apGXmax,$(n).empty(),r='<option value="{0}">{1}-{2}<\/option>',t=0;t<DeviceProcessData.length;t++)i=DeviceProcessData[t],$(n).append(r.format(i.Id,i.CategoryName,i.StepName));$(n).css("width","100%");$(n).select2()}apGXmax++;apGXmaxV++}function apGXDelSelf(n){var i,r,t;for($("#apGXBody").find("[id=apGX"+n+"]").remove(),apGXmaxV--,i=1,r=$("#apGXBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function addProductionProcess(){var s=220,r,u,n,f,e,t,h,o,c,i,l,a;if(!checkPermission(s)){layer.msg("没有权限");return}if(r=$("#productionProcessName").val().trim(),isStrEmptyOrUndefined(r)){showTip($("#productionProcessNameTip"),"计划号不能为空");return}for(u=[],n=1;n<apGGmax;n++)if($("#apGG"+n).length>0){if(f=$("#apGGm"+n).val().trim(),isStrEmptyOrUndefined(f)){layer.msg("规格名不能为空");return}if(e=$("#apGGz"+n).val().trim(),isStrEmptyOrUndefined(e)){layer.msg("规格值不能为空");return}u.push({SpecificationName:f,SpecificationValue:e})}for(t=[],h=1,n=1;n<apGXmax;n++)if($("#apGX"+n).length>0){if(o=$("#apGXm"+n).val().trim(),isStrEmptyOrUndefined(o)){layer.msg("工序名称不能为空");return}if(c=$("#apGXz"+n).val().trim(),i=$("#apGXh"+n).val().trim(),isStrEmptyOrUndefined(i)||parseFloat(i)<=0){layer.msg("合格值必须大于0");return}t.push({ProcessStepOrder:h++,ProcessStepId:o,ProcessStepRequirements:c,ProcessStepRequirementMid:i})}if(t.length<=0){layer.msg("请填写工序");return}l={ProductionProcessName:r,Specifications:u,ProcessSteps:t};a=function(){$("#productionProcessModel").modal("hide");var n={};n.opType=s;n.opData=JSON.stringify(l);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&selectPlan()})};showConfirm("添加",a)}function updateProductionProcess(){var h=218,u,f,n,t,e,o,i,c,s,l,r,a,v;if(!checkPermission(h)){layer.msg("没有权限");return}if(u=$("#productionProcessName").val().trim(),isStrEmptyOrUndefined(u)){showTip($("#productionProcessNameTip"),"计划号不能为空");return}for(f=[],n=1;n<apGGmax;n++)if($("#apGG"+n).length>0){if(e=$("#apGGm"+n).val().trim(),isStrEmptyOrUndefined(e)){layer.msg("规格名不能为空");return}if(o=$("#apGGz"+n).val().trim(),isStrEmptyOrUndefined(o)){layer.msg("规格值不能为空");return}t=$("#apGG"+n).attr("value");f.push({Id:t,SpecificationName:e,SpecificationValue:o})}for(i=[],c=1,n=1;n<apGXmax;n++)if($("#apGX"+n).length>0){if(s=$("#apGXm"+n).val().trim(),isStrEmptyOrUndefined(s)){layer.msg("工序名称不能为空");return}if(l=$("#apGXz"+n).val().trim(),r=$("#apGXh"+n).val().trim(),isStrEmptyOrUndefined(r)||parseFloat(r)<=0){layer.msg("合格值必须大于0");return}t=$("#apGX"+n).attr("value");i.push({Id:t,ProcessStepOrder:c++,ProcessStepId:s,ProcessStepRequirements:l,ProcessStepRequirementMid:r})}if(i.length<=0){layer.msg("请填写工序");return}a={id:parseInt($("#updateppId").html()),ProductionProcessName:u,Specifications:f,ProcessSteps:i};v=function(){$("#productionProcessModel").modal("hide");var n={};n.opType=h;n.opData=JSON.stringify(a);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getProductionProcessList()})};showConfirm("修改",v)}function getRawMateriaList(){var f=232,i,n,u,t,r;if(!checkPermission(f)){layer.msg("没有权限");return}if(i={},n={},i.opType=f,$(".ylHead .icb_minimal").is(":checked")){if(u=$("#selectYlList").val(),$(".ylHead .icb_minimal").eq(0).is(":checked")){if(isStrEmptyOrUndefined(u)){layer.msg("请选择原料批号");return}n.rawMateriaName=u}if(t=$("#ylStartDate").val()+" 00:00:00",r=$("#ylEndDate").val()+" 23:59:59",exceedTime(t)){layer.msg("开始时间不能大于当前时间");return}if(compareDate(t,r)){layer.msg("结束时间不能小于开始时间");return}if($(".ylHead .icb_minimal").eq(1).is(":checked")){if(isStrEmptyOrUndefined(t)||isStrEmptyOrUndefined(r)){layer.msg("请选择修改时间");return}n.startTime=t;n.endTime=r}i.opData=JSON.stringify(n)}ajaxPost("/Relay/Post",i,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i=function(n){var t='<button type="button" class="btn btn-primary" onclick="showUpdateRawMateriaModel({0})">详情<\/button>'.format(n.Id),i='<button type="button" class="btn btn-danger" onclick="deleteRawMateria({0}, \'{1}\')">删除<\/button>'.format(n.Id,escape(n.RawMateriaName));return"{0}{1}".format(checkPermission(235)?t:"",checkPermission(239)?i:"")},r=0,t=function(){return++r},u=checkPermission(235)||checkPermission(239)?[{data:null,title:"操作",render:i},{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"RawMateriaName",title:"原料批号"}]:[{data:null,title:"序号",render:t},{data:"Id",title:"Id",bVisible:!1},{data:"MarkedDateTime",title:"修改时间"},{data:"RawMateriaName",title:"原料批号"},],f=checkPermission(235)||checkPermission(239)?[[1,"asc"]]:[[0,"asc"]],e=checkPermission(235)||checkPermission(239)?[{orderable:!1,targets:0}]:"";$("#rawMateriaList").DataTable({destroy:!0,paging:!0,searching:!0,autoWidth:!0,language:oLanguage,data:n.datas,aaSorting:f,aLengthMenu:[20,40,60],iDisplayLength:20,columns:u,columnDefs:e})})}function deleteRawMateria(n,t){var i,r;if(t=unescape(t),i=239,!checkPermission(i)){layer.msg("没有权限");return}r=function(){var t={};t.opType=i;t.opData=JSON.stringify({id:n});ajaxPost("/Relay/Post",t,function(n){layer.msg(n.errmsg);n.errno==0&&(selectRaw(),getRawMateriaList())})};showConfirm("删除原料："+t,r)}function showUpdateRawMateriaModel(n,t=0){var r,i;if($("#urRawMateriaName").val(""),$("#urBody").empty(),uMax=uMaxV=1,r=233,!checkPermission(r)){layer.msg("没有权限");return}(i={},i.opType=r,i.opData=JSON.stringify({id:n}),t!=1||rec!=1)&&(t==1&&(rec=1),ajaxPost("/Relay/Post",i,function(i){var r,u,f,e;if(i.errno!=0){layer.msg(i.errmsg);return}for(r=i.datas[0],$("#updateId").html(n),$("#urRawMateriaName").val(r.RawMateriaName),u=0;u<r.RawMateriaSpecifications.length;u++)f=r.RawMateriaSpecifications[u],e='<tr id="ur{0}" value="{2}"><td><label class="control-label" id="urx{0}">{1}<\/label><\/td><td><input class="form-control" value="{3}" id="urm{0}" maxlength="20"><\/td><td><input class="form-control" value="{4}" id="urz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf1({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(uMax,uMaxV,f.Id,f.SpecificationName,f.SpecificationValue),$("#urBody").append(e),uMax++,uMaxV++;t==0?$("#updateRawMateriaModel").modal("show"):rec=0}))}function updateRawMateria(){var f=235,t,i,n,e,r,u,o,s;if(!checkPermission(f)){layer.msg("没有权限");return}if(t=$("#urRawMateriaName").val().trim(),isStrEmptyOrUndefined(t)){showTip($("#urRawMateriaNameTip"),"原料批次不能为空");return}for(i=[],n=1;n<uMax;n++)if($("#ur"+n).length>0){if(e=$("#ur"+n).attr("value"),r=$("#urm"+n).val().trim(),isStrEmptyOrUndefined(r)){layer.msg("规格名不能为空");return}if(u=$("#urz"+n).val().trim(),isStrEmptyOrUndefined(u)){layer.msg("规格值不能为空");return}i.push({Id:e,SpecificationName:r,SpecificationValue:u})}o={id:parseInt($("#updateId").html()),RawMateriaName:t,RawMateriaSpecifications:i};s=function(){$("#updateRawMateriaModel").modal("hide");var n={};n.opType=f;n.opData=JSON.stringify(o);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&getRawMateriaList()})};showConfirm("修改",s)}function recovery(){var n=parseInt($("#updateId").html());showUpdateRawMateriaModel(n,1)}function addOther1(){var n='<tr id="ur{0}" value="0"><td><label class="control-label" id="urx{0}">{1}<\/label><\/td><td><input class="form-control" id="urm{0}" maxlength="20"><\/td><td><input class="form-control" id="urz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf1({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(uMax,uMaxV);$("#urBody").append(n);uMax++;uMaxV++}function delSelf1(n){var i,r,t;for($("#urBody").find("[id=ur"+n+"]").remove(),uMaxV--,i=1,r=$("#urBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function reset1(){$("#urBody").empty();uMax=uMaxV=1}function showAddRawMateriaModel(){hideClassTip("adt");$("#arRawMateriaName").val("");reset();$("#addRawMateriaModel").modal("show")}function reset(){$("#arBody").empty();var n='<tr id="ar{0}"><td><label class="control-label" id="arx{0}">{0}<\/label><\/td><td><input class="form-control" id="arm{0}" maxlength="20"><\/td><td><input class="form-control" id="arz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(1);$("#arBody").append(n);max=maxV=2}function addOther(){var n='<tr id="ar{0}"><td><label class="control-label" id="arx{0}">{1}<\/label><\/td><td><input class="form-control" id="arm{0}" maxlength="20"><\/td><td><input class="form-control" id="arz{0}" maxlength="20"><\/td><td><button type="button" class="btn btn-default btn-sm" onclick="delSelf({0})"><i class="fa fa-minus"><\/i> 删除<\/button><\/td><\/tr>'.format(max,maxV);$("#arBody").append(n);max++;maxV++}function delSelf(n){var i,r,t;for($("#arBody").find("[id=ar"+n+"]").remove(),maxV--,i=1,r=$("#arBody").find("label"),t=0;t<r.length;t++)r[t].textContent=i,i++}function addRawMateria(){var f=237,t,i,n,r,u,e,o;if(!checkPermission(f)){layer.msg("没有权限");return}if(t=$("#arRawMateriaName").val().trim(),isStrEmptyOrUndefined(t)){showTip($("#arRawMateriaNameTip"),"原料批次不能为空");return}for(i=[],n=1;n<max;n++)if($("#ar"+n).length>0){if(r=$("#arm"+n).val().trim(),isStrEmptyOrUndefined(r)){layer.msg("规格名不能为空");return}if(u=$("#arz"+n).val().trim(),isStrEmptyOrUndefined(u)){layer.msg("规格值不能为空");return}i.push({SpecificationName:r,SpecificationValue:u})}e={RawMateriaName:t,RawMateriaSpecifications:i};o=function(){$("#addRawMateriaModel").modal("hide");var n={};n.opType=f;n.opData=JSON.stringify(e);ajaxPost("/Relay/Post",n,function(n){layer.msg(n.errmsg);n.errno==0&&selectRaw()})};showConfirm("添加",o)}var trOne=null,ufRecover=0,ufGGmax=1,ufGGmaxV=1,ufGXmax=1,ufGXmaxV=1,cfRecover=0,gxLength=1,DeviceProcessData=null,recover=0,lastType=-2,apGGmax=2,apGGmaxV=2,apGXmax=2,apGXmaxV=2,uMax=1,uMaxV=1,rec=0,max=2,maxV=2;