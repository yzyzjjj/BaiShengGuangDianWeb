function pageReady(){$(".ms2").select2();$(".form_date").val(getDate()).datepicker("update");new Promise(n=>getWarnSet(n,1,".device-warn")).then(()=>getDeviceData(!1));$("#deviceSTime,#deviceETime").on("changeDate",()=>getDeviceData(!1));$("#deviceWarn").on("select2:select",()=>getDeviceData(!1));$("#devCurrentLi").one("click",()=>getDeviceData(!0));$("#deviceWarnCurrent").on("select2:select",()=>getDeviceData(!0));$("#productionBox").one("click",()=>new Promise(n=>getWarnSet(n,2,".production-warn")).then(()=>getProductionData(!1)));$("#productionSTime,#productionETime").on("changeDate",()=>getProductionData(!1));$("#productionWarn").on("select2:select",()=>getProductionData(!1));$("#productionCurrentLi").one("click",()=>getProductionData(!0));$("#productionWarnCurrent").on("select2:select",()=>getProductionData(!0))}function getDeviceData(n){n?getCurrentWarnLogList("device",1):getWarnLogList("device",1)}function getProductionData(n){n?getCurrentWarnLogList("production",2):getWarnLogList("production",2)}function getWarnSet(n,t,i){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:1,dataType:t})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}$(i).empty().append(`<option value="0">全部</option>${setOptions(t.datas,"Name")}`);n()})}function getAppointWarnSet(n,t,i,r){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:1,dataType:t,qId:n})},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}$(`#${i}Info${r}`).removeClass("hidden");const u=n.datas[0];$(`#${i}WarnType${r}`).text(u.Class);t===1?$(`#${i}WarnScript${r}`).text(u.Script):t===2&&$(`#${i}WarnCategory${r}`).text(u.CategoryName);$(`#${i}WarnDevice${r}`).text(u.Code)})}function getWarnLogList(n,t){const i=$(`#${n}Warn`).val();if(isStrEmptyOrUndefined(i)){layer.msg("请选择预警名");return}let r=$(`#${n}STime`).val().trim();if(isStrEmptyOrUndefined(r)){layer.msg("请选择开始时间");return}let u=$(`#${n}ETime`).val().trim();if(isStrEmptyOrUndefined(u)){layer.msg("请选择结束时间");return}if(compareDate(r,u)){layer.msg("开始时间不能大于结束时间");return}r+=" 00:00:00";u+=" 23:59:59";const f={};f.opType=1206;f.opData=JSON.stringify({sId:i,startTime:r,endTime:u,type:1,dataType:t});ajaxPost("/Relay/Post",f,r=>{if(r.errno!=0){layer.msg(r.errmsg);return}i==0?$(`#${n}Info`).addClass("hidden"):getAppointWarnSet(i,t,n,"");setWarnLogList(`#${n}List`,r.datas,!1,tableNameSet(t))})}function getCurrentWarnLogList(n,t){const i=$(`#${n}WarnCurrent`).val();if(isStrEmptyOrUndefined(i)){layer.msg("请选择预警名");return}const r={};r.opType=1205;r.opData=JSON.stringify({sId:i,type:1,dataType:t});ajaxPost("/Relay/Post",r,r=>{if(r.errno!=0){layer.msg(r.errmsg);return}i==0?$(`#${n}InfoCurrent`).addClass("hidden"):getAppointWarnSet(i,t,n,"Current");setWarnLogList(`#${n}ListCurrent`,r.datas,!0,tableNameSet(t))})}function tableNameSet(n){return n===1?"VariableName":n===2?"Item":null}function setWarnLogList(n,t,i,r){const o=n=>n?"是":"否",s=n=>`${n.StartTime}至${n.EndTime}`,h=n=>{return`<span>${n.Frequency}${["","秒","分","小时","天","周","月","年"][n.Interval]}${n.Count}次</span>`},u=n=>{return`<span>${["","大于","大于等于","小于","小于等于"][n]}</span>`},c=n=>{return`<span>${["","并且","或者"][n]}</span>`},l=n=>n.Condition2?n.Value2:"",a=n=>`<button class="btn btn-info btn-sm" onclick='showDetailModel(${n})'>查看</button>`,f=[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"SetName",title:"预警名"},{data:"Code",title:"机台号"},{data:r,title:"名称"},{data:"CurrentTime",title:"出现时间",sClass:"text-danger"},{data:"Current",title:"出现次数",sClass:"text-danger"}],v=[{data:"IsWarning",title:"是否预警",sClass:"text-danger",render:o},{data:"WarningTime",title:"预警时间",sClass:"text-danger"}],e=[{data:null,title:"时间段",sClass:"text-danger",render:s},{data:null,title:"出现频率",render:h},{data:"Condition1",title:"条件1",render:u},{data:"Value1",title:"数值"},{data:"Logic",title:"逻辑",render:c},{data:"Condition2",title:"条件2",render:u},{data:null,title:"数值",render:l},{data:"Values",title:"详情",render:a}],y=i?[...f,...e]:[...f,...v,...e];$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,deferRender:!0,data:t,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:y})}function showDetailModel(n){$("#warnLogDetailList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,data:n,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"DT",title:"时间"},{data:"V",title:"数值"}]});$("#showDetailModel").modal("show")}