function pageReady(){$(".ms2").select2();$(".form_date").val(getDate()).datepicker("update").on("changeDate",()=>getWarnLogList());new Promise(n=>getWarnSet(n)).then(()=>getWarnLogList("device"));$("#deviceWarn").on("select2:select",()=>getWarnLogList());$("#currentDeviceWarn").on("select2:select",()=>getCurrentWarnLogList());$("#devCurrentLi").one("click",()=>getCurrentWarnLogList())}function getWarnSet(n){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:1})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}$(".warn-type").empty().append(`<option value="0">全部</option>${setOptions(t.datas,"Name")}`);n()})}function getAppointWarnSet(n,t,i){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:i,qId:n})},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}$(`#deviceInfo${t}`).removeClass("hidden");const i=n.datas[0];$(`#warnType${t}`).text(i.Class);$(`#warnScript${t}`).text(i.Script);$(`#warnDevice${t}`).text(i.Code)})}function getWarnLogList(n){const t=$(`#${n}Warn`).val();if(isStrEmptyOrUndefined(t)){layer.msg("请选择预警名");return}let i=$(`#${n}STime`).val().trim();if(isStrEmptyOrUndefined(i)){layer.msg("请选择开始时间");return}let r=$(`#${n}ETime`).val().trim();if(isStrEmptyOrUndefined(r)){layer.msg("请选择结束时间");return}if(compareDate(i,r)){layer.msg("开始时间不能大于结束时间");return}i+=" 00:00:00";r+=" 23:59:59";const u={};u.opType=1206;u.opData=JSON.stringify({sId:t,startTime:i,endTime:r,type:1});ajaxPost("/Relay/Post",u,i=>{if(i.errno!=0){layer.msg(i.errmsg);return}t==0?$(`#${n}Info`).addClass("hidden"):getAppointWarnSet(t,"");setWarnLogList(`#${n}List`,i.datas,!1)})}function getCurrentWarnLogList(n){const t=$(`#${n}WarnCurrent`).val();if(isStrEmptyOrUndefined(t)){layer.msg("请选择预警名");return}const i={};i.opType=1205;i.opData=JSON.stringify({sId:t,type:1});ajaxPost("/Relay/Post",i,i=>{if(i.errno!=0){layer.msg(i.errmsg);return}t==0?$(`#${n}InfoCurrent`).addClass("hidden"):getAppointWarnSet(t,"Current");setWarnLogList(`#${n}ListCurrent`,i.datas,!0)})}function setWarnLogList(n,t,i){const e=n=>n?"是":"否",o=n=>`${n.StartTime}至${n.EndTime}`,s=n=>{return`<span>${n.Frequency}${["","秒","分","小时","天","周","月","年"][n.Interval]}${n.Count}次</span>`},r=n=>{return`<span>${["","大于","大于等于","小于","小于等于"][n]}</span>`},h=n=>{return`<span>${["","并且","或者"][n]}</span>`},c=n=>n.Condition2?n.Value2:"",l=n=>`<button class="btn btn-info btn-sm" onclick='showDetailModel(${n})'>查看</button>`,u=[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"SetName",title:"预警名"},{data:"Code",title:"机台号"},{data:"VariableName",title:"名称"},{data:"CurrentTime",title:"出现时间",sClass:"text-danger"},{data:"Current",title:"出现次数",sClass:"text-danger"}],a=[{data:"IsWarning",title:"是否预警",sClass:"text-danger",render:e},{data:"WarningTime",title:"预警时间",sClass:"text-danger"}],f=[{data:null,title:"时间段",sClass:"text-danger",render:o},{data:null,title:"出现频率",render:s},{data:"Condition1",title:"条件1",render:r},{data:"Value1",title:"数值"},{data:"Logic",title:"逻辑",render:h},{data:"Condition2",title:"条件2",render:r},{data:null,title:"数值",render:c},{data:"Values",title:"详情",render:l}],v=i?[...u,...f]:[...u,...a,...f];$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,deferRender:!0,data:t,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:v})}function showDetailModel(n){$("#warnLogDetailList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,data:n,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"DT",title:"时间"},{data:"V",title:"数值"}]});$("#showDetailModel").modal("show")}