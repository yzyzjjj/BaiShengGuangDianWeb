function pageReady(){$(".ms2").select2();$("#sTime,#eTime").val(getDate()).datepicker("update").on("changeDate",()=>getWarnLogList());new Promise(n=>getWarnSet(n)).then(()=>getWarnLogList());$("#deviceWarn").on("select2:select",()=>getWarnLogList());$("#currentDeviceWarn").on("select2:select",()=>getCurrentWarnLogList());$("#currentLi").one("click",()=>getCurrentWarnLogList())}function getWarnSet(n){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:1})},t=>{if(t.errno!=0){layer.msg(t.errmsg);return}$("#deviceWarn,#currentDeviceWarn").empty().append(`<option value="0">全部</option>${setOptions(t.datas,"Name")}`);n()})}function getAppointWarnSet(n,t){ajaxPost("/Relay/Post",{opType:1200,opData:JSON.stringify({first:!1,type:1,qId:n})},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}$(`#warnLogInfo${t}`).removeClass("hidden");const i=n.datas[0];$(`#warnType${t}`).text(i.Class);$(`#warnScript${t}`).text(i.Script);$(`#warnDevice${t}`).text(i.Code)})}function getWarnLogList(){const n=$("#deviceWarn").val();if(isStrEmptyOrUndefined(n)){layer.msg("请选择预警名");return}let t=$("#sTime").val().trim();if(isStrEmptyOrUndefined(t)){layer.msg("请选择开始时间");return}let i=$("#eTime").val().trim();if(isStrEmptyOrUndefined(i)){layer.msg("请选择结束时间");return}if(compareDate(t,i)){layer.msg("开始时间不能大于结束时间");return}t+=" 00:00:00";i+=" 23:59:59";const r={};r.opType=1206;r.opData=JSON.stringify({sId:n,startTime:t,endTime:i,type:1});ajaxPost("/Relay/Post",r,t=>{if(t.errno!=0){layer.msg(t.errmsg);return}n==0?$("#warnLogInfo").addClass("hidden"):getAppointWarnSet(n,"");setWarnLogList("#warnLogList",t.datas,!1)})}function getCurrentWarnLogList(){const n=$("#currentDeviceWarn").val();if(isStrEmptyOrUndefined(n)){layer.msg("请选择预警名");return}const t={};t.opType=1205;t.opData=JSON.stringify({sId:n,type:1});ajaxPost("/Relay/Post",t,t=>{if(t.errno!=0){layer.msg(t.errmsg);return}n==0?$("#warnLogInfoCurrent").addClass("hidden"):getAppointWarnSet(n,"Current");setWarnLogList("#currentWarnLogList",t.datas,!0)})}function setWarnLogList(n,t,i){const e=n=>n===1?"设备数据":"生产数据",o=n=>n?"是":"否",s=n=>`${n.StartTime}至${n.EndTime}`,h=n=>{return`<span>${n.Frequency}${["","秒","分","小时","天","周","月","年"][n.Interval]}${n.Count}次</span>`},r=n=>{return`<span>${["","大于","大于等于","小于","小于等于"][n]}</span>`},c=n=>{return`<span>${["","并且","或者"][n]}</span>`},l=n=>n.Condition2?n.Value2:"",a=n=>`<button class="btn btn-info btn-sm" onclick='showDetailModel(${n})'>查看</button>`,u=[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"SetName",title:"预警名"},{data:"Type",title:"数据类型",render:e},{data:"Code",title:"机台号"},{data:"VariableName",title:"名称"},{data:"CurrentTime",title:"出现时间",sClass:"text-danger"},{data:"Current",title:"出现次数",sClass:"text-danger"}],v=[{data:"IsWarning",title:"是否预警",sClass:"text-danger",render:o},{data:"WarningTime",title:"预警时间",sClass:"text-danger"}],f=[{data:null,title:"时间段",sClass:"text-danger",render:s},{data:null,title:"出现频率",render:h},{data:"Condition1",title:"条件1",render:r},{data:"Value1",title:"数值"},{data:"Logic",title:"逻辑",render:c},{data:"Condition2",title:"条件2",render:r},{data:null,title:"数值",render:l},{data:"Values",title:"详情",render:a}],y=i?[...u,...f]:[...u,...v,...f];$(n).DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,deferRender:!0,data:t,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:y})}function showDetailModel(n){$("#warnLogDetailList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,data:n,language:oLanguage,aaSorting:[[0,"asc"]],aLengthMenu:[20,40,60],iDisplayLength:20,columns:[{data:null,title:"序号",render:(n,t,i,r)=>++r.row},{data:"DT",title:"时间"},{data:"V",title:"数值"}]});$("#showDetailModel").modal("show")}