function pageReady(){getUsersList();$(".ms2").select2();$("#add_perDiv").click(function(){var n=$("#addRole").val();n=n==null?"":n.join();isStrEmptyOrUndefined(n)||getOtherPermission("add_per_body",n,null)});$("#update_perDiv").click(function(){var n=$("#updateRole").val();n=n==null?"":n.join();getOtherPermission("update_per_body",n,permission)});$("#updatePassword").on("ifChanged",function(){$(this).is(":checked")?$("#updateNewPassword").removeAttr("disabled"):($("#updateNewPassword").attr("disabled","disabled"),$("#updateNewPassword").val(""))});checkPermission(74)||$("#showAddUserModal").addClass("hidden");$("#addEmail,#updateEmail").on("input",function(){$(this)[0].value=$(this)[0].value.replace(/[^\w\@\.\-]+/g,"")})}function getUsersList(){$("#userTable").empty();var n=new Promise(function(n){ajaxGet("/AccountManagement/List",null,function(t){if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}var i=checkPermission(76),r=checkPermission(75),f='<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>',e="<li><a onclick=\"showUpdateUserModal({0}, '{1}', '{2}', '{3}', '{4}', '{5}', '{6}', '{7}','{8}','{9}','{10}')\">修改<\/a><\/li>",o="<li><a onclick=\"deleteUser({0}, '{1}')\">删除<\/a><\/li>",s=function(n){var t=e.format(n.id,n.role,escape(n.account),escape(n.name),escape(n.phone),escape(n.emailAddress),escape(n.permissions),escape(n.deviceIds),escape(n.productionRole),escape(n.emailType),escape(n.allDevice)),u=o.format(n.id,escape(n.account));return!i&&!r||n.isDeleted?"":f.format(i?t:"",r?u:"")},h=function(n){return n.isDeleted?"<span class='text-red'>是<\/span>":"否"},c=function(n,t,i,r){return r.row+1},u=[{data:"id",title:"id",render:c},{data:"account",title:"用户名"},{data:"number",title:"编号"},{data:"name",title:"姓名"},{data:"roleName",title:"角色"},{data:"phone",title:"手机号"},{data:"emailAddress",title:"邮箱"},{data:null,title:"删除",render:h}];(i||r)&&u.push({data:null,title:"操作",render:s,orderable:!1});$("#userTable").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t.datas,aLengthMenu:[20,40,60],iDisplayLength:20,columns:u})})});Promise.all([n]).then(()=>{})}function deleteUser(n,t){t=unescape(t);var i=function(){var i={id:n,account:t};ajaxPost("/AccountManagement/Delete",i,function(n){layer.msg(n.errmsg);n.errno==0&&getUsersList()})};showConfirm("删除用户："+t,i)}function roleRule(n,t){return n.id<t.id?1:-1}function addReset(){addList=[];$(".dd").val("");$("#addProcessor").iCheck("uncheck");$("#addSurveyor").iCheck("uncheck");lastAddRole=0;addList=[];showAddUserModal(-1)}function showAddUserModal(n=0){var u,i,t,r;if(emailType(),addList=[],$("#add_protoDiv").click(),$(".dd").val(""),$("#addProcessor").iCheck("uncheck"),$("#addSurveyor").iCheck("uncheck"),u=$("#addRole").val(),$("#addRole").empty(),i=new Promise(function(n){ajaxGet("/RoleManagement/List",null,function(t){var i,r;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}var u=t.datas.sort(roleRule),f="";for(i=0;i<u.length;i++)r=u[i],f+='<option value="{0}">{1}<\/option>'.format(r.id,r.name);$("#addRole").append(f)})}),t=100,!checkPermission(t)){layer.msg("没有权限");return}r=new Promise(function(n){deviceId=[];var i={};i.opType=t;ajaxPost("/Relay/Post",i,function(t){var i;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}for(i in t.datas)deviceId.push(t.datas[i].Id.toString());var r=function(n){return'<input type="checkbox" value="{0}" class="icb_minimal">'.format(n.Id)},u=0,f=function(){return++u};$("#addDeviceList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t.datas,aLengthMenu:[20,40,60],iDisplayLength:20,aaSorting:[[1,"asc"]],columns:[{data:null,title:"全选<input type='checkbox' class='icb_minimal' id='checkAll'>",render:r,orderable:!1},{data:"Id",title:"Id",render:f},{data:"Code",title:"机台号"},{data:"DeviceName",title:"设备名"}],drawCallback:function(){var t,n;$("#addDeviceList td").css("padding","3px");$("#addDeviceList .icb_minimal").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"});$("#addDeviceList .icb_minimal").on("ifChanged",function(){var n=$(this),t=n.attr("value"),i;if(!isStrEmptyOrUndefined(t))if(n.is(":checked"))n.parents("tr:first").css("background-color","gray"),addList.indexOf(t)==-1&&addList.push(t),$("#checkAll").is(":checked")&&(addList=[]),addList.length==deviceId.length&&$("#checkAll").iCheck("check");else if(n.parents("tr:first").hasClass("odd")?n.parents("tr:first").css("background-color","#f9f9f9"):n.parents("tr:first").css("background-color",""),addList.indexOf(t)!=-1&&addList.splice(addList.indexOf(t),1),$("#checkAll").is(":checked")){for(i=0;i<deviceId.length;i++)deviceId[i]!=t&&addList.push(deviceId[i]);$("#checkAll").iCheck("uncheck")}});$("#checkAll").on("ifChanged",function(){$(this).is(":checked")?($("#addDeviceList .icb_minimal").iCheck("check"),addList=[]):addList.length==0&&$("#addDeviceList .icb_minimal").iCheck("uncheck")});if($("#checkAll").is(":checked"))addList=[],$("#addDeviceList .icb_minimal").iCheck("check");else for(t=$("#addDeviceList .icb_minimal"),n=0;n<t.length;n++)isNumber(t[n].value)&&(addList.indexOf(t[n].value)==-1?$(t[n]).iCheck("uncheck"):$(t[n]).iCheck("check"))}})})});Promise.all([i,r]).then(()=>{n!=-1&&$("#addUserModal").modal("show")})}function emailType(){ajaxGet("/AccountManagement/EmailType",null,function(n){var u,i,t,r;if(n.errno!=0){layer.msg(n.errmsg);return}for($("#addEmailType").empty(),tf&&(tf=!1,$("#addEmailType").before('<label class="control-label">邮件类型：<\/label>')),u='<label class="control-label" style="margin-left:10px">{1}：<\/label><input type="checkbox" value="{0}" class="icb_minimal">',i="",t=0;t<n.datas.length;t++)r=n.datas[t],i+=u.format(r.type,r.name);$("#addEmailType").append(i);$("#addEmailType .icb_minimal").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal",increaseArea:"20%"});emailTypeData=[];$("#addEmailType .icb_minimal").on("ifChanged",function(){$(this).is(":checked")?emailTypeData.push($(this).val()):emailTypeData.splice(emailTypeData.indexOf($(this).val()),1)})})}function addUser(){var s=$("#addAccount").val().trim(),h=$("#addName").val().trim(),u=$("#addPhone").val().trim(),t=$("#addEmail").val().trim(),c=emailTypeData.join(),l=$("#addPassword").val().trim(),n=$("#addRole").val(),i,r,f,e,y,o,p;n=n==null?"":n.join();i=[];$("#addProcessor").is(":checked")&&i.push(0);$("#addSurveyor").is(":checked")&&i.push(1);var w=i.join(","),a=[],v=$("#add_per_body .on_cb");for(r=0;r<v.length;r++)f=v[r],e=parseInt($(f).attr("value")),$(f).is(":checked")&&e>0&&a.push(e);if(y=a.join(","),o="",o=$("#checkAll").is(":checked")?deviceId.join(","):addList.join(","),isStrEmptyOrUndefined(s)){layer.msg("用户名不能为空");return}if(isStrEmptyOrUndefined(h)){layer.msg("姓名不能为空");return}if(!isStrEmptyOrUndefined(u)&&!isPhone(u)){layer.msg("手机号错误");return}if(!isEmail(t)&&!isStrEmptyOrUndefined(t)){showTip("addEmailTip","邮箱格式不正确，请输入：登录名@主机名.域名的格式");return}if(isStrEmptyOrUndefined(l)){layer.msg("密码不能为空");return}if(isStrEmptyOrUndefined(t)&&!isStrEmptyOrUndefined(c)){layer.msg("选择邮件类型邮箱不能为空");return}if(isStrEmptyOrUndefined(n)){layer.msg("请选择角色");return}p=function(){$("#addUserModal").modal("hide");var i={account:s,password:l,name:h,phone:u,email:t,emailType:c,role:n,permissions:y,isProcessor:w,allDevice:$("#checkAll").is(":checked")?"1":"0",deviceIds:o};ajaxPost("/AccountManagement/Add",i,function(n){layer.msg(n.errmsg);n.errno==0&&getUsersList()})};showConfirm("添加",p)}function showUpdateUserModal(n,t,i,r,u,f,e,o,s,h,c){var l,v,y,a,p;if(t=t.split(","),i=unescape(i),r=unescape(r),u=unescape(u),f=unescape(f),e=unescape(e),o=unescape(o),s=unescape(s),h=unescape(h),c=unescape(c),isStrEmptyOrUndefined(o)||(updateList=o.split(",")),$("#update_protoDiv").click(),permission=e,$("#updateId").html(n),$("#updateAccount").val(i),$("#updateName").val(r),$("#updatePhone").val(u),$("#updateEmail").val(f),$("#updatePassword").iCheck("uncheck"),$("#updateNewPassword").val(""),l=s.split(","),$("#updateProcessor").iCheck(l.indexOf("0")>-1?"check":"uncheck"),$("#updateSurveyor").iCheck(l.indexOf("1")>-1?"check":"uncheck"),v=new Promise(function(n){ajaxGet("/AccountManagement/EmailType",null,function(t){var o,f,u,e,s,r,i;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}for($("#upEmailType").empty(),tf1&&(tf1=!1,$("#upEmailType").before('<label class="control-label">邮件类型：<\/label>')),o='<label class="control-label" style="margin-left:10px">{1}：<\/label><input type="checkbox" value="{0}" class="icb_minimal">',f="",u=0;u<t.datas.length;u++)e=t.datas[u],f+=o.format(e.type,e.name);for($("#upEmailType").append(f),$("#upEmailType .icb_minimal").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal",increaseArea:"20%"}),s=h.split(","),r=$("#upEmailType .icb_minimal"),i=0;i<r.length;i++)s.indexOf(r[i].value)==-1?$(r[i]).iCheck("uncheck"):$(r[i]).iCheck("check")})}),$("#updateRole").empty(),y=new Promise(function(n){ajaxGet("/RoleManagement/List",null,function(i){var r,u;if(n("success"),i.errno!=0){layer.msg(i.errmsg);return}var f=i.datas.sort(roleRule),o="";for(r=0;r<f.length;r++)u=f[r],o+='<option value="{0}">{1}<\/option>'.format(u.id,u.name);$("#updateRole").append(o);$("#updateRole").val(t).trigger("update");getOtherPermission("update_per_body",$("#updateRole").val(),e)})}),a=100,!checkPermission(a)){layer.msg("没有权限");return}p=new Promise(function(n){deviceId=[];var t={};t.opType=a;ajaxPost("/Relay/Post",t,function(t){var i;if(n("success"),t.errno!=0){layer.msg(t.errmsg);return}c=="true"&&(updateList=[]);for(i in t.datas)deviceId.push(t.datas[i].Id.toString()),c=="true"&&updateList.push(t.datas[i].Id);var r=function(n){return'<input type="checkbox" value="{0}" class="icb_minimal" onclick="">'.format(n.Id)},u=0,f=function(){return++u};$("#updateDeviceList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:t.datas,aLengthMenu:[20,40,60],iDisplayLength:20,aaSorting:[[1,"asc"]],columns:[{data:null,title:"全选<input type='checkbox' class='icb_minimal' id='upCheckAll'>",render:r,orderable:!1},{data:"Id",title:"Id",render:f},{data:"Code",title:"机台号"},{data:"DeviceName",title:"设备名"}],drawCallback:function(){var t,n;$("#updateDeviceList td").css("pupdateing","3px");$("#updateDeviceList .icb_minimal").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"});updateList.length==deviceId.length&&$("#upCheckAll").iCheck("check");$("#updateDeviceList .icb_minimal").on("ifChanged",function(){var n=$(this),t=n.attr("value"),i;if(!isStrEmptyOrUndefined(t))if(n.is(":checked"))n.parents("tr:first").css("background-color","gray"),updateList.indexOf(t)==-1&&updateList.push(t),$("#upCheckAll").is(":checked")&&(updateList=[]),updateList.length==deviceId.length&&$("#upCheckAll").iCheck("check");else if(n.parents("tr:first").hasClass("odd")?n.parents("tr:first").css("background-color","#f9f9f9"):n.parents("tr:first").css("background-color",""),updateList.indexOf(t)!=-1&&updateList.splice(updateList.indexOf(t),1),$("#upCheckAll").is(":checked")){for(i=0;i<deviceId.length;i++)deviceId[i]!=t&&updateList.push(deviceId[i]);$("#upCheckAll").iCheck("uncheck")}});$("#upCheckAll").on("ifChanged",function(){$(this).is(":checked")?($("#updateDeviceList .icb_minimal").iCheck("check"),updateList=[]):updateList.length==0&&$("#updateDeviceList .icb_minimal").iCheck("uncheck")});if($("#upCheckAll").is(":checked"))updateList=[],$("#updateDeviceList .icb_minimal").iCheck("check");else for(t=$("#updateDeviceList .icb_minimal"),n=0;n<t.length;n++)isNumber(t[n].value)&&(updateList.indexOf(t[n].value)==-1?$(t[n]).iCheck("uncheck"):$(t[n]).iCheck("check"))}})})});Promise.all([v,y,p]).then(()=>{$("#updateUserModal").modal("show")})}function updateUser(){for(var e,o,n,i,r,s,h,k,c,l,a,d,g=parseInt($("#updateId").html()),v=$("#updateName").val(),t=$("#updateEmail").val(),u=$("#updatePhone").val(),y=[],p=$("#upEmailType .icb_minimal"),f=0;f<p.length;f++)e=p[f],$(e).is(":checked")&&y.push(e.value);o=y.join();n=$("#updateRole").val();n=n==null?"":n.join();i=[];$("#updateProcessor").is(":checked")&&i.push(0);$("#updateSurveyor").is(":checked")&&i.push(1);var nt=i.join(","),w=[],b=$("#update_per_body .on_cb");for(r=0;r<b.length;r++)s=b[r],h=parseInt($(s).attr("value")),$(s).is(":checked")&&h>0&&w.push(h);if(k=w.join(","),c="",c=$("#upCheckAll").is(":checked")?"":updateList.join(","),isStrEmptyOrUndefined(v)){layer.msg("姓名不能为空");return}if(!isStrEmptyOrUndefined(u)&&!isPhone(u)){layer.msg("手机号错误");return}if(l={id:g,name:v,phone:u,email:t,emailType:o,role:n,permissions:k,isProcessor:nt,allDevice:$("#upCheckAll").is(":checked")?"1":"0",deviceIds:c},!isEmail(t)&&!isStrEmptyOrUndefined(t)){showTip("updateEmailTip","邮箱格式不正确，请输入：登录名@主机名.域名的格式");return}if($("#updatePassword").is(":checked")){if(a=$("#updateNewPassword").val(),isStrEmptyOrUndefined(a)){layer.msg("密码不能为空");return}l.password=a}if(isStrEmptyOrUndefined(t)&&!isStrEmptyOrUndefined(o)){layer.msg("选择邮件类型邮箱不能为空");return}if(isStrEmptyOrUndefined(addRole)){layer.msg("请选择角色");return}d=function(){$("#updateUserModal").modal("hide");ajaxPost("/AccountManagement/Update",l,function(n){layer.msg(n.errmsg);n.errno==0&&getUsersList()})};showConfirm("修改",d)}function getOtherPermission(n,t,i,r=0){if(r==0){if(lastAddRole==t)return;lastAddRole=t}else{if(lastUpdateRole==t)return;lastUpdateRole=t}var u=null;isStrEmptyOrUndefined(i)||(u=i.split(",").map(Number));$("#"+n).empty();ajaxGet("/Account/OtherPermissions",{role:t},function(t){var o,r,f,e,i;if(t.errno!=0){layer.msg(t.errmsg);return}if(r=[],u!=null)for(i=0;i<t.datas.length;i++)o=t.datas[i],u.indexOf(o.id)>-1&&r.push(o.id);for(showPermissions(n,t.datas),i=0;i<r.length;i++)$("#update_per_body .on_cb").filter("[value="+r[i]+"]").iCheck("check");if(u!=null){for(f=$("#update_per_body .4"),i=0;i<f.length;i++)$(f[i]).is(":checked")&&updateCheckBoxState("update_per_body",f[i],!1);for(e=$("#update_per_body .3"),i=0;i<e.length;i++)$(e[i]).is(":checked")&&updateCheckBoxState("update_per_body",e[i],!1)}})}function showPermissions(n,t){for(var r,w,c,u,e,l,s,b,f,o,k,a,h,v=`<div class="box box-solid noShadow" style="margin-bottom: 0;">
            <div class="box-header no-padding">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="on_i fa fa-minus"></i></button>
                <input type="checkbox" class="on_cb" style="width: 15px;"/>
                <h3 class="box-title" style="vertical-align: middle;font-size: 16px;"></h3>
            </div>
            <div class="box-body no-padding">
                <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px"></ul>
            </div>
        </div>`,g=`<div class="box box-solid noShadow" style="margin-bottom: 0;">
            <div class="box-header no-padding">
                <a type="button" class="btn btn-box-tool disabled" data-widget="collapse" style="opacity:0;"><i class="on_i fa fa-minus"></i></a>
                <input type="checkbox" class="on_cb" style="width: 15px;"/>
                <h3 class="box-title" style="vertical-align: middle;font-size: 16px;"></h3>
            </div>
            <div class="box-body no-padding">
                <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px"></ul>
            </div>
        </div>`,y=`<li>
            <div class="box box-solid noShadow" style="margin-bottom: 0;">
                <div class="box-header no-padding">
                    <a type="button" class="btn btn-box-tool disabled" data-widget="collapse"><i class="fa fa-chevron-right"></i></a>
                    <input type="checkbox" class="on_cb" style="width: 15px;" />
                    <h3 class="box-title" style="vertical-align: middle;font-size: 16px;"></h3>
                </div>
            </div>
         </li>`,d=PermissionTypes,i=null,p=0;p<d.length;p++)for(r=d[p],i=$(v).clone(),i.find("h3").text(r.name),i.find(".on_cb").attr("value",r.id),i.find(".on_cb").addClass("1"),i.find(".on_ul").attr("id",`${r.isPage?"t":"f"}ul`+r.id),$("#"+n).append(i),w=getMenus(t,r),c=0;c<w.length;c++)if(u=w[c],e=getMenuData(t,u),e.length>0)if(r.isPage&&u.noChild)l=e[0],i=$(y).clone(),i.find("h3").text(l.name),i.find(".on_cb").attr("value",l.id),i.find(".on_cb").attr("pid",l.parent),i.find(".on_cb").addClass("1"),$("#"+n).find(`[id=${r.isPage?"t":"f"}ul${u.parent}]`).append(i);else if(i=$("<li>"+v+"<li>").clone(),i.find("h3").text(u.name),i.find(".on_cb").attr("value",u.id),i.find(".on_cb").attr("pid",u.parent),i.find(".on_cb").addClass("2"),i.find(".on_ul").attr("id",`${r.isPage?"t":"f"}ul`+u.id),i.find("div:first").addClass("collapsed-box"),i.find(".on_i").removeClass("fa-minus"),i.find(".on_i").addClass("fa-plus"),$("#"+n).find(`[id=${r.isPage?"t":"f"}ul${u.parent}]`).append(i),r.isPage)for(f=0;f<e.length;f++)s=e[f],i=$(y).clone(),i.find("h3").text(s.name),i.find(".on_cb").attr("value",s.id),i.find(".on_cb").attr("pid",s.parent),i.find(".on_cb").addClass("3"),$("#"+n).find(`[id=${r.isPage?"t":"f"}ul${s.parent}]`).append(i);else for(b=getLabels(e,u),f=0;f<b.length;f++)for(o=b[f],i=$("<li>"+v+"<li>").clone(),i.find("h3").text(o.name),i.find(".on_cb").attr("value",o.id),i.find(".on_cb").attr("pid",o.parent),i.find(".on_cb").addClass("3"),i.find(".on_ul").attr("id",`${r.isPage?"t":"f"}ul`+o.id),i.find("div:first").addClass("collapsed-box"),i.find(".on_i").removeClass("fa-minus"),i.find(".on_i").addClass("fa-plus"),$("#"+n).find(`[id=${r.isPage?"t":"f"}ul${o.parent}]`).append(i),k=getLabelData(e,o),a=0;a<k.length;a++)h=k[a],i=$(y).clone(),i.find("h3").text(h.name),i.find(".on_cb").attr("value",h.id),i.find(".on_cb").attr("pid",h.parent),i.find(".on_cb").addClass("4"),$("#"+n).find(`[id=${r.isPage?"t":"f"}ul${h.parent}]`).append(i);$(".on_cb").iCheck({checkboxClass:"icheckbox_minimal",increaseArea:"20%"});$(".on_cb").on("ifClicked",function(){var t=$(this).is(":checked");$(this).parents(".box-solid:first").find(".on_cb").iCheck(t?"uncheck":"check");updateCheckBoxState(n,this,t)})}function rule(n,t){return n.parent!=t.parent?n.parent>t.parent?1:-1:n.order!=t.order?n.order>t.order?1:-1:n.id>t.id?1:-1}function getMenus(n,t){for(var i,f,r,e,u,s=[],o=0;o<PermissionPageTypes.length;o++)for(i=PermissionPageTypes[o],f=0;f<n.length;f++)if(r=n[f],e=!1,t.isPage?r.isPage==t.isPage&&r.label==i.name&&(e=!0):r.isPage==t.isPage&&r.type==i.type&&(e=!0),e){u=clone(i);u.id=t.isPage?i.id:lid--;u.isPage=t.isPage;u.parent=t.id;s.push(u);break}return s}function getMenuData(n,t){for(var i,r,u,e=[],f=0;f<n.length;f++)i=n[f],r=!1,t.isPage?i.isPage==t.isPage&&i.label==t.name&&(r=!0):i.isPage==t.isPage&&i.type==t.type&&(r=!0),r&&(u=clone(i),u.isPage=t.isPage,u.parent=t.id,e.push(u));return e.sort(rule)}function getLabels(n,t){for(var i,r,u=[],f=0;f<n.length;f++)i=n[f],i.isPage!=t.isPage||i.type!=t.type||existArrayObj(u,"name",i.label)||(r=clone(i),r.id=lid--,r.name=i.label,r.parent=t.id,u.push(r));return u.sort(rule)}function getLabelData(n,t){for(var i,u,f=[],r=0;r<n.length;r++)i=n[r],i.isPage==t.isPage&&i.type==t.type&&i.label==t.name&&(u=clone(i),u.parent=t.id,f.push(u));return f.sort(rule)}function updateCheckBoxState(n,t,i){var r=$(t).attr("pid"),f,u;if(i){for($("#"+n).find(".on_cb").filter("[value="+r+"]").iCheck("uncheck"),f=$("#"+n).find(".on_cb").filter("[pid="+r+"]"),u=0;u<f.length;u++)if($(f[u]).is(":checked")){$("#"+n).find(".on_cb").filter("[value="+r+"]").iCheck("check");break}}else $("#"+n).find(".on_cb").filter("[value="+r+"]").iCheck("check");(r=$(t).attr("pid"),r!=null)&&(t=$("#"+n).find(".on_cb").filter("[value="+r+"]"),updateCheckBoxState(n,t,i))}var addList=null,deviceId=null,emailTypeData=[],tf=!0,updateList=[],permission=null,tf1=!0,lastAddRole=0,lastUpdateRole=0,lid=-PermissionPageTypes.length;