function pageReady(){getRoleList();$("#add_per_body,#update_per_body").on("ifClicked",".on_cb",function(){var r=!$(this).is(":checked"),n=$(this).parents(".box-solid"),t,u,i;if(n.eq(0).find(".on_cb").iCheck(r?"check":"uncheck"),r)n.find(".on_cb:first").iCheck("check");else for(t=1,u=n.length;t<u;t++)i=n.eq(t),i.find("ul:first > li").find(".on_cb:first").is(":checked")||i.find(".on_cb:first").iCheck("uncheck")})}function getRoleList(){ajaxGet("/RoleManagement/List",null,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}var i=function(n){var t="<li><a onclick=\"showUpdateRole({0}, '{1}', '{2}')\">修改<\/a><\/li>".format(n.id,escape(n.name),escape(n.permissions)),i="<li><a onclick=\"deleteRole({0}, '{1}')\">删除<\/a><\/li>".format(n.id,escape(n.name));return'<div class="btn-group"><button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"><\/i>操作<\/button >    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="caret"><\/span>        <span class="sr-only">Toggle Dropdown<\/span>    <\/button>    <ul class="dropdown-menu" role="menu" style="cursor:pointer">{0}{1}    <\/ul><\/div>'.format(t,i)},r=0,t=function(){return++r},u=checkPermission(80)||checkPermission(79)?[{data:null,title:"序号",render:t},{data:"id",title:"Id",bVisible:!1},{data:"name",title:"角色名称"},{data:null,title:"操作",render:i,orderable:!1}]:[{data:null,title:"序号",render:t},{data:"id",title:"Id",bVisible:!1},{data:"name",title:"角色名称"}];$("#rolesList").DataTable({dom:'<"pull-left"l><"pull-right"f>rt<"col-sm-5"i><"col-sm-7"p>',destroy:!0,paging:!0,searching:!0,language:oLanguage,data:n.datas,aLengthMenu:[10,20,30],iDisplayLength:10,columns:u})})}function showAddRoles(){$("#addRoleName").val("");$("#add_per_body").empty();ajaxGet("/Account/Permissions",null,function(n){if(n.errno!=0){layer.msg(n.errmsg);return}n.datas.length>0&&showPermissions("add_per_body",n.datas);$("#addRoleModel").modal("show")})}function addRole(){var e=$("#addRoleName").val().trim(),t,i,n,o,r,u,f,s;if(isStrEmptyOrUndefined(e)){layer.msg("角色名不能为空");return}for(t=[],i=$("#add_per_body .on_cb"),n=0,o=i.length;n<o;n++)r=i.eq(n),u=r.val(),r.is(":checked")&&u>0&&t.push(u);if(f=t.join(","),isStrEmptyOrUndefined(f)){layer.msg("请选择权限");return}s=function(){$("#addRoleModel").modal("hide");var n={name:e,permissions:f};ajaxPost("/RoleManagement/Add",n,function(n){layer.msg(n.errmsg);n.errno==0&&getRoleList()})};showConfirm("添加",s)}function deleteRole(n,t){t=unescape(t);var i=function(){var t={id:n};ajaxPost("/RoleManagement/Delete",t,function(n){layer.msg(n.errmsg);n.errno==0&&getRoleList()})};showConfirm("删除角色："+t,i)}function showUpdateRole(n,t,i){t=unescape(t);i=unescape(i);var r=i.split(",");$("#update_protoDiv").click();$("#updateRoleName").val(t);$("#update_per_body").empty();$("#updateId").html(n);ajaxGet("/Account/Permissions",null,function(n){var i,t,u;if(n.errno!=0){layer.msg(n.errmsg);return}if(n.datas.length>0)for(showPermissions("update_per_body",n.datas),i=$("#update_per_body .on_cb"),i.filter("[value=0]").iCheck("check"),t=0,u=r.length;t<u;t++)i.filter(`[value=${r[t]}]`).iCheck("check");$("#updateRoleModal").modal("show")})}function updateRole(){var e=$("#updateRoleName").val(),t,i,n,o,r,u,f,s,h;if(isStrEmptyOrUndefined(e)){layer.msg("角色名不能为空");return}for(t=[],i=$("#update_per_body .on_cb"),n=0,o=i.length;n<o;n++)r=i.eq(n),u=r.val(),r.is(":checked")&&u>0&&t.push(u);if(f=t.join(","),isStrEmptyOrUndefined(f)){layer.msg("你还未选择权限");return}s=parseInt($("#updateId").html());h=function(){$("#updateRoleModal").modal("hide");var n={id:s,name:e,permissions:f};ajaxPost("/RoleManagement/Update",n,function(n){layer.msg(n.errmsg);n.errno==0&&getRoleList()})};showConfirm("修改",h)}function showPermissions(n,t){for(var r,u,e,o=`<div class="box box-solid noShadow" style="margin-bottom: 0;">
                            <div class="box-header no-padding">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="on_i fa fa-minus"></i></button>
                                <label class="pointer" style="margin:0;font-weight:inherit">
                                    <input type="checkbox" class="on_cb" style="width: 15px" value="0">
                                    <span class="textOverTop" style="vertical-align: middle;font-size: 16px">权限管理</span>
                                </label>
                            </div>
                            <div class="box-body no-padding">
                                <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px">{0}</ul>
                            </div>
                        </div>`,s=`<li><div class="box box-solid noShadow collapsed-box" style="margin-bottom: 0;">
                        <div class="box-header no-padding">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="on_i fa fa-plus"></i></button>
                            <label class="pointer" style="margin:0;font-weight:inherit">
                                <input type="checkbox" class="on_cb" style="width: 15px" value="{0}">
                                <span class="textOverTop" style="vertical-align: middle;font-size: 16px">{1}</span>
                            </label>
                        </div>
                        <div class="box-body no-padding">
                            <ul class="on_ul nav nav-pills nav-stacked mli" style="margin-left: 20px">{2}</ul>
                        </div>
                    </div></li>`,h=`<li><div class="box box-solid noShadow" style="margin-bottom: 0;">
                            <div class="box-header no-padding">
                                <a type="button" class="btn btn-box-tool disabled" data-widget="collapse"><i class="fa fa-chevron-right"></i></a>
                                <label class="pointer" style="margin:0;font-weight:inherit">
                                    <input type="checkbox" class="on_cb" style="width: 15px" value="{0}">
                                    <span class="textOverTop" style="vertical-align: middle;font-size: 16px">{1}</span>
                                </label>
                            </div>
                        </div></li>`,i={parent:[]},f=0,c=t.length;f<c;f++)r=t[f],u=r.parent,u==0?i.parent.push(r):i[u]?i[u].push(r):i[u]=[r];e=n=>(n.sort((n,t)=>n.order-t.order),n.map(n=>{return""+(i[n.id]?s.format(n.id,n.name,e(i[n.id])):h.format(n.id,n.name))}).join(""));$(`#${n}`).empty().append(i.parent.length?o.format(e(i.parent)):"");$(".on_cb").iCheck({checkboxClass:"icheckbox_minimal",increaseArea:"20%"})}