function pageReady(){_permissionList[123]={uIds:["showAddRoles"]};_permissionList[124]={uIds:[]};_permissionList[125]={uIds:[]};_permissionList=checkPermissionUi(_permissionList);getRoleList();$("#add_per_body,#update_per_body").on("ifClicked",".on_cb",function(){var n=!$(this).is(":checked"),t=$(this).parents(".box-solid");t.eq(0).find(".on_cb").iCheck(n?"check":"uncheck");n&&t.find(".on_cb:first").iCheck("check")})}function getRoleList(){ajaxPost("/Relay/Post",{opType:81},n=>{if(n.errno!=0){layer.msg(n.errmsg);return}const i=n.datas,t="rolesList",f=`#${t}`,e=`${t}Arr`,o=`${t}Data`;if(tableTmp[e]=[],tableTmp[o]=[],tableTmp[t])updateTable(tableTmp[t],i);else{const n=dataTableConfig(i);n.addColumns([{data:"Name",title:"角色名称"},]);var r=_permissionList[124].have,u=_permissionList[125].have;const e=function(n){const t=`<li><a onclick="showUpdateRole(${n.Id}, '${escape(n.Name)}', '${escape(n.Permissions)}')">修改</a></li>`,i=`<li><a onclick="deleteRole(${n.Id}, '${escape(n.Name)}')">删除</a></li>`;return`<div class="btn-group">
                            <button type = "button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false"> <i class="fa fa-asterisk"></i>操作</button >
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu" style="cursor:pointer">${r?t:""}${u?i:""}
                            </ul>
                        </div>`};(r||u)&&n.addColumns([{data:null,title:"操作",render:e,orderable:!1}]);tableTmp[t]=$(f).DataTable(n)}})}function showAddRoles(){$("#addRoleName").val("");$("#add_per_body").empty();ajaxPost("/Relay/Post",{opType:55},n=>{n.errno==0&&(n.datas.length>0&&showPermissions("add_per_body",n.datas),$("#addRoleModel").modal("show"))})}function addRole(n){var o=$("#addRoleName").val().trim(),i,r,t,s,u,f,e;if(isStrEmptyOrUndefined(o)){layer.msg("角色名不能为空");return}for(i=[],r=$("#add_per_body .on_cb"),t=0,s=r.length;t<s;t++)u=r.eq(t),f=u.val(),u.is(":checked")&&f>0&&i.push(f);if(e=i.join(","),isStrEmptyOrUndefined(e)){layer.msg("请选择权限");return}showConfirm("添加",()=>{ajaxPost("/Relay/Post",{opType:83,opData:JSON.stringify([{Name:o,Permissions:e}])},t=>{(n&&$("#addRoleModel").modal("hide"),layer.msg(t.errmsg),t.errno==0)&&getRoleList()})})}function deleteRole(n,t){t=unescape(t);showConfirm(`删除角色：${t}`,()=>{ajaxPost("/Relay/Post",{opType:84,opData:JSON.stringify({ids:[n]})},n=>{layer.msg(n.errmsg),n.errno==0&&getRoleList()})})}function showUpdateRole(n,t,i){t=unescape(t);i=unescape(i);var r=i.split(",");$("#update_protoDiv").click();$("#updateRoleName").val(t);$("#update_per_body").empty();$("#updateId").html(n);ajaxPost("/Relay/Post",{opType:55},n=>{var i,t,u;if(n.errno!=0){layer.msg(n.errmsg);return}if(n.datas.length>0)for(showPermissions("update_per_body",n.datas),i=$("#update_per_body .on_cb"),i.filter("[value=0]").iCheck("check"),t=0,u=r.length;t<u;t++)i.filter(`[value=${r[t]}]`).iCheck("check");$("#updateRoleModal").modal("show")})}function updateRole(n){var o=$("#updateRoleName").val(),i,r,t,s,u,f,e,h;if(isStrEmptyOrUndefined(o)){layer.msg("角色名不能为空");return}for(i=[],r=$("#update_per_body .on_cb"),t=0,s=r.length;t<s;t++)u=r.eq(t),f=u.val(),u.is(":checked")&&f>0&&i.push(f);if(e=i.join(","),isStrEmptyOrUndefined(e)){layer.msg("你还未选择权限");return}h=parseInt($("#updateId").html());showConfirm("修改",()=>{ajaxPost("/Relay/Post",{opType:82,opData:JSON.stringify([{Id:h,Name:o,Permissions:e}])},t=>{(n&&$("#updateRoleModal").modal("hide"),layer.msg(t.errmsg),t.errno==0)&&getRoleList()})})}var _permissionList=[],tableTmp=[];