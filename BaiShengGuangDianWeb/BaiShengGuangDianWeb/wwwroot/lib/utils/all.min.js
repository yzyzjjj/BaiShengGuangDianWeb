function padLeft0(n){return n.toString().replace(/^[0-9]{1}$/,"0"+n)}function getDate(){return(new Date).format("yyyy-MM-dd")}function getTime(){return(new Date).format("hh:mm:ss")}function getFullTime(){return(new Date).format("yyyy-MM-dd hh:mm:ss")}function getDayAfter(n){var t=new Date;t.setDate(t.getDate()+n);var i=t.getFullYear(),r=padLeft0(t.getMonth()+1),u=padLeft0(t.getDate());return i+"-"+r+"-"+u}function getDayAgo(n){var t=new Date;t.setDate(t.getDate()-n);var i=t.getFullYear(),r=padLeft0(t.getMonth()+1),u=padLeft0(t.getDate());return i+"-"+r+"-"+u}function getNowMonth(){var n=new Date,t=n.getFullYear(),i=padLeft0(n.getMonth()+1);return t+"-"+i}function getNowYear(){var n=new Date;return n.getFullYear()}function compareDate(n,t){var i=new Date(n),r=new Date(t);return i.getTime()>r.getTime()}function getWeek(){return getNowYear()+"第"+$.datepicker.iso8601Week(new Date)+"周"}function codeTime(n){return n<60?n+"秒":n<3600?(n-n%60)/60+"分"+n%60+"秒":n<86400?(n-n%3600)/3600+"小时"+(n-n%60)/60%60+"分"+n%60+"秒":(n-n%86400)/86400+"天"+(n-n%3600)/3600%24+"小时"+(n-n%60)/60%60+"分"+n%60+"秒"}function exceedTime(n){return n.indexOf(" ")>-1?new Date(n).getTime()>new Date(getFullTime()).getTime():n.indexOf("-")>-1?new Date(n).getTime()>new Date(getDate()).getTime():new Date(getDate()+" "+n).getTime()>new Date(getFullTime()).getTime()}function searchPage(){var n=$("#search-select").val();isStrEmptyOrUndefined(n)||(window.location=n)}function sortRule(n,t){return typeof n=="object"?n.order==t.order?n.id>t.id?1:-1:n.order>t.order?1:-1:n>t?1:-1}function getParent(n){for(var r,t=[],i=0;i<n.length;i++)r=n[i],t.indexOf(r.parent)<0&&t.push(r.parent);return t.sort(sortRule)}function getChild(n,t){for(var i,f=getCookieTokenInfo(),u=[],r=0;r<n.length;r++)i=n[r],i.parent==t&&f.permissionsList.indexOf(i.id)>=0&&u.push(i);return u.sort(sortRule)}function initHub(){hubConnection==null&&(hubConnection=(new signalR.HubConnectionBuilder).withUrl("/chatHub").build(),initHubCallBack());hubConnection.connection.connectionState!=1&&(hubConnection.start(),joinFunc())}function joinFunc(){join==null&&(join=setInterval(function(){if(hubConnection.connection.connectionState==1){var n=getCookieTokenInfo(),t={ChatEnum:chatEnum.Connect,Message:{Id:n.id}};hubConnection.invoke("SendMsg",t);clearInterval(join);join=null;check1Func()}},1e3))}function check1Func(){check1==null&&(check1=setInterval(function(){hubConnection.connection.connectionState==2&&(clearInterval(check1),check1=null,check2Func())},1e3))}function check2Func(){check2==null&&(check2=setInterval(function(){hubConnection.connection.connectionState==1&&(clearInterval(check2),check2=null);initHub()},1e4))}function initHubCallBack(){hubConnection.on("Default",()=>{console.log("connect success")});hubConnection.on("FaultDevice",n=>{var i=parseInt($(".rCnt").html()),t;$(".rCnt").html(++i);t='<li><a href="/RepairManagement"><h3><strong class="text-red">{0}<\/strong>于<strong class="text-info">{1}<\/strong>发生故障<\/h3><\/a><\/li> ';$("#errLi .menu").append(t.format(n.Code,getFullTime()))})}function isPhone(n){return isNaN(n)?!1:/^1[0-9]{10}$/i.test(n)}function isEmail(n){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(n)?!0:!1}function isStrEmptyOrUndefined(n){return n==""?!0:n==undefined?!0:!1}function isMac(n){return/^[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}$/.test(n)||/^[A-Fa-f\d]{2}-[A-Fa-f\d]{2}-[A-Fa-f\d]{2}-[A-Fa-f\d]{2}-[A-Fa-f\d]{2}-[A-Fa-f\d]{2}$/.test(n)?!0:!1}function isIp(n){var t=n.match(/^((25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))$/);return t==null?!1:!0}function isPort(n){return n<0||n>65536?!1:!0}function isNumber(n){if(n===undefined||n===null||n==="")return!1;if(typeof n=="string")return/^\d+$/.test(n)||/^-\d+$/.test(n)||/^[1-9]\d*[.]\d+$/.test(n)||/^0[.]\d+$/.test(n)||/^-[1-9]\d*[.]\d+$/.test(n)||/^-0[.]\d+$/.test(n)?!0:!1;return typeof n=="number"?!0:!1}function getJwtInfo(n){if(isStrEmptyOrUndefined(n))return null;var i=n.split("."),r=i[1],u=Base64.decode(r),t=JSON.parse(u);return t.permissionsList=isStrEmptyOrUndefined(t.permissions)?[]:t.permissions.split(",").map(Number),t.proleList=isStrEmptyOrUndefined(t.prole)?[]:t.prole.split(",").map(Number),t}function getCookieTokenInfo(){var n=GetCookie("token");return getJwtInfo(n)}function isTokenValid(){var n=getCookieTokenInfo(),t;return n==null?!1:(t=(new Date).getTime()/1e3,t>n.exp)?!1:!0}function checkPermission(n){var t=getCookieTokenInfo();return t!=null&&isTokenValid()?t.permissionsList.indexOf(n)>=0:(SetCookie(lastLocation,window.location.pathname),window.location.href=loginUrl,-1)}function addCover(){$("body").append('<div id="body-cover"><div class="spinner"> <div class="spinner-container container1"><div class="circle1"><\/div><div class="circle2"><\/div> <div class="circle3"><\/div><div class="circle4"><\/div>  <\/div> <div class="spinner-container container2"><div class="circle1"><\/div> <div class="circle2"><\/div><div class="circle3"><\/div> <div class="circle4"><\/div> <\/div><div class="spinner-container container3"><div class="circle1"><\/div> <div class="circle2"><\/div>  <div class="circle3"><\/div> <div class="circle4"><\/div><\/div><\/div><\/div>')}function removeCover(){$("#body-cover").remove()}function reLogin(){console.log("err")}function ajaxPost(n,t,i,r){r!=0&&addCover();t==null&&(t={});var u=function(n){r!=0&&removeCover();i(n)};$.post(n,t,u).error(reLogin)}function ajaxGet(n,t,i){var r,u,f;t==null&&(t={});r="";for(u in t)r==""&&(r="?"),r!="?"&&(r=r+"&"),r=r+u+"="+t[u];f=function(n){removeCover();i(n)};n=n+r;$.get(n,f).error(reLogin)}function addToken(n){var t=GetCookie("token");return isStrEmptyOrUndefined(t)||(n.token=t),n}function getTokenTable(){var n=GetCookie("token");return isStrEmptyOrUndefined(n)?{}:{token:n}}function errorHandle(n){return n.errno==undefined||n.errno==null?!1:n.errno==0?!1:(layer.alert(n.errmsg),!0)}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+31104e6);document.cookie=n+"="+escape(t)+";expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function DelCookie(n){var t=new Date,i;t.setTime(t.getTime()-1);i=GetCookie(n);i!=null&&(document.cookie=n+"="+i+"; path=/;expires="+t.toGMTString())}function uploaderImg(n,t,i){function o(n){var t,i;for(t in uploader.fileList)for(i in uploader.fileList[t])if(uploader.fileList[t][i]===n)return t}function s(n){var t=o(File);for(var i in uploader.fileList[t])if(uploader.fileList[t][i]===n)return i}var r={},e,u,f;for(e in n)r[e]=n[e];$(document.body).append($('<input id="hidden-uploader-btn" type="file" style="display:none"  hidden/>'));for(e in n)(function(t){var i=$('<input type="file" accept="image/*" style="display:none"  hidden/>').change(function(){var r=$(n[t])[0],i=this.files[0];i&&(u=t,f=n[t],uploader.addFile(i))});$(document.body).append(i);$(n[t]).click(function(){i.click()})})(e);return uploader=new plupload.Uploader({browse_button:"hidden-uploader-btn",filters:{mime_types:[{title:"Image files",extensions:"jpeg,jpg,png"},],max_file_size:"10mb"},resize:{width:2500,quality:92,crop:!1,preserve_headers:!0},init:{PostInit:function(){},FilesAdded:function(n,t){var r=t[0],e;u&&f?(uploader.fileList[u]||(uploader.fileList[u]={}),uploader.fileList[u][f]&&uploader.removeFile(uploader.fileList[u][f]),uploader.fileList[u][f]=r,e=new FileReader,e.readAsDataURL(r.getNative()),e.onload=function(n){$(f).css("background-image","url("+n.target.result+")").addClass("bx-sz-img-loaded");i&&i.fileAdded&&i.fileAdded($(f)[0].id,r.getNative(),n.target.result)}):uploader.removeFile(r)},BeforeUpload:function(n,t){var f=o(t),r,i,u,e;if(f){if(r=uploader.fileAuths[f],r instanceof Array){for(u=0;u<r.length;u++)if(!r[u].used){i=r[u];uploader.fileAuths[f][u].used=!0;break}}else i=r;i?(e={key:i.objname,OSSAccessKeyId:i.accessid,policy:i.policy,signature:i.signature,callback:i.callback,success_action_status:"200"},n.setOption({url:i.host,multipart_params:e}),n._start()):n.removeFile(t)}else n.removeFile(t)},FileUploaded:function(n,r,u){var e,h,f;if(u.status===200){e=o(r);e;try{h=JSON.parse(u.response);t&&t(h)}catch(c){}}else i&&i.uploadedError?i.uploadedError(n,r,u):(f=s(r),f&&($(f).css("background-image","none"),$(f).removeClass("bx-sz-img-loaded"),layer.msg("上传失败,请重新上传",{icon:2})))},Error:function(n,t){if(t.file){var r=s(t.file);r&&($(r).css("background-image","none"),$(r).removeClass("bx-sz-img-loaded"));switch(t.code){case plupload.FILE_SIZE_ERROR:layer.msg("文件大小超出上传上限",{icon:2});break;case plupload.FILE_EXTENSION_ERROR:layer.msg("文件格式错误",{icon:2});break;case plupload.FILE_DUPLICATE_ERROR:layer.msg("不能上传同一张图片",{icon:2});break;case plupload.IMAGE_FORMAT_ERROR:layer.msg("图片格式出错",{icon:2});break;default:layer.msg("请重新上传",{icon:2})}}else layer.msg("上传失败,请重新上传..",{icon:2});i&&i.error&&i.error(n,t)}}}),uploader.fileList={},uploader.fileAuths={},uploader.init(),uploader._start=uploader.start,uploader.start=function(n){uploader.fileAuths=n;uploader._start()},uploader.addImg=function(n,t){var e,i;r[t]instanceof Array?r[t].push(n):(e=r[t],r[t]=[e,n]);i=$('<input type="file" accept="image/*" style="display:none" hidden/>').change(function(){var i=this.files[0];i&&(u=t,f=n,uploader.addFile(i))});$(document.body).append(i);$(n).click(function(){i.click()})},uploader.getPictures=function(){var e=[],n,t,f,i,u;for(n in r){if(t={UploadFileType:n,NewCount:0,ModifyList:[]},r[n]instanceof Array)for(f=0;f<r[n].length;f++)i=r[n][f],$(i).hasClass("bx-sz-img-loaded")&&uploader.fileList[n]&&uploader.fileList[n]&&uploader.fileList[n][i]&&(u=parseInt($(i).attr("data-modify-idx")),u===0||u?t.ModifyList.push(u):t.NewCount++);else i=r[n],$(i).hasClass("bx-sz-img-loaded")&&uploader.fileList[n]&&uploader.fileList[n][i]&&(u=parseInt($(i).attr("data-modify-idx")),u===0||u?t.ModifyList.push(u):t.NewCount=1);(t.NewCount>0||t.ModifyList.length>0)&&e.push(t)}return e},uploader.removeAllImgs=function(){r={};uploader.fileList={}},uploader}function CreateImgsByMultyUrl(n,t){var u,r,i,f;if($(n).html(""),t)for(u=t.split(","),r=0;r<u.length;r++)i=document.createElement("img"),i.setAttribute("src",u[r]),i.setAttribute("style","margin-top:5px"),f=new Viewer(i),$(n).append(i),$(n).append("<br />")}function CreateImgsByMultyUrlNew(n,t){var u,i,r;if($(n).html(""),t)for(u=t.split(","),i=0;i<u.length;i++)r=document.createElement("img"),r.setAttribute("src",u[i]),r.setAttribute("style","margin-top:5px"),$(n).append(r),$(n).append("<br />")}function CreateInvoiceImgs(n,t){var i,f,r,u,e;if($(n).html(""),t)for(i=0;i<t.OurInvoiceUrlList.length;i++)f=t.OurInvoiceUrlList[i].m_Item2.URL,r=document.createElement("imgDiv"),$(r).append('<h4 style="color:#45B4FF; margin-top:5px;">第'+t.OurInvoiceUrlList[i].m_Item1+"期<\/h4>"),$(r).append('<p style="margin-top:5px;"><b style="margin-right:10px;">发票号:<\/b>'+t.OurInvoiceUrlList[i].m_Item2.Id+"<\/p>"),$(r).append('<p style="margin-top:5px;"><b style="margin-right:10px;">开票时间:<\/b>'+t.OurInvoiceUrlList[i].m_Item2.Time+"<\/p>"),u=document.createElement("img"),u.setAttribute("src",f),e=new Viewer(u),$(r).append(u),$(n).append(r)}function CreateInvoiceImgsNew(n,t){var i,f,r,u;if($(n).html(""),t)for(i=0;i<t.OurInvoiceUrlList.length;i++)f=t.OurInvoiceUrlList[i].m_Item2.URL,r=document.createElement("imgDiv"),$(r).append('<h4 style="color:#45B4FF; margin-top:5px;">第'+t.OurInvoiceUrlList[i].m_Item1+"期<\/h4>"),$(r).append('<p style="margin-top:5px;"><b style="margin-right:10px;">发票号:<\/b>'+t.OurInvoiceUrlList[i].m_Item2.Id+"<\/p>"),$(r).append('<p style="margin-top:5px;"><b style="margin-right:10px;">开票时间:<\/b>'+t.OurInvoiceUrlList[i].m_Item2.Time+"<\/p>"),u=document.createElement("img"),u.setAttribute("src",f),$(r).append(u),$(n).append(r)}function ImgCreated(n){this.id=n.id;this.url=n.url;this.dataType();this.creat()}function dataType(){var n=Object.prototype.toString,t={isStr:function(t){return n.call(t)=="[object String]"},isObj:function(t){return n.call(t)=="[object Object]"},isArr:function(t){return n.call(t)=="[object Array]"},isNull:function(t){return n.call(t)=="[object Null]"}};if(!t.isArr(this.id))throw"ID  type must be an array";if(!t.isArr(this.url))throw"URL  type must be an array";if(this.id.length!==this.url.length)throw"The length of ID and URL must be the same";}function imgShowBig(n){var t=new Viewer(document.getElementById(n),{ready:function(){t.update()},show:function(){t.update()},shown:function(){t.update()},hide:function(){t.update()}})}function creat(){var n=this,t=[null,undefined,NaN];this.url.forEach(function(i,r){var u=document.getElementById(n.id[r]);if(u.innerHTML="",t.indexOf(i)>=0)return!1;i.split(",").forEach(function(n){var t=document.createElement("img");t.className="idePhoto";t.setAttribute("src",n);u.appendChild(t)})})}function showConfirm(n,t){layer.confirm("是否确定"+n,{btn:["确定","取消"],success:function(){this.enterEsc=function(n){return n.keyCode===13?($(".layui-layer-btn0").click(),!1):n.keyCode==27?($(".layui-layer-btn1").click(),!1):void 0};$(document).on("keydown",this.enterEsc)},end:function(){$(document).off("keydown",this.enterEsc)}},function(n){layer.close(n);t()},function(n){layer.close(n)})}function focusIn(n,t="label-danger"){var i=n.parent().find("."+t+":first");i.html();i.addClass("hidden")}function inputChange(n,t){var i=n.parents("."+t+":first").find(".label-danger");i.html();i.addClass("hidden")}function hideTip(n){typeof n=="string"?($("#"+n).addClass("hidden"),$("#"+n).html()):(n.addClass("hidden"),n.html())}function showTip(n,t){typeof n=="string"?($("#"+n).removeClass("hidden"),$("#"+n).html(t)):(n.removeClass("hidden"),n.html(t))}function hideClassTip(n){$("."+n).addClass("hidden");$("."+n).html()}function showClassTip(n,t){$("."+n).removeClass("hidden");$("."+n).html(t)}function getQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(i);return t!=null?unescape(t[2]):null}function initFileInput(n,t){$("#"+n).attr("accept",fileAccept[t]);return $("#"+n).fileinput({language:"zh",uploadUrl:"/Upload/File",allowedFileExtensions:fileExt[t],showUpload:!1,showPreview:!0,showCaption:!0,minFileCount:1,maxFileCount:1,dropZoneEnabled:!1,browseClass:"btn btn-primary",uploadAsync:!0,autoReplace:!0,layoutTemplates:{actionDelete:"",actionUpload:"",actionZoom:""},uploadExtraData:function(){var n={};return n.type=t,n}}).on("filebatchselected",function(i,r){var u,f;r.length>1&&$("#"+n).fileinput("clear");switch(t){case fileEnum.FirmwareLibrary:case fileEnum.ApplicationLibrary:r.length!=undefined&&$("#"+n).fileinput("clear");u="";for(f in r)if(r.hasOwnProperty(f)){u=f;break}checkFileExt(u,fileExt[t])||$("#"+n).fileinput("clear")}}).on("filepreupload",function(n,t){var i=t.form,r=t.files,u=t.extra,f=t.response,e=t.reader;console.log("文件正在上传")}).on("fileerror",function(n,t,i){console.log("文件上传失败！"+i);$(this).fileinput("clear")}).on("fileuploaded",function(n,i){console.log("文件上传成功！");$(this).fileinput("clear");fileCallBack[t](i.response)})}function initFileInputMultiple(n,t){prepareUpload=[];$("#"+n).attr("multiple","");$("#"+n).attr("accept",fileAccept[t]);return $("#"+n).fileinput({language:"zh",uploadUrl:"/Upload/FileMultiple",allowedFileExtensions:fileExt[t],showUpload:!1,showPreview:!0,showCaption:!0,minFileCount:0,maxFileCount:0,dropZoneEnabled:!1,browseClass:"btn btn-primary",uploadAsync:!0,autoReplace:!1,layoutTemplates:{actionUpload:""},uploadExtraData:function(){var n={};return n.type=t,n}}).on("filebatchselected",function(i,r){var u="",e,f;for(e in r)if(r.hasOwnProperty(e)){if(u=e,!checkFileExt(u,fileExt[t])){$("#"+n).fileinput("clear");break}f=$("#"+$(this).attr("parent")).find('[data-fileid="{0}"]'.format(u)).filter(".file-preview-frame").first().attr("id");prepareUpload[f]||(prepareUpload[f]={pre:f,name:u,done:!1})}}).on("fileclear",function(){console.log("删除所有选择文件");prepareUpload=[]}).on("fileremoved",function(n,t){console.log("删除选择文件");prepareUpload=removeArrayObj(prepareUpload,t)}).on("filepreupload",function(n,t){console.log("文件正在上传");var i=t.form,r=t.files,u=t.extra,f=t.response,e=t.reader}).on("fileerror",function(n,i,r){console.log("文件上传失败！"+r);$(this).fileinput("clear");fileCallBack[t]({errno:1,errmsg:"失败"})}).on("fileuploaded",function(n,t,i){var r=t.response,u,f;if(r.errno==0)for(console.log("文件上传成功！"),u=0;u<r.data.length;u++)f=r.data[u],prepareUpload[i].done=!0,prepareUpload[i].newName=f.newName;else console.log("文件上传失败！"),layer.msg(r.errmsg)}).on("filebatchuploadcomplete",function(){var n,i;console.log("文件全部上传成功！");n=!0;for(i in prepareUpload)prepareUpload.hasOwnProperty(i)&&(prepareUpload[i].done||(n=!1));n?fileCallBack[t]({errno:0,errmsg:"成功",data:prepareUpload}):fileCallBack[t]({errno:1,errmsg:"失败"});prepareUpload=[]})}function hasPre(){var n=!1;for(var t in prepareUpload)prepareUpload.hasOwnProperty(t)&&(n=!0);return n}function checkFileExt(n,t){var r=n.toLowerCase().split("."),i;if(r.length>1)for(i=0;i<t.length;i++)if(r[r.length-1]==t[i])return!0;return!1}function onInput(n,t=5,i=4){n.value=input(n.value,t,i)}function input(n,t=5,i=4){n!=""&&n.substr(0,1)=="."&&(n="");n=n.replace(/^0*(0\.|[1-9])/,"$1");n=n.replace(/[^\d.]/g,"");n=n.replace(/\.{2,}/g,".");n=n.replace(".","$#$").replace(/\./g,"").replace("$#$",".");var r=eval("/^(\\-)*(\\d+)\\.(\\d{"+i+"}).*$/");if(n=n.replace(r,"$1$2.$3"),n.indexOf(".")<0&&n!="")while(n.substr(0,2)=="00")n=n.substr(1,n.length);return n!=""&&(n=n.split("."),n.length>0&&n[0].length>t&&(n[0]=n[0].substr(0,t)),n=n.join(".")),n}function onInputEnd(n){n.value=inputEnd(n.value)}function inputEnd(n){if(n.indexOf(".")>-1&&n!=""){for(n=n.split("").reverse().join("");n.substr(0,1)=="0";)n=n.substr(1,n.length);while(n.substr(0,1)==".")n=n.substr(1,n.length)}return n.split("").reverse().join("")}function autoCal(n,t){var o,i,u,e,f,r;if(n.value!=""){for(o=0,n.value.indexOf("±")>-1?o=1:n.value.indexOf("+")>-1&&n.value.indexOf("/")>-1&&n.value.indexOf("-")>-1?o=3:(n.value.indexOf("～")>-1||n.value.indexOf("~")>-1||n.value.indexOf("-")>-1)&&(o=2),t=$("#"+t),i=[],u=n.value.replace(" ","").split(""),u.push(";"),e="",f=0;f<u.length;f++)o==3?isNumber(u[f])||u[f]=="."||u[f]=="-"?e+=u[f]:(isNumber(e)&&(i[i.length]=parseFloat(e)),e=""):isNumber(u[f])||u[f]=="."?e+=u[f]:(isNumber(e)&&(i[i.length]=parseFloat(e)),e="");switch(o){case 1:i.length>=1&&(r=i[0]);break;case 2:i.length==1?r=i[0]:i.length>=2&&(r=(i[0]+i[1])/2);break;case 3:i.length==1?r=i[0]:i.length>=3&&(r=i[0]+(i[1]+i[2])/2);break;default:r=i.length>=1?i[0]:0}r=r.toFixed(4);r=input(r.toString());r=inputEnd(r.toString());t.val(r)}}function pcAndroid(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?!0:!1}function objectSort(n,t){for(var i,f,e=n.length,u,r=0;r<e-1;r++){for(u=!0,i=0;i<e-1-r;i++)n[i][t]>n[i+1][t]&&(u=!1,f=n[i],n[i]=n[i+1],n[i+1]=f);if(u)break}}function distinct(n){for(var r=[],u={},f=n.length,i,t=0;t<f;t++)i=n[t],u[i]||(r.push(i),u[i]=1);return r}function removeArray(n,t,i=false){for(var r in n)if(r.hasOwnProperty(t)){n.splice(n.indexOf(r),i?n.length:1);break}return n}function removeArray(n,t,i,r=false){for(var u=n.length-1;u>=0;u--)if(n[u][t]==i){n.splice(n.indexOf(n[u]),r?n.length:1);break}return n}function removeArrayObj(n,t,i=false){var u=[];for(var r in n)r!=t&&(u[r]||i||(u[r]=n[r]));return u}var loginUrl="/Account/Login",indexUrl="/Home",hubConnection=null,maxProcessData=8,lastLocation="lastLocation",tdShowLength=20,tdShowContentLength=10,oLanguage={sLengthMenu:"每页显示 _MENU_ 条记录",sZeroRecords:"对不起，查询不到任何相关数据",sInfo:"当前显示 _START_ 到 _END_ 条，共 _TOTAL_条记录",sInfoEmtpy:"找不到相关数据",sInfoFiltered:"数据表中共为 _MAX_ 条记录)",sProcessing:"正在加载中...",sSearch:"搜索",oPaginate:{sFirst:"第一页",sPrevious:" 上一页 ",sNext:" 下一页 ",sLast:" 最后一页 "}},PermissionPages=[{id:-1,name:"网页",isPage:!0},{id:-2,name:"接口",isPage:!1}],PermissionTypes=[],fileExt,fileCallBack,commonfunc,isCover,prepareUpload;PermissionTypes[0]={};PermissionTypes[1]={id:-3,name:"页面管理"};PermissionTypes[2]={id:-4,name:"组织管理"};PermissionTypes[3]={id:-5,name:"设备管理"};PermissionTypes[4]={id:-6,name:"流程卡管理"};PermissionTypes[5]={id:-7,name:"工艺管理"};PermissionTypes[6]={id:-8,name:"维修管理"};PermissionTypes[7]={id:-9,name:"数据统计"};var chatEnum={Default:0,Connect:1,FaultDevice:2,Logout:3},fileEnum={Default:0,FirmwareLibrary:1,ApplicationLibrary:2,SpotCheckImage:3},fileAccept=[];fileAccept[fileEnum.Default]=[];fileAccept[fileEnum.FirmwareLibrary]=".bin";fileAccept[fileEnum.ApplicationLibrary]="";fileAccept[fileEnum.SpotCheckImage]="image/*";fileExt=[];fileExt[fileEnum.Default]=[];fileExt[fileEnum.FirmwareLibrary]=["bin"];fileExt[fileEnum.ApplicationLibrary]=[];fileExt[fileEnum.SpotCheckImage]=["bmp","jpg","jpeg","png","gif"];fileCallBack=[];fileCallBack[fileEnum.Default]=function(){};fileCallBack[fileEnum.FirmwareLibrary]=function(){};fileCallBack[fileEnum.ApplicationLibrary]=function(){};fileCallBack[fileEnum.SpotCheckImage]=function(){};Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};commonfunc=function(){if(!isTokenValid()){window.location.href=loginUrl;return}var n=getCookieTokenInfo();$("#nuser_name").text(n.name);$("#nuser_role").text(n.role);$("#user_name").prepend(n.name);$("#user_email").text(n.email);$("#logoutBtn").click(function(){var n=getCookieTokenInfo(),t={ChatEnum:chatEnum.Logout,Message:{Id:n.id}};hubConnection.invoke("SendMsg",t);ajaxPost("/Account/Logout",null,function(){DelCookie("token");window.location.href=loginUrl})});$("#search-select").select2({allowClear:!0,placeholder:""});$("#search-select").on("select2:select",function(){$("#search-text").val($(this).find("option:selected").text());$("#search-text").css("backgroundColor","white")});$(".sidebar-menu li.mli").remove();ajaxGet("/Account/Pages",null,function(n){var e,r,o,u,i,t,s;if(n.errno!=0){layer.msg(n.msg);return}var h='<option value="{0}">{1}<\/option>',f=n.datas;for($("#search-select").empty(),$("#search-select").append("<option><\/option>"),$.each(f,function(n,t){isStrEmptyOrUndefined(t.url)||$("#search-select").append(h.format(t.url,t.name.trim()))}),e=getParent(f),r=0;r<e.length;r++)for(o=getChild(f,e[r]),u=0;u<o.length;u++)i=o[u],t=null,i.parent==0?i.url==""?(t=$('<li class="mli treeview">    <a href="#">        <i class="mi fa"><\/i> <span class="mt"><\/span>        <span class="pull-right-container">           <i class="fa fa-angle-left pull-right"><\/i>        <\/span>    <\/a>    <ul class="treeview-menu">    <\/ul><\/li>').clone(),t.find(".treeview-menu").attr("id","main"+i.id),t.find("i.mi").addClass(i.icon),t.find("span.mt").text(i.name),$(".sidebar-menu").append(t)):(t=$('<li class="mli">   <a class="menuitem">       <i class="mi fa"><\/i> <span class="mt"><\/span>   <\/a><\/li>').clone(),t.find(".menuitem").attr("id","main"+i.id),t.find(".menuitem").attr("href",i.url),t.find("i.mi").addClass(i.icon),t.find("span.mt").text(i.name),$(".sidebar-menu").append(t)):(t=$('<li>   <a class="menuitem" > <i class="fa fa-circle-o"><\/i><span><\/span><\/a><\/li >').clone(),t.find(".treeview-menu").attr("id","main"+i.id),t.find("a").attr("href",i.url),t.find("span").text(i.name),$(".sidebar-menu").find("[id=main"+i.parent+"]").append(t));s=window.location;$("a.menuitem[href]").filter(function(){var n=this.pathname;return this.pathname===s.pathname}).parent().addClass("active").parent().parent().addClass("active")});initHub()};var join=null,check1=null,check2=null;$(function(){$(".form_date").on("keydown",function(n){n.keyCode==13&&$(this).blur();$(".form_date").on("change",function(){isStrEmptyOrUndefined($(this).val())&&$(this).val(getDate())})});$(".form_date").datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$(".form_time").on("click",function(){var n=$(this).val();$(this).val(n).timepicker("setTime",n);$(".bootstrap-timepicker-widget").find("input").off("input").on("input",function(){var n=$(this).val().replace(/[^\d]/g,"");$(this).val(n)})});$(".form_month").on("keydown",function(n){n.keyCode==13&&$(this).blur();$(".form_month").on("change",function(){isStrEmptyOrUndefined($(this).val())&&$(this).val(getNowMonth())})});$(".form_month").datepicker({language:"zh-CN",format:"yyyy-mm",startView:1,minViewMode:1,maxViewMode:2,todayBtn:"linked",autoclose:!0});$(".form_time").timepicker({format:"HH:mm:ss",language:"zh-CN",showMeridian:!1,minuteStep:1,showSeconds:!0,secondStep:1});$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"});commonfunc();typeof pageReady!="undefined"&&(pageReady(),$(".form_date,.form_month,.form_time").attr("readonly",!0));$(".modal").on("hidden.bs.modal",function(){$(".modal.in").size()>=1&&$("body").addClass("modal-open")});$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.select2.defaults.set("width","100%")});jQuery.extend(jQuery.fn.dataTableExt.oSort,{"html-percent-pre":function(n){var t=String(n).replace(/<[\s\S]*?>/g,"");return t=t.replace(/&amp;nbsp;/ig,""),t=t.replace(/%/,""),parseFloat(t)?parseFloat(t):0},"html-percent-asc":function(n,t){return n<t?-1:n>t?1:0},"html-percent-desc":function(n,t){return n<t?1:n>t?-1:0}});isCover=!1;String.prototype.format=function(n){var i=this,r,t,u;if(arguments.length>0)if(arguments.length==1&&typeof n=="object")for(r in n)n[r]!=undefined&&(u=new RegExp("({"+r+"})","g"),i=i.replace(u,n[r]));else for(t=0;t<arguments.length;t++)arguments[t]!=undefined&&(u=new RegExp("({)"+t+"(})","g"),i=i.replace(u,arguments[t]));return i};String.format=function(){var t,n,i;if(arguments.length==0)return null;for(t=arguments[0],n=1;n<arguments.length;n++)i=new RegExp("\\{"+(n-1)+"\\}","gm"),t=t.replace(i,arguments[n]);return t};ImgCreated.prototype.dataType=dataType;ImgCreated.prototype.creat=creat;prepareUpload=[];