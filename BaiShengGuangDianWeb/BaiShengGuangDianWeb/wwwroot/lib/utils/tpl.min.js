function searchPage(){var n=$("#search-select").val();isStrEmptyOrUndefined(n)||(window.location=n)}function sortRule(n,t){return typeof n=="object"?n.order==t.order?n.id>t.id?1:-1:n.order>t.order?1:-1:n>t?1:-1}function getParent(n){for(var r,t,e,u,f=[],o=0,i=0;i<PermissionPageTypes.length;i++)for(r=PermissionPageTypes[i],t=0;t<n.length;t++)if(e=n[t],e.label==r.name){u=clone(r);u.id=o--;f.push(u);break}return f}function getChild(n,t){for(var r,u,f=[],i=0;i<n.length;i++)r=n[i],r.label==t.name&&(u=clone(r),u.parent=t.id,f.push(u));return f.sort(sortRule)}function initHub(){hubConnection==null&&(hubConnection=(new signalR.HubConnectionBuilder).withUrl("/chatHub").build(),hubConnection.SendMsg=(n,t,i)=>{var r=typeof n,u;if((r=="string"||r=="number")&&(r!="string"||chatEnum[n])){if(r=="number")for(u in chatEnum)if(chatEnum[u]==n){n=u;break}i&&hubConnection.off(n);hubConnection.on(n,t=>{console.log(`${n} Back Success`),i&&i(t)});hubConnection.invoke("SendMsg",{ChatEnum:chatEnum[n],Message:t})}},initHubCallBack());hubConnection.connection.connectionState!==1&&(check&&clearInterval(check),hubConnection.start().then(()=>{const n=getCookieTokenInfo();hubConnection.invoke("SendMsg",{ChatEnum:chatEnum.Connect,Message:n.id});checkFunc()}).catch(n=>{console.log(n.toString()),initHub()}))}function checkFunc(){check=setInterval(function(){hubConnection.connection.connectionState!==1&&initHub()},1e4)}function initHubCallBack(){hubConnection.on("Back",n=>{console.log(n)});hubConnection.on("Connect",n=>{console.log("Connect Success");var i=GetCookie("cid");if(i){const n=getCookieTokenInfo();hubConnection.invoke("SendMsg",{ChatEnum:chatEnum.RefreshId,Message:{Id:n.id,CId:i}})}const t=n.split(",");t.length>1&&t[0]==="Success"&&SetCookie("cid",t[1])});hubConnection.on("RefreshId",()=>{console.log("Refresh Success")});hubConnection.on("FaultDevice",n=>{var i=parseInt($(".rCnt").html()),t;$(".rCnt").html(++i);t=`<li>
                <a href="/RepairManagement">
                <h3>
                    <strong class="text-red">{0}</strong> 于<strong class="text-info">{1}</strong>发生故障
                </h3>
                </a>
            </li>`;$("#errLi .menu").append(t.format(n.Code,getFullTime()))})}var commonfunc=function(){if(!isTokenValid()){window.location.href=loginUrl;return}const n=getCookieTokenInfo();$("#nuser_name").text(n.name);$("#nuser_role").text(n.role.length>10?n.role.substring(0,10)+"...":n.role);$("#nuser_role").attr("title",n.role);$("#user_name").prepend(n.role.length>10?n.role.substring(0,10)+"...":n.role);$("#user_name").attr("title",n.role);$("#user_email").prepend(n.email);$("#logoutBtn").click(function(){const t={ChatEnum:chatEnum.Logout,Message:n.id};hubConnection.invoke("SendMsg",t);ajaxPost("/Account/Logout",null,function(){DelCookie("token");window.location.href=loginUrl})});$("#search-select").select2({allowClear:!0,placeholder:""});$("#search-select").on("select2:select",function(){$("#search-text").val($(this).find("option:selected").text());$("#search-text").css("backgroundColor","white")});$(".sidebar-menu li.mli").remove();ajaxGet("/Account/Pages",null,function(n){var t,u,h,f;if(n.errno!=0){layer.msg(n.msg);return}var y='<li>   <a class="menuitem" href="{0}"><i class="fa fa-circle-o"><\/i><span>{1}<\/span><\/a><\/li >',p='<option value="{0}">{1}<\/option>',c="",e="",r={parent:[]},l=n.datas;l.sort((n,t)=>n.order-t.order);$.each(l,(n,t)=>{isStrEmptyOrUndefined(t.url)||(c+=p.format(t.url,t.name.trim()));var i=t.parent;i==0?r.parent.push(t):r[i]?r[i].push(t):r[i]=[t]});$("#search-select").empty().append(`<option></option>${c}`);for(var a=window.location.pathname,o=!1,i=null,s=0,v=r.parent,w=v.length;s<w;s++)t=v[s],u=r[t.id],u?(h="",u.sort((n,t)=>n.order-t.order),$.each(u,(n,t)=>{h+=y.format(t.url,t.name),t.url==a&&(o=!0),i||(i=t.url)}),e+='<li class="mli treeview">    <a href="#">        <i class="mi fa {1}"><\/i><span class="mt">{2}<\/span>        <span class="pull-right-container">           <i class="fa fa-angle-left pull-right"><\/i>        <\/span>    <\/a>    <ul class="treeview-menu" id="{0}">{3}<\/ul><\/li>'.format(`main${t.id}`,t.icon,t.name,h)):(e+='<li class="mli">   <a class="menuitem" id="{0}" href="{1}">       <i class="mi fa {2}"><\/i><span class="mt">{3}<\/span>   <\/a><\/li>'.format(`main${t.id}`,t.url,t.icon,t.name),t.url==a&&(o=!0),i||(i=t.url));if($(".sidebar-menu").empty().append(e),i||(i="/"),!o){window.location=i;return}f=window.location.pathname;$("a.menuitem[href]").filter(function(){return this.pathname===f}).parent().addClass("active").parent().parent().addClass("active");f!=window.location.pathname&&(window.location=f)});initHub()},join=null,check=null,check1=null,check2=null;$(function(){$(".content").on("keydown",".form_date",function(n){n.keyCode==13&&$(this).blur()});$(".form_date").datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$(".form_time").on("click",function(){var n=$(this).val();$(this).val(n).timepicker("setTime",n);$(".bootstrap-timepicker-widget").find("input").off("input").on("input",function(){var n=$(this).val().replace(/[^\d]/g,"");$(this).val(n)})});$(".form_month").on("keydown",function(n){n.keyCode==13&&$(this).blur();$(".form_month").on("change",function(){isStrEmptyOrUndefined($(this).val())&&$(this).val(getNowMonth())})});$(".form_month").datepicker({language:"zh-CN",format:"yyyy-mm",startView:1,minViewMode:1,maxViewMode:2,autoclose:!0});$(".form_time").timepicker({format:"HH:mm:ss",language:"zh-CN",showMeridian:!1,minuteStep:1,showSeconds:!0,secondStep:1});$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"});commonfunc();typeof pageReady!="undefined"&&(pageReady(),$(".form_date,.form_month,.form_time").attr("readonly",!0));$(".modal").on("hidden.bs.modal",function(){$(".modal.in").size()>=1&&$("body").addClass("modal-open")});$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.select2.defaults.set("width","100%")});jQuery.extend(jQuery.fn.dataTableExt.oSort,{"html-percent-pre":function(n){var t=String(n).replace(/<[\s\S]*?>/g,"");return t=t.replace(/&amp;nbsp;/ig,""),t=t.replace(/%/,""),parseFloat(t)?parseFloat(t):0},"html-percent-asc":function(n,t){return n<t?-1:n>t?1:0},"html-percent-desc":function(n,t){return n<t?1:n>t?-1:0}});