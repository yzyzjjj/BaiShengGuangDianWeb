function searchPage(){var n=$("#search-select").val();isStrEmptyOrUndefined(n)||(window.location=n)}function sortRule(n,t){return typeof n=="object"?n.order==t.order?n.id>t.id?1:-1:n.order>t.order?1:-1:n>t?1:-1}function getParent(n){for(var r,t,e,u,f=[],o=0,i=0;i<PermissionPageTypes.length;i++)for(r=PermissionPageTypes[i],t=0;t<n.length;t++)if(e=n[t],e.label==r.name){u=clone(r);u.id=o--;f.push(u);break}return f}function getChild(n,t){for(var r,u,f=[],i=0;i<n.length;i++)r=n[i],r.label==t.name&&(u=clone(r),u.parent=t.id,f.push(u));return f.sort(sortRule)}function initHub(){hubConnection==null&&(hubConnection=(new signalR.HubConnectionBuilder).withUrl("/chatHub").build(),initHubCallBack());hubConnection.connection.connectionState!=1&&(hubConnection.start(),joinFunc())}function joinFunc(){join==null&&(join=setInterval(function(){if(hubConnection.connection.connectionState==1){var n=getCookieTokenInfo(),t={ChatEnum:chatEnum.Connect,Message:{Id:n.id}};hubConnection.invoke("SendMsg",t);clearInterval(join);join=null;check1Func()}},1e3))}function check1Func(){check1==null&&(check1=setInterval(function(){hubConnection.connection.connectionState==2&&(clearInterval(check1),check1=null,check2Func())},1e3))}function check2Func(){check2==null&&(check2=setInterval(function(){hubConnection.connection.connectionState==1&&(clearInterval(check2),check2=null);initHub()},1e4))}function initHubCallBack(){hubConnection.on("Default",()=>{console.log("connect success")});hubConnection.on("FaultDevice",n=>{var i=parseInt($(".rCnt").html()),t;$(".rCnt").html(++i);t='<li><a href="/RepairManagement"><h3><strong class="text-red">{0}<\/strong>于<strong class="text-info">{1}<\/strong>发生故障<\/h3><\/a><\/li> ';$("#errLi .menu").append(t.format(n.Code,getFullTime()))})}var commonfunc=function(){if(!isTokenValid()){window.location.href=loginUrl;return}var n=getCookieTokenInfo();$("#nuser_name").text(n.name);$("#nuser_role").text(n.role.length>10?n.role.substring(0,10)+"...":n.role);$("#nuser_role").attr("title",n.role);$("#user_name").prepend(n.role.length>10?n.role.substring(0,10)+"...":n.role);$("#user_name").attr("title",n.role);$("#user_email").prepend(n.email);$("#logoutBtn").click(function(){var n=getCookieTokenInfo(),t={ChatEnum:chatEnum.Logout,Message:{Id:n.id}};hubConnection.invoke("SendMsg",t);ajaxPost("/Account/Logout",null,function(){DelCookie("token");window.location.href=loginUrl})});$("#search-select").select2({allowClear:!0,placeholder:""});$("#search-select").on("select2:select",function(){$("#search-text").val($(this).find("option:selected").text());$("#search-text").css("backgroundColor","white")});$(".sidebar-menu li.mli").remove();ajaxGet("/Account/Pages",null,function(n){var f,e,o;if(n.errno!=0){layer.msg(n.msg);return}var v='<option value="{0}">{1}<\/option>',s=n.datas;$("#search-select").empty();$("#search-select").append("<option><\/option>");$.each(s,function(n,t){isStrEmptyOrUndefined(t.url)||$("#search-select").append(v.format(t.url,t.name.trim()))});var l=window.location.pathname,h=!1,a=getParent(s),u=null;for(f=0;f<a.length;f++){var r=a[f],c=getChild(s,r),t=null,i=null;if(r.noChild)i=c[0],i.url==l&&(h=!0),u||(u=i.url),t=$('<li class="mli">   <a class="menuitem">       <i class="mi fa"><\/i> <span class="mt"><\/span>   <\/a><\/li>').clone(),t.find(".menuitem").attr("id","main"+r.id),t.find(".menuitem").attr("href",i.url),t.find("i.mi").addClass(r.icon),t.find("span.mt").text(r.name),$(".sidebar-menu").append(t);else for(t=$('<li class="mli treeview">    <a href="#">        <i class="mi fa"><\/i> <span class="mt"><\/span>        <span class="pull-right-container">           <i class="fa fa-angle-left pull-right"><\/i>        <\/span>    <\/a>    <ul class="treeview-menu">    <\/ul><\/li>').clone(),t.find(".treeview-menu").attr("id","main"+r.id),t.find("i.mi").addClass(r.icon),t.find("span.mt").text(r.name),$(".sidebar-menu").append(t),e=0;e<c.length;e++)i=c[e],i.url==l&&(h=!0),u||(u=i.url),t=$('<li>   <a class="menuitem" > <i class="fa fa-circle-o"><\/i><span><\/span><\/a><\/li >').clone(),t.find(".treeview-menu").attr("id","main"+i.id),t.find("a").attr("href",i.url),t.find("span").text(i.name.trim()),$(".sidebar-menu").find("[id=main"+i.parent+"]").append(t)}if(u||(u="/"),!h){window.location=u;return}o=window.location.pathname;$("a.menuitem[href]").filter(function(){return this.pathname===o}).parent().addClass("active").parent().parent().addClass("active");o!=window.location.pathname&&(window.location=o)});initHub()},join=null,check1=null,check2=null;$(function(){$(".content").on("keydown",".form_date",function(n){n.keyCode==13&&$(this).blur()});$(".form_date").datepicker({language:"zh-CN",format:"yyyy-mm-dd",maxViewMode:2,todayBtn:"linked",autoclose:!0});$(".form_time").on("click",function(){var n=$(this).val();$(this).val(n).timepicker("setTime",n);$(".bootstrap-timepicker-widget").find("input").off("input").on("input",function(){var n=$(this).val().replace(/[^\d]/g,"");$(this).val(n)})});$(".form_month").on("keydown",function(n){n.keyCode==13&&$(this).blur();$(".form_month").on("change",function(){isStrEmptyOrUndefined($(this).val())&&$(this).val(getNowMonth())})});$(".form_month").datepicker({language:"zh-CN",format:"yyyy-mm",startView:1,minViewMode:1,maxViewMode:2,todayBtn:"linked",autoclose:!0});$(".form_time").timepicker({format:"HH:mm:ss",language:"zh-CN",showMeridian:!1,minuteStep:1,showSeconds:!0,secondStep:1});$(".icb_minimal").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"});commonfunc();typeof pageReady!="undefined"&&(pageReady(),$(".form_date,.form_month,.form_time").attr("readonly",!0));$(".modal").on("hidden.bs.modal",function(){$(".modal.in").size()>=1&&$("body").addClass("modal-open")});$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.select2.defaults.set("width","100%")});jQuery.extend(jQuery.fn.dataTableExt.oSort,{"html-percent-pre":function(n){var t=String(n).replace(/<[\s\S]*?>/g,"");return t=t.replace(/&amp;nbsp;/ig,""),t=t.replace(/%/,""),parseFloat(t)?parseFloat(t):0},"html-percent-asc":function(n,t){return n<t?-1:n>t?1:0},"html-percent-desc":function(n,t){return n<t?1:n>t?-1:0}});